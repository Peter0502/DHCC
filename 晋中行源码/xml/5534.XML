<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11111111100000000000000000000000" TITLE="5534 扣税交易历史查询"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
  commsend_001();
    //$FD44=#TX_DATE;
    //$FD16=$TXNO;
}"
</COMMSEND>
<COMMRECV>"{
    commrecv_001();
}"
</COMMRECV>
<VARIABLE UPLOOP="TRUE">
  <ITEM LINE="3"  COL="3" TYPE="%-50s" FUNCTIONS=
    "T(5534                          扣税交易历史查询)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#DOLIST" TYPE="%-1s" FUNCTIONS="">
  <ONLOSTFOCUS>"{
    if(#DOLIST!=''){
        dim  @tota as string;
        dim  @filename as string;
        dim  @selid as number;
        dim  @taxorgcode as string;
        dim  @wtdate as string;
        dim  @tranno  as string;
        dim  @packno  as string;
        dim  @payeebankno  as string;
        dim  @payeeorgcode  as string;
        dim  @payeeacct  as string;
        dim  @payeename  as string;
        dim  @paybkcode  as string;
        dim  @payopbkcode  as string;
        dim  @payacct  as string;
        dim  @handorgname  as string;
        dim  @traamt  as string;
        dim  @taxvouno  as string;
        dim  @billdate  as string;
        dim  @taxpaycode  as string;
        dim  @taxpayname  as string;
        dim  @protocolno  as string;
        dim  @taxtypenum  as string;
        dim  @trecode  as string;
        dim  @corpcode as string;
        dim  @result  as string;
        dim  @addword  as string;
        dim  @msgref  as string;
        dim  @statname  as string;
        dim  @jsfs      as string;
        dim  @cfxno     as string;
        @selid=list_work();
        if(@selid &lt; 0){
            list_del();
            rerun();
            return(true);
        }
        @selid=list_getselid();
        @taxorgcode=rtrim(list_gettext(@selid,0));    //征收机关
        @wtdate=rtrim(list_gettext(@selid,1));        //委托日期
        @tranno=rtrim(list_gettext(@selid,2));        //交易流水
        @packno=rtrim(list_gettext(@selid,3));        //包流水
        @payeebankno=rtrim(list_gettext(@selid,4));   //收款行行号
        @payeeorgcode=rtrim(list_gettext(@selid,5));  //收款单位代码
        @payeeacct=rtrim(list_gettext(@selid,6));     //收款人帐号
        @payeename=rtrim(list_gettext(@selid,7));     //收款人名称
        @paybkcode=rtrim(list_gettext(@selid,8));     //付款行行号
        @payopbkcode=rtrim(list_gettext(@selid,9));   //付款人开户行行号
        @payacct=rtrim(list_gettext(@selid,10));      //付款帐号
        @handorgname=rtrim(list_gettext(@selid,11));  //缴款单位名称
        @traamt=rtrim(list_gettext(@selid,12));       //交易金额
        @taxvouno=rtrim(list_gettext(@selid,13));     //税票号码
        @billdate=rtrim(list_gettext(@selid,14));     //出票日期
        @taxpaycode=rtrim(list_gettext(@selid,15));   //纳税人编码
        @taxpayname=rtrim(list_gettext(@selid,16));   //纳税人名称
        @protocolno=rtrim(list_gettext(@selid,17));   //协议书号
        @taxtypenum=rtrim(list_gettext(@selid,18));   //税种条数
        @result=rtrim(list_gettext(@selid,21));       //处理结果
        @addword=rtrim(list_gettext(@selid,22));      //处理附言
        @msgref=rtrim(list_gettext(@selid,23));       //报文参考号
        @statname=rtrim(list_gettext(@selid,24));     //记录状态
        @jsfs =rtrim(list_gettext(@selid,25));       //缴费方式
        @cfxno=rtrim(list_gettext(@selid,26));       //报文编号
        @filename='CFX_KSMX.XML';
        //showmsg(@filename);
        open(@filename,'#TAX_ORG_CODE='+@taxorgcode+';#WT_DATE='+@wtdate+';#TRAN_NO='+@tranno+';#PACK_NO='+@packno+';#PAYEE_BANK_NO='+@payeebankno+';#PAYEE_ORG_CODE='+@payeeorgcode+';#PAYEE_ACCT='+@payeeacct+';#PAYEE_NAME='+@payeename+';#PAY_BK_CODE='+@paybkcode+';#PAY_OPBK_CODE='+@payopbkcode+';#PAY_ACCT='+@payacct+';#HAND_ORG_NAME='+@handorgname+';#TRAAMT='+@traamt+';#TAX_VOU_NO='+@taxvouno+';#BILL_DATE='+@billdate+';#TAX_PAY_CODE='+@taxpaycode+';#TAX_PAY_NAME='+@taxpayname+';#PROTOCOL_NO='+@protocolno+';#TAX_TYPE_NUM='+@taxtypenum+';#RESULT='+@result+';#ADDWORD='+@addword+';#MSG_REF='+@msgref+';#KSSTAT='+@statname+';#JSFS='+@jsfs+';#CFQF='+@cfxno+';');
        return(true);
    }
    list_del();
    #DOLIST='';
    return(true);
  }"</ONLOSTFOCUS></ITEM>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=5556)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>

  <ITEM LINE="10" COL="20" TYPE="%-12s" FUNCTIONS="T(交 易 机 构:)"/>
  <ITEM LINE="11" COL="20" TYPE="%-12s" FUNCTIONS="T(接 收 日 期:)"/>
  <ITEM LINE="11" COL="50" TYPE="%-18s" FUNCTIONS="T(一般是税务机关日期:)"/>
  <ITEM LINE="12" COL="20" TYPE="%-12s" FUNCTIONS="T(交 易 序 号:)"/>
  <ITEM LINE="13" COL="20" TYPE="%-12s" FUNCTIONS="T(包流水序号:)"/>
  <ITEM LINE="14" COL="20" TYPE="%-14s" FUNCTIONS="T(征税机关代码:)"/>
  <ITEM LINE="15" COL="20" TYPE="%-12s" FUNCTIONS="T(交 易 状 态:)"/>
  <ITEM LINE="16" COL="20" TYPE="%-12s" FUNCTIONS="T(纳税人编码:)"/>
  <ITEM LINE="17" COL="20" TYPE="%-12s" FUNCTIONS="T(扣税方式:!)"/>

  <!--输入变量-->
  <ITEM NAME="#INIT" TYPE="%-1s" FUNCTIONS="">
    <ONLOSTFOCUS>"{
        if($KINBR=='50001'){
            enable(#TX_BR_NO,true);
        }
    "}</ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#TX_BR_NO"   LINE="10" COL="32"  TYPE="%-5s"    ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="T($KINBR)"/>
  <ITEM NAME="#WT_DATE"    LINE="11" COL="32"  TYPE="%-8d"    INPUT="TEXT" FUNCTIONS="T($HDATE)D()"/>
  <ITEM NAME="#TRANO"      LINE="12" COL="32"  TYPE="%-8s"    INPUT="TEXT" FUNCTIONS="T()"/>
  <ITEM NAME="#PACKNO"     LINE="13" COL="32"  TYPE="%-8s"    INPUT="TEXT" FUNCTIONS=""/>
  <ITEM NAME="#TAXORGCODE" LINE="14" COL="34"  TYPE="%-12s"   INPUT="TEXT" FUNCTIONS=""/>
  <ITEM NAME="#JYSTAT"     LINE="15" COL="32"  TYPE="%-1s"    INPUT="SELECT" FUNCTIONS="">
    <SELECT LINE="15" COL="45" >
        <OPTION VALUE="9"     TITLE="9.全部"/>
        <OPTION VALUE="0"     TITLE="0.正式接收"/>
        <OPTION VALUE="1"     TITLE="1.扣税成功"/>
        <OPTION VALUE="2"     TITLE="2.扣税失败"/>
        <OPTION VALUE="3"     TITLE="3.被冲正或止付"/>
    </SELECT></ITEM>
 
  <ITEM NAME="#TAXPAYCODE" LINE="16" COL="32" TYPE="%-20s" INPUT="TEXT" FUNCTIONS=""/>
  <ITEM NAME="#FQF" LINE="17" COL="32" TYPE="%-4s" INPUT="SELECT" FUNCTIONS="">
  <SELECT LINE="15" COL="45" >
        <!--<OPTION VALUE="1008"     TITLE="银行端缴款"/>-->
        <OPTION VALUE="3001"     TITLE="实时扣税"/>
        <OPTION VALUE="3102"     TITLE="批量扣税"/>

    </SELECT></ITEM>
  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  <ITEM NAME="#RETSTAT" TYPE="%-4s" FUNCTIONS="T()"/>

  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
  <ONCLICK>"{
        dim @tota as string;
        initfd();
        commsend_001();
        $FD16=$TXNO;
        $FD28=#TRANO;
        $FD44=#WT_DATE;
        $FD52=#TAXORGCODE;
        $FD62=#TAXPAYCODE;
        $FD67=#JYSTAT;
        $FD78=#PACKNO;
        $FD91=#TX_BR_NO;
        $FD92=#FQF;               //发起方
        //@tota=callserver();       chengbo    20090619      callserver换成calltips
        @tota=calltips();    
        if($FD12!='0000'){
            showmsg(geterror());
            rerun();
            return(true);
        }
        if(autolist(@tota)){
        //    list_work();
        }
        #DOLIST='1';
      }"
  </ONCLICK>
  </ITEM>
    
</VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
    <PACKAGE DEVICE="SCREEN" DESC="显示内容" >
    NOTHING
    </PACKAGE>
</RESPONSE>
</TRANSACTION>
