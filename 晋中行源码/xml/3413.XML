<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="00000000" TITLE="3413 卡限额维护"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	commsend_001();
	
	
	$FD39 = itoa(#DAYMONEY*100,'%16.0f');
	showmsg($FD39);
	$FD40 = itoa(#DAYDRAW*100,'%16.0f');
	$FD41 = itoa(#DAYCONSUME*100,'%16.0f');
	$FD42 = itoa(#MONEYOVERDRAFT*100,'%16.0f');
	$FD43 = itoa(#TOTALOVERDRAFT*100,'%16.0f');
	$FD67 = '1';
	$FD100= itoa(#MONTYMONEY*100,'%16.0f')+itoa(#MONTHDRAW*100,'%16.0f')+
			itoa(#MONTHCONSUME*100,'%16.0f');
    $FD114 =space(1)+#CHOOSEPASSWORD+space(6)+#PASSWD+#CHOOSECERTIFICATE+#CERTIFICATE+space(1)+#CERTIFYTYPE+space(2);
    $FD102 = #MAINCARDNO+space(359);
}"
</COMMSEND>
<COMMRECV>"{
		commrecv_001();
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(3413                       卡限额维护)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=2413)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  
  <!--输入变量-->
  
  <ITEM LINE="6" COL="9" TYPE="%-9s" FUNCTIONS="T(主 卡 号:)"/>
  <ITEM LINE="7" COL="9" TYPE="%-9s" FUNCTIONS="T(姓    名:)"/>
  <ITEM LINE="8" COL="9" TYPE="%-9s" FUNCTIONS="T(密码支取:)"/>
  <ITEM NAME = "#LBPSW"  LINE="8" COL="44" TYPE="%-9s" VISABLE="FALSE" FUNCTIONS="T(支取密码:)"/>
 <ITEM LINE="9" COL="9" TYPE="%-9s" FUNCTIONS="T(证件支取:)"/>
  <ITEM NAME="#LBCERTYPE" LINE="9" COL="44" TYPE="%-9s" VISABLE="FALSE"  FUNCTIONS="T(证件类型:)"/>
  <ITEM NAME="#LBCERT" LINE="10"COL="9" TYPE="%-9s" VISABLE="FALSE"  FUNCTIONS="T(证件号码:)"/>

  <ITEM LINE="12" COL="9"TYPE="%-65s"    FUNCTIONS="T(------------------------------------------------------------------)"/>

  <ITEM LINE="14" COL="9" TYPE="%-9s" FUNCTIONS="T(副 卡 号:)"/>

  <ITEM LINE="15" COL="9" TYPE="%-13s" FUNCTIONS="T(每日取现限额:)"/>
  <ITEM LINE="15" COL="44" TYPE="%-13s" FUNCTIONS="T(每月取现限额:)"/>
  <ITEM LINE="16" COL="9" TYPE="%-13s" FUNCTIONS="T(每日取款限额:)"/>
  <ITEM LINE="16" COL="44" TYPE="%-13s" FUNCTIONS="T(每月取款限额:)"/>
  <ITEM LINE="17" COL="9" TYPE="%-13s" FUNCTIONS="T(每日消费限额:)"/>
  <ITEM LINE="17" COL="44" TYPE="%-13s" FUNCTIONS="T(每月消费限额:)"/>
  <ITEM LINE="19" COL="9" TYPE="%-13s" FUNCTIONS="T(现金透支限额:)"/>
  <ITEM LINE="19" COL="44" TYPE="%-13s" FUNCTIONS="T(总计透支限额:)"/>

 <ITEM NAME="#MAINCARDNO" INPUT="TEXT" LINE="6" COL="18" TYPE="%-19s" FUNCTIONS="V(NB)T()">
  <ONLOSTFOCUS>
"{
    dim @spa as string ;
    @spa =  space(118);
    $FD102 = #MAINCARDNO+space(359);
    commsend_001();
    $FD16 = '9709';
    $FD67 = '1';
    callserver();
    if($FD12!='0000')
    {
        showmsg(geterror());
        return (false);
    }
    #USERNAME  =  $FD25;
    #CHOOSEPASSWORD = substr($FD114,1,1);
    #CHOOSECERTIFICATE = substr($FD114,14,1);
    
    if(#CHOOSEPASSWORD=='Y')
    {
        show(#LBPSW,true);
        show(#PASSWD,true);
    }
    if(#CHOOSECERTIFICATE=='Y')
    {
        show(#LBCERTYPE,true);
        show(#LBCERT,true);
        show(#CERTIFYTYPE,true);
        show(#CERTIFICATE,true);
        #CERTIFYTYPE = substr($FD114,36,1);
		show(#CHOOSECERTIFICATE,true);
    }
	show(#USERNAME,true);
    show(#CHOOSEPASSWORD,true);
	show(#CHOOSECERTIFICATE,true);
 

}"
</ONLOSTFOCUS>
</ITEM>
  <ITEM NAME="#USERNAME" INPUT="TEXT"  LINE="7" COL="18" TYPE="%-50s" FUNCTIONS=""/>
  <ITEM NAME="#CHOOSEPASSWORD"   INPUT="SELECT"  LINE="8" COL="18" TYPE="%1s" FUNCTIONS="G(N,#CHOOSECERTIFICATE)">
      <SELECT>
		<OPTION VALUE="N" TITLE="0.否"/>
		<OPTION VALUE="Y" TITLE="1.是"/>
     </SELECT>
  </ITEM>
  <ITEM NAME="#PASSWD"   INPUT="TEXT"  LINE="8" COL="53" TYPE="%-6s" VISABLE="FALSE" DEVICE="PINPAD" FUNCTIONS="i()"/>
  <ITEM NAME="#CHOOSECERTIFICATE" INPUT="SELECT"  LINE="9" COL="18" TYPE="%1s" FUNCTIONS="V(NB)">
      <SELECT>
		<OPTION VALUE="N" TITLE="0.否"/>
		<OPTION VALUE="Y" TITLE="1.是"/>
     </SELECT>
  </ITEM>
    <ITEM NAME="#CERTIFYTYPE"   INPUT="SELECT"  LINE="9" COL="53" TYPE="%1s" VISABLE="false"  FUNCTIONS="">
	<SELECT>
	<OPTION VALUE="1" TITLE="1 身份证"/>
	<OPTION VALUE="2" TITLE="2 户口簿"/>
	<OPTION VALUE="3" TITLE="3 护照"/>
	<OPTION VALUE="4" TITLE="4 军官证"/>
	<OPTION VALUE="5" TITLE="5 回乡证"/>
	<OPTION VALUE="8" TITLE="8 企业代码证"/>
	<OPTION VALUE="9" TITLE="9 经营许可证"/>
  </SELECT>
  </ITEM>
  <ITEM NAME="#CERTIFICATE"   INPUT="TEXT"  LINE="10" COL="18" TYPE="%-20s"  VISABLE="false" FUNCTIONS=""/>
 
 <ITEM NAME="#SENDCARDNO"      INPUT="TEXT" LINE="14" COL="18" TYPE="%-19s" FUNCTIONS="">
<ONLOSTFOCUS>
"{
	initfd();
    commsend_001();
	$FD16 = '9715';
	$FD31 = #SENDCARDNO;
	callserver();
	if($FD12!='0000')
	{
		showmsg(geterror());
		return (false);
    }
    
	#DAYMONEY = val($FD39, 0.01);
	#MONTYMONEY = val(substr($FD100,0,16), 0.01);
	#DAYDRAW = val($FD40, 0.01);
	#MONTHDRAW = val(substr($FD100,16,16), 0.01);
	#DAYCONSUME = val($FD41, 0.01);
	#MONTHCONSUME = val(substr($FD100,32,16), 0.01);
	#MONEYOVERDRAFT = val($FD42, 0.01);
	#TOTALOVERDRAFT = val($FD43, 0.01);
//    #AVL1 = $FD39;
//    #AVL2 = substr($FD100,0,16);
//    #AVL3 = $FD40;
//    #AVL4 = substr($FD100,16,16);
//    #AVL5 = $FD41;
//    #AVL6 = substr($FD100,32,16);
//    #AVL7 = $FD42;
//    #AVL8 = $FD43;
   	
}"
</ONLOSTFOCUS>
</ITEM>
 <ITEM NAME="#AVL1"            TYPE="%16s"       FUNCTIONS="X(#DAYMONEY)"/>
 <ITEM NAME="#DAYMONEY"        INPUT="TEXT" LINE="15" COL="22" TYPE="%17.2f" FUNCTIONS="J(#AVL1)"/>
 <ITEM NAME="#AVL2"            TYPE="%16s"       FUNCTIONS="X(#MONTYMONEY)"/>
 <ITEM NAME="#MONTYMONEY"      INPUT="TEXT" LINE="15" COL="57" TYPE="%17.2f" FUNCTIONS="J(#AVL2)"/>
 <ITEM NAME="#AVL3"            TYPE="%16s"       FUNCTIONS="X(#DAYDRAW)"/>
 <ITEM NAME="#DAYDRAW"         INPUT="TEXT" LINE="16" COL="22" TYPE="%17.2f" FUNCTIONS="J(#AVL3)"/>
 <ITEM NAME="#AVL4"            TYPE="%16s"       FUNCTIONS="X(#MONTHDRAW)"/>
 <ITEM NAME="#MONTHDRAW"       INPUT="TEXT" LINE="16" COL="57" TYPE="%17.2f" FUNCTIONS="J(#AVL4)"/>
 <ITEM NAME="#AVL5"            TYPE="%16s"       FUNCTIONS="X(#DAYCONSUME)"/>
 <ITEM NAME="#DAYCONSUME"      INPUT="TEXT" LINE="17" COL="22" TYPE="%17.2f" FUNCTIONS="J(#AVL5)"/>
 <ITEM NAME="#AVL6"            TYPE="%16s"       FUNCTIONS="X(#MONTHCONSUME)"/>
 <ITEM NAME="#MONTHCONSUME"    INPUT="TEXT" LINE="17" COL="57" TYPE="%17.2f" FUNCTIONS="J(#AVL6)"/>
 <ITEM NAME="#AVL7"            TYPE="%16s"       FUNCTIONS="X(#MONEYOVERDRAFT)"/>
 <ITEM NAME="#MONEYOVERDRAFT"  INPUT="TEXT" LINE="19" COL="22" TYPE="%17.2f" FUNCTIONS="J(#AVL7)"/>
 <ITEM NAME="#AVL8"            TYPE="%16s"       FUNCTIONS="X(#TOTALOVERDRAFT)"/>
 <ITEM NAME="#TOTALOVERDRAFT"  INPUT="TEXT" LINE="19" COL="57" TYPE="%17.2f" FUNCTIONS="J(#AVL8)"/>
 <ITEM NAME="#SPACE64"            TYPE="%64s"       FUNCTIONS=""/>
  
   
  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
 <ITEM NAME="#CONFIRM"  LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
	<PACKAGE DEVICE="SCREEN" DESC="卡限额维护!">
      NOTHING
	</PACKAGE>
	<PRINT>"{
	  print(8,30,' 限额维护成功!');
	  print(10,20,'主卡卡号:[19]',#MAINCARDNO);
	  print(11,20,'副卡卡号:[19]',#SENDCARDNO);
	}"
	</PRINT>
</RESPONSE>
<RESPONSE>
	<PACKAGE DEVICE="PRINTER" DESC="请打印业务专用凭证">
      NOTHING
	</PACKAGE>
	<PRINT>"{
	  print(8,30,' 限额维护普通凭证');
	  print(10,20,'主卡卡号:[19]',#MAINCARDNO);
	  print(11,20,'副卡卡号:[19]',#SENDCARDNO);
	  print(12,20,'流 水 号:[ 6]',$FD4);
	}"
	</PRINT>
</RESPONSE>
</TRANSACTION>
