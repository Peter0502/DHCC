<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="00000110" TITLE="8104    批量处理日期维护"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
     commsend_001();
     $MSGTYPE='03001';
     dim @baktxno as string;
     @baktxno=$TXNO;
     $TXNO = '9986';
     $FD12 = '6104';
     $FD21=#AGENTYPE;
     $FD25=#DWNAME; 
     $FD44=#BATCHSDATE;
     $FD47=#BATCHEDATE;
     $FD71=#YWTYPE;
     $FD92=#DWID;
     commsend_001();
     callserver();
     $TXNO=@baktxno;
     if($FD12!='0000')
     {
        showmsg(geterror());
        return(false);
     }
     $FD16 = '6104';
     $MSGTYPE='03001';
     
}"
</COMMSEND>
<COMMRECV>"{
commrecv_001();
if($FD12 == '0000')
	 {
		 showmsg('交易成功!');
	 }
}"
</COMMRECV>

<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-52s" FUNCTIONS=
    "T(8104                           批量处理日期维护)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=6104)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  
  <ITEM LINE="7"   COL="10"   TYPE="%-10s" FUNCTIONS="T(单位编号:)"/>
  <ITEM LINE="7"   COL="26"   TYPE="%-10s" FUNCTIONS="T(业务性质:!)" />
  <ITEM LINE="7"   COL="48"   TYPE="%-10s" FUNCTIONS="T(代理类型:!)" />
  <ITEM LINE="9"   COL="10"   TYPE="%-10s" FUNCTIONS="T(单位名称:)" />

  <ITEM LINE="11"  COL="10"   TYPE="%-12s" FUNCTIONS="T(批处理时间:)"/>
  <ITEM LINE="11"  COL="30"   TYPE="%-2s" FUNCTIONS="T(→)"/>
   
  <ITEM LINE="7"   COL="21"  NAME="#DWID"        TYPE="%-4s"        INPUT="TEXT"    FUNCTIONS="">
   <ONLOSTFOCUS>
		"{
		    dim @txno_bak as string;
        @txno_bak=$TXNO;
		    $TXNO='9841';
		    $FD92=#DWID;
		    commsend_001();		
		    callserver();
		    if($FD12!='0000')
		    {
			    showmsg(geterror());
			    return(false);
		    }
		    $TXNO=@txno_bak;
		    #DWNAME=delspace($FD25);
		    #YWTYPE=delspace($FD71);
		    #AGENTYPE=delspace($FD21);
		    enable(#DWNAME,false);
		    enable(#YWTYPE,false);
		    enable(#AGENTYPE,false);
		}"
	 </ONLOSTFOCUS>
  </ITEM>  
  <ITEM LINE="7"  COL="37"  NAME="#YWTYPE"      TYPE="%-1s"        INPUT="SELECT"  FUNCTIONS="T(0)">
    <SELECT>
       <OPTION VALUE ="0" TITLE="0.代收" />
       <OPTION VALUE ="1" TITLE="1.代付" />
    </SELECT>
  </ITEM>
  <ITEM LINE="7"  COL="60"  NAME="#AGENTYPE"    TYPE="%-2s"        INPUT="SELECT"  FUNCTIONS="T(30)">
   <SELECT>
       <OPTION VALUE ="30" TITLE="30.代发工资       " />
       <OPTION VALUE ="31" TITLE="31.财政工资       " />
       <OPTION VALUE ="32" TITLE="32.代发自来水工资 " />
       <OPTION VALUE ="33" TITLE="33.批量贷记       " />
       <OPTION VALUE ="35" TITLE="35.现金代发       " />
       <OPTION VALUE ="37" TITLE="37.代发定活       " />
       <OPTION VALUE ="38" TITLE="38.代发整整       " />
       <OPTION VALUE ="39" TITLE="39.代发零整       " />
       <OPTION VALUE ="40" TITLE="40.代扣费         " />
       <OPTION VALUE ="41" TITLE="41.代收个人所得税 " />
       <OPTION VALUE ="42" TITLE="42.代收罚款       " />
       <OPTION VALUE ="43" TITLE="43.代收水费       " />
       <OPTION VALUE ="44" TITLE="44.代收煤气费     " />
       <OPTION VALUE ="45" TITLE="45.代收电费       " />
       <OPTION VALUE ="46" TITLE="46.代收税款       " />
       <OPTION VALUE ="47" TITLE="47.代收话费       " />
       <OPTION VALUE ="48" TITLE="48.代收移动费    " />
    </SELECT>          
  </ITEM>
  <ITEM LINE="9"   COL="21"   NAME="#DWNAME"         TYPE="%-50s"       INPUT="TEXT"  FUNCTIONS=""/>  
  <ITEM LINE="11"  COL="22"   NAME="#BATCHSDATE"     TYPE="%-8s"        INPUT="TEXT"  FUNCTIONS="">
  <ONLOSTFOCUS>
		"{
			if(#BATCHSDATE &lt;$HDATE)
			  {
				 showmsg('批处理日期不能小于当前日期!');
				 return(false);
				}
		}"
	</ONLOSTFOCUS>
	 </ITEM>
  <ITEM LINE="11"   COL="32"  NAME="#BATCHEDATE"     TYPE="%-8s"        INPUT="TEXT"    FUNCTIONS=""/>
	 <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  <ITEM NAME="#NAME1"  TYPE="%-20s" FUNCTIONS="S(#YWTYPE,#YWTYPE)"/>
  <ITEM NAME="#NAME2"  TYPE="%-20s" FUNCTIONS="S(#AGENTYPE,#AGENTYPE)"/>
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
  <ITEM NAME="#YEAR"  TYPE="%-4s" FUNCTIONS="T($HDATE,1,4)"/>
  <ITEM NAME="#MON"   TYPE="%-2s" FUNCTIONS="T($HDATE,5,2)"/>
  <ITEM NAME="#DAY"   TYPE="%-2s" FUNCTIONS="T($HDATE,7,2)"/>
  </VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
	<PACKAGE DEVICE="SCREEN" DESC="批量处理日期维护!">
 NOTHING
 </PACKAGE>
  <PRINT>"{
          print( 2,  24,'交易名称:批量处理日期维护');
          
          print( 4,  20,'交易机构:[5]',$FD2);
	  print( 5,  20,'交易日期:[4]年[2]月[2]日',#YEAR,#MON,#DAY);  
	  print( 6,  20,'流水号码:[6]',$FD4);
	  print( 7,  20,'操作员号:[4]',$FD7);
	  
	  print( 8,  20,'单位编号:[4 ]',#DWID);
	  print( 9,  20,'单位名称:[50 ]',#DWNAME);
	  print( 10, 20,'业务性质:[4  ]',#NAME1);
	  print( 11, 20,'代理类型:[20 ]',#NAME2);
	  print( 11, 20,'处理时间:[8 ]--[8 ]',#BATCHSDATE,#BATCHEDATE);
	  
	}"
</PRINT>
</RESPONSE>

<RESPONSE>
	<PACKAGE DEVICE="PRINTER" DESC="请打印业务专用凭证">
 NOTHING
 </PACKAGE>
  <PRINT>"{
        $KINDNO='00';
        dim @txtime  as string;
        @txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
        print( 5, 20,'机构名称:[30]',$BRNAME);
        print( 5, 2,'代码:8104');
        print( 5, 13,'交易:批量处理日期维护');
	print( 7, 20,'单位编号:[4 ]',#DWID);
	print( 8, 20,'单位名称:[50 ]',#DWNAME);
	print( 9, 20,'业务性质:[4  ]',#NAME1);
	print( 10, 20,'代理类型:[20 ]',#NAME2);
	print( 11, 20,'处理时间:[8 ]--[8 ]',#BATCHSDATE,#BATCHEDATE);
	print( 24,20,'备注:')
        print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
        print( 24,5,'柜员:[4]',$FD7);
        print( 24,5,'流水号:[6]',$FD4);
  
	}"
</PRINT>
</RESPONSE>
</TRANSACTION>
