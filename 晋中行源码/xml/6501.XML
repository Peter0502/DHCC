<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="00110000" TITLE="6501 债券投资买入信息维护"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
  <COMMSEND>"{
  		commsend_001();
		$FD23=#CPBH;	
		$FD67=#CZLX;
	}"
</COMMSEND>
<COMMRECV>"{
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-60s" FUNCTIONS=
    "T(6501                      债券投资买入信息维护  )"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
   <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=4601)"/>
   <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
   <!--输入变量 -->
  <ITEM LINE="7"   COL="3"  TYPE="%-10s" FUNCTIONS="T(操作类型:)"/>
  <ITEM LINE="7"   COL="36" TYPE="%-14s" FUNCTIONS="T(投资协议编号:)"/>
  <ITEM LINE="8"   COL="3"  TYPE="%-10s" FUNCTIONS="T(产品编号:)"/>
  <ITEM LINE="8"   COL="40" TYPE="%-10s" FUNCTIONS="T(产品名称:)"/>
  <ITEM LINE="11"  COL="5"  TYPE="%-14s" FUNCTIONS="T(买入债券品种: )"/>
  <ITEM LINE="12"  COL="5"  TYPE="%-10s" FUNCTIONS="T(买 入 价:)"/>
  <ITEM LINE="12"  COL="36" TYPE="%-10s" FUNCTIONS="T(票 面 价:)"/>
  <ITEM LINE="13"  COL="5"  TYPE="%-10s" FUNCTIONS="T(发行日期:)"/>
  <ITEM LINE="13"  COL="36" TYPE="%-10s" FUNCTIONS="T(债券期限:)"/>
  <ITEM LINE="13"  COL="57" TYPE="%-14s" FUNCTIONS="T(月 )"/>

  <ITEM LINE="14"   COL="5"  TYPE="%-12s" FUNCTIONS="T(购入日期:)"/>
  <ITEM LINE="14"   COL="36" TYPE="%-14s" FUNCTIONS="T(债券到期日期:)"/>

  <ITEM LINE="16"   COL="5"  TYPE="%-14s" FUNCTIONS="T(债券计息方式:)"/>
  <ITEM LINE="16"   COL="36" TYPE="%-10s" FUNCTIONS="T(年 利 率:)"/>
  <ITEM LINE="16"   COL="63" TYPE="%-6s"  FUNCTIONS="T(％)"/>

  <ITEM LINE="17"   COL="5"  TYPE="%-10s" FUNCTIONS="T(应计利息:)"/>
<!--  <ITEM LINE="17"   COL="36" TYPE="%-12s" FUNCTIONS="T(手续费金额:)"/>  -->
  <ITEM LINE="18"   COL="5"  TYPE="%-10s" FUNCTIONS="T(折价金额:)"/>
  <ITEM LINE="18"   COL="36" TYPE="%-10s" FUNCTIONS="T(溢价金额:)"/>


  <ITEM NAME="#CZLX"   INPUT="SELECT" LINE="7" COL="13" TYPE="%-1s" 	FUNCTIONS="T(0)"> 
  	<SELECT>
  		<OPTION VALUE="0" TITLE="录入"/>
  		<OPTION VALUE="1" TITLE="修改"/>
  		<OPTION VALUE="2" TITLE="删除"/>
  	</SELECT>
  </ITEM>
  <ITEM NAME="#SCZLX"   TYPE="%-4s"  	FUNCTIONS="S(#CZLX,#CZLX)"/>
  <ITEM NAME="#XYBH"    INPUT="TEXT" LINE="7" COL="49" TYPE="%-15s" 	FUNCTIONS="T()V(NB)">
  <ONLOSTFOCUS>
  "{
	$TXNO='9825';
	$FD58=#XYBH;
	$FD67=#CZLX;
	if('0' != #CZLX){
//		initfd();
		commsend_001();
		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
	}else{
		return(true);
	}

	#CPBH=$FD23;
	#MRJ= val($FD39, 0.01);
	#PMJ = val($FD40, 0.01);	
	#YJLX = val($FD41, 0.01);
	#YJJE = val($FD42, 0.01);	
	#ZJJE = val($FD43, 0.01);
	#FXRQ=$FD44;
	#DQRQ=$FD45;
	#GRRQ=$FD46;
	#ZQQX=$FD48;
	#JXFS=$FD68;
	#NLV=val($FD84, 0.000001);
	#ZQPZ=$FD86;
//	#SXF=val(substr($FD100, 32, 16), 0.01);
//	showmsg('fd68=['+$FD68+']jxfs=['+#JXFS+']');

	enable(#CPBH, false);
	enable(#MRJ, false);
	enable(#PMJ, false);
	enable(#YJLX, false);
	enable(#DQRQ, false);
	enable(#GRRQ, false);
	enable(#FXRQ, false);
	enable(#ZQQX, false);
	//enable(#JXFS, false);
	enable(#NLV, false);
	enable(#ZQPZ, false);
//  enable(#SXF, false);

if('1' == #CZLX){
	enable(#CPBH, true);
	enable(#MRJ, true);
	enable(#PMJ, true);
	enable(#YJLX, true);
	enable(#DQRQ, true);
	enable(#GRRQ, true);
	enable(#FXRQ, true);
	enable(#ZQQX, true);
	enable(#JXFS, true);
	enable(#NLV, true);
	enable(#ZQPZ, true);
//		enable(#SXF, true);
	}else{
		goitem(#FD);
	}
  }"
  </ONLOSTFOCUS>

   </ITEM>
   <ITEM NAME="#CPBH" INPUT="SELECT" LINE="8"  COL="13" TYPE="%-3s" 	FUNCTIONS="T(931)V(NB)">
  	<SELECT>
  		<OPTION VALUE="931" TITLE="短期国家债券 "/>
  		<OPTION VALUE="932" TITLE="短期金融债券 "/>
  		<OPTION VALUE="933" TITLE="其他短期债券 "/>
  		<OPTION VALUE="934" TITLE="投资长期债券面值 "/>
  	</SELECT>
	<ONLOSTFOCUS>
	"{
//		initfd();
		dim @txno as string;
		if('934' != #CPBH){
			#YJLX=0;
			#ZJJE=0;
			#YJJE=0;
			//#JXFS='2'; //短期
			enable(#YJLX, false);
			enable(#ZJJE, false);
			enable(#YJJE, false);
      show(#JXFS,true);
      enable(#JXFS,true);
		}else {
		  //#JXFS='4'; //长期
			enable(#YJLX, false);
			show(#JXFS,true);
      enable(#JXFS,true);
		}
		@txno=$TXNO;
		$TXNO='9824';
		$FD23=#CPBH;
		commsend_001();
		$TXNO=@txno;
		callserver();
		#CPMC=substr($FD81, 0, 30);	
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
	}"
	</ONLOSTFOCUS>
</ITEM>
   <ITEM NAME="#CPMC" INPUT="TEXT" LINE="8" COL="49" TYPE="%-30s" 	FUNCTIONS="V(NB)"/>
   <ITEM NAME="#JCMPC" TYPE="%-1s"/>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>

  <ITEM NAME="#ZQPZ" 	INPUT="TEXT" LINE="11" COL="19" TYPE="%-10s" 	FUNCTIONS="V(NB)"/>
  <ITEM NAME="#MRJ"	 LINE="12" COL="15" TYPE="%13.2f"  INPUT="TEXT"	FUNCTIONS="V(000000000001,999999999999)"/>
  <ITEM NAME="#PMJ"	 LINE="12" COL="51" TYPE="%13.2f" INPUT="TEXT"	FUNCTIONS="V(000000000001,999999999999)">
  <ONLOSTFOCUS>
  "{
		#ZJJE=#PMJ-#MRJ;
		#YJJE=0;
		if(#ZJJE &lt; 0){
			#ZJJE=0;
			#YJJE=#MRJ-#PMJ;
		}
    enable(#ZJJE, false);
    enable(#YJJE, false);
  }"
  </ONLOSTFOCUS>
  </ITEM>

  <ITEM NAME="#FXRQ"	 LINE="13" COL="15" TYPE="%-8s" INPUT="TEXT"    FUNCTIONS="V(NB)D()"/>
  <ITEM NAME="#ZQQX"	 LINE="13" COL="51" TYPE="%4d"  INPUT="TEXT"    FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
  "{
	if(#CPBH == '934')
	{
		if(#ZQQX &lt; '0013')
		{
			showmsg('投资长期债券面值的期限必须大于12个月');
			return(false);
		}
	}
	else
	{
			if(#ZQQX &gt; '0012')
			{
			showmsg('短期投资债券的期限必须小于等于12个月');
			return(false);
		}
	}
	#DQRQ=addmon(#FXRQ, val(#ZQQX));
	enable(#DQRQ, false);
  }"
  </ONLOSTFOCUS>
  </ITEM>

  <ITEM NAME="#GRRQ"	 LINE="14" COL="15" TYPE="%-8s" INPUT="TEXT"	FUNCTIONS="T()D()V(NB)"/>
  <ITEM NAME="#DQRQ"	 LINE="14" COL="51" TYPE="%-8s" INPUT="TEXT"	FUNCTIONS="T()D()V(NB)"/>

 <ITEM NAME="#JXFS"   INPUT="SELECT" LINE="16" COL="19" TYPE="%-1s"	FUNCTIONS="T(2)"> 
  	<SELECT>
  		<OPTION VALUE="2" TITLE="到期付息"/>
  		<OPTION VALUE="4" TITLE="按期计息"/>
  	</SELECT>
  </ITEM>
  <ITEM NAME="#SJXFS"	 TYPE="%-8s"  	FUNCTIONS="S(#JXFS,#JXFS)"/>
  <!--长期投资 应记利息#YJLX=票面金额PMJ * 年利率NLV * 期限ZQQX/12个月*0.01   -->
  <ITEM NAME="#NLV"	 LINE="16" COL="51" TYPE="%9.6f" INPUT="TEXT"	FUNCTIONS="V(NB)">
 <ONLOSTFOCUS>
  "{
	if(#CPBH == '934')
	{
		  #YJLX=#PMJ*#NLV*val(#ZQQX)/12*0.01;
		  enable(#YJLX, false);
	}
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#YJLX"	 LINE="17" COL="15" TYPE="%16.2f" INPUT="TEXT"	FUNCTIONS="V(NB)"/>
<!--  <ITEM NAME="#SXF"	 LINE="17" COL="51" TYPE="%16.2f" INPUT="TEXT"	FUNCTIONS="V(000000000000001,999999999999999)"/> -->

   <ITEM NAME="#ZJJE"	 LINE="18" COL="15" TYPE="%16.2f" INPUT="TEXT"	FUNCTIONS=""/>
  <ITEM NAME="#YJJE"	 LINE="18" COL="51" TYPE="%16.2f" INPUT="TEXT"	FUNCTIONS=""/>
  <ITEM NAME="#FD" TYPE="%-1s">
  <ONLOSTFOCUS>
  "{

		$FD39=itoa(#MRJ*100, '%016.0f');
		$FD40=itoa(#PMJ*100, '%016.0f');
		$FD41=itoa(#YJLX*100, '%016.0f');
		$FD42=itoa(#YJJE*100, '%016.0f');
		$FD43=itoa(#ZJJE*100, '%016.0f');
		$FD44=#FXRQ;
		$FD45=#DQRQ;
		$FD46=#GRRQ;
		$FD48=#ZQQX;

		$FD68=#JXFS;
		$FD81=#CPMC+space(30);
		$FD84=itoa(#NLV*1000000, '%08.0f');
		//showmsg('84=['+$FD84+'?=['+itoa(#NLV*1000000, '%016.0f')+']');
		$FD86=#ZQPZ;
		$FD12='4601';
//		$FD100=space(32)+itoa(#SXF*100, '%016.0f');
//收费信息检查 不要了
 // 		$FD12='4601';
//		$TXNO='9986';
//		commsend_001();
//		showmsg('$84=['+$FD84+']');
//		callserver();
//		if($FD12!='0000'){
//			showmsg(geterror());
//			return(false);
//		}
// 恢复主交易代码
		$FD12='';
		$TXNO='4601';
  }"
  </ONLOSTFOCUS>
  </ITEM>
<!--  打印转换  界面修改  -->
  <ITEM NAME="#XMRJ"	 TYPE="%-16s"   FUNCTIONS="X(#MRJ)"/>
  <ITEM NAME="#XPMJ"	 TYPE="%-16s"   FUNCTIONS="X(#PMJ)"/>
  <ITEM NAME="#XNLV"	 TYPE="%-9s"    FUNCTIONS="X(#NLV)"/>
  <ITEM NAME="#XYJLX"	 TYPE="%-20s"   FUNCTIONS="X(#YJLX)"/>
  <ITEM NAME="#XZJJE"	 TYPE="%-20s"   FUNCTIONS="X(#ZJJE)"/>
  <ITEM NAME="#XYJJE"	 TYPE="%-20s"   FUNCTIONS="X(#YJJE)"/>
  <ITEM NAME="#SUBMIT" LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>

  
    </VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
	<PACKAGE DEVICE="SCREEN" DESC="显示内容">
	NOTHING
	</PACKAGE>
	<PRINT>"{
		print( 4, 20,'债券投资买入信息 [4] 成功',#SCZLX);
		print( 7, 10,'投资协议编号:[15  ]',#XYBH);
   }"
   </PRINT>
 </RESPONSE>

<RESPONSE>
<PACKAGE DEVICE="PRINTER" DESC="打印业务专用凭证" >
NOTHING
</PACKAGE>
<PRINT>
"{
    dim @txtime as string;
		@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
print( 5, 20,'机构名称:[30]',$BRNAME);  
print( 5, 2,'代码:6501');
print( 5, 13,'交易:债券投资买入信息维护');

print( 7,20,'操作类型:[4   ]                投资协议编号:[15             ]',#SCZLX,$FD58);
print( 8,20,'产品名称:[30                            ]',#CPMC);
print( 9,20,'买入债券品种:[10        ]',$FD86);
print(10,20,'买入价:[16              ]      票面价:[16              ]',#XMRJ,#XPMJ);
print(11,20,'发行日期:[8       ]            债券期限:[4   ] 月',#FXRQ,$FD48);
print(12,20,'购入日期:[8       ]            债券到期日期:[8       ]',#GRRQ,$FD45);
print(13,20,'债券计息方式:[8       ]        年利率:[9        ]%',#SJXFS,#XNLV);
print(14,20,'应记利息:[20                  ]',#XYJLX);
print(15,20,'折价金额:[20                  ]溢价金额:[20                  ]',#XZJJE,#XYJJE);

print( 24,20,'备注:');
print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
print( 24,5,'柜员:[4]',$FD7);
print( 24,5,'流水号:[6]',$FD4);
}"
</PRINT>
</RESPONSE>
<OUTPUT>
</OUTPUT>
</TRANSACTION>
   
   
