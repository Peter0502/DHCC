<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11000000" TITLE="8608      批量代理结果打印"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	 dim @baktxno as string;
	 initfd();
	 $MSGTYPE='03001';
	 @baktxno=$TXNO;
	 $FD12='6608';
	 $TXNO='9986'; 
    	 $FD21=#AGENTYPE;
   	 $FD25=#DWNAME; 
   	 $FD46=#BATCHDATE;
  	 $FD61=#AGENTNAME;
  	 $FD70=#PRINTFG;
 	 $FD71=#YWTYPE;
 	 $FD92=#DWID;
 	 commsend_001();
 	 callserver();
 	 $TXNO=@baktxno;
 	 if($FD12!='0000')
          {
             showmsg(geterror());
             return(false);
          } 
          $FD16 = '6608';
  	  $MSGTYPE='03001';
}"
</COMMSEND>
<COMMRECV>"{
  commrecv_001();
  if($FD12 == '0000')
	 {
		 showmsg('交易成功!');
	 }
}"
</COMMRECV>

<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-52s" FUNCTIONS=
    "T(8608                         联机代理结果打印)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=6608)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  
  <ITEM LINE="7"   COL="10"   TYPE="%-10s" FUNCTIONS="T(单位编号:)"/>
  <ITEM LINE="7"   COL="28"   TYPE="%-10s" FUNCTIONS="T(单位名称:)" />
  <ITEM LINE="9"   COL="10"   TYPE="%-10s" FUNCTIONS="T(业务性质:!)" />
  <ITEM LINE="9"   COL="35"   TYPE="%-10s" FUNCTIONS="T(代理类型:!)" />
  <ITEM LINE="11"  COL="10"   TYPE="%-14s" FUNCTIONS="T(打印记录标志:!)" />
  <ITEM LINE="13"  COL="10"   TYPE="%-12s" FUNCTIONS="T(批处理日期:)" />
  <ITEM LINE="15"  COL="10"   TYPE="%-12s" FUNCTIONS="T(批处理流水:)" />
  <ITEM LINE="7"   COL="21"  NAME="#DWID"        TYPE="%-4s"        INPUT="TEXT"    FUNCTIONS="">
   <ONLOSTFOCUS>
		"{
		    dim @txno_bak as string;
		    dim @str as string;
      		    @txno_bak=$TXNO;
		    $TXNO='9841';
		    $FD92=#DWID;
		    commsend_001();		
		    callserver();
		    if($FD12!='0000')
		    {
			    showmsg(geterror());
			    return(false);
		    }
		    $TXNO=@txno_bak;
		    #DWNAME=delspace($FD25);
		    #YWTYPE=delspace($FD71);
		    #AGENTYPE=delspace($FD21);
		    enable(#DWNAME,false);
		    enable(#YWTYPE,false);
		    enable(#AGENTYPE,false);
		}"
	 </ONLOSTFOCUS>
  </ITEM>  
  <ITEM LINE="7"  COL="37"   NAME="#DWNAME"      TYPE="%-40s"       INPUT="TEXT"    FUNCTIONS=""/>
  <ITEM LINE="9"  COL="21"   NAME="#YWTYPE"      TYPE="%-1s"        INPUT="SELECT"  FUNCTIONS="T(0)">
    <SELECT>
       <OPTION VALUE ="0" TITLE="0.代收" />
       <OPTION VALUE ="1" TITLE="1.代付" />
    </SELECT>
  </ITEM>
  <ITEM LINE="9"  COL="45"  NAME="#AGENTYPE"    TYPE="%-2s"        INPUT="SELECT"  FUNCTIONS="T(30)">
   <SELECT>
       <OPTION VALUE ="30" TITLE="30.代发工资       " />
       <OPTION VALUE ="31" TITLE="31.财政工资       " />
       <OPTION VALUE ="32" TITLE="32.代发自来水工资 " />
       <OPTION VALUE ="33" TITLE="33.批量贷记       " />
       <OPTION VALUE ="35" TITLE="35.现金代发       " />
       <OPTION VALUE ="37" TITLE="37.代发定活       " />
       <OPTION VALUE ="38" TITLE="38.代发整整       " />
       <OPTION VALUE ="39" TITLE="39.代发零整       " />
       <OPTION VALUE ="40" TITLE="40.代扣费         " />
       <OPTION VALUE ="41" TITLE="41.代收个人所得税 " />
       <OPTION VALUE ="42" TITLE="42.代收罚款       " />
       <OPTION VALUE ="43" TITLE="43.代收水费       " />
       <OPTION VALUE ="44" TITLE="44.代收煤气费     " />
       <OPTION VALUE ="45" TITLE="45.代收电费       " />
       <OPTION VALUE ="46" TITLE="46.代收税款       " />
       <OPTION VALUE ="47" TITLE="47.代收话费       " />
       <OPTION VALUE ="48" TITLE="48.代收移动费    " />
    </SELECT>          
  </ITEM>
  <ITEM LINE="11"  COL="25"   NAME="#PRINTFG"     TYPE="%-1s"       INPUT="SELECT"    FUNCTIONS="T(0)">
   <SELECT>
       <OPTION VALUE ="0" TITLE="0.打印成功记录" />
       <OPTION VALUE ="1" TITLE="1.打印失败记录" />
    </SELECT>
  </ITEM>
  <ITEM LINE="13"  COL="23"   NAME="#BATCHDATE"      TYPE="%-8s"       INPUT="TEXT"    FUNCTIONS="V(NB)"/>
  <ITEM LINE="15"  COL="23"   NAME="#BATCHTRACE"      TYPE="%8d"       INPUT="TEXT"    FUNCTIONS="V(NB)"/>
	 <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD"      TYPE="%-6s"     FUNCTIONS="T()"/>
  <ITEM NAME="#AGENTNAME"   TYPE="%-16s"    FUNCTIONS="S(#AGENTYPE,#AGENTYPE)"/>
  <ITEM NAME="#PRINTNAME"   TYPE="%-16s"    FUNCTIONS="S(#PRINTNAME,#PRINTNAME)"/>
  <ITEM LINE="21"  COL="59" TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
  <ONCLICK>
  "{
   	 dim @baktxno as string;
   	 dim @tota as string;
   	 dim @f as file;
   	 initfd();
	 $MSGTYPE='03001';
	 @baktxno=$TXNO;
	 $FD12='6608';
	 $TXNO='9986'; 
    	 $FD21=#AGENTYPE;
   	 $FD25=#DWNAME; 
   	 $FD46=#BATCHDATE;
  	 $FD61=#AGENTNAME;
  	 $FD70=#PRINTFG;
 	 $FD71=#YWTYPE;
 	 $FD92=#DWID;
	 $FD29=getitems('#BATCHTRACE');
 	 commsend_001();
 	 callserver();
 	 $TXNO=@baktxno;
 	 if($FD12!='0000')
          {
             showmsg(geterror());
             return(false);
          } 
          $FD21=#AGENTYPE;
   	  $FD25=#DWNAME; 
   	  $FD46=#BATCHDATE;
  	  $FD61=#AGENTNAME;
  	  $FD70=#PRINTFG;
 	  $FD71=#YWTYPE;
 	  $FD92=#DWID;
	  $FD29=getitems('#BATCHTRACE');
  	  commsend_001();
  	  @tota=callserver();
	  if($FD12!='0000')
          {
             showmsg(geterror());
             return(false);
          } 
	  @f=openfile('../tmp/批量代理结果打印['+#DWID+']','w');
	 writeline(@f,@tota);
	 closefile(@f);
	 call('fview ../tmp/批量代理结果打印['+#DWID+']');	
  }"
  </ONCLICK>
  </ITEM>
 </VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
</RESPONSE>

<OUTPUT>

</OUTPUT>
</TRANSACTION>
