<?xml version="1.0"  encoding="GBK" ?>
<TRANSACTION RIGHTS="11111111011100000000000001100010" TITLE="提交单笔缴款退费"
xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
 <VARIABLE>
	<ITEM LINE="3" COL="3"   TYPE="%-70s"    FUNCTIONS="T(9932                         提交单笔缴款退费 )"/>
	<ITEM LINE="4" COL="3"   TYPE="%-70s"    FUNCTIONS="T(────────────────────────────────────────)"/> 
  <ITEM NAME="#TXNO"       TYPE="%-4s"     FUNCTIONS="T($TXNO=2100)"/>
  <ITEM NAME="#MSGTYPE"    TYPE="%-5s"     FUNCTIONS="T($MSGTYPE=03001)"/>  
  <ITEM LINE="6"   COL ="5"  TYPE="%-14s"    FUNCTIONS="T(用   户   号:)"/>
	<ITEM LINE="6"   COL="19"  TYPE="%-20s"    NAME="#USR_NO"    INPUT="TEXT"  FUNCTIONS="T()V(NB)"/>
	<ITEM LINE="7"   COL ="5"  TYPE="%-14s"    FUNCTIONS="T(年        度:)"/>
	<ITEM LINE="7"   COL="19"  TYPE="%-20s"    NAME="#YEAR"    INPUT="TEXT"  FUNCTIONS="T()V(NB)"/>
	<ITEM LINE="8"   COL ="5"  TYPE="%-14s"    FUNCTIONS="T(原 缴费日期:)"/>
	<ITEM LINE="8"   COL="19"  TYPE="%-20s"    NAME="#OLD_DATE"    INPUT="TEXT"  FUNCTIONS="T($HDATE)"/>
	<ITEM LINE="9"  COL="5"   TYPE="%-14s"    FUNCTIONS="T(金        额:)"/>	
	<ITEM LINE="9"  COL="19"  TYPE="%16.2f"   NAME="#OLD_AMT"   INPUT="TEXT"  FUNCTIONS="V(0000000000000001,9999999999999999)"/>		
	<ITEM LINE="10"   COL ="5"  TYPE="%-14s"    FUNCTIONS="T(原 交易流水:)"/>
	<ITEM LINE="10"   COL="19"  TYPE="%-20s"    NAME="#OLD_TRACENO"    INPUT="TEXT"  FUNCTIONS="T()V(NB)"/>
	<ITEM LINE="11"  COL="5"   TYPE="%-14s"    FUNCTIONS="T(缴款退费原因:)"/>	
	<ITEM LINE="11"  COL="19"  TYPE="%-50s"    NAME="#REASON"  INPUT="TEXT"  FUNCTIONS="T()"/>	
	
	<ITEM NAME="#YHNO_2"      TYPE="%-30s"    FUNCTIONS=""/>
	<ITEM NAME="#YHNAME_2"    TYPE="%-50s"    FUNCTIONS=""/>              		
	<ITEM NAME="#ADDRESS_2"   TYPE="%-50s"    FUNCTIONS=""/>           					
 	<ITEM NAME="#YEAR_2"      TYPE="%-4s"  		FUNCTIONS=""/>                    
 	<ITEM NAME="#FWMJ_2"      TYPE="%-12.2f"  FUNCTIONS=""/> 										
 	<ITEM NAME="#MONTH_2"     TYPE="%-2s"  	  FUNCTIONS=""/> 									
 	<ITEM NAME="#MJDJ_2"      TYPE="%-12.2f"  FUNCTIONS=""/> 										
 	<ITEM NAME="#MJYS_2"      TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#JLYL_2"      TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#JLDJ_2"      TYPE="%-12.3f"  FUNCTIONS=""/> 										
	<ITEM NAME="#JLYS_2"      TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#YSBJ_2"      TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#JMJE_2"      TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#YHJE_2"      TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#AMT_2"       TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#BZ_2"        TYPE="%-60s"    FUNCTIONS=""/>    										
	<ITEM NAME="#TRACE_NO"    TYPE="%-24s"    FUNCTIONS=""/>
	<ITEM NAME="#STAT"        TYPE="%-1s"     FUNCTIONS=""/>
	<ITEM NAME="#JFDATE"      TYPE="%-8s"     FUNCTIONS=""/>  
	
  <ITEM NAME="#BTN" LINE="21"  COL="61"  TYPE="%-6s"     FUNCTIONS="T(确  定)" INPUT="BUTTON">
		<ONCLICK>
		 "{	
			initfd();
			commsend_002(); 
			$FD16='2100';
			$FD30=#USR_NO;
			$FD34=#YEAR;
			$FD28=#OLD_DATE;
			$FD32=#OLD_TRACENO;
			$FD82=#REASON;                  //退费原因
			$FD60='RYGR';
			$FD44=itoa(#OLD_AMT,'%-16.2f'); //交易金额
			callagnpt();
			if($FD12!='0000')
			{
			  showmsg(geterror());
			  return(false);
			}

			#YHNO_2=$FD30;
			#YHNAME_2=$FD25;
			#ADDRESS_2=$FD26;
			#YEAR_2=$FD34;
			#MONTH_2=$FD35;
			#FWMJ_2=val($FD84);
			#MJDJ_2=val($FD85);
			#MJYS_2=val($FD97);
			#JLDJ_2=val($FD94);
			#JLYL_2=val($FD39);
			#JLYS_2=val($FD40);
			#YSBJ_2=val($FD41);
			#JMJE_2=val($FD42);
			#YHJE_2=val($FD43);
			#AMT_2=val($FD44);
			#BZ_2=$FD81;
			#STAT=$FD20;
			#TRACE_NO=$FD27;
			#JFDATE=$FD45;
			runoutput();
			rerun();	     
		  }"
		</ONCLICK>
	</ITEM>	
 </VARIABLE>
 <RESPONSE>
  <PACKAGE DEVICE="SCREEN"  DESC="交易完成">
    NOTHING
  </PACKAGE>
	<PRINT>
	 "{
 			print(3,42,'[4]   [2]    [2]',substr($HDATE,0,4),substr($HDATE,4,5),substr($HDATE,6,7));
		  	print(4,20,'     [35][16]      [20]',#ADDRESS_2,#YHNAME_2,#TRACE_NO); 
		  	print(5,14,'     [24]',#USR_NO);
			print(7,12,' [4]供热费            [15]  [4]        [10]    [16]',#YEAR_2,delspace(comma(itoa(#FWMJ_2,'%.2f'))),#MONTH_2,delspace(comma(itoa(#MJDJ_2,'%.2f'))),delspace(comma(itoa(#MJYS_2,'%.2f')))); 
			
			print(8,12,' 优惠金额                                                         [16]',delspace(comma(itoa(#YHJE_2,'%.2f'))));
			
			print(9,12,' 实收金额                                                         [16]',delspace(comma(itoa(#AMT_2,'%.2f'))));
			
			print(12,20,'基础热费');
			print(15,20,'[12]                                [12]',$FD3,$FD7);
	 }"
	</PRINT>
 </RESPONSE>
 <RESPONSE>
   <PACKAGE DEVICE="PRINTER"  LINESPACE="22" DESC="打印专用凭证">
     NOTHING
   </PACKAGE>
   <PRINT>
   	"{
 			print(3,42,'[4]   [2]    [2]',substr($HDATE,0,4),substr($HDATE,4,5),substr($HDATE,6,7));
		  	print(4,20,'     [35][16]      [20]',#ADDRESS_2,#YHNAME_2,#TRACE_NO); 
		  	print(5,14,'     [24]',#USR_NO);
			print(7,12,' [4]供热费            [15]  [4]        [10]    [16]',#YEAR_2,delspace(comma(itoa(#FWMJ_2,'%.2f'))),#MONTH_2,delspace(comma(itoa(#MJDJ_2,'%.2f'))),delspace(comma(itoa(#MJYS_2,'%.2f')))); 
			
			print(8,12,' 优惠金额                                                         [16]',delspace(comma(itoa(#YHJE_2,'%.2f'))));
			
			print(9,12,' 实收金额                                                         [16]',delspace(comma(itoa(#AMT_2,'%.2f'))));
			
			print(12,20,'退费');
			print(15,20,'[12]                                [12]',$FD3,$FD7);
     }"
   </PRINT>
 </RESPONSE>
 
 <RESPONSE>
<PACKAGE DEVICE="PRINTER" LINESPACE="22" DESC="请打印业务专用凭证">
NOTHING
</PACKAGE>
<PRINT>
"{
dim @txtime  as string;
@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
print(5,20,'机构名称:[30]',$BRNAME);
print(5,2,'代码:9932');
print(5,13,'交易:单笔缴款退费');

print(7,40,'\L0单笔缴款退费\L1');
		  if(#JKFS=='1'){
			print(9,20, '缴费方式：现金                                缴费单位或个人：[35]',#ADDRESS_2);
			print(10,20,'用户姓名：[30]      房间编号：[24]',#YHNAME_2,#USR_NO);
			  
			print(11,20,'项    目：[4]供热费                          面积：[15]',#YEAR_2,delspace(comma(itoa(#FWMJ_2,'%.2f')))); 
			print(12,20,'月    数：[4]                                单价：[10]',#MONTH_2,delspace(comma(itoa(#MJDJ_2,'%.2f')))); 
			print(13,20,'面积应收：[16]',delspace(comma(itoa(#MJYS_2,'%.2f'))));
			print(14,20,'优惠金额：[16]',delspace(comma(itoa(#YHJE_2,'%.2f'))));
			print(15,20,'实收金额：[16]',delspace(comma(itoa(#AMT_2,'%.2f'))));
			print(16,20,'票    号：[20]', #TRACE_NO);
			print(17,20,'说    明：退款');
			  	  
		  }
		  else{
			  print(9,20, '缴费方式：转账                                缴费单位或个人：[35]',#ADDRESS_2);
			print(10,20,'用户姓名：[30]      房间编号：[24]',#YHNAME_2,#USR_NO);
			print(11,20,'支付账号：[20]                账号户名：[30]',#AC_NO,#AC_NAME);   
			print(12,20,'项    目：[4]供热费                          面积：[15]',#YEAR_2,delspace(comma(itoa(#FWMJ_2,'%.2f')))); 
			print(13,20,'月    数：[4]                                单价：[10]',#MONTH_2,delspace(comma(itoa(#MJDJ_2,'%.2f')))); 
			print(14,20,'面积应收：[16]',delspace(comma(itoa(#MJYS_2,'%.2f'))));
			print(15,20,'优惠金额：[16]',delspace(comma(itoa(#YHJE_2,'%.2f'))));
			print(16,20,'实收金额：[16]',delspace(comma(itoa(#AMT_2,'%.2f'))));
			print(17,20,'票    号：[20]', #TRACE_NO);
			print(18,20,'说    明：退款');
		  }
		  print(19,80,'\H0本人已确认银行打印记录正确无误.\H1');
		  print(21,80,'客户签名:_____________________');

print( 24,20,'备注:');
print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
print( 24,5,'柜员:[4]',$FD7);
print( 24,5,'流水号:[6]',itoa(#TRACE_NO,'%06d'));
}"
</PRINT>
</RESPONSE>
 
 
</TRANSACTION>


