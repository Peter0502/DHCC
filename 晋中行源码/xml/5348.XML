<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110000" TITLE="5348 小额收费清单查询"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	initfd();
	commsend_001();
	$FD44=#BEG_MON;
	$FD45=#END_MON;
	$FD68=#FLAG;
	$FD91=#BR_NO;
}"
</COMMSEND>
<COMMRECV>"{
	commrecv_001();
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="4"  COL="3" TYPE="%-44s" FUNCTIONS="T(5348                      收费清单查询)"/>
  <ITEM LINE="5"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=5888)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>

  <BLOCK NAME="COMM" LINE="0" COL="7">
  <ITEM LINE="08"   COL="10" TYPE="%-10s"  FUNCTIONS="T(交易类型:)"/>
  <ITEM LINE="10"   COL="10" TYPE="%-10s"  FUNCTIONS="T(查询种类:)"/>
  <ITEM LINE="12"   COL="10" TYPE="%-12s"  FUNCTIONS="T(交易机构:)"/>
  <ITEM LINE="14"  COL="10" TYPE="%-10s" INPUT="LABEL"  NAME="#NAME1"    FUNCTIONS="T(起始月份: )"/>
  <ITEM LINE="14"  COL="10" TYPE="%-10s" INPUT="LABEL"  VISABLE="FALSE"  NAME="#NAME2"    FUNCTIONS="T(打印月份: )"/>
  <ITEM LINE="16"  COL="10" TYPE="%-10s" INPUT="LABEL"  NAME="#NAME3"    FUNCTIONS="T(截至月份: )"/>
    <!--输入变量-->
   <ITEM LINE="08"  COL="20" NAME="#OPER"   TYPE="%-1s"   INPUT="TEXT"  FUNCTIONS="T(1)V(NB)">
        <SELECT LINE="8" COL="25">
                <OPTION VALUE="1" TITLE="0.查询"/>
                <OPTION VALUE="2" TITLE="1.打印"/>
        </SELECT>
        <ONLOSTFOCUS>
        "{
        	show(#NAME1,true);
        	show(#NAME3,true);
        	show(#END_MON,true);
        	show(#QUERY,true);
        	show(#PRINTER,false);
        	
        	
        	if(#OPER=='2')
        	{
        		show(#NAME1,false);
        		show(#NAME3,false);
        		show(#NAME2,true);
        		show(#BEG_MON,true);
        		show(#END_MON,false);
        		show(#QUERY,false);
        		show(#PRINTER,true);
        	}
    
         }"
         </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="10"  COL="20" NAME="#FLAG"   TYPE="%-1s"   INPUT="TEXT"  FUNCTIONS="T(1)V(NB)">
        <SELECT LINE="6" COL="46">
                <OPTION VALUE="1" TITLE="0.CMT552小额收费通知报文"/>
                <OPTION VALUE="2" TITLE="1.CMT554小额对外返还通知报文"/>
        </SELECT>
  </ITEM>
  <ITEM LINE="12"   COL="20" NAME="#BR_NO"      TYPE="%-5s"   INPUT="TEXT"   FUNCTIONS="T($KINBR)V(NB)"/>
  <ITEM LINE="14"  COL="20" NAME="#BEG_MON"    TYPE="%-6d"   INPUT="TEXT"  FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
  "{
  	if(#OPER=='2')
  	{
  		#END_MON = #BEG_MON;

  	}
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="16"  COL="20" NAME="#END_MON"    TYPE="%-6d"   INPUT="TEXT"  FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
  "{
  	
	
	if(#BEG_MON>#END_MON)
	{
		showmsg('起始月份不能大于截至月份');
		return (false);
	}
   }"
  </ONLOSTFOCUS>
  </ITEM>
  
  </BLOCK>
  <BLOCK NAME="COMN1" LINE="0" COL="7" VISABLE="FALSE">
    <ITEM LINE="5"  COL="22" TYPE="%-20s"  FUNCTIONS="T(CMT  802   查   询)"/>
    <ITEM LINE="6"  COL="3"  TYPE="%-14s"  FUNCTIONS="T(收报中心代码:)"/>
    <ITEM LINE="6"  COL="25" TYPE="%-10s"  FUNCTIONS="T(清算行号: )"/>
    <ITEM LINE="6"  COL="40" TYPE="%-10s"  FUNCTIONS="T(收费金额: )"/>
    <ITEM LINE="7"  COL="3"  TYPE="%-14s"  FUNCTIONS="T(计费开始日期: )"/>
    <ITEM LINE="7"  COL="30" TYPE="%-10s"  FUNCTIONS="T(终止日期: )"/>
    <ITEM LINE="7"  COL="51" TYPE="%-22s"  FUNCTIONS="T(月累计业务量收费比率: )"/>
    <ITEM LINE="8"  COL="3"  TYPE="%-20s"  FUNCTIONS="T(直接参与者收费比率:)"/>  
    <ITEM LINE="8"  COL="40" TYPE="%-10s"  FUNCTIONS="T(行别收费比率: )"/>
    <ITEM LINE="9"  COL="3"  TYPE="%-20s"  FUNCTIONS="T(单边类业务收费金额: )"/>
    <ITEM LINE="9"  COL="40" TYPE="%-10s"  FUNCTIONS="T(记录个数: )"/>
    <ITEM LINE="10" COL="3"  TYPE="%-20s"  FUNCTIONS="T(信息类业务收费金额:)"/>
    <ITEM LINE="10" COL="40" TYPE="%-10s"  FUNCTIONS="T(记录个数: )"/>
    <ITEM LINE="11" COL="3"  TYPE="%-20s"  FUNCTIONS="T(信息类业务收费金额: )"/>
    <ITEM LINE="11" COL="40" TYPE="%-10s"  FUNCTIONS="T(记录个数: )"/>
       <!----------接收后台传来的部分信息------------>
    <ITEM NAME="#RECECO"    LINE="6"    COL="18"   TYPE="%-4s"  FUNCTIONS="T()"/> 
    <ITEM NAME="#QSBRNO"    LINE="6"    COL="36"   TYPE="%-12s" FUNCTIONS="T()"/> 
    <ITEM NAME="#SDATE"     LINE="6"    COL="51"   TYPE="%-8s"  FUNCTIONS="T()"/> 
    <ITEM NAME="#EDATE"     LINE="7"    COL="18"   TYPE="%-8s"  FUNCTIONS="T()"/> 
    <ITEM NAME="#TXAMT"     LINE="7"    COL="41"   TYPE="%-15s" FUNCTIONS="T()"/> 
    <ITEM NAME="#IDRATE"    LINE="7"    COL="74"   TYPE="%-6s"  FUNCTIONS="T()"/> 
    <ITEM NAME="#SERATE"    LINE="8"    COL="24"   TYPE="%-6s"  FUNCTIONS="T()"/> 
    <ITEM NAME="#MORATE"    LINE="8"    COL="51"   TYPE="%-6s"  FUNCTIONS="T()"/> 
    <ITEM NAME="#ZFTXAMT"   LINE="9"    COL="24"   TYPE="%-15s"  FUNCTIONS="T()"/> 
    <ITEM NAME="#ZFNUM"     LINE="9"    COL="51"   TYPE="%-8s"  FUNCTIONS="T()"/> 
    <ITEM NAME="#DBTXAMT"   LINE="10"   COL="24"   TYPE="%-15s"  FUNCTIONS="T()"/> 
    <ITEM NAME="#DBNUM"     LINE="10"   COL="51"   TYPE="%-8s"  FUNCTIONS="T()"/> 
    <ITEM NAME="#MESTXAMT"  LINE="11"   COL="24"   TYPE="%-15s"  FUNCTIONS="T()"/> 
    <ITEM NAME="#MESNUM"    LINE="11"   COL="51"   TYPE="%-8s"  FUNCTIONS="T()"/> 
    
    <ITEM NAME="#FILED1"   TYPE="%-8s"  FUNCTIONS="T()"/> 
    <ITEM NAME="#FILED2"   TYPE="%-16s"  FUNCTIONS="T()"/> 
    <ITEM NAME="#FILED3"   TYPE="%-8s"  FUNCTIONS="T()"/> 
    <ITEM NAME="#FILED4"   TYPE="%-8s"  FUNCTIONS="T()"/> 
    <ITEM NAME="#FILED5"   TYPE="%-16s"  FUNCTIONS="T()"/> 
    <ITEM NAME="#FILED6"   TYPE="%-8s"  FUNCTIONS="T()"/> 
    <ITEM NAME="#FILED7"   TYPE="%-8s"  FUNCTIONS="T()"/> 

  </BLOCK>                   
   <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/> 

  <!--
  <ONCLICK>
  "{
  	initfd();
	commsend_001();
	$FD44=#BEG_MON;
	$FD45=#END_MON;
	$FD68=#FLAG;
	$FD91=#BR_NO;;
	
	callserver();
   }"
   </ONCLICK>
   </ITEM>  
   -->
  <ITEM LINE="21" COL="59"  TYPE="%-6s" NAME ="#PRINTER" VISABLE="FALSE"  FUNCTIONS="T(打  印)" INPUT="BUTTON">  
  <ONCLICK>
  "{
  	dim @tota as string;
  	dim @f as file;
  	dim @line as string;
  	dim @cnt as number;
  	dim @selid as number;
  	dim @i1 as number;
        dim @i2 as number;
  	dim @i3 as number;
  	dim @i4 as number;
  	dim @i5 as number;
  	dim @i6 as number;
  	dim @i7 as number;
  	dim @f1 as string;
  	dim @f2 as string;
  	dim @f3 as string;
  	dim @f4 as string;
  	dim @f5 as string;
  	dim @f6 as string;
  	dim @f7 as string;
    	initfd();
	commsend_001();
	$FD44=#BEG_MON;
	$FD45=#END_MON;
	$FD68=#FLAG;
	$FD91=#BR_NO;;
	@tota=callserver();
	#RECECO=substr($FD123,0,4);
	#QSBRNO=substr($FD123,4,12);
	#SDATE=substr($FD123,16,8);
	#EDATE=substr($FD123,24,8);
	#ZFTXAMT=substr($FD123,32,15);
	#ZFNUM=substr($FD123,47,8);
	#IDRATE=substr($FD123,55,6);
	if($FD12!='0000')
    	 {
		showmsg(geterror());
		return(false);
    	 }
       	 	 
    	if(autolist(@tota))
        {
	    @cnt=list_getrowcnt();
	}	
	@f=openfile('../tmp/支付业务收费清单明细查询','w');
	
	@selid=list_getselid();
	@f1=delspace(list_gettext(@selid,9));
	@f2=delspace(list_gettext(@selid,10));
	@f3=delspace(list_gettext(@selid,11));
	@f4=delspace(list_gettext(@selid,12));
	@f5=delspace(list_gettext(@selid,13));
	@f6=delspace(list_gettext(@selid,8));
	
	
	if(#FLAG=='1')
	{
		writeline(@f,' 机构：'+#BR_NO+'   月份：'+#BEG_MON+'           支付业务收费清单明细 552   金额单位:分');
		writeline(@f,' 收报中心代码 '+#RECECO+' 清算行号: '+#QSBRNO+' 收费金额: '+val(#ZFTXAMT,0.01));
		writeline(@f,' 计费开始日期: '+#SDATE+ ' 终止日期: '+#EDATE +' 返还基础费率单位: '+#IDRATE);
		writeline(@f,'┏━━━━┳━━━━━━━━┳━━━━┳━━━━┳━━━━━━━━┳━━━━┓');
		writeline(@f,'┃报文类型┃ 计费总量       ┃计费单价┃基础费率┃    明细金额    ┃通知类型┃');
		writeline(@f,'┣━━━━╋━━━━━━━━╋━━━━╋━━━━╋━━━━━━━━╋━━━━┫');
	}
	if(#FLAG=='2')
	{
		writeline(@f,' 机构：'+#BR_NO+'   月份：'+#BEG_MON+'                        对外返还通知清单明细 554                   ');
		writeline(@f,' 收报中心代码: '+#RECECO+' 清算行号: '+#QSBRNO+' 收费金额: '+val(#ZFTXAMT,0.01));
		writeline(@f,' 计费开始日期: '+#SDATE+ ' 终止日期: '+#EDATE +' 返还基础费率单位: '+#IDRATE);
		writeline(@f,'┏━━━━┳━━━━━━━━┳━━━━┳━━━━┳━━━━━━━━┳━━━━┓');
		writeline(@f,'┃报文类型┃ 计费总量       ┃计费单价┃基础费率┃    明细金额    ┃通知类型┃');
		writeline(@f,'┣━━━━╋━━━━━━━━╋━━━━╋━━━━╋━━━━━━━━╋━━━━┫');
	}
	
	
        @i1=len(@f1);
        @i2=len(@f2);
        @i3=len(@f3);
        @i4=len(@f4);
        @i5=len(@f5);
        @i6=len(@f6);
        @i7=len(@f7);    
        #FILED1=@f1+space(8-@i1);
        #FILED2=@f2+space(16-@i2);
        #FILED3=@f3+space(8-@i3);
        #FILED4=@f4+space(8-@i4);
        #FILED5=@f5+space(16-@i5);
        #FILED6=@f6+space(8-@i6);
        #FILED7=@f7+space(8-@i7);
        while(true)
	{   
	    
	 writeline(@f,'┃'+#FILED1+'┃'+#FILED2+'┃'+#FILED3+'┃'+#FILED4+'┃'+#FILED5+'┃'+#FILED6+'┃');
	    
	 list_rmitem(@selid);	        	        	        
	 @selid=list_getselid();
	 @cnt=list_getrowcnt();
	 if(@cnt==0)
	 {
	    
	    break;
	 }
	 writeline(@f,'┣━━━━╋━━━━━━━━╋━━━━╋━━━━╋━━━━━━━━╋━━━━┫');	
        
	@f1=delspace(list_gettext(@selid,9));
	@f2=delspace(list_gettext(@selid,10));
	@f3=delspace(list_gettext(@selid,11));
	@f4=delspace(list_gettext(@selid,12));
	@f5=delspace(list_gettext(@selid,13));
	@f6=delspace(list_gettext(@selid,8));
	
        @i1=len(@f1);
        @i2=len(@f2);
        @i3=len(@f3);
        @i4=len(@f4);
        @i5=len(@f5);
        @i6=len(@f6);
        @i7=len(@f7);    
        #FILED1=@f1+space(8-@i1);
        #FILED2=@f2+space(16-@i2);
        #FILED3=@f3+space(8-@i3);
        #FILED4=@f4+space(8-@i4);
        #FILED5=@f5+space(16-@i5);
        #FILED6=@f6+space(8-@i6);
        #FILED7=@f7+space(8-@i7);
	}
	writeline(@f,'┗━━━━┻━━━━━━━━┻━━━━┻━━━━┻━━━━━━━━┻━━━━┛');	
 	closefile(@f);
 	call('fview ../tmp/支付业务收费清单明细查询');
	
   }"
 </ONCLICK>
  </ITEM> 
  
    <ITEM LINE="21" COL="65"  TYPE="%-6s" NAME ="#QUERY"    FUNCTIONS="T(查  询)" INPUT="SUBMIT"/>
  </VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="凭证打印!">
 NOTHING
 </PACKAGE>
 <!--
  <PRINT>"{
          print( 5, 24,'CMT  802   查   询');          
          print( 6,  3,'收报中心代码:[4   ] 清算行号:[12          ] 收费金额:[15]',#RECECO,#QSBRNO,#TXAMT);
          print( 7,  3,'计费开始日期:[8       ] 终止日期:[8       ] 月累计业务量收费比率:[6]',#SDATE,#EDATE,#IDRATE);          
	  print( 8,  3,'直接参与者收费比率:[6 ]              行别收费比率:[6]',#SERATE,#MORATE);  
	  print( 9,  3,'支付类业务收费金额:[15             ] 记录    个数:[8]',#ZFTXAMT,#ZFNUM);
	  print( 10, 3,'单边类业务收费金额:[15             ] 记录    个数:[8]',#DBTXAMT,#DBNUM);
	  print( 11, 3,'信息类业务收费金额:[15             ] 记录    个数:[8]',#MESTXAMT,#MESNUM);
	}"
</PRINT>
-->
</RESPONSE>
<OUTPUT>
</OUTPUT>
</TRANSACTION>
