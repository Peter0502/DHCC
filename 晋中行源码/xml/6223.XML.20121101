<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11100000000000000000000000000000" TITLE="6223 卡签约信息查询"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<!--
<COMMSEND>"{
	//与神码通讯开始 
	dim @buffer as string;
	dim @selid as number;
	initfd();
	commsend_001();
	$FD16='6223';
	$FD30=#ACTNO;
	$FD18=$TXNO;
	$FD75=$MSR2;
	$FD76=$MSR3;
	@buffer=callagn();
	if($FD12 != '0000')
	{
		showmsg(geterror());
		return(false);
	}
	if(@buffer=='')
	{
		showmsg('未找到记录!');
		return(false);
	}
	savefiletxt('../tmp/'+$KINBR+$TTYNAME+'mif',@buffer);
	list_init(17,78,5,1);
	list_setcolcnt(4);
	list_setcol(0,'交易名称',20);
	list_setcol(1,'开通标志',14);
	list_setcol(2,'签约日期',22);
	list_setcol(3,'解约日期',22);
	list_load('../tmp/'+$KINBR+$TTYNAME+'mif');
	list_work();
	@selid=list_work();
	if(@selid &lt; 0)
	{
		list_del();
		rerun();
		return(true);
	}
	list_del();
	return(true);
}"
</COMMSEND>
<COMMRECV>"{
	commrecv_001();
}"
</COMMRECV>
-->
<FIRSTWORK>
"{
}"
</FIRSTWORK>

	<!--VARIABLE UPLOOP="TRUE"-->
	<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(6223                          卡业务签约信息查询)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO"    TYPE="%-4s"  FUNCTIONS="T($TXNO=6223)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s"  FUNCTIONS="T($MSGTYPE=1400)"/>
  <ITEM NAME="#TXCD"    TYPE="%4s"   FUNCTIONS="T(6223)"/>      <!---交易代码--->
  <ITEM NAME="#TXNAME"  TYPE="%-10s" FUNCTIONS="T(卡信息查询)"/>  <!---交易名称--->
  <ITEM NAME="#CARD_TRACENO" TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#RESP_CODE" TYPE="%-4s" FUNCTIONS=""/>
  <ITEM NAME="#MSR2BAK" TYPE="%-37s"  FUNCTIONS=""/>
  <ITEM NAME="#MSR3BAK" TYPE="%-104s"  FUNCTIONS=""/>
  <ITEM NAME="#LDQFS" LINE="6"  COL="11"  TYPE="%-10s" VISABLE="TRUE" FUNCTIONS="T(读取方式: )"/>
  <ITEM LINE="6" COL="21" TYPE="%-1s"  NAME="#DQFS" INPUT="SELECT"   FUNCTIONS="V(NB)T(0)">
		<SELECT>
			<OPTION VALUE="0" TITLE="读取磁条方式"/>
			<OPTION VALUE="1" TITLE="读取芯片方式"/>
		</SELECT>
  <ONLOSTFOCUS>"{
     if(#DQFS=='1')
     {
     enable(#ACTNO1,false);
     enable(#ACTNO2,true);
     show(#ACTNO1,false);
     show(#ACTNO2,true);
     }
     if(#DQFS=='0')
     {
     enable(#ACTNO1,true);
     enable(#ACTNO2,false);
     show(#ACTNO1,true);
     show(#ACTNO2,false);
      
     }
     refresh();
   }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#LACTNO" LINE="7"  COL="11"  TYPE="%-10s" VISABLE="TRUE" FUNCTIONS="T(账/卡号:)"/>
   <ITEM NAME="#ACTNO1"   DEVICE="MSR" INPUT="TEXT" LINE="7" COL="21" TYPE="%-19s"   FUNCTIONS="V(NB)M($MSR2,1)" VISABLE="FALSE" >
	<ONLOSTFOCUS>
	"{
		#ACTNO=#ACTNO1;
	}"
	</ONLOSTFOCUS>
</ITEM>
<ITEM NAME="#ACTNO2"   INPUT="TEXT" DEVICE="ICC" LINE="7"  COL="21" TYPE="%-19s" VISABLE="FALSE" FUNCTIONS="V(NB)M($MSR2,1)">
	<ONLOSTFOCUS>
	"{
		#ACTNO=#ACTNO2;
	}"
	</ONLOSTFOCUS>
</ITEM>

<ITEM NAME="#ACTNO"  TYPE="%-19s"  FUNCTIONS="" >
  <ONLOSTFOCUS>"{
		dim @baktxno as string;
   	if((substr(#ACTNO,0,6)=='621223' or substr(#ACTNO,0,6)=='621780') and len(rtrim($MSR2))!=37)
    {
       showmsg('刷卡错误,请重试!');
       //return(false);
    }
    
    if(substr(#ACTNO,0,6)!='621223' and substr(#ACTNO,0,6)!='621780')
    {
       showmsg('输入卡号错误');
       return(false);
    }
    
    #MSR2BAK=$MSR2;
	#MSR3BAK=$MSR3;
	$MSR2='';
	$MSR3='';
	
	}"
	</ONLOSTFOCUS>
</ITEM>

<ITEM NAME="#LPASSWD" LINE="9"  COL="11"  TYPE="%-10s" VISABLE="TRUE" FUNCTIONS="T(密   码:)"/>
<!--<ITEM NAME="#PASSWD" INPUT="TEXT" DEVICE="KEYBORD" LINE="11"  COL="21"  TYPE="%-6s" VISABLE="TRUE" FUNCTIONS="i()"/>-->
<ITEM  LINE="9"  COL="21"  DEVICE="PINPAD" NAME="#PASSWORD" TYPE="%-6s"  FUNCTIONS="i()V(NB)">
	<ONLOSTFOCUS>
		"{
			if(substr(#ACTNO,0,6) == '621223' or substr(#ACTNO,0,6) == '621780')
				{
					initfd();
					commsend_001();
					$FD16='7007';
					$FD30=#ACTNO;
					$FD79=#PASSWORD;
					$FD68='4';
					callagn();
					if($FD12!='0000')
					{
						showmsg(geterror());
						return (false);
					}
				}	
		 	}"
		</ONLOSTFOCUS>
</ITEM>
 
<ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
<ONCLICK>
"{
	//与神码通讯开始 
	dim @buffer as string;
	dim @selid as number;
	initfd();
	commsend_001();
	$FD16='6223';
	$FD30=#ACTNO;
	$FD18=$TXNO;
	$FD75=#MSR2BAK;
	$FD76=#MSR3BAK;
	$FD79=#PASSWORD;
	@buffer=callagn();
	if($FD12 != '0000')
	{
		showmsg(geterror());
		return(false);
	}
	if($FD72=='1')
	{
		showmsg('该卡尚未激活,无签约信息!');
		return(false);
	}
	if(@buffer=='')
	{
		showmsg('未找到记录!');
		return(false);
	}
	savefiletxt('../tmp/'+$KINBR+$TTYNAME+'mif',@buffer);
	list_init(17,78,5,1);
	list_setcolcnt(5);
	list_setcol(0,'交易名称',20);
	list_setcol(1,'开通标志',14);
	list_setcol(2,'签约日期',22);
	list_setcol(3,'解约日期',22);
	list_setcol(4,'操作柜员',20);
	list_load('../tmp/'+$KINBR+$TTYNAME+'mif');
	list_work();
	@selid=list_work();
	if(@selid &lt; 0)
	{
		list_del();
		rerun();
		return(true);
	}
	list_del();
	rerun();
}"
</ONCLICK>
</ITEM>

</VARIABLE>

<REQUEST>
</REQUEST>

</TRANSACTION>
