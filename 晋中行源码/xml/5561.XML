<TRANSACTION RIGHTS="11111111111100000000000000000000"  TITLE="5561  银行端缴款对账登记簿查询"
xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>
"{
   // initfd();
    commsend_001();
    $FD44=#CHKDATE;     //对账日期
    $FD78=#PACKNO;     //包流水号
    $FD37=#ORITAXORGCODE; //原征收机关代码
}"
</COMMSEND>

<COMMRECV>
"{
commrecv_001();
}"
</COMMRECV>

<VARIABLE UPLOOP="TRUE">
<ITEM LINE="3"  COL="3" TYPE="%-70s" FUNCTIONS=
"T(5561                    银行端缴款对账登记簿查询)"/>
<ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
"T(─────────────────────────────────────)"/>
<ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=5569)"/>
<ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>

<ITEM NAME="#DOLIST" TYPE="%1s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
  
	dim @selid       as number;
	dim @paybkcode  as string;
	dim @chkdate     as string;
	dim @packno as string;
	dim @oritaxorgcode as string;
	dim @orientrustdate  as string;
	dim @oritrano     as string;
	dim @payopbkcode    as string;
	dim @taxvouno   as string;
	dim @traamt     as string;
		
	if(#DOLIST == '1')
	{
	    @selid=list_work();
	    if(@selid &lt; 0)
	    {
		     list_del();
		     rerun();
		     return(true);
	    }
      @selid=list_getselid();
      if(@selid &lt; 0)
      {
         list_del();
         rerun();
         return(true);
      }

	    @paybkcode=rtrim(list_gettext(@selid,0));
	    @chkdate=rtrim(list_gettext(@selid,1));
	    @packno=rtrim(list_gettext(@selid,2));
	    @oritaxorgcode=rtrim(list_gettext(@selid,3));
	    @orientrustdate=rtrim(list_gettext(@selid,4));
	    @oritrano=rtrim(list_gettext(@selid,5));
	    @payopbkcode=rtrim(list_gettext(@selid,6));
	    @taxvouno=rtrim(list_gettext(@selid,7));
	    @traamt=rtrim(list_gettext(@selid,8));
	    
	       
	     //银行端缴款对账登记簿信息明细
	    open('5561_1.XML','#PAYBKCODE='+@paybkcode+';#CHKDATE='+@chkdate+';#PACKNO='+@packno+';#ORITAXORGCODE='+@oritaxorgcode+';#ORIENTRUSTDATE='+@orientrustdate+';#ORITRANO='+@oritrano+';#PAYOPBKCODE='+@payopbkcode+';#TAXVOUNO='+@taxvouno+';#TRAAMT='+@traamt+';');
		showfooter();
		return(true);
	}
	list_del();
	#DOLIST='';
  }"
  </ONLOSTFOCUS>
  </ITEM>
<ITEM NAME="#DOLIST" TYPE="%-1s" FUNCTIONS="">
<ONLOSTFOCUS>
"{
	showall();
}"
</ONLOSTFOCUS>
</ITEM>

<ITEM LINE="6"   COL="19" TYPE="%-15s" FUNCTIONS="T(对  账  日  期:)"/>
<ITEM LINE="8"   COL="19" TYPE="%-15s" FUNCTIONS="T(包  流  水  号:)"/>
<ITEM LINE="10"  COL="19" TYPE="%-15s" FUNCTIONS="T(原征收机关代码:)"/>
<ITEM NAME="#ORITAXORGTYPE" TYPE="%1s" FUNCTIONS=""/><!--征收机关类型 -->

<ITEM LINE="6"   COL="35" NAME="#CHKDATE" TYPE="%-8s" DEVICE="KEYBOARD" FUNCTIONS="T()V(NB)D()"/>
<ITEM LINE="8"   COL="35" NAME="#PACKNO"  TYPE="%-8s" DEVICE="KEYBOARD" FUNCTIONS="T()"/>
<ITEM LINE="10"  COL="35" NAME="#ORITAXORGCODE" TYPE="%-12s" DEVICE="KEYBOARD" FUNCTIONS="T()">
 <ONLOSTFOCUS>
  "{
    dim @c as string;
    dim @d as string;
    dim @a as string;
    dim @b as string;
    // TODO在这里callserver判断征收机关代码是否存在
    if(#ORITAXORGCODE =='')
	  return (true);
    dim @FullMsg as string;
    @FullMsg='';
    initfd();
    dim @baktxno as string;
    @baktxno=$TXNO;
    $TXNO='9410';
    $FD61=#ORITAXORGCODE;
    commsend_001();
    //callserver(); chengbo 20090619  HS
    calltips();
    $TXNO=@baktxno;
    if($FD12!='0000'){
      showmsg(geterror());
      return (false);
    }
    @d = substr($FD95,12,60);
    @c =substr($FD95,72,1);
    @a = substr($FD95,73,1);
    @b = substr($FD95,74,1);
    @FullMsg='户名:'+@d+chr(10)+'类型:'+@c+chr(10)+'征收机关类型:'+@a+chr(10)+'机构级次:'+@b;
    showhelp(6,70,8,3,'征收机关基本信息',@FullMsg);
    #ORITAXORGTYPE=substr(@a,0,1);
    $FD20=@b;
  }"
  </ONLOSTFOCUS>
  </ITEM> 

<ITEM LINE="20"  COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">  
<ONCLICK>
"{
  dim @tota as string;
  initfd();
	commsend_001();
	$FD44=#CHKDATE;     //对账日期
  $FD78=#PACKNO;     //包流水号
  $FD37=#ORITAXORGCODE; //原征收机关代码
  //@tota=callserver();  chengbo  20090619 HS
  @tota=calltips();
  if($FD12!='0000'){
		showmsg(geterror());
		return(false);
	}
  autolist(@tota);
	#DOLIST='1';
}"
</ONCLICK>
</ITEM>
</VARIABLE>

<REQUEST>        
</REQUEST>      
<RESPONSE>       
<PACKAGE>        
</PACKAGE>          
</RESPONSE>      
</TRANSACTION>   
