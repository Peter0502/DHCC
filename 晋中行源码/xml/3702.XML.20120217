<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11000000" TITLE="3702 IC卡卡内开户"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>
	"{	
   }"
</COMMSEND>
<COMMRECV>
	"{
  }"
</COMMRECV>
<VARIABLE>
	<ITEM LINE="3"  COL="3" TYPE="%-54s" FUNCTIONS=
		"T(3702                          IC卡卡内开户)"/>
	<ITEM LINE="4"  COL="3" TYPE="%-74s" FUNCTIONS=
		"T(─────────────────────────────────────)"/>   
	<ITEM NAME="#TXNO"      TYPE="%-4s"  FUNCTIONS="T($TXNO=3702)"/>
	<ITEM NAME="#MSGTYPE"   TYPE="%-5s"  FUNCTIONS="T($MSGTYPE=03001)"/>
	<PAGE NAME="DEFAULT">
	<!--界面变量-->
		<ITEM LINE="6" COL="5"  TYPE="%-9s"  FUNCTIONS="T(卡    号:)"/> 
		<ITEM LINE="6" COL="14" TYPE="%-19s" NAME="#CARD_NO" INPUT="TEXT"  DEVICE="ICC"  FUNCTIONS="V(NB)M($MSR2,1)">
			<ONLOSTFOCUS>
			"{
				dim @chkcard as string ;
				dim @tota as string;
				if(len(rtrim(#CARD_NO))!=19)
				{
					showmsg('卡号长度不正确，请重新输入!');
					return(false);
				}
				if(substr(#CARD_NO,0,6) != #CARDBIN2)
				{
					showmsg('卡号的前6位必须为'+#CARDBIN2);
					return(false);
				}
				initfd();
				commsend_001();
				$FD16='9959';
				$FD102=#CARD_NO;
				callserver();
				if($FD12!='0000')
				{
					showmsg(geterror());
					return(false);
				}
				#KH_NAME=substr($FD102,125,35);//户名
				enable(#KH_NAME,false);	
				initfd();
				commsend_001();
				$FD16='9160';
				$FD30=#CARD_NO;
				$FD67='1';//回显未开通的子账户类型
				@tota=callserver();
				if($FD12 != '0000')
				{
					showmsg(geterror());
					return(false);
				}
				show(#SUB_SEQN,true);
				show(#S_SUB_SEQN,true);
				show(#CARDPWD,true);
				show(#S_CARDPWD,true);
				setsel(#SUB_SEQN,@tota,'o5t20o1v4o2');
			}"
			</ONLOSTFOCUS>
		</ITEM>
		<ITEM LINE="7"   COL="5"  TYPE="%-9s"  FUNCTIONS="T(客户名称:)" />
		<ITEM LINE="7"   COL="14" TYPE="%-60s" NAME="#KH_NAME"  FUNCTIONS="V(NB)" INPUT="TEXT"/>
		<ITEM LINE="8"   COL="5"  TYPE="%-70s" FUNCTIONS="T(----------------------------------------------------------------------)"/>
		<ITEM LINE="10"  COL="5"  TYPE="%-11s" NAME="#S_SUB_SEQN" VISABLE="FALSE" FUNCTIONS="T(子业务名称:)" />
		<ITEM LINE="10"  COL="16" TYPE="%4d"   NAME="#SUB_SEQN"   DEVICE="KEYBOARD" INPUT="SELECT" VISABLE="FALSE" FUNCTIONS="V(NB)" />
		<ITEM LINE="11"  COL="5"  TYPE="%-11s" NAME="#S_CARDPWD"  VISABLE="FALSE" FUNCTIONS="T(密      码:)" />
		<ITEM LINE="11"  COL="16" TYPE="%6d"   NAME="#CARDPWD"    DEVICE="PINPAD"   INPUT="TEXT"   VISABLE="FALSE" FUNCTIONS="V(NB)i()" >
			<ONLOSTFOCUS>
			"{
				commsend_001();
				$FD16='9317';
				$FD30=#CARD_NO;
				$FD79=getitems('#CARDPWD');
				callserver();
				if($FD12!='0000')
				{
					showmsg(geterror());
					return (false);
				}
			}"
			</ONLOSTFOCUS>
		</ITEM>
		<ITEM NAME="#CARDBIN1" TYPE="%-6s"   FUNCTIONS="T(621223)"/>   <!--卡bin1-->
		<ITEM NAME="#CARDBIN2" TYPE="%-6s"   FUNCTIONS="T(621780)"/>   <!--卡bin2 fortest--> 
		<ITEM NAME="#TXNAME"   TYPE="%-12s"  FUNCTIONS="T(IC卡卡内开户)"/>  
		<ITEM NAME="#TRACK2"   TYPE="%-37s"  FUNCTIONS="T()"/>         <!--卡二磁-->
		<ITEM NAME="#TRACK3"   TYPE="%-104s" FUNCTIONS="T()"/>	       <!--卡三磁-->
		<ITEM NAME="#CCY"      TYPE="%-3s"   FUNCTIONS=""/>            <!--交易币种-->
		<ITEM NAME="#IC_ATC"   TYPE="%-4s"   FUNCTIONS=""/>            <!--应用交易计数器-->
		<ITEM NAME="#IC_AC"    TYPE="%-16s"  FUNCTIONS=""/>            <!--应用密文-->
		<!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
		<ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
		<ITEM NAME="#AUCODE" TYPE="%-1s" FUNCTIONS="T(#AUCODE)"/>      <!---授权标志--->
		<ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
			<ONCLICK>
			"{
				dim @shuju as string ;
				initfd();
				commsend_001();
				$FD30=delspace(#CARD_NO);
				$FD48=#SUB_SEQN;
				$FD79=#CARDPWD;
				callserver();
				if($FD12 != '0000')
				{
					showmsg(geterror());
					return(false);
				}
			}"
			</ONCLICK>
		</ITEM>
	</PAGE>
	<!--IMPORT>ic_qc_accinfo.IMP</IMPORT-->
</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE DEVICE="SCREEN"  DESC="交易完成">
	NOTHING
</PACKAGE>
	<PRINT>
	"{
		print(8,25,'操 作 成 功!');
	}"
	</PRINT>
</RESPONSE>
<RESPONSE>
	<PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="请打印业务专用凭证">
		NOTHING
	</PACKAGE>
	<PRINT>
	"{
		dim @txtime  as string;
		@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
		print( 5, 20,'机构名称:[30]',$BRNAME);
		print( 5,  2,'代码:[4 ]',$TXNO);
		print( 5, 13,'交易:[10 ]',$TXNO);
		print( 7, 20,'客 户 号:[12     ]',#KH_HM);
		print( 8, 20,'申请补换卡卡号:[19]',#CARD_NO);
		if (#CHANGEREASON == '0')
		{
			print( 9, 20,'补换卡原因:损坏补换卡');
		}
		else if(#CHANGEREASON == '1')
		{
			print( 9, 20,'补换卡原因:挂失补发新卡');
			print( 10,20,'挂失编号:[16]',#LOSTNO);
		}
		print( 15,20,'备注:');
		print( 15,27,'交易日期:[8] [8]',$HDATE,@txtime);
		print( 15, 5,'柜员:[4]',$FD7);
		print( 15,10,'流水号:[6]',$FD4);
	}"
	</PRINT>
</RESPONSE>
</TRANSACTION>
