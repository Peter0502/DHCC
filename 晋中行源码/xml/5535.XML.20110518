<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11111001" TITLE="5535  对账明细查询"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	commsend_001();
 	//$FD16='5555';
	//$FD44=getitems('#TX_DATE');
	//$FD44=#TX_DATE;
 	//$FD91 =#TX_BR_NO;

}"
</COMMSEND>

<COMMRECV>"{
	commrecv_001();
}"
</COMMRECV>

<VARIABLE UPLOOP="TRUE">
<ITEM LINE="3"  COL="3" TYPE="%-49s" FUNCTIONS=
"T(5535                        3111对账明细查询)"/>
<ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
"T(─────────────────────────────────────)"/>

<ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=5555)"/>
<ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
<ITEM NAME="#DOLIST" TYPE="%1s" FUNCTIONS="">
<ONLOSTFOCUS>
"{
	dim @selid as number;
	dim @ldxml as string;
	dim @filename as string;
	dim @tota as string;
	dim @payno as string;
	dim @cashno as string;
	dim @chkdate as string;
	dim @chkacc as string;
	dim @txamt as string;
	dim @tel as string;
	if(#DOLIST !='')
	{
			@selid=list_work();
			if(@selid &lt; 0)
			{
				list_del();
				rerun();
				return(true);
			}
			@selid=list_getselid();
                        if(@selid &lt; 0)
                        {
                                list_del();
                                rerun();
                                return(true);
                        }

			initfd();
			commsend_001();
			@payno = rtrim(list_gettext(@selid,0));
			@cashno = rtrim(list_gettext(@selid,1));
			@chkdate = rtrim(list_gettext(@selid,2));
			@chkacc = rtrim(list_gettext(@selid,3));
			@txamt = rtrim(list_gettext(@selid,4));
			@tel = $FD7;

//			runoutput('DZCX'+@payno+'|'+@cashno+'|'+@chkdate+'|'+@chkacc+'|'+@txamt+chr(10));
			open('55351.XML','#PAYNO='+@payno+';#CASHNO='+@cashno+';#CHKDATE='+@chkdate+';#CHKACC='+@chkacc+';#TXAMT='+@txamt+';#TEL='+@tel+';');
                	showfooter();

		return(true);
	}
	list_del();
	#DOLIST='';
}"
</ONLOSTFOCUS>
</ITEM>	
<ITEM NAME="#DOLIST" TYPE="%-1s" FUNCTIONS="">
<ONLOSTFOCUS>
"{
	showall();
}"
</ONLOSTFOCUS>
</ITEM>
  
  <!--输入变量-->
  <ITEM LINE="11"  COL="30" TYPE="%-10s" FUNCTIONS="T(交易机构:)"/>
  <ITEM LINE="13"  COL="30" TYPE="%-10s" FUNCTIONS="T(对帐日期:)"/>
  <ITEM LINE="13"  COL="50" TYPE="%-12s" FUNCTIONS="T(tips系统日期)"/>
 <ITEM NAME="#INIT" TYPE="%-1s" FUNCTIONS="">
       <ONLOSTFOCUS>"{
               if($KINBR=='10001')
               {
                  enable(#TX_BR_NO,true);
               }
       "}</ONLOSTFOCUS>
 </ITEM>
 <ITEM NAME="#TX_BR_NO" LINE="11" COL="39" TYPE="%-5s" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="T($KINBR)"/>

  <ITEM NAME="#TX_DATE"  LINE="13" COL="40"  DEVICE="KEYBOARD" TYPE="%8d"  FUNCTIONS="D()V(NB)"/>
  
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
  <ONCLICK>"{
	dim @tota as string;
	dim @offset as number;
	dim @cnt as number;
	dim @packlen as number;
	dim @flag as string;
	dim @id as number;
	list_init(17,78,5,1);
	list_setcolcnt(6);
	initfd();

	commsend_001();
 	$FD91 =#TX_BR_NO;
 	$FD16='5555';
	$FD44=getitems('#TX_DATE');
	@tota=calltips();
	if($FD12!='0000')
	{
		showmsg(geterror());
		return(false);
	}
	if(substr(@tota,36,1)=='E')
	{
		showmsg(substr(@tota,36,5) +'  '+substr(@tota,44,40))
		list_del();
		return(true);
	}

	if(autolist(@tota))
	{
		list_work();
	}

	#DOLIST='1';
	}"
</ONCLICK>
</ITEM>
</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
    <PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="请打印业务专用凭证">
	DZCX|@payno|@cashno|@chkdate|@chkacc|@txamt
    </PACKAGE>
    <PRINT>
    	"{
   dim @txtime as string;
   @txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
   print(5,10,'机构名称:[30]',$BRNAME);
   print(5, 2, '交易代码:5535');
   print(5,5,'交易名称:对账明细查询');
   print(6,5,'付款行号:[12     ]',@payno);
   print(7,5,'国库行号:[12     ]',@cashno);
   print(8,5,'对账日期:[8     ]',@chkdate);
   print(9,5,'对账批次:[8     ]',@chkacc);
   print(10,5,'金    额:[21]',@txamt));
   print(10,5,'对账机构:[5  ]',$KINBR);
   print(13,10,'交易日期:[8] [8]',$HDATE,@txtime);
   print(13,5,' 前置柜员:[6]',$FD7);
   print(13,5,' 流水号:[6]',$FD4);
   print(13,5,' 交易机构:[5]',$FD3);
    }"
    </PRINT>
</RESPONSE>
</TRANSACTION>
