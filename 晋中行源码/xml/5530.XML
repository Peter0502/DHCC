<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11111001" TITLE="5530 登录TIPS交易"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
    	commsend_001();
	    $FD25=#PASSWORD;
	    $FD26=#NEWPASWD;
}"
</COMMSEND>
<COMMRECV>"{
	commrecv_001();

}"
</COMMRECV>
<VARIABLE UPLOOP="TRUE">
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(5530                        登录TIPS交易)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=5550)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>

  <ITEM LINE="10" COL="7"   TYPE="%-7s"  FUNCTIONS="T(口  令:)"/>
  <ITEM LINE="12" COL="7"   TYPE="%-7s"  FUNCTIONS="T(新口令:)"/>
  <ITEM LINE="12" COL="49"  TYPE="%-30s" FUNCTIONS="T([需要重置新密码时才需输入此项])"/>

  <!--输入变量-->
  <ITEM NAME="#PASSWORD" LINE="10" COL="15" TYPE="%-32s" INPUT="TEXT" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>"{
	dim @a as number;
	@a = len(#PASSWORD);
	if( @a &lt; 8)
	{
	        showmsg('口令长度不能小于8');
                return(false);

	}
  }"</ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#NEWPASWD" LINE="12" COL="15" TYPE="%-32s" INPUT="TEXT" FUNCTIONS="">
  <ONLOSTFOCUS>"{
	dim @a as number;
	@a = len(#NEWPASWD);
	if( @a !=0)
	{
		if( @a &lt; 8)
		{
	        	showmsg('口令长度不能小于8');
                	return(false);

		}
	}
  }"</ONLOSTFOCUS>
</ITEM> 


  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  <ITEM NAME="#RETSTAT" TYPE="%-4s" FUNCTIONS="T()"/>

  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
  	<ONCLICK>"{
          commsend_001();
          $FD16='5550';
	        $FD25=#PASSWORD;
	        $FD26=#NEWPASWD;
	        calltips();
	        if($FD12!='0000'){
	          showmsg(geterror());
	          return(false);
	        }
	        // showmsg($FD67); 
	        if($FD67 == '1')
	        {
	        	setitems('#RETSTAT','登录');		
	        }
	        else if($FD67 == '2')
          {
            setitems('#RETSTAT','故障');
          }
	        else if($FD67 == '3')
          {
            setitems('#RETSTAT','签退');
          }
	        else if($FD67 == '4')
          {
            setitems('#RETSTAT','停用');
          }
	        runoutput();
	        rerun();
  		}"
</ONCLICK>
</ITEM>

</VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
    <PACKAGE DEVICE="SCREEN" DESC="显示内容" >
    NOTHING
    </PACKAGE>
    <PRINT>"{
	            print( 3, 10,'机   构   号:[5]',$KINBR);
              print( 4, 10,'机 构  名 称:[20]',$BRNAME);
	            print( 5, 10,'流   水   号:[6]',$FD4);
	            print( 7, 10,'登 录  结 果:[5]',$FD86);
              print( 8, 10,'当前系统状态:[4]',#RETSTAT);
              print( 9, 10,'附        言:[60]',$FD76);
     }"
    </PRINT>
</RESPONSE>
<RESPONSE>
    <PACKAGE DEVICE="PRINTER" LINESPACE="24"   DESC="请打印业务专用凭证" >
    NOTHING
    </PACKAGE>
    <PRINT>"{
	$KINDNO = '00';
	dim @txtime as string;
	@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	print(5, 20,'机构名称:[30]',$BRNAME);
	print(5,  2,'交易代码:5530');
	print(5, 13,'交易名称:登录TIPS交易'); 
	print(10,20,'登 录  结 果:[5]',$FD86);
	print(11,20,'当前系统状态:[4]',#RETSTAT);
	print(12,20,'附        言:[60]',$FD76);
	print(24,20,'交易日期:[8] [8]',$HDATE,@txtime);
  print(24, 5,'流水号:[6]',$FD4);
  print(24, 5,'交易机构:[24]',substr($FD74,0,24));
 }"
    </PRINT>
</RESPONSE>
</TRANSACTION>
