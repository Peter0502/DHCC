<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11111111" TITLE="     小额非支付明细"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">

<VARIABLE>

  <ITEM LINE="3"  COL="3" TYPE="%-52s" FUNCTIONS=
    "T(LVFZF                      小额非支付明细)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
    "T(─────────────────────────────────────)"/>
  <ITEM LINE="06"  COL="08"  TYPE="%-12s"  FUNCTIONS="T(交易日期:)"/>
  <ITEM LINE="06"  COL="47"  TYPE="%-9s"  FUNCTIONS="T(交易类型:)"/>
  <ITEM LINE="07"  COL="08"  TYPE="%-12s"  FUNCTIONS="T(交易序号:)"/>
  <ITEM LINE="08"  COL="08"  TYPE="%-12s"  FUNCTIONS="T(申请行号:)"/>
  <ITEM LINE="09"  COL="08"  TYPE="%-12s"  FUNCTIONS="T(接受行号:)"/>
  <ITEM LINE="10"  COL="08"  TYPE="%-12s"  FUNCTIONS="T(当前状态:)"/>

  <ITEM LINE="12"  COL="08"  TYPE="%-12s"  FUNCTIONS="T(原报文编号:)"/>
  <ITEM LINE="13"  COL="08"  TYPE="%-14s"  FUNCTIONS="T(原委托日期:)"/>
  <ITEM LINE="14"  COL="08"  TYPE="%-16s"  FUNCTIONS="T(原支付交易序号:)"/>
  <ITEM LINE="15"  COL="08"  TYPE="%-16s"  FUNCTIONS="T(原发起行行号:)"/>
  <ITEM LINE="16"  COL="08"  TYPE="%-14s"  FUNCTIONS="T(原接收行行号:)"/>
  <ITEM LINE="17"  COL="08"  TYPE="%-14s"  FUNCTIONS="T(原交易金额:)"/>

 <BLOCK NAME="BLOCK_RES_LB" COL="0" LINE="17" VISABLE="FALSE">
  <ITEM LINE="1"  COL="08"  TYPE="%-9s"  FUNCTIONS="T(应答行号:)"/>
  <ITEM LINE="1"  COL="47"  TYPE="%-9s"  FUNCTIONS="T(应答结果:)"/>
  <ITEM LINE="2"  COL="08"  TYPE="%-9s"  FUNCTIONS="T(应答序号:)"/>
  <ITEM LINE="3"  COL="08"  TYPE="%-9s"  FUNCTIONS="T(应答日期:)"/>
 </BLOCK>
 
  

  <ITEM NAME="#RES_NOTPAY_CONTENT"  TYPE="%-255s"     FUNCTIONS=""/>
  <ITEM NAME="#LW_IND" TYPE="%-1s" FUNCTIONS="T($BUFFER,804,1)"/>
  <ITEM NAME="#RES_STS" TYPE="%-1s" FUNCTIONS="T($BUFFER,799,1)">
  <ONLOSTFOCUS>
  "{
	showblock('BLOCK_RES_LB',false,true);
	showblock('BLOCK_RES_TX',false,true);

	if(#RES_STS=='0' or #RES_STS=='1' or #RES_STS=='9' or #RES_STS=='2')
	{
		showblock('BLOCK_RES_LB',true,true);
		showblock('BLOCK_RES_TX',true,true);
	}
   }"
   </ONLOSTFOCUS>
   </ITEM>
  <ITEM LINE="6"   COL="20"  NAME="#TX_DATE"     TYPE="%-8s"    FUNCTIONS="V(NB)"/>
  <ITEM NAME="#CMT_DES"     TYPE="%-20s"    FUNCTIONS=""/>
  <ITEM NAME="#CMTNO"     TYPE="%-3s"    FUNCTIONS="T($BUFFER,1,3)">
  <ONLOSTFOCUS>
  "{
	if(#LW_IND=='2')
		show(#RESPONSE,true);
	LV_SET_CMTNAME();
	#CMT_DES1= #CMT_DES;
   }"
   </ONLOSTFOCUS>
   </ITEM>
  <ITEM LINE="6"   COL="56"  NAME="#CMT_DES1"     TYPE="%-20s"    FUNCTIONS="V(NB)"/>
  <ITEM LINE="7"   COL="20"  NAME="#ORDERNO"   TYPE="%-8s"    FUNCTIONS="V(NB)T($BUFFER,393,8)"/>
  <ITEM LINE="8"   COL="20"  NAME="#QR_BRNO"   TYPE="%-12s"  FUNCTIONS="V(NB)T($BUFFER,19,12)"/> 
  <ITEM LINE="9"   COL="20"  NAME="#CR_BRNO"   TYPE="%-12s"  FUNCTIONS="V(NB)T($BUFFER,211,12)"/> 
  <ITEM 		    NAME="#TMP_TXSTAT" TYPE="%-1s" FUNCTIONS="T($BUFFER,801,1)">
  <ONLOSTFOCUS>
  "{
	LV_SET_STAT();
   }"
   </ONLOSTFOCUS>
   </ITEM>
  <ITEM LINE="10"   COL="20" NAME="#TXSTAT"    TYPE="%-16s"    FUNCTIONS=""/>

   <ITEM  NAME="#OCMTNO"   TYPE="%-3s"    INPUT="LABEL"   FUNCTIONS="V(NB)T($BUFFER,4,3)">
   <ONLOSTFOCUS>
   "{
	dim @cmtno as string;
	@cmtno = #CMTNO;
	 #CMTNO = #OCMTNO;
	 LV_SET_CMTNAME();
	#CMTNO = @cmtno;
	 #OCMTNO_DES = #CMT_DES;
		
    }"
   </ONLOSTFOCUS>
   </ITEM>
   <ITEM LINE="12"  COL="24" NAME="#OCMTNO_DES"   TYPE="%-20s"    INPUT="LABEL"   FUNCTIONS=""/>
   <!--
         <SELECT LINE="21" COL="4">
                <OPTION VALUE="100 汇兑"           TITLE="0.汇兑(100)"/>
                <OPTION VALUE="101 委托收款"       TITLE="1.委托收款(101)"/>
                <OPTION VALUE="102 托收承付"       TITLE="2.托收承付(102)"/>
                <OPTION VALUE="105 拆借"           TITLE="3.拆借(105)"/>
                <OPTION VALUE="109 电子联行" 	   TITLE="4.电子联行(109)"/>
	      	<OPTION VALUE="121 资金移存"       TITLE="5.资金移存(121)"/>
	      	<OPTION VALUE="122 银行资金清算"   TITLE="6.银行资金清算(122)"/>
	      	<OPTION VALUE="123 多余资金退回"   TITLE="7.多余资金退回(123)"/>
	      	<OPTION VALUE="124 汇票未用退回"   TITLE="8.汇票未用退回(124)"/>
	      	<OPTION VALUE="721 申请兑付"       TITLE="9.申请兑付(721)"/>
	      	<OPTION VALUE="724 汇票申请退回"   TITLE="a.汇票申请退回(724)"/>
	      	<OPTION VALUE="725 全额兑付通知"   TITLE="b.全额兑付通知(725)"/>
        </SELECT>
  </ITEM>
  --->
  <ITEM LINE="13"   	COL="24" NAME="#OWTDATE"  	TYPE="%-8s"    	FUNCTIONS=""/>
  <ITEM LINE="14"  	COL="24" NAME="#ORDERNOHV"  	TYPE="%8d"  	FUNCTIONS="T($BUFFER,473,8)"/> 
  <ITEM 			 NAME="#FLAG"		TYPE="%-1s"	FUNCTIONS="T($BUFFER,537,1)">
  <ONLOSTFOCUS>
  "{
		if(#FLAG=='A')
		{
			#OORBRNO = #CR_BRNO;
			#OACBRNO = #QR_BRNO;	
		}
		else if(#FLAG=='B')
		{
			#OORBRNO = #QR_BRNO;
			#OACBRNO = #CR_BRNO;
		}
		enable(#OACBRNO,true);
		enable(#OORBRNO,true);
				
   }"
   </ONLOSTFOCUS>
   </ITEM>
  <ITEM LINE="15" 	COL="24" NAME="#OORBRNO" 	TYPE="%-12s"   	FUNCTIONS=""/>
  <ITEM LINE="16" 	COL="24" NAME="#OACBRNO" 	TYPE="%-12s"   	FUNCTIONS=""/>
  <ITEM 		   NAME="#TMP_TXAMT" TYPE="%-16s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
	#HTXAMT	= atoi(#TMP_TXAMT)/100;	
   }"
   </ONLOSTFOCUS>
   </ITEM>
  <ITEM 		   NAME="#HTXAMT" TYPE="%16.2f" FUNCTIONS=""/>


  <ITEM LINE="17" COL="24" NAME="#LHTXAMT" 	TYPE="%-17s"   		FUNCTIONS="X(#HTXAMT)"/>
 <ITEM NAME="#INITLIST" TYPE="%-1s" FUNCTIONS="">
  <ONLOSTFOCUS>"{
        dim @reason as string;
        dim @reason1 as string;
        @reason=substr($BUFFER,537,255);
        @reason=delspace(@reason);
        @reason1=#RES_NOTPAY_CONTENT;
        @reason1=delspace(@reason1);
        if(len(@reason1)==0){
          @reason1='';
        }
        else{
          @reason=@reason+'------------应答内容----------'+@reason1;
        }
	      #CONTENT = substr($BUFFER,537,255);
        if(#INITLIST==''){
                list_init(12,32,5,44);
                list_loadtext('交易附言',@reason);
                #INITLIST='1';
                list_show();
        }else{
                list_work();
        }
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#CONTENT" TYPE="%-255s" FUNCTIONS=""/>
 <BLOCK NAME="BLOCK_RES_TX" COL="0" LINE="17" VISABLE="FALSE">
  <ITEM LINE="1"  COL="24"  TYPE="%-12s" NAME="#RES_BRNO"  	FUNCTIONS="T($BUFFER,497,12)"/>
  <ITEM LINE="1"  COL="56"  TYPE="%-10s" NAME="#RES_STS_DESC"	FUNCTIONS="T(          )j(#RES_STS=1,T{同意应答})j(#RES_STS=2,T{不同意应答})j(#RES_STS=9,T{已被查复})"/>
  <ITEM LINE="2"  COL="24"  TYPE="%-8s" NAME="#RES_ORDERNO"  	FUNCTIONS="T($BUFFER,509,8)"/>
  <ITEM LINE="3"  COL="24"  TYPE="%-8s" NAME="#RES_DATE"  	FUNCTIONS="T($BUFFER,489,8)"/>
  </BLOCK>

  <ITEM NAME="#PRINTER_FLAG" TYPE="%-1s" FUNCTIONS="T(0)"/>
  
  <ITEM LINE="21"  COL="35" NAME="#CLOSE"    INPUT="BUTTON" TYPE="%-6s" FUNCTIONS="T(确 定)">
  <ONCLICK>"{
  	close();
  }"
  </ONCLICK>
  </ITEM>
  
    <ITEM LINE="21"  COL="45" NAME="#PRINTER"    INPUT="BUTTON" TYPE="%-6s" FUNCTIONS="T(打 印)">
  <ONCLICK>"{
  	#PRINTER_FLAG = '1';
  	runoutput();
  }"
  </ONCLICK>
  </ITEM>
  
  <ITEM LINE="21"  COL="55" NAME="#RESPONSE"    INPUT="BUTTON" VISABLE="FALSE"  TYPE="%-9s" FUNCTIONS="T(应答/查复)">
  <ONCLICK>"{
	if(#TMP_TXSTAT=='H')
	{
		if(#RES_STS=='1' or #RES_STS=='2' or #RES_STS=='9')
		{
			showmsg('该笔交易已经做过应答了');
		}
		if(#CMTNO=='301')
		{
			open('5325.XML','#NOTPAY_DATE='+#TX_DATE+';#QR_TX_NUM='+#ORDERNO+';#AC_BR_NO='+#QR_BRNO+';');
		}
		if(#CMTNO=='319')
		{
			open('5319.XML','#NOTPAY_DATE='+#TX_DATE+';#QR_TX_NUM='+ORDERNO+';#AC_BR_NO='+#QR_BRNO+';');
		}
		if(#CMTNO=='327')
		{
			open('5323.XML','#NOTPAY_DATE='+#TX_DATE+';#QR_TX_NUM='+#ORDERNO+';#AC_BR_NO='+#QR_BRNO+';');
		}
			
	}
	else
	
  		showmsg('此种状态交易无法应答');

  					
  }"
  </ONCLICK>
  </ITEM>
</VARIABLE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER" DESC="按任意键退出"  CHECK="#PRINTER_FLAG=1">
NOTHING
</PACKAGE> 
    
    <PRINT>"{
    	
   	print(3,25,'小额非支付交易明细');
        print(05,15,'交易日期 :[08]          业务类型 :[20]',#TX_DATE,#CMT_DES1);
        print(06,15,'交易序号 :[08]          申请行号 :[12]',#ORDERNO,#QR_BRNO);
        print(07,15,'当前状态 :[08]',#TXSTAT);
        print(08,15,'接受行号 :[12]',#CR_BRNO);
        print(10,15,'原报文编号 :[20]',#OCMTNO_DES); 
        print(11,15,'原委托日期 :[08]',#OWTDATE);
        print(12,15,'原支付序号 :[08]',#ORDERNOHV);
        print(13,15,'原发起行号 :[12]',#OORBRNO);
        print(14,15,'原接受行号 :[12]' ,#OACBRNO);
        print(15,15,'原交易金额 :[60]',#LHTXAMT);
        print(17,15,'原 附 言   :[60]',substr(#CONTENT,0,60));
        print(18,15,'[60]',substr(#CONTENT,60,60));
        print(19,15,'[60]',substr(#CONTENT,120,60));
        print(20,15,'[75]',substr(#CONTENT,180,75));        
        print(21,15,'应答机构 :[12]          应答结果 :[10]',#RES_BRNO,#RES_STS_DESC);
        print(22,15,'应答序号 :[08]',#RES_ORDERNO);
        print(23,15,'应答日期 :[12]',#RES_DATE);
        
        
}"
</PRINT>
</RESPONSE>
</TRANSACTION>
