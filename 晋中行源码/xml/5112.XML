<TRANSACTION RIGHTS="11110000" TITLE="5112   银行汇票基本信息查询"
xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>
"{
  commsend_001();
  commsend_123();
  commsend_hv();
  $FD71    = #BANK_TYPE; 
  $FD72    = #PO_STS; 
  $FD45    = #O_WT_DAY;
}"
</COMMSEND>
<COMMRECV>
"{
  commrecv_001();
}"
</COMMRECV>

<VARIABLE>
<ITEM LINE="3"  COL="3" TYPE="%-70s" FUNCTIONS=
"T(5112                         银行汇票基本信息查询)"/>
<ITEM LINE="4"  COL="3"  TYPE="%-70s" FUNCTIONS=
"T(───────────────────────────────────)"/>

<ITEM NAME="#MSGTYPE"   TYPE="%-5s"    FUNCTIONS="T($MSGTYPE=03001)"/>
<ITEM NAME="#TXNO"      TYPE="%-4s"    FUNCTIONS="T($TXNO=5812)"/>
<ITEM NAME="#DOLIST" TYPE="%1s" FUNCTIONS="">
<ONLOSTFOCUS>
"{
  dim @selid as number;
  dim @filename as string;
  dim @po_no    as string;
  
  
  if(#DOLIST !='')
  {
    while(true)
    {
      @selid=list_work();
      if(@selid &lt; 0)
      {
        list_del();
        rerun();
        return(true);
      }
      initfd();
      commsend_001();
      $FD16 = '9560';
      
      #PO_NO = rtrim(list_gettext(@selid,2));
      @po_no = rtrim(list_gettext(@selid,2));
      #PAY_OPN_BR_NO=rtrim(list_gettext(@selid,1));
      
      
      commsend_123();
      
      callserver();
      
      if($FD12!='0000')
      {
        showmsg(geterror());
        return (false);
      }
      commrecv_123();
      $BUFFER = $FD123;
      
      @filename = 'HVPOINFO.XML';
      open(@filename,'#PO_NO='+#PO_NO+';#PO_STS='+$FD68+';#TMP_TXAMT='+$FD39+';#REG_DATE='+$FD45+';#SIGN_DATE='+$FD46+';#DEAL_MODE='+$FD72+';');  
      
      return(true);
    }
  }
  list_del();
  #DOLIST='';
}"
</ONLOSTFOCUS>
</ITEM>  

<ITEM NAME="#DOLIST1" TYPE="%-1s" FUNCTIONS="">
<ONLOSTFOCUS>
"{
  showall();
}"
</ONLOSTFOCUS>
</ITEM>

  <ITEM NAME="#CMTNO"          TYPE="%-3s"    FUNCTIONS=""/>
  <ITEM NAME="#O_CMTNO"        TYPE="%-3s"    FUNCTIONS=""/>
  <ITEM NAME="#PAY_QS_NO"      TYPE="%-12s"   FUNCTIONS=""/>
  <ITEM NAME="#OR_BR_NO"       TYPE="%-12s"   FUNCTIONS=""/>
  <ITEM NAME="#SENDCO"         TYPE="%-4s"    FUNCTIONS=""/>
  <ITEM NAME="#PAY_AC_NO"      TYPE="%-32s"    FUNCTIONS=""/>
  <ITEM NAME="#PAY_NAME"       TYPE="%-60s"    FUNCTIONS=""/>
  <ITEM NAME="#PAY_ADDR"       TYPE="%-60s"    FUNCTIONS=""/>
  <ITEM NAME="#CASH_QS_NO"     TYPE="%-12s"    FUNCTIONS=""/>
  <ITEM NAME="#AC_BR_NO"       TYPE="%-12s"    FUNCTIONS=""/>
  <ITEM NAME="#RECECO"         TYPE="%-4s"     FUNCTIONS=""/>
  <ITEM NAME="#CASH_OPN_BR_NO" TYPE="%-12s"    FUNCTIONS=""/>
  <ITEM NAME="#CASH_AC_NO"     TYPE="%-32s"    FUNCTIONS=""/>
  <ITEM NAME="#CASH_NAME"      TYPE="%-60s"    FUNCTIONS=""/>
  <ITEM NAME="#CASH_ADDR"      TYPE="%-60s"    FUNCTIONS=""/>
  <ITEM NAME="#YW_TYPE"        TYPE="%-2s"     FUNCTIONS=""/>
  <ITEM NAME="#ORDERNO"        TYPE="%-8s"     FUNCTIONS=""/>
  <ITEM NAME="#CONTENT"        TYPE="%-60s"    FUNCTIONS=""/>
  <ITEM NAME="#RATE"           TYPE="%-7s"     FUNCTIONS=""/>
  <ITEM NAME="#RATEDATE"       TYPE="%-5s"     FUNCTIONS=""/>
  <ITEM NAME="#OORDERNO"       TYPE="%-8s"     FUNCTIONS=""/>
  <ITEM NAME="#PROCODE"        TYPE="%-8s"     FUNCTIONS=""/>
  <ITEM NAME="#CR_DATE"             TYPE="%-8s"         FUNCTIONS=""/>
  <ITEM NAME="#CR_BR_NO"             TYPE="%-12s"        FUNCTIONS=""/>
  <ITEM NAME="#CR_TX_NUM"            TYPE="%-8s"         FUNCTIONS=""/>
  <ITEM NAME="#QR_BR_NO"            TYPE="%-12s"        FUNCTIONS=""/>
  <ITEM NAME="#QR_TX_NUM"           TYPE="%-8s"         FUNCTIONS=""/>
  <ITEM NAME="#TX_TYPE"             TYPE="%-1s"         FUNCTIONS=""/>
  <ITEM NAME="#NOTPAY_CONTENT"      TYPE="%-255s"       FUNCTIONS=""/>
  <ITEM NAME="#NOTPAY_ORDERNO"      TYPE="%-3s"         FUNCTIONS=""/>
  <ITEM NAME="#O_NOTPAY_ORDERNO"    TYPE="%-3s"         FUNCTIONS=""/>
  <ITEM NAME="#RESP1"               TYPE="%-1s"         FUNCTIONS=""/>
  <ITEM NAME="#OPERLEVEL"           TYPE="%-1s"         FUNCTIONS=""/><!--优先级别-->
  <ITEM NAME="#PROC_STS"            TYPE="%-1s"         FUNCTIONS=""/><!--处理状态-->

  <ITEM NAME="#WT_DAY"            TYPE="%-8s"         FUNCTIONS=""/>
  <ITEM NAME="#NOTPAY_DATE"       TYPE="%-8s"         FUNCTIONS=""/>
  <ITEM NAME="#TX_AMT"            TYPE="%-16.2f"       FUNCTIONS=""/>
  <ITEM NAME="#CUR_NO"            TYPE="%-3s"          FUNCTIONS=""/>
  <ITEM NAME="#OPCD"              TYPE="%-2s"         FUNCTIONS=""/>
  <ITEM NAME="#NOTE_TYPE"         TYPE="%-3s"         FUNCTIONS=""/>
  <ITEM NAME="#NOTE_NO"           TYPE="%-16s"        FUNCTIONS=""/>
  <ITEM NAME="#LW_IND"            TYPE="%-1s"         FUNCTIONS=""/>
  <ITEM NAME="#HP_ADD_PWD"      TYPE="%-1s"     FUNCTIONS=""/>
  <ITEM NAME="#PACKID"          TYPE="%8d"      FUNCTIONS=""/>
  <ITEM NAME="#O_PACKID"          TYPE="%8d"         FUNCTIONS=""/>
  <ITEM NAME="#PACK_DATE"       TYPE="%8d"      FUNCTIONS=""/>
  <ITEM NAME="#O_PACK_DATE"     TYPE="%8d"      FUNCTIONS=""/>
  <ITEM NAME="#TXNUM"       TYPE="%5d"      FUNCTIONS=""/>
  <ITEM NAME="#O_TXNUM"         TYPE="%5d"      FUNCTIONS=""/>
  <ITEM NAME="#LV_YW_IND"       TYPE="%12s"     FUNCTIONS=""/>
  <ITEM NAME="#RESP_DATE"       TYPE="%8d"      FUNCTIONS=""/>
  <ITEM NAME="#RCP_STS"         TYPE="%2d"      FUNCTIONS=""/>
  <ITEM NAME="#RESP2"             TYPE="%8s"         FUNCTIONS=""/>
  <ITEM NAME="#RETCODE"           TYPE="%2d"         FUNCTIONS=""/>
  <ITEM NAME="#YW_DTL_ID"         TYPE="%8d"         FUNCTIONS=""/>
  <ITEM NAME="#ACC_IND"           TYPE="%1d"         FUNCTIONS=""/>
  <ITEM NAME="#REQ_TYPE"          TYPE="%1d"         FUNCTIONS=""/>
  <ITEM NAME="#DF_FREEAMT"        TYPE="%16s"        FUNCTIONS=""/>
  <ITEM NAME="#PROTNO"            TYPE="%60s"        FUNCTIONS=""/>
  <ITEM NAME="#PO_TYPE"           TYPE="%1d"         FUNCTIONS=""/>
  <ITEM NAME="#OTYPE"             TYPE="%1d"         FUNCTIONS="T(1)"/><!-- 表示大额 -->


  <ITEM LINE="6"   COL="15" TYPE="%-9s"    FUNCTIONS="T(签发日期:)"/>
  <ITEM LINE="8"   COL="15" TYPE="%-9s"    FUNCTIONS="T(签发行别:)"/>
  <ITEM LINE="10"  COL="15" TYPE="%-9s"    NAME="#LB0"  INPUT="LABEL" VISABLE="FALSE"    FUNCTIONS="T(签 发 行: )"/>
  <ITEM LINE="12"  COL="15" TYPE="%-9s"    FUNCTIONS="T(汇票状态:!)"/>
  <ITEM LINE="14"  COL="15" TYPE="%-9s"    FUNCTIONS="T(汇票号码:)"/>


  <ITEM LINE="6"   COL="24" NAME="#O_WT_DAY" TYPE="%-8s" INPUT="TEXT"   FUNCTIONS="T($HDATE)"/>
  <ITEM LINE="8"   COL="24" NAME="#BANK_TYPE" TYPE="%-1s" INPUT="SELECT" FUNCTIONS="T(0)V(NB)">
  <SELECT LINE="8" COL="29">
    <OPTION VALUE="0"     TITLE="0.本行汇票  "/>
    <OPTION VALUE="1"     TITLE="1.他行汇票"/>
  </SELECT>
  <ONLOSTFOCUS>
  "{
    if(#BANK_TYPE=='0')
    {
      show(#AC_BR_NO,false);
      show(#PAY_OPN_BR_NO,false);
      show(#LB0,false);
    }
    else
    {
      show(#AC_BR_NO,true)
      show(#PAY_OPN_BR_NO,true);
      show(#LB0,true);
    }
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="10"   COL="24" NAME="#PAY_OPN_BR_NO" TYPE="%-12s"   INPUT="TEXT" INPUT="TEXT" VISABLE="FALSE"  FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
    showmsg('不输入将匹配所有的行号!');
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="12"   COL="24" NAME="#PO_STS" TYPE="%-1s"  INPUT="SELECT" FUNCTIONS="T(Z)">
    <SELECT LINE="12" COL="29">
      <OPTION VALUE="Z" TITLE="0.全部"/>
      <OPTION VALUE="0" TITLE="0.汇票登记"/>
      <OPTION VALUE="1" TITLE="0.汇票签发(复核)"/>
      <OPTION VALUE="2" TITLE="0.资金移存记帐"/>
      <OPTION VALUE="3" TITLE="0.申请兑付"/>
      <OPTION VALUE="4" TITLE="0.汇票兑付"/>
      <OPTION VALUE="5" TITLE="0.全额结清"/>
      <OPTION VALUE="6" TITLE="0.部分退回"/>
      <OPTION VALUE="7" TITLE="0.未用退回"/>
      <OPTION VALUE="8" TITLE="0.汇票正常解付"/>
      <OPTION VALUE="9" TITLE="0.汇票签发取消"/>
      <OPTION VALUE="A" TITLE="0.解付取消"/>
      <OPTION VALUE="B" TITLE="0.发送"/>
      <OPTION VALUE="C" TITLE="0.申请兑付取消"/>
      <OPTION VALUE="D" TITLE="0.汇票登记取消"/>
      <OPTION VALUE="E" TITLE="0.挂失"/>
      <OPTION VALUE="F" TITLE="0.解挂"/>
      <OPTION VALUE="G" TITLE="0.逾期未用退回"/>
      <OPTION VALUE="H" TITLE="0.未用解付"/>
      <OPTION VALUE="I" TITLE="0.未用退回冲帐"/>
    </SELECT>
    </ITEM>
    <ITEM LINE="14"   COL="24" NAME="#PO_NO" TYPE="%8d"  INPUT="TEXT"   FUNCTIONS="">
    <ONLOSTFOCUS>
    "{
      showmsg('不输入匹配将匹配全部');
    }"
    </ONLOSTFOCUS>
    </ITEM>



    <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
    <ITEM NAME="#PASSWD"   TYPE="%-6s" FUNCTIONS="T()"/>

    <ITEM LINE="21"  COL="65"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
    <ONCLICK>
    "{
      dim @tota as string;
      initfd();
      commsend_001();
      commsend_123();
      commsend_hv();
      $FD71    = #BANK_TYPE; 
      $FD72    = #PO_STS; 
      $FD16    = '5812';

      @tota=callserver();
      if($FD12!='0000')
      {
        showmsg(geterror());
        return(false);
      }
      if(substr(@tota,36,1)=='E')
      {
        showmsg(substr(@tota,36,5) +'  '+substr(@tota,44,40))
        list_del();
        return(true);
      }
      if(autolist(@tota))
      {
        list_work();
      }

      #DOLIST='1';  
         }"
         </ONCLICK>
         </ITEM>
    

     </VARIABLE>
    <!--发送信息包-->
    <REQUEST>
    </REQUEST>

    <!--接收信息包-->
    <RESPONSE>
    <PACKAGE>
    NOTHING
    </PACKAGE>
        <PRINT>"{
       print(3,25,'汇票基本信息查询');
    }"
    </PRINT>
    </RESPONSE>
    <OUTPUT>
  </OUTPUT>
  </TRANSACTION>



