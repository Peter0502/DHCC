<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="111111100000000000000000000000000" TITLE="5370 代收付业务查询"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">

<COMMSEND>
"{
}"
</COMMSEND>

<COMMRECV>
"{
}"
</COMMRECV>

<VARIABLE>
  <ITEM LINE="3" COL="3" TYPE="%-60s" FUNCTIONS=
    "T(5370                     代收付业务查询)"/>
  <ITEM LINE="4" COL="3" TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=5409)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  <ITEM NAME="#DOLIST" TYPE="%1s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
		dim @selid as number;
		dim @filename as string;
		dim @tota as string;
		dim @wt_date as string;
		dim @packid as string;
		dim @orderno as string;
		dim @tx_type as string;
		dim @br_no as string;
		dim @tx_name as string;
		dim @sts as string;
		//add by sunlicheng 20110617 start 当从DSFLIST.XML返回时,可以根据传入条件,重新查询
		if(#AUTOSEARCH!='')
		{
				#AUTOSEARCH='';
				dim @tota2 as string;
				initfd();
				commsend_001();
				$FD16='5406';
				$FD91=#BR_NO;
				$FD44=#RQ;
				$FD50=#TYPE;
				@tota2=callserver();
				if($FD12!='0000')
				{
					showmsg(geterror());
					return(false);
				}
				if(autolist(@tota2))
				{
				   #DOLIST='1';
				}
		}
		//add by sunlicheng 20110617 end

		if(#DOLIST != '')
		{
    	//add by sunlicheng 20110616 start
      //清空#DOLIST保证DSFLIST.XML关闭以后返回本交易时,不会再次初始化LIST框
      #DOLIST='';
    	//add by sunlicheng 20110616 end
			@selid=list_work();
			if(@selid &lt; 0)
			{
				list_del();
				//close();
				return(true);
			}

			@br_no         = rtrim(list_gettext(@selid,0));
			@wt_date       = rtrim(list_gettext(@selid,1));
			@packid        = rtrim(list_gettext(@selid,2));
			@orderno       = rtrim(list_gettext(@selid,3));
			@tx_name       = rtrim(list_gettext(@selid,4));
			@sts           = rtrim(list_gettext(@selid,5));
			@tx_type       = rtrim(list_gettext(@selid,7));
			initfd();
			commsend_001();
    	//add by sunlicheng 20110615 start
    	//删除List框,再打开下DSFLIST.XML,目前win前台不支持同时两个交易中list_work()方式打开LIST
      list_del();
      //传递给DSFLIST当前查询条件的值,保证再返回本交易时,进行自动查询
			//open('DSFLIST.XML','#PACK_ID='+@packid+';#WT_DATE='+@wt_date+';#ORDER_NO='+@orderno+';#TX_TYPE='+@tx_type+';#BR_NO='+#BR_NO+';#RQ='+#RQ+';#TYPE='+#TYPE);
			open('DSFLIST.XML','#PACK_ID='+@packid+';#WT_DATE='+@wt_date+';#ORDER_NO='+@orderno+';#TX_TYPE='+@tx_type+';#ASBR_NO='+#BR_NO+';#ASRQ='+#RQ+';#ASTYPE='+#TYPE);
			//add by sunlicheng 20110615 end
			
			return(true);
		}
		list_del();
		#DOLIST='';
  }"
  </ONLOSTFOCUS>
  </ITEM>


  <ITEM NAME="#DOLIST" TYPE="%-1s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
		showall();
  }"
  </ONLOSTFOCUS>
  </ITEM>
  
  <ITEM LINE="8" COL="20" TYPE="%-10s" FUNCTIONS="T(行    号:)"/>
  <ITEM LINE="10" COL="20" TYPE="%-10s" FUNCTIONS="T(交易日期:)"/>
  <ITEM LINE="12" COL="20" TYPE="%-10s" FUNCTIONS="T(交易类型:)"/>

  <ITEM NAME="#BR_NO" LINE="8" COL="32" TYPE="%-5s" INPUT="TEXT" FUNCTIONS="V(NB)T($KINBR)">
  	 <ONLOSTFOCUS>
       "{
           dim @kinbr as string;
           dim @brno as string;
           @kinbr=$KINBR;
           @brno=#BR_NO;
           if(@kinbr != '50001' and @brno != @kinbr)
           {
              showmsg('非清算机构只能查询本机构的代收付交易!');
              #BR_NO=@kinbr;
              return(false);
           }
         }"
     </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#RQ" LINE="10" COL="32" TYPE="%-8s" INPUT="TEXT" FUNCTIONS="V(NB)T($HDATE)D()"/>
  <ITEM NAME="#TYPE" LINE="12" COL="32" TYPE="%-1s" INPUT="SELECT" DEVICE="KEYBOARD" FUNCTIONS="T(0)">
  <SELECT>
			<OPTION VALUE ="0" TITLE="0.全部" />  
			<OPTION VALUE ="1" TITLE="1.代付" />
			<OPTION VALUE ="2" TITLE="2.代收" />
			<OPTION VALUE ="3" TITLE="3.撤销" />
			<OPTION VALUE ="4" TITLE="4.合同变更" />
		</SELECT>
	</ITEM>

	<!--add by sunlicheng 20110616 start 作为DSFLIST.XML返回本交易时,进行自动查询查询-->
  <ITEM NAME="#AUTOSEARCH" TYPE="%-1s" FUNCTIONS="" />
	<!--add by sunlicheng 20110616 end-->

  <ITEM LINE="21"  COL="59" TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
  <ONCLICK>
  "{
		dim @tota as string;
		initfd();
		commsend_001();
		$FD16='5406';
		$FD91=#BR_NO;
		$FD44=#RQ;
		$FD50=#TYPE;
		@tota=callserver();
		if($FD12!='0000')
		{
			showmsg(geterror());
			return(false);
		}
		if(autolist(@tota))
		{
		   #DOLIST='1';
		}   
		
  }"
  </ONCLICK>
  </ITEM>
 </VARIABLE>
 <REQUEST>
 </REQUEST>
 <RESPONSE>
 <PACKAGE>
 NOTHING
 </PACKAGE>
 </RESPONSE>

 </TRANSACTION>
