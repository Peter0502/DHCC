<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110000" TITLE="7105 凭证出售  "
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
  <COMMSEND>"{
  
	dim @tota as string;
	       
	$FD25=#KHMC;
	$FD31=#ACTNO;
	$FD52=#PZSL; 
	$FD58=#QSHM;
	$FD59=#ZZHM; 
	$FD67=#CSFS;
	$FD89=#PZZL;
	@tota=call_9986();
	#FD122=$FD122;
	$FD12='';
	$FD25=#KHMC;
	$FD31=#ACTNO;
	$FD52=#PZSL; 
	$FD58=#QSHM;
	$FD59=#ZZHM; 
	$FD67=#CSFS;
	$FD89=#PZZL;
	$FD122=#FD122;
  }"
  </COMMSEND>
  <COMMRECV>"{
	commrecv_001();
}"
</COMMRECV>
<FIRSTWORK>
"{
  #PIC='';
  #PIC1='';
  show(#PIC,false);
  show(#PIC1,false);
  show(#LBLPIC,false);
  show(#LBLPIC1,false);
  enable(#SETPIC,false);
  enable(#SETPIC1,false);
}"
</FIRSTWORK>
  <VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-60s" FUNCTIONS=
    "T(7105                            凭证出售)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
   <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
   <ITEM NAME="#TXNO" 	 TYPE="%-4s" FUNCTIONS="T($TXNO=5105)"/>
   <!--输入变量-->
  <ITEM LINE="7"  COL="10" TYPE="%-10s" FUNCTIONS="T(帐    号:)"/>
  <ITEM LINE="8"  COL="10" TYPE="%-10s" FUNCTIONS="T(客户名称:)"/>
  <ITEM LINE="10" COL="10" TYPE="%-10s" FUNCTIONS="T(出售方式:!)"/>
  <ITEM LINE="11" COL="10" TYPE="%-10s" FUNCTIONS="T(凭证种类:!)"/>
  <ITEM LINE="13" COL="10" TYPE="%-10s" FUNCTIONS="T(起始号码:)"/>
  <ITEM LINE="14" COL="10" TYPE="%-10s" FUNCTIONS="T(终止号码:)"/>
  <ITEM LINE="15" COL="10" TYPE="%-10s" FUNCTIONS="T(凭证数量:)"/>
  <ITEM LINE="7"  COL="50" NAME="#LBLPIC" TYPE="%-10s"  FUNCTIONS="T(照    片:)"/>
  <ITEM LINE="10"  COL="50" NAME="#LBLPIC1" TYPE="%-10s"  FUNCTIONS="T(印    件:)"/>
  <ITEM NAME="#ACTNO" INPUT="TEXT" LINE="7" COL="20" TYPE="%-20s" 	FUNCTIONS="T()V(NB)">
  <ONLOSTFOCUS>
	"{
		dim @txno_bak as string;
		@txno_bak=$TXNO;
		$TXNO='9935';
		commsend_001();
		$FD31=#ACTNO;
		
		callserver();
		$TXNO=@txno_bak;
		
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		#KHMC=$FD25;
		//showmsg($FD31);
		#ACTNO=$FD31;
		//showmsg(#ACTNO);
		enable(#KHMC,false);
	initfd();
	}"
    </ONLOSTFOCUS>
  </ITEM>
  <!--added by liuyong 2009-9-15 显示图片信息 start-->
  <ITEM  NAME="#CHECKACNO"  TYPE="%10s" FUNCTIONS="">
 <ONLOSTFOCUS>
 "{
     dim @txnobak as string;
     dim @len as number;
     @len = len(rtrim(#ACTNO));
     if(@len != 0 and @len != 3 and @len != 5 and @len != 7)
     {
       @txnobak = $TXNO;
       $TXNO = '9663';
       $FD30 = #ACTNO;
       commsend_001();
       callserver();
       if($FD12 !='0000')
       {
         show(#PIC,false);
         show(#PIC1,false);
         show(#LBLPIC,false);
         show(#LBLPIC1,false);
         enable(#SETPIC,false);
         enable(#SETPIC1,false);
       }
       else
       {
         show(#PIC,true);
         show(#PIC1,true);
         show(#LBLPIC,true);
         show(#LBLPIC1,true);
         enable(#SETPIC,true);
         enable(#SETPIC1,true);
       }
       $TXNO = @txnobak;
     }
     
 }"
 </ONLOSTFOCUS>
 </ITEM>
  <ITEM LINE="7" COL="60" LINES="160" COLS="120" NAME="#PIC" TYPE="%-10s" VISABLE="FALSE" FUNCTIONS=""/>
  <ITEM NAME="#SETPIC" TYPE="%-10s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
      dim @txnobak as string;
      dim @tatl as string;
      @txnobak = $TXNO;
      $TXNO = '9664';
      $FD30 = #ACTNO;
      $FD72 = '1';
      commsend_001();
      @tatl = callserver();
      if($FD12 !='0000')
      {
        
      }
      $TXNO = @txnobak;
      setpicture(#PIC,1,0);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="10" COL="60" LINES="220" COLS="160" NAME="#PIC1" TYPE="%-10s" VISABLE="FALSE" FUNCTIONS=""/>
  <ITEM NAME="#SETPIC1" TYPE="%-10s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
      dim @txnobak as string;
      dim @tatl as string;
      @txnobak = $TXNO;
      $TXNO = '9664';
      $FD30 = #ACTNO;
      $FD72 = '2';
      commsend_001();
      @tatl = callserver();
      if($FD12 !='0000')
      {
        
      }
      $TXNO = @txnobak;
      setpicture(#PIC1,1,0);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <!--added by liuyong 2009-9-15 显示图片信息 end-->
  <ITEM NAME="#KHMC"   INPUT="TEXT" 	LINE="8"  COL="20" TYPE="%-50s"	FUNCTIONS="T()V(NB)"/>
  <ITEM NAME="#CSFS"   INPUT="SELECT" 	LINE="10" COL="20" TYPE="%-1s" 	FUNCTIONS="T(0)"> 
  	<SELECT>
  		<OPTION VALUE="0" TITLE="1.零张"/>
  		<OPTION VALUE="1" TITLE="1.整本"/>
  	</SELECT>
  	  <ONLOSTFOCUS>
	"{
		dim @txno_bak as string;
		dim @tota as string;
		@txno_bak=$TXNO;
		$TXNO='9889';
		commsend_001();
		$FD67=#CSFS;
		@tota=callserver();	
		$TXNO=@txno_bak;
		setsel(#PZZL,@tota,'o5t20o1v3o2');
		$FD11='2';
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
	initfd();
	}"
    </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#PZZL" 	INPUT="SELECT" LINE="11" COL="20" TYPE="%-3s" 	FUNCTIONS="T(001)V(NB)">
  	<SELECT>
  		<OPTION VALUE="001" TITLE="1.现金支票"/>
  	</SELECT>
  </ITEM>

  <ITEM NAME="#QSHM" INPUT="TEXT" LINE="13" COL="20" TYPE="%16d" 	FUNCTIONS="T()V(NB)"/>
  <ITEM NAME="#ZZHM" INPUT="TEXT" LINE="14" COL="20" TYPE="%16d" 	FUNCTIONS="T()V(NB)">
  <ONLOSTFOCUS>
  "{
         if(#ZZHM &lt; #QSHM)
         {
           showmsg('终止号码必须大于起始号码');
           return(false);
         }

  }"
  </ONLOSTFOCUS>
  </ITEM>
  
  <ITEM NAME="#FLAG" TYPE="%-12s"     FUNCTIONS="G(#CZTYPE=1,#SUBMIT)">
   <ONLOSTFOCUS>
  "{
     // #PZSL=itoa((atoi(substr(#ZZHM,8,8))-atoi(substr(#QSHM,8,8))+1),'%12d'); mod 20120103
     initfd(); 
     commsend_001(); 
     $FD16='9204'; 
     $FD58=#QSHM; 
     $FD59=#ZZHM; 
     callserver(); 
     if($FD12!='0000') 
     { 
          showmsg(geterror()); 
          return(false); 
     } 
     #PZSL=$FD60; 
     show(#PZSL,true);
     enable(#PZSL,false);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#PZSL" INPUT="TEXT" LINE="15" COL="20" TYPE="%12s" 	FUNCTIONS="T(0)"/>
   <ITEM NAME="#FD122"  TYPE="%-89s" FUNCTIONS=""/>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  
  <ITEM NAME="#NAME2"  TYPE="%-20s" FUNCTIONS="S(#PZZL,#PZZL)"/>
  <ITEM NAME="#NAME1"  TYPE="%-20s" FUNCTIONS="S(#CSFS,#CSFS)"/>
  <ITEM NAME="#TXNAME1" TYPE="%-24s" FUNCTIONS="T(凭证出售手续费)"/>  
  <ITEM NAME="#TXNAME" TYPE="%-24s" FUNCTIONS="T(凭证出售)"/>
  <ITEM NAME="#XFEE_AMT"  TYPE="%16s"/>
  <ITEM NAME="#PRTNAME"     TYPE="%-70s"/>
	<ITEM NAME="#PRTACTNO"    TYPE="%-40s">
		<ONLOSTFOCUS>
  "{
		//验印 start 20131210 wudawei
//	if(#PZZL != '026')
//	{
//		dim @rs as string;
//		showhelp('系统提示','开始调取验印系统... ');
//		@rs = judgeone(#ACTNO,'299','0',$HDATE,0,'1');
//		if(@rs=='1')
//		{
//			showmsg('验印不通过！');
//			return(false);
//		}
//		else if(@rs=='0')
//		{       
//			showmsg('验印通过！');
//			return(true);			
//		}else
//		{       
//			showmsg('验印失败请重新验印！');
//			return(false);		
//		}
//  }
	//验印 end 20131210 wudawei
	}"
  </ONLOSTFOCUS>
	</ITEM>
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
  
  <ITEM NAME="#YEAR"  TYPE="%-4s" FUNCTIONS="T($HDATE,1,4)"/>
  <ITEM NAME="#MON"   TYPE="%-2s" FUNCTIONS="T($HDATE,5,2)"/>
  <ITEM NAME="#DAY"   TYPE="%-2s" FUNCTIONS="T($HDATE,7,2)"/>
  </VARIABLE>
  
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="凭证出售">
 NOTHING
</PACKAGE>
  <PRINT>"{
          print( 2,  24,'交易名称:凭证出售');
          
          print( 4,  20,'交易机构:[5]',$FD2);
	  			print( 5,  20,'交易日期:[4]年[2]月[2]日',#YEAR,#MON,#DAY);  
	  			print( 6,  20,'流水号码:[6]',$FD4);
	 			 	print( 7,  20,'操作员号:[4]',$FD7);
	  			print( 8,  20,'帐    号:[20 ]',#ACTNO);
	  			print( 9,  20,'客户名称:[20 ]',#KHMC);
	  			print( 10, 20,'出售方式:[20 ]',#NAME1);
	  			print( 11, 20,'凭证种类:[20 ]',#NAME2);
	  			print( 12, 20,'起始号码:[16 ]',#QSHM);
	  			print( 13, 20,'终止号码:[16 ]',#ZZHM);
	  			print( 14, 20,'凭证数量:[12 ]',#PZSL);
	}"
</PRINT>
</RESPONSE>
<RESPONSE>
	<PACKAGE DEVICE="PRINTER" DESC="请打印业务专用凭证" LINESPACE="24">
 NOTHING
 </PACKAGE>
  <PRINT>
  "{
 $KINDNO='00';
dim @txtime  as string;
@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	print( 5,20,'机构名称:[30]',$BRNAME);
	print( 5, 2,'代码:7105');
	print( 5,13,'交易:凭证出售');
	
	print( 7,20,'帐    号:[20                  ]  户    名:[50]',#ACTNO,#KHMC);
	print( 8,20,'凭证种类:[20]',#NAME2);
	print( 9,20,'起始号码:[16              ]      终止号码:[16 ]',#QSHM,#ZZHM);
	printacdtl_1();
	
	print( 24,20,'备注:');
	print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
	print( 24,5,'柜员:[4]',$FD7);
	print( 24,5,'流水号:[6]',$FD4); 
	}"
</PRINT>
</RESPONSE>
<!---
<RESPONSE>
<PACKAGE DEVICE="PRINTER"  LINESPACE="24" DESC="手续费凭证">
NOTHING  
</PACKAGE>
<PRINT>
"{
		#XFEE_AMT=itoa(substr($FD122,76,12),'%16.2f');
		#XFEE_AMT=comma(#XFEE_AMT,16);
		print( 3,20,'[7      ]  [30                            ]',$KINBR,$BRNAME);
		print( 4,10,'[6     ]                [24        ]                        [8       ]',$FD4,#TXNAME,$HDATE);
		print( 8,10,'[40               ]',#PRTACTNO);
		print( 9,10,'[70]',#PRTNAME);
		print(10,10,'收费金额:[16]',#XFEE_AMT);
		print(15,80,'[4]',$TLRNO);
}"
</PRINT>
</RESPONSE>--->
</TRANSACTION>

