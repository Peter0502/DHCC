<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="00000000" TITLE="6801 贴现信息录入"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	initfd();
    $FD31=#CPRZH;
    $FD26=#CPRQC;
    $FD81=#FKHQC;
    $FD32=#SKRZH;
    $FD27=#SKRQC;
    $FD82=#SKRKHH;
    $FD25=#NAME;
    $FD45=#MDATE;
    $FD48=#WDAYS;
    $FD60=#PNNO;
    $FD62=#PANO;
    $FD67='1';
    $FD68=#LIND;
    $FD69=#OPNO;
    $FD83=#ACNO;
    $FD84=getitems('#PINT');
    $FD90=#NOTYPE;
    $FD100=getitems('#TINT#AMT');
	commsend_001();
	$FD16 = '4911';
}"
</COMMSEND>
<COMMRECV>"{
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(6801                          贴现信息录入)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=4911)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>

  <ITEM LINE="5"  COL="5"  TYPE="%-10s" FUNCTIONS="T(操 作 码!)"/>
  <ITEM LINE="5"  COL="29" TYPE="%-14s" FUNCTIONS="T(贴现协议编号:)"/>
  <ITEM LINE="6"  COL="29" TYPE="%-16s" FUNCTIONS="T(贴现申请人账号:)"/>
  <ITEM LINE="7"  COL="5"  TYPE="%-16s" FUNCTIONS="T(贴现申请人户名:)"/>
  <ITEM LINE="8"  COL="5"  TYPE="%-10s" FUNCTIONS="T(贴 现 率:)"/>
  <ITEM LINE="8"  COL="30" TYPE="%-12s" FUNCTIONS="T(异地同城:!)"/>
  <ITEM LINE="8"  COL="54" TYPE="%-10s" FUNCTIONS="T(在途天数:)"/>
  <ITEM LINE="9"  COL="5" TYPE="%-10s" FUNCTIONS="T(贴现利息:)"/>

  <ITEM LINE="10"  COL="3" TYPE="%-74s" FUNCTIONS=
   "T(------------------------【以下为票面信息】----------------------------------)"/>

  <ITEM LINE="11"  COL="5"  TYPE="%-10s" FUNCTIONS="T(票据类型!)"/>
  <ITEM LINE="11"  COL="50" TYPE="%-10s" FUNCTIONS="T(票 据 号:)"/>
  <ITEM LINE="12"  COL="5"  TYPE="%-10s" FUNCTIONS="T(汇票金额:)"/>
  <ITEM LINE="12"  COL="50" TYPE="%-12s" FUNCTIONS="T(汇票到期日:)"/>
  <ITEM LINE="13"  COL="5"  TYPE="%-12s" FUNCTIONS="T(出票人全称:)"/>
  <ITEM LINE="14"  COL="5"  TYPE="%-12s" FUNCTIONS="T(出票人帐号:)"/>
  <ITEM LINE="15"  COL="5"  TYPE="%-12s" FUNCTIONS="T(付款行全称:)"/>
  <ITEM LINE="16"  COL="5"  TYPE="%-12s" FUNCTIONS="T(收款人全称:)"/>
  <ITEM LINE="17"  COL="5"  TYPE="%-12s" FUNCTIONS="T(收款人帐号:)"/>
  <ITEM LINE="18"  COL="5"  TYPE="%-18s" FUNCTIONS="T(收款人开户行全称:)"/>
  <ITEM NAME="#FLAG" FUNCTIONS="">
  
  </ITEM>
  <!--输入变量-->
  <ITEM NAME="#OPNO" LINE="5" COL="15" TYPE="%-1s" INPUT="SELECT" FUNCTIONS="T(0)">
  <SELECT>
		<OPTION VALUE="0" TITLE="录入"/>
		<OPTION VALUE="1" TITLE="修改"/>
		<OPTION VALUE="2" TITLE="删除"/>
	</SELECT>
	<!----
	<ONLOSTFOCUS>
  "{
     if($KINBR!='50701' and $KINBR!='10001')
     {
     		showmsg('没有权限做此交易!');
     		return(false);
     }
  }"
  </ONLOSTFOCUS>
  ---->
  </ITEM>

  <ITEM NAME="#PANO" LINE="5" COL="42" TYPE="%-20s" INPUT="TEXT" FUNCTIONS="V(NB)">
  	<ONLOSTFOCUS>
 "{
	initfd();
	dim @baktxno as string;
	@baktxno=$TXNO;
	if(#OPNO!='0')
	{
 		$TXNO='9860';
		$FD62=#PANO;
        	commsend_001();
		callserver();
		$TXNO=@baktxno;
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		#NAME=substr($FD25,0,50);
		#MDATE=$FD45;
		#WDAYS=$FD48;
		#PNNO=$FD60;
		#LIND=$FD68;
		#ACNO=$FD83;
		setitems('#PINT',$FD84);
		#NOTYPE=$FD90;
		setitems('#TINT#AMT',$FD100);
		show(#ACNO,true);
		show(#NAME,true);
		show(#PINT,true);
		show(#LIND,true);
		show(#WDAYS,true);
		show(#TINT,true);
		show(#NOTYPE,true);
		show(#PNNO,true);
		show(#AMT,true);
		show(#MDATE,true);
		enable(#NAME,false);
	}
    if(#OPNO=='1')
    {
		initfd();
		@baktxno=$TXNO;
 		$TXNO='9863';
		$FD25=#NAME;
		$FD83=#ACNO;
       		commsend_001();
		callserver();
		$TXNO=@baktxno;
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
	}
	else if(#OPNO=='2')
	{
		goitem(#PASSWD);
	}
 }"
 </ONLOSTFOCUS>
 </ITEM>
  <ITEM NAME="#ACNO" LINE="6" COL="44" TYPE="%-32s" INPUT="TEXT" FUNCTIONS="T()">
  <ONLOSTFOCUS>
 "{
		initfd();
    	dim @baktxno as string;
		@baktxno=$TXNO;
		$TXNO='9863';
 		$FD67='1';
		$FD83=#ACNO;
        commsend_001();
		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		#NAME=substr($FD25,0,50);
		#ACNO=delspace($FD83);
		show(#NAME,true);
		show(#ACNO,true);
			goitem(#PINT,false);
 }"
 </ONLOSTFOCUS>
 </ITEM>
  <ITEM NAME="#NAME" LINE="7" COL="21" TYPE="%-50s" INPUT="TEXT" FUNCTIONS=""/>
  <ITEM NAME="#PINT" LINE="8" COL="15" TYPE="%9.6f" INPUT="TEXT" FUNCTIONS="V(00000001,99999999)"/>
  <ITEM LINE="8"  COL="25" TYPE="%-2s" FUNCTIONS="T(‰)"/>
  <ITEM NAME="#LIND" LINE="8" COL="40" TYPE="%-1s" INPUT="SELECT" FUNCTIONS="T(0)">
  <SELECT>
		<OPTION VALUE="0" TITLE="本地"/>
		<OPTION VALUE="1" TITLE="异地"/>
	</SELECT>
  <ONLOSTFOCUS>
   "{
               if(#LIND == '1')
                 enable(#WDAYS,true);
   }"
  </ONLOSTFOCUS>
	</ITEM>
  <ITEM NAME="#WDAYS" LINE="8" COL="63" TYPE="%4d" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="T()"/>
  <ITEM NAME="#TINT" LINE="9" COL="15" TYPE="%17.2f" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="T()"/>
  
  <ITEM NAME="#NOTYPE" LINE="11" COL="15" TYPE="%-3s" INPUT="SELECT" FUNCTIONS="T(111)">
  <SELECT>
		<OPTION VALUE="111" TITLE="银行承兑汇票"/>
		<OPTION VALUE="112" TITLE="商业承兑汇票"/>
	</SELECT>
  </ITEM>
  <ITEM NAME="#PNNO" LINE="11" COL="60" TYPE="%-16s" INPUT="TEXT" FUNCTIONS="V(NB)"/>
  <ITEM NAME="#AMT" LINE="12" COL="15" TYPE="%17.2f" INPUT="TEXT" FUNCTIONS="V(0000000000000001,0000999999999999)"/>
  <ITEM NAME="#LAMT" TYPE="%-16s" FUNCTIONS="X(#AMT)"/>
  <ITEM NAME="#MDATE" LINE="12" COL="60" TYPE="%-8s" INPUT="TEXT" FUNCTIONS="V(NB)D()">
  <ONLOSTFOCUS>
 "{
        if( #MDATE  &lt; $HDATE)
        {
            showmsg('到期日期必须大于当前日期，请重新输入!');
            return(false);
        }
        if( addmon($HDATE,6) &lt; #MDATE)
        {
            showmsg('到期日不允许超过贴现交易日期六个月，请重新输入!');
            return(false);
        }

 }"
 </ONLOSTFOCUS>
 </ITEM>
<!--added by lyz-->
 <ITEM NAME="#CPRQC" LINE="13" COL="17" TYPE="%-50s" INPUT="TEXT" FUNCTIONS="V(NB)"/>

 <ITEM NAME="#CPRZH" LINE="14" COL="17" TYPE="%-24s" INPUT="TEXT" FUNCTIONS="V(NB)"/>

 <ITEM NAME="#FKHQC" LINE="15" COL="17" TYPE="%-50s" INPUT="TEXT" FUNCTIONS="V(NB)"/>

 <ITEM NAME="#SKRQC" LINE="16" COL="17" TYPE="%-50s" INPUT="TEXT" FUNCTIONS="V(NB)"/>

 <ITEM NAME="#SKRZH" LINE="17" COL="17" TYPE="%-24s" INPUT="TEXT" FUNCTIONS="V(NB)"/>

 <ITEM NAME="#SKRKHH" LINE="18" COL="25" TYPE="%-30s" INPUT="TEXT" FUNCTIONS="V(NB)"/> 
  
   <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS=""/>
  <ITEM NAME="#FLAGNOTYPE" TYPE="%12s" FUNCTIONS="S(#NOTYPE,#NOTYPE)"/>
  <ITEM NAME="#UNITNAME"  TYPE="%-4s" FUNCTIONS="S(#OPNO,#OPNO)"/>
  <ITEM NAME="#LINDNAME"  TYPE="%4s" FUNCTIONS="S(#LIND,#LIND)"/>
  
  <ITEM NAME="#YEAR"  TYPE="%-4s" FUNCTIONS="T($FD5,1,4)"/>
  <ITEM NAME="#MON"   TYPE="%-2s" FUNCTIONS="T($FD5,5,2)"/>
  <ITEM NAME="#DAY"   TYPE="%-2s" FUNCTIONS="T($FD5,7,2)"/>
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>

  </VARIABLE>

<REQUEST>
</REQUEST>

<RESPONSE>
	<PACKAGE DEVICE="SCREEN" DESC="贴现信息录入">
	NOTHING
	</PACKAGE>
	<PRINT>"{
	 	print( 7, 30,'贴现信息--[4]成功',#UNITNAME);
	 	print( 8, 10,'贴现协议编号: [20]',#PANO);
	 	print( 9, 10,'贴现申请人账号: [32]',#ACNO);
	 	print(10, 10,'贴现申请人户名: [50]',#NAME);
	 	print(11, 10,'贴 现 率: [8]',itoa(#PINT,'%9.6f'));
	 	print(11, 40,'异地同城标志: [4]',#LINDNAME);
	 	print(11, 60,'在途天数: [4]',#WDAYS);
	 	print(12, 10,'票 据类 型: [12]',#FLAGNOTYPE);
	 	print(13, 10,'票  据  号: [16]',#PNNO);
	 	print(14, 10,'汇 票金 额: [16]',#LAMT);
	 	print(15, 10,'汇票到期日: [8]', #MDATE);
    }"
	</PRINT>
</RESPONSE>

<RESPONSE>
	<PACKAGE DEVICE="PRINTER"  DESC="打印业务专用凭证">
	NOTHING
	</PACKAGE>
	<PRINT>"{
                dim @txtime  as string;
                @txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	 	print( 5, 20,'机构名称:[30]',$BRNAME);
                print( 5, 2,'代码:6801');
                print( 5, 13,'交易:贴现信息录入');
                print( 7, 36,'贴现信息--[4]成功',#UNITNAME);
	 	print( 8, 20,'贴现协议编号: [20]',#PANO);
	 	print( 9, 20,'贴现申请人账号: [32]',#ACNO);
	 	print( 10,20,'贴现申请人户名: [50]',#NAME);
	 	print( 11,20,'贴 现 率: [8]',itoa(#PINT,'%9.6f'));
	 	print( 12,20,'异地同城标志: [4]',#LINDNAME);
	 	print( 13,20,'在途天数: [4]',#WDAYS);
	 	print( 14,20,'票 据类 型: [12]',#FLAGNOTYPE);
	 	print( 15,20,'票  据  号: [16]',#PNNO);
	 	print( 16,20,'汇 票金 额: [16]',#LAMT);
	 	print( 17,20,'汇票到期日: [8]', #MDATE);
 	        print( 24,20,'备注:')
                print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
                print( 24,5,'柜员:[4]',$FD7);
                print( 24,5,'流水号:[6]',$FD4);

             }"
 	</PRINT>
</RESPONSE>
</TRANSACTION>
