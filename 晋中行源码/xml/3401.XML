<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11000000" TITLE="3401 转存单交易"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	commsend_001();
	//验印 start 20131212 yaofuqiang
			dim @rs as string;
			showhelp('系统提示','开始调取验印系统... ');
		//	@rs = judgeone(#CARDNO,'299',#NOTENO,$HDATE,#AVL,'1');
			if(@rs=='1')
			{
				showmsg('验印不通过！');
		//		return(false);
			}
			else if(@rs=='0')
			{       
				showmsg('验印通过！');
				return(true);			
			}else
			{       
				showmsg('验印失败请重新验印！');
		//		return(false);		
			}
			//验印 end 20131212 yaofuqiang
}"
</COMMSEND>
<COMMRECV>"{
		commrecv_001();
}"
</COMMRECV>
<FIRSTWORK>
"{
  #PIC='';
  #PIC1='';
}"
</FIRSTWORK>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(3401                           转存单交易)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=2401)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  
  <!--输入变量-->
  <PAGE NAME="DEFAULT"> 
  <ITEM LINE="7"  COL="12" TYPE="%-9s" FUNCTIONS="T(账 /卡号:)"/>
  <ITEM LINE="7"  COL="47" TYPE="%-9s" FUNCTIONS="T(账户序号:)" NAME="#S_SEQNO" INPUT="LABEL" VISABLE="FALSE"/>
  <ITEM LINE="8"  COL="12" TYPE="%-9s" FUNCTIONS="T(姓    名:)"/>
  <ITEM LINE="9"     COL="47"  TYPE="%-10s" FUNCTIONS="T(照    片:)"/>
  <ITEM LINE="11"     COL="47"  TYPE="%-10s" FUNCTIONS="T(印    件:)"/>
  <ITEM LINE="10" COL="12" TYPE="%-9s" FUNCTIONS="T(币    种:)"/>
  <ITEM LINE="11" COL="12" TYPE="%-9s" FUNCTIONS="T(余    额:)"/>
  <ITEM LINE="12" COL="12" TYPE="%-9s" FUNCTIONS="T(凭证种类:)"/>
  <ITEM LINE="13" COL="12" TYPE="%-9s" FUNCTIONS="T(产品名称:)"/>
  
  
  <ITEM NAME="#S_PASS"     LINE="15"   COL="12" TYPE="%-9s" FUNCTIONS="T(密码支取:)" INPUT="LABEL" VISABLE="FALSE"/>
  <ITEM NAME="#LBPSW"      LINE="15"   COL="47" TYPE="%-9s" FUNCTIONS="T(密    码:)" INPUT="LABEL" VISABLE="FALSE"/>
  <ITEM NAME="#S_CERT"     LINE="16"   COL="12" TYPE="%-9s" FUNCTIONS="T(证件支取:)" INPUT="LABEL" VISABLE="FALSE"/>
  <ITEM NAME="#LBCERTYPE"  LINE="16"   COL="47" TYPE="%-9s" FUNCTIONS="T(证件类型:)" INPUT="LABEL" VISABLE="FALSE"/>
  <ITEM NAME="#LBCERT"     LINE="17"   COL="12" TYPE="%-9s" FUNCTIONS="T(证件号码:)" INPUT="LABEL" VISABLE="FALSE"/>
  
 
  
 <ITEM NAME="#CARDNO" INPUT="TEXT" LINE="7" COL="22" TYPE="%-19s" FUNCTIONS="V(NB)">
<ONLOSTFOCUS>
"{
	dim @spa as string ;
	@spa =  space(118);
	$FD102 =#CARDNO;
	commsend_001();
	$FD16 = '9707';
	callserver();
	if($FD12!='0000')
	{
		showmsg(geterror());
		return (false);
	}
	if(atoi($FD34) &gt;1)
	{
		#SEQNO=$FD34;
		show(#SEQNO,true)
		show(#S_SEQNO,true);
		
		return(true);
	}else{
		show(#SEQNO,false)
		show(#S_SEQNO,false);
	}

	#USERNAME  = substr($FD116,56,50);
	#MONEYTYPE = $FD21; 
	#AVL=val($FD42,0.01);
	#CREDENCETYPE = $FD89;
	#PRODUCTNAME = $FD24;
	#CPMC=$FD27;
	#CHOOSEPASSWORD = substr($FD114,1,1);
	#CHOOSECERTIFICATE = substr($FD114,14,1);
        
        #NOTENO = $FD61;
	show(#CPMC,true);
	show(#USERNAME,true);
	show(#MONEYTYPE,true);
	show(#AVL,true);
	show(#CREDENCETYPE,true);
	show(#PRODUCTNAME,true);
	show(#CHOOSEPASSWORD,true);
	show(#CHOOSECERTIFICATE,true);

	enable(#USERNAME,false);
	enable(#MONEYTYPE,false);
	enable(#AVL,false);
	enable(#CREDENCETYPE,false);
	enable(#PRODUCTNAME,false);
	enable(#CHOOSEPASSWORD,false);
	enable(#CHOOSECERTIFICATE,false);
	enable(#CPMC,false);

	$BUFFER = substr($FD116,0,4);
	if(#CHOOSEPASSWORD=='Y')
	{
		show(#CHOOSEPASSWORD,true);
		show(#LBPSW,true);
		show(#PASSWD,true);
		show(#S_PASS,true);
	}else{
		show(#CHOOSEPASSWORD,false);
		show(#LBPSW,false);
		show(#PASSWD,false);
		show(#S_PASS,false);
	}
	if(#CHOOSECERTIFICATE=='Y')
	{
		show(#CHOOSECERTIFICATE,true);
		show(#LBCERTYPE,true);
		show(#LBCERT,true);
		show(#CERTIFYTYPE,true);
		show(#CERTIFICATE,true);
		show(#S_CERT,true);
		#CERTIFYTYPE = substr($FD114,36,1);
	}else{
		show(#CHOOSECERTIFICATE,false);
		show(#LBCERTYPE,false);
		show(#LBCERT,false);
		show(#CERTIFYTYPE,false);
		show(#CERTIFICATE,false);
		show(#S_CERT,false);
	}

}"
</ONLOSTFOCUS>
</ITEM>
<!--added by liuy 2009-9-23 凭证号码-->
<ITEM NAME="#NOTENO" TYPE="%16s" FUNCTIONS=""/>
<!--added by liuy 2009-9-23 end-->

 <ITEM NAME="#SEQNO" INPUT="TEXT" LINE="7" COL="57" TYPE="%4s" FUNCTIONS="" VISABLE="FALSE">
<ONLOSTFOCUS>
"{
	dim @spa as string ;
	@spa =  space(118);
	$FD102 =#CARDNO;
	commsend_001();
	$FD16 = '9788';
	callserver();
	if($FD12!='0000')
	{
		showmsg(geterror());
		return (false);
	}
	#USERNAME  = substr($FD116,56,50);
	#MONEYTYPE = $FD21; 
	#AVL=val($FD42,0.01);
	#CREDENCETYPE = $FD89;
	#PRODUCTNAME = $FD24;
	#CPMC=$FD27;
	#CHOOSEPASSWORD = substr($FD114,1,1);
	#CHOOSECERTIFICATE = substr($FD114,14,1);

	show(#CPMC,true);
	show(#USERNAME,true);
	show(#MONEYTYPE,true);
	show(#AVL,true);
	show(#CREDENCETYPE,true);
	show(#PRODUCTNAME,true);

	enable(#USERNAME,false);
	enable(#MONEYTYPE,false);
	enable(#AVL,false);
	enable(#CREDENCETYPE,false);
	enable(#PRODUCTNAME,false);
	enable(#CPMC,false);

	$BUFFER = substr($FD116,0,4);
	if(#CHOOSEPASSWORD=='Y')
	{
		show(#CHOOSEPASSWORD,true);
		enable(#CHOOSEPASSWORD,false);
		show(#LBPSW,true);
		show(#PASSWD,true);
		show(#S_PASS,true);
	}else{
		show(#CHOOSEPASSWORD,false);
		show(#LBPSW,false);
		show(#PASSWD,false);
		show(#S_PASS,false);
	}
	if(#CHOOSECERTIFICATE=='Y')
	{
		show(#CHOOSECERTIFICATE,true);
		enable(#CHOOSECERTIFICATE,false);
		show(#LBCERTYPE,true);
		show(#LBCERT,true);
		show(#CERTIFYTYPE,true);
		show(#CERTIFICATE,true);
		show(#S_CERT,true);
		#CERTIFYTYPE = substr($FD114,36,1);
	}else{
		show(#CHOOSECERTIFICATE,false);
		show(#LBCERTYPE,false);
		show(#LBCERT,false);
		show(#CERTIFYTYPE,false);
		show(#CERTIFICATE,false);
		show(#S_CERT,false);
	}

}"
</ONLOSTFOCUS>
</ITEM>

  <ITEM NAME="#USERNAME"  INPUT="TEXT"    LINE="8"  COL="22" TYPE="%-50s" FUNCTIONS=""/>
  <!--added by liuyong 2009-10-10 显示图片信息 start-->
  <ITEM NAME="#LYACNO" TYPE="%-19s" FUNCTIONS="" />
  <ITEM LINE="9" COL="55" LINES="160" COLS="120" NAME="#PIC" TYPE="%-10s" VISABLE="FALSE" FUNCTIONS=""/>
  <ITEM NAME="#SETPIC" TYPE="%-10s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
      #LYACNO=#CARDNO;
      call_96641();
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="11" COL="55" LINES="220" COLS="160" NAME="#PIC1" TYPE="%-10s" VISABLE="FALSE" FUNCTIONS=""/>
  <ITEM NAME="#SETPIC1" TYPE="%-10s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
      #LYACNO=#CARDNO;
      call_96642();
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <!--added by liuyong 2009-10-10 显示图片信息 end-->
  
  <ITEM NAME="#MONEYTYPE" INPUT="SELECT"  LINE="10" COL="22" TYPE="%-2s"  FUNCTIONS="T(01)">
  <SELECT>
		<OPTION VALUE="01" TITLE="0.人民币"/>
     </SELECT>
  </ITEM>
  <ITEM NAME="#AVL"          INPUT="TEXT"    LINE="11" COL="22" TYPE="%17.2f" FUNCTIONS="V(0000000000000000,9999999999999999)"/>
  <ITEM NAME="#CREDENCETYPE" INPUT="SELECT"  LINE="12" COL="22" TYPE="%3s" FUNCTIONS="T(000)">
  <SELECT>
		<OPTION VALUE="000" TITLE="无单折            "/>
		<OPTION VALUE="006" TITLE="单位通知存单      "/>
		<OPTION VALUE="007" TITLE="单位定期证实书    "/>
		<OPTION VALUE="008" TITLE="单位定期存单      "/>
		<OPTION VALUE="010" TITLE="储蓄活期存折      "/>
		<OPTION VALUE="011" TITLE="储蓄零整存折      "/>
		<OPTION VALUE="012" TITLE="贺卡定期储蓄存单  "/>
		<OPTION VALUE="013" TITLE="储蓄整整定期存单  "/>
		<OPTION VALUE="014" TITLE="储蓄存款特种存单  "/>
		<OPTION VALUE="015" TITLE="储蓄定活两便存单  "/>
		<OPTION VALUE="016" TITLE="定期一本通存折    "/>
		<OPTION VALUE="017" TITLE="储蓄通知存款存单  "/>
		<OPTION VALUE="018" TITLE="整零及存本取息存折"/>
		<OPTION VALUE="019" TITLE="人民币定期存单    "/>
		<OPTION VALUE="020" TITLE="储蓄卡（普通）    "/>
		<OPTION VALUE="021" TITLE="储蓄卡（职工）    "/>
		<OPTION VALUE="022" TITLE="储蓄卡（银联）    "/>
		<OPTION VALUE="023" TITLE="储蓄卡（国际）    "/>
		<OPTION VALUE="024" TITLE="神农借记磁卡      "/>
		<OPTION VALUE="025" TITLE="神农联名卡        "/>
  </SELECT>
  </ITEM>
  <ITEM NAME="#PRODUCTNAME" INPUT="TEXT"  LINE="13" COL="22" TYPE="%-3s" FUNCTIONS="T(000)"/>
  <ITEM NAME="#CPMC"        INPUT="TEXT"  LINE="13" COL="26" TYPE="%-50s" />
  <ITEM NAME="#CHOOSEPASSWORD"   INPUT="TEXT" VISABLE="FALSE" LINE="15" COL="22" TYPE="%1s" FUNCTIONS="G(N,#CHOOSECERTIFICATE)">
      <SELECT>
		<OPTION VALUE="N" TITLE="0.否"/>
		<OPTION VALUE="Y" TITLE="1.是"/>
     </SELECT>
  </ITEM>
  <ITEM NAME="#PASSWD"   INPUT="TEXT"  LINE="15" COL="57" TYPE="%-6s" VISABLE="FALSE" DEVICE="PINPAD"  FUNCTIONS="i()I()V(NB)"/>
  <ITEM NAME="#CHOOSECERTIFICATE" INPUT="SELECT" VISABLE="FALSE" LINE="16" COL="22" TYPE="%1s" FUNCTIONS="">
      <SELECT>
		<OPTION VALUE="N" TITLE="否"/>
		<OPTION VALUE="Y" TITLE="是"/>
     </SELECT>
  </ITEM>
    <ITEM NAME="#CERTIFYTYPE"   INPUT="SELECT"  LINE="16" COL="57" TYPE="%1s" VISABLE="false"  FUNCTIONS="">
	<SELECT>
	<OPTION VALUE="1" TITLE="身份证"/>
	<OPTION VALUE="2" TITLE="户口簿"/>
	<OPTION VALUE="3" TITLE="护照"/>
	<OPTION VALUE="4" TITLE="军官证"/>
	<OPTION VALUE="5" TITLE="回乡证"/>
	<OPTION VALUE="8" TITLE="企业代码证"/>
	<OPTION VALUE="9" TITLE="经营许可证"/>

  </SELECT>
  </ITEM>
  <ITEM NAME="#CERTIFICATE"   INPUT="TEXT"  LINE="17" COL="22" TYPE="%-20s"  VISABLE="false" FUNCTIONS="V(NB)">
  	<ONLOSTFOCUS>
  		"{
		   		//add 20130926 start 调用身份核查
		   		if(#CERTIFYTYPE == '1')
		   		{
					  idcheck(#CERTIFICATE,#USERNAME);
					}
  				//add 20130926 end
  		}"
  	</ONLOSTFOCUS>
  </ITEM>
  
 <!--
 <ITEM NAME="#ADDINFO"   TYPE="%3s" FUNCTIONS="">
 <ONCLICK>
 "{	
         dim @a as number;
   		 dim @b as number;
   		 dim @c as number;
  		 dim @d as number;
   		 @a = len(#CERTIFICATE);
   		 @b = 20 - @a;
   		 @a = len(#PASSWD);
   		 @c = 6 - @a;
   		 @a = len(#CERTIFYTYPE);
   		 @d = 1 - @a ;
   		 $BUFFER = 'N'+#CHOOSEPASSWORD+space(6)+#PASSWD+space(@c)+#CHOOSECERTIFICATE+#CERTIFICATE+space(@b)+'N'+#CERTIFYTYPE+space(@d)+'O'+'N';
   		 showmsg($BUFFER);
		 $FD115 = $BUFFER;
		
		open('34011.XML','#MEDIUMTYPE='+$BUFFER+';');//加入点附加信息
 }"
 </ONCLICK>
 -->
 <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(下一页)" INPUT="BUTTON">
 <ONCLICK>
 "{	
	loadpage('PAGE2');
 }"
 </ONCLICK>
 </ITEM>
  </PAGE>

 <PAGE NAME="PAGE2">
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>

  <ITEM LINE="08" COL="12" TYPE="%-9s" FUNCTIONS="T(介质种类:)"/>
  <ITEM LINE="10" COL="12" TYPE="%-9s" FUNCTIONS="T(凭证号码:)"/>

  <ITEM NAME="#BEGIN" TYPE="%1s" FUNCTIONS="S(#MEDIUMTYPE,0008)"/>
  <ITEM NAME="#MEDIUMTYPE"   INPUT="SELECT"  LINE="08" COL="22" TYPE="%4s" FUNCTIONS="T(0008)V(NB)">
      <SELECT>
        <OPTION VALUE="0008" TITLE="0.单位定期存单"/>
     </SELECT>
     <ONLOSTFOCUS>
     "{
        commsend_001();
        $FD16 = '9739';
        $FD116 = #MEDIUMTYPE+substr($FD116,4,138);
        callserver();
        if($FD12!='0000')
        {
            showmsg(geterror());
            return (false);
        }
     }"
     </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#CREDENCENO"   INPUT="TEXT"  LINE="10" COL="22" TYPE="%16d" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
  "{
        commsend_001();
		$MSGTYPE='03001';
        $FD16 = '9782';
		$FD116=substr($FD116,0,135)+#CREDENCENO+substr($FD116,151,1);
        callserver();
        if($FD12!='0000')
        {
            showmsg(geterror());
            return (false);
        }
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#SBAL" TYPE="%13.2f" FUNCTIONS="J(#UPBAL)"/>
  <ITEM NAME="#UPBAL" TYPE="%-40s" FUNCTIONS="U(#SBAL)"/>
  <ITEM NAME="#SBAL1" TYPE="%-21s" FUNCTIONS=""/>
  <ITEM  LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>

 </PAGE> 
   
  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
</VARIABLE>
<REQUEST>
</REQUEST>
<!-- 20151202 start zgf 结构性存款娜姐说，不需要打印该内容
<RESPONSE>
<PACKAGE DEVICE="PRINTER" LINESPACE="38" DESC="显示内容">
NOTHING
</PACKAGE>
<INIT>
if(#SEQNO=='' or #SEQNO=='    ')
{
	#SEQNO='0';
}
</INIT>
<PRINT>"{
print(7,20,'    账 /卡号: [19                  ] ',#CARDNO);
print(9,20,'    帐户序号: [4    ]                ',#SEQNO);
}"
</PRINT>
</RESPONSE>
20151102 end-->
<RESPONSE>
<PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="原凭证">
NOTHING
</PACKAGE>
<PRINT>"{
print(13,65,'\L0【 已转存单 】\L1');
}"
</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="新凭证">
CZFY|@actno|@acttype|@bal|@ac_type|@op_day|@opnbr||@end_day|@term|@term_unit|@rate|
</PACKAGE>
<PRINT>"{
setitems('#SBAL',itoa(val(@bal,100),'%12.0f'));
setitems('#SBAL1',itoa(val((itoa(val(@bal,100),'%16f')),0.01),'%16.2f'));
print( 5,14,'[36                                  ]        [19                 ]',@acttype,@actno);
print( 7,20,'[40                                      ]',#UPBAL);
print( 9,20,'[21]',ltrim(comma(#SBAL1,21)));
print(11,40,'[16]',#NOTENO);
print(15,10,'[10         ]     [10        ]    [2 ][2  ]          [7     ]%     [10]',@op_day,@end_day,@term,@term_unit,@rate,$HDATE);
print(17,18,'                                                                   [10       ]           ',$TLRNO);
}"
</PRINT>
</RESPONSE>
</TRANSACTION>
