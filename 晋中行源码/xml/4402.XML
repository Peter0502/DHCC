<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="00000000" TITLE="4402 放款计划"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
  <COMMSEND>"{
	    initfd();
		$MSGTYPE='03001';
		dim @txno_bak as string;
		@txno_bak=$TXNO;
		$FD12='3102';
		//$TXNO='9986';
		$FD25=#DKHM;
	  $FD31=#CKZH;
    $FD34=#CD34;
	  $FD35=#CD35;
		$FD37=#DKZH;
		$FD39=space(16);
		$FD42=itoa(#DKXYE*100, '%016.0f');
		$FD41=itoa(#LJFFE*100, '%016.0f');
		$FD40=itoa(#JHFKE*100, '%016.0f');
		$FD50=#CD50;
	  $FD65='3102';
		$FD67=#CZBZ;
		$FD72=#CD72;
		$FD116=space(56)+#CKHM;
		commsend_001();
	  //  callserver();
		//if($FD12!='0000')
			//{
			//showmsg(geterror());
			//return(false);
			//} 

		//$FD16='3102'; 
		//$MSGTYPE='03001';
	}"
</COMMSEND>
<COMMRECV>
   "{
	 if($FD12 == '0000')
			{
			showmsg('交易成功!');
			}
}"
</COMMRECV>

<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-60s" FUNCTIONS=
    "T(4402                         放款计划  )"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
   <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=3102)"/>
   <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
   <!--输入变量-->
   <ITEM LINE="6"   COL="3" TYPE="%-14s" FUNCTIONS="T(贷款账号)"/>
   <ITEM LINE="8" COL="3" TYPE="%-74s" FUNCTIONS="T(---------------------------------------------------------------------------)"/>
   <ITEM LINE="10"   COL="3" TYPE="%-14s" FUNCTIONS="T(贷款户名)"/>
   <ITEM LINE="11"   COL="3" TYPE="%-14s" FUNCTIONS="T(操作标志)"/>



    <ITEM LINE="12"   COL="33" TYPE="%-14s" FUNCTIONS="T(贷款现余额)"/>
    <ITEM LINE="13"   COL="33" TYPE="%-14s" FUNCTIONS="T(累计发放额)"/>
    <ITEM LINE="14"   COL="33" TYPE="%-14s" FUNCTIONS="T(计划放款额)"/>

    <ITEM LINE="16"   COL="3" TYPE="%-18s" FUNCTIONS="T(存款帐号)"/>
   <ITEM LINE="18" COL="3"  TYPE="%-74s" FUNCTIONS="T(---------------------------------------------------------------------------)"/>
   <ITEM LINE="20"   COL="3" TYPE="%-14s" FUNCTIONS="T(存款户名)"/>
   <ITEM NAME="#CD34"  TYPE="%-4s" FUNCTIONS=""/>
   <ITEM NAME="#CD35"  TYPE="%-4s" FUNCTIONS=""/>
   <ITEM NAME="#CD50"  TYPE="%-3s" FUNCTIONS=""/>
   <ITEM NAME="#CD72"  TYPE="%-1s" FUNCTIONS=""/>


  <ITEM NAME="#DKZH"	 LINE="6" COL="17" TYPE="%-14s" INPUT="TEXT"	FUNCTIONS="T()V(NB)">
  <ONLOSTFOCUS>
 
  	   "{
		dim @txno as string;
		$FD37=#DKZH;
		$FD65='3102';
		@txno=$TXNO;
		$TXNO='9807';
		commsend_001();
		callserver();
		if($FD12!='0000')
		{
			showmsg(geterror());
			return(false);
		}
		#DKHM=$FD25;
		#DKXYE=val($FD42, 0.01);
		#LJFFE=val($FD41, 0.01);
		#JHFKE=val($FD40, 0.01);
        #CD34=$FD34;
        #CD35='0001';
        #CD50='001';
        #CD72=$FD72;
        
		enable(#DKHM, false);
		enable(#DKXYE, false);
		enable(#LJFFE, false);
		enable(#JHFKE, false);
}"
  
  </ONLOSTFOCUS>
  </ITEM>
	
  <ITEM NAME="#DKHM"	 LINE="10" COL="17" TYPE="%-40s" INPUT="TEXT"	FUNCTIONS="T()V(NB)"/>

   <ITEM NAME="#CZBZ" INPUT="SELECT" LINE="11"  COL="17" TYPE="%-2s" 	FUNCTIONS="T(0)V(NB)">
  	<SELECT>
  		<OPTION VALUE="0" TITLE="0重新编辑 "/>
  		<OPTION VALUE="1" TITLE="1继续编辑 "/>

  	</SELECT>
	<ONLOSTFOCUS>
	"{
	dim @txno as string;
		$FD67=#CZBZ;
		@txno=$TXNO;
		$TXNO='9807';
		commsend_001();

		callserver();
		if($FD12!='0000')
		{
			showmsg(geterror());
			return(false);
		}
	}"
	</ONLOSTFOCUS>
</ITEM>
   <ITEM NAME="#DKXYE"	 LINE="12" COL="43" TYPE="%16.2f" INPUT="TEXT"	FUNCTIONS="T()V(NB)"/>
   <ITEM NAME="#LJFFE"	 LINE="13" COL="43" TYPE="%16.2f" INPUT="TEXT"	FUNCTIONS="T()V(NB)"/>
   <ITEM NAME="#JHFKE"	 LINE="14" COL="43" TYPE="%16.2f" INPUT="TEXT"	FUNCTIONS="T()V(NB)"/>
  <ITEM NAME="#CKZH"	 LINE="16" COL="17" TYPE="%-24s" INPUT="TEXT"	FUNCTIONS="T()V(NB)">
  <ONLOSTFOCUS>
 
  	   "{
		dim @txno as string;

		$FD31=#CKZH;
		@txno=$TXNO;
		$TXNO='9873';
		commsend_001();

		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		$TXNO=@txno;
		#CKHM=substr($FD116, 56, 40);

		enable(#CKHM, false);

  }"
  
  </ONLOSTFOCUS>
  </ITEM>
	
  <ITEM NAME="#CKHM"	 LINE="20" COL="17" TYPE="%-40s" INPUT="TEXT"	FUNCTIONS="T()V(NB)"/>


  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  <ITEM NAME="#FD" TYPE="%-1s">
<!--  <ITEM LINE="6"   COL="17"  NAME="#FKRQ"  TYPE="%-8s" INPUT="TEXT"    FUNCTIONS="V(NB)"> -->

<ITEM   NAME="#FKRQ"  TYPE="%-8s"    FUNCTIONS="V(NB)">
<ONLOSTFOCUS>
"{
dim @txno as string;
dim @tota as string;

		@txno=$TXNO;
		$TXNO='9834';
		commsend_001();

		@tota=callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		$TXNO=@txno;

		call('rm -rf ../tmp/'+$KINBR+$TTYNAME+'_4402_'+#DKZH);
	savefiletxt('../tmp/'+$KINBR+$TTYNAME+'_4402_'+#DKZH, @tota);
	editfile('../xml/LN_PAY_PLN.DLG','../tmp/'+$KINBR+$TTYNAME+'_4402_'+#DKZH);
	
	setvfile(true, true)

	//call('cat ../tmp/'+$KINBR+$TTYNAME+'_4402_'+#DKZH+'>'+$KINBR+$TTYNAME);
	call('mv ../tmp/'+$KINBR+$TTYNAME+'_4402_'+#DKZH+'  ../tmp/'+$KINBR+$TTYNAME);
	call('end['+'mv ../tmp/'+$KINBR+$TTYNAME+'_4402_'+#DKZH+'  '+$KINBR+$TTYNAME);

}"
</ONLOSTFOCUS>
<!--
  <ONLOSTFOCUS>
  "{
    dim @line as string;
	dim @ch as string;
	dim @selid as number;
	list_init(17,78,6,1);
    list_setcolcnt(2);
    list_setcol(0,'放款日期',25);
    list_setcol(1,'放款金额',51);
	// list_setcol(2,'金额',17);
	// list_setcol(3:w ,'身份证号码',20);
	list_load('../tmp/'+$KINBR+$TTYNAME+#DKZH+'_4402');
    while(true)
		{ if(list_getrowcnt()==0){
	       list_show();
		   @ch=showmsg('1-增加,0-退出');
		}
		else
		{ list_work();
		  @ch=showmsg('1-增加,2-修改,3-删除,0-退出');
		}
		showfooter();
	    if(@ch=='0')
	    {
		  break;
	    }
	    else if(@ch=='1')
	    {
		   //增加
	       @line=input('1|30|【放款计划手工录入-增加】',
		   '2|5|放款日期: |%-8s',
		   '4|5|放款金额: |%13.2f');
		  // '6|5|    姓名: |%-50s',
		   //'8|5|账[卡]号: '+#DWACTNO,
		  // '10|5|    金额: |%13.2f',
		  // '12|5|身份证号: |%-19s');
		   if(@line!='')
		   {
              list_additem('','');
              @selid=list_getrowcnt()-1;
              list_settext(@selid,0,strfld(@line,'|',0));
	//        list_settext(@selid,1,strfld(@line,'|',1));
		      list_settext(@selid,1,itoa(val(strfld(@line,'|',1),0.01),'%.2f'));
	//		  list_settext(@selid,3,strfld(@line,'|',3));
			}
			  list_setselid(@selid);
			}else if(@ch=='2'){
			//修改
			@selid=list_getselid(); 
			if(@selid &lt; 0)
			{
			continue;
			}
			@line=input('1|30|【放款计划手工录入-修改】', 
		            '2|5|放款日期: |%-8s'+'|T('+list_gettext(@selid,0)+')',
					'4|5|放款金额: |%13.2f'+'|T('+itoa(val(list_gettext(@selid,1),100),'%.0f')+')');
					//	'2|5|单位编号: '+#DWID,
					//	'4|5|代发编号: |%-24s'+'|T('+list_gettext(@selid,0)+')',
					//  '6|5|    姓名: |%-50s'+'|T('+list_gettext(@selid,1)+')',
					//	'8|5|账[卡]号: '+#DWACTNO,
					//  '10|5|    金额: |%13.2f'
				//	+'|T('+itoa(val(list_gettext(@selid,2),100),'%.0f')+')',
				//	'12|5|身份证号: |%-19s'+'|T('+list_gettext(@selid,3)+')');
		 if(@line!='')
		 {
		   	 list_settext(@selid,0,strfld(@line,'|',0));
	//		 list_settext(@selid,1,strfld(@line,'|',1));
			 list_settext(@selid,1,itoa(val(strfld(@line,'|',1),0.01),'%.2f'));
	//		 list_settext(@selid,3,strfld(@line,'|',3));
		  }
			 list_setselid(@selid);
     }    
	 else if(@ch=='3'){
		 @selid=list_getselid();
		 if(@selid &lt; 0)
		 {
		  continue;
		  }
		  @ch=showmsg('您确定要删除此记录吗?(y/n)');
		  if(@ch=='y' or @ch=='Y')
		  {
	      list_rmitem(@selid);
		  }
		  if(list_getrowcnt() &gt; 0 and @selid &lt; list_getrowcnt())
		  {
          list_setselid(@selid);
		  }
	   }
    }
	if(list_getrowcnt()!=0)
	{
	   //保存文件
	   setvfile(true,true);
	   list_save('../tmp/'+$KINBR+$TTYNAME);
	   list_save('../tmp/'+$KINBR+$TTYNAME+#DKZH+'_4402');
	   call('');
	}
	list_del();
	refresh();
}"
  </ONLOSTFOCUS>
  -->
  </ITEM>


  <ITEM NAME="#SUBMIT" LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
  <ITEM NAME="#YEAR"  TYPE="%-4s" FUNCTIONS="T($FD5,1,4)"/>
  <ITEM NAME="#MON"   TYPE="%-2s" FUNCTIONS="T($FD5,5,2)"/>
  <ITEM NAME="#DAY"   TYPE="%-2s" FUNCTIONS="T($FD5,7,2)"/>

    </VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE>
	NOTHING
</PACKAGE>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER" DESC="打印凭条">
	NOTHING
</PACKAGE>
	<PRINT>"{
		print( 5, 16,'[4]      [2]     [2]',#YEAR,#MON,#DAY);
		print( 7,  8,'[5]',$FD2);
		print( 7, 24,' 放款计划');
		print( 7, 46,'[4]',$FD7);
	    print( 7, 62,'[6]',$FD4);
		print( 8,  2,'贷款帐号:[24]',#DKZH);
        print(10,  2,'贷款户名:[50]',#DKHM);
		print(12,  2,'存款账号:[19]',#CKZH);
        print(14,  2,'存款户名:[50]',#CKHM);
        }"
		</PRINT>

</RESPONSE>

<LASTWORK>"{
	dim @ans as number;
	@ans=msgbox('下一步执行 【还款计划】 Y?'+chr(10),'提示','yes|no');
	if(@ans==0){
		open('4403.XML','#DKZH='+#DKZH+';');
	}
}"
</LASTWORK>
</TRANSACTION>
   
   
   
   
    
   
  
