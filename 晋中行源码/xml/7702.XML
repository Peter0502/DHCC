<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110000" TITLE="7702      冲正/补记"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	initfd();
	commsend_001();
	$FD30 = #NACTNO;
	$FD34 = #ACTSEQN;
	$FD44 = #TXDATE;
	$FD41 = getitems('#AVL');
	$FD67 = #PROCESSTYPE;
	$FD68 = #CREDUFLAG;
	$FD69 = #CASHVIREMENTFLAG;

	
}"
</COMMSEND>
<COMMRECV>"{
		commrecv_001();
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(7702                           冲正/补记)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO"    TYPE="%-4s" FUNCTIONS="T($TXNO=5702)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  
  <!--输入变量-->
  
  <ITEM LINE="8"  COL="12" TYPE="%-9s" FUNCTIONS="T(错帐日期:)"/>
  <ITEM LINE="10" COL="12" TYPE="%-9s" FUNCTIONS="T(帐    号:)"/>
  <ITEM LINE="10" COL="47" TYPE="%-9s" FUNCTIONS="T(帐户序号:)"/>
  <ITEM LINE="12" COL="12" TYPE="%-9s" FUNCTIONS="T(处理方式:)"/>
  <ITEM LINE="14" COL="12" TYPE="%-9s" FUNCTIONS="T(借贷类型:)"/>
  <ITEM LINE="14" COL="47" TYPE="%-9s" FUNCTIONS="T(现转标志:)"/>
  <ITEM LINE="16" COL="12" TYPE="%-9s" FUNCTIONS="T(金    额:)"/>
  
  
  
  
 <ITEM NAME="#TXDATE" INPUT="TEXT" LINE="8" COL="21" TYPE="%-8s" FUNCTIONS="V(NB)D()"> 
 <ONLOSTFOCUS>
"{
	if(atoi($HDATE)==atoi(#TXDATE))
	{
//		showmsg('冲正补记交易不能记当日的帐');
//		return (false);
	}
        if(atoi($HDATE) &lt; atoi(#TXDATE))
        {
                showmsg('错帐日期错误!!!');
		return (false);
        }
}"
</ONLOSTFOCUS>
</ITEM>
  <ITEM NAME="#ACTNO" INPUT="TEXT"  LINE="10" COL="21" TYPE="%-19s" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
  "{
	if(substr(#ACTNO,0,3)=='407' or substr(#ACTNO,0,3)=='416'){
		showmsg('不可以记此科目的帐务!');
		return(false);
	}
	if(substr(#ACTNO,0,3)=='408'){
		if($KINBR!='10001'){
			showmsg('不可以记此科目的帐务!');
			return(false);
		}
	}
		initfd();
		commsend_001();
		$FD30 = #ACTNO;
		$FD16 = '9958';
		callserver();
		if($FD12!='0000')
		{
			showmsg(geterror());
			return (false);
		}
		//showmsg($FD30);
		#NACTNO = delspace($FD30);
		if(substr(#NACTNO,0,1)=='9'){
			#ACTSEQN='0000';
		}
		else{
			#ACTSEQN='';
		}
		
		//showmsg(#NACTNO);  //得到新帐号
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#NACTNO"  TYPE="%-19s" FUNCTIONS=""/><!---新帐号--->
  <ITEM NAME="#ACTSEQN" INPUT="TEXT"  LINE="10" COL="56" TYPE="%4d" FUNCTIONS="V(NB)"/>
  <ITEM NAME="#PROCESSTYPE" INPUT="SELECT"  LINE="12" COL="21" TYPE="%1s" FUNCTIONS="V(NB)T(1)">
  <SELECT>
		<OPTION VALUE="1" TITLE="冲正"/>
		<OPTION VALUE="2" TITLE="补记"/>
  </SELECT>
  </ITEM>

  <ITEM NAME="#CREDUFLAG" INPUT="SELECT"  LINE="14" COL="21" TYPE="%1s" FUNCTIONS="V(NB)T(1)">
  <SELECT>
		<OPTION VALUE="1" TITLE="借"/>
		<OPTION VALUE="2" TITLE="贷"/>
  </SELECT>
  </ITEM>
  <ITEM NAME="#CASHVIREMENTFLAG"   INPUT="SELECT"  LINE="14" COL="56" TYPE="%1s" FUNCTIONS="V(NB)T(1)">
      <SELECT>
		<OPTION VALUE="1" TITLE="现金"/>
		<OPTION VALUE="2" TITLE="转帐"/>
     </SELECT>
  </ITEM>
  
  <ITEM NAME="#AVL"  INPUT="TEXT"  LINE="16" COL="21" TYPE="%17.2f"   FUNCTIONS="V(NB)"/>
  <ITEM NAME="#XAVL" TYPE="%-21s"  FUNCTIONS="X(#AVL)"/>
  
  
  
   
  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#NAME1"  TYPE="%-4s" FUNCTIONS="S(#PROCESSTYPE,#PROCESSTYPE)"/>
  <ITEM NAME="#NAME2"  TYPE="%-2s" FUNCTIONS="S(#CREDUFLAG,#CREDUFLAG)"/>
  <ITEM NAME="#NAME3"  TYPE="%-4s" FUNCTIONS="S(#CASHVIREMENTFLAG,#CASHVIREMENTFLAG)"/>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS=""/>
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="冲正/补记">
 NOTHING
 </PACKAGE>
  <PRINT>"{
          print( 2,  24,'交易名称:冲正/补记');
          
          print( 4,  20,'交易机构:[5]',$FD2);
	  print( 5,  20,'交易日期:[4]年[2]月[2]日',substr($HDATE,0,4),substr($HDATE,4,2),substr($HDATE,6,2));  
	  print( 6,  20,'流水号码:[6]',$FD4);
	  print( 7,  20,'操作员号:[4]',$FD7);
	  
	  print( 8,  20,'错帐日期:[8 ]',#TXDATE);
	  print( 9,  20,'帐    号:[19]',#ACTNO);
	  print( 10, 20,'帐户序号:[4 ]',#ACTSEQN);
	  print( 11, 20,'处理方式:[4 ]',#NAME1);
	  print( 12, 20,'借贷类型:[2 ]',#NAME2);
	  print( 13, 20,'现转标志:[4 ]',#NAME3);
	  print( 14, 20,'金    额:[21]',#XAVL);
	}"
</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER" DESC="请打印业务专用凭证" LINESPACE="24">
 NOTHING
 </PACKAGE>
  <PRINT>"{
		dim @txtime as string;
		@txtime = substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
		$KINDNO = '00';
		print( 5, 20,'机构名称:[30]',$BRNAME);
                print( 5, 2,'代码:7702');
                print( 5, 13,'交易: 冲正/补记');
		print( 7, 20,'交易类型:[4 ]',#NAME1);
		print( 8, 20,'错帐日期:[8 ]',#TXDATE);
		print( 9, 20,'帐    号:[19]',#ACTNO);
		print(10, 20,'帐户序号:[4 ]',#ACTSEQN);
		print(11, 20,'借贷类型:[2 ]',#NAME2);
		print(12, 20,'现转标志:[4 ]',#NAME3);
		print(13, 20,'金    额:[21]',#XAVL);
        	printacdtl_1();
                print_sq();
                print( 24,20,'备注:')
                print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
                print( 24,5,'柜员:[4]',$FD7);
                print( 24,5,'流水号:[6]',$FD4);
	}"
</PRINT>
</RESPONSE>
</TRANSACTION>
