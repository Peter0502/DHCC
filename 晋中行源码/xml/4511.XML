<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11000000" TITLE="4511 贷款产品转换"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	initfd();
	commsend_001();
	$MSGTYPE='03001';
	$TXNO='3312';
	$FD16='3312';
	$FD23=#CPBM;
	$FD24=#CPBM2;
	$FD25=#NAME;
	$FD26=#CPMC;
	$FD27=#CPMC2;
	$FD31=#ACTNO;
	$FD46=#OPDAY;
	$FD44=#ENDAY;
	$FD45=#ENDAY2;
	$FD51=#TERM;
	$FD65='3312';
	

	$FD41 = itoa(#CD41*100, '%016.0f');
	$FD42 = itoa(#CD41*100, '%016.0f');

	$FD67 = #CD67;
	$FD68 = #CD68;
	$FD69 = #CD69;
	$FD70 = #DKFS;
	$FD71 = #CD71;
	}"
</COMMSEND>
<COMMRECV>"{
	commrecv_001();
}"
</COMMRECV>

<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-60s" FUNCTIONS=
   "T(4511                            贷款产品转换)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>

  <!--输入变量-->
  <ITEM LINE="7"   COL="05" TYPE="%-14s" FUNCTIONS="T(贷款账号:)"/>
  <ITEM LINE="7"   COL="41" TYPE="%-14s" FUNCTIONS="T(帐户序号:)" NAME="#S_SEQNO" INPUT="LABEL" VISABLE="FALSE"/>
  <ITEM LINE="08"  COL="05" TYPE="%-14s" FUNCTIONS="T(贷款户名:)"/>
  <ITEM LINE="10"  COL="05" TYPE="%-14s" FUNCTIONS="T(原产品信息:)"/>
  <ITEM LINE="11"  COL="11" TYPE="%-14s" FUNCTIONS="T(产品编号!:)"/>
  <ITEM LINE="12"  COL="11" TYPE="%-14s" FUNCTIONS="T(开户日期 :)"/>
  <ITEM LINE="13"  COL="11" TYPE="%-14s" FUNCTIONS="T(到期日期 :)"/>
  <ITEM LINE="15"  COL="05" TYPE="%-14s" FUNCTIONS="T(新产品信息:)"/>
  <!--ITEM LINE="16"  COL="11" TYPE="%-14s" FUNCTIONS="T(期限:     月)"/-->
  <ITEM LINE="16"  COL="11" TYPE="%-14s" FUNCTIONS="T(贷款方式!:)"/>
  <ITEM LINE="17"  COL="11" TYPE="%-14s" FUNCTIONS="T(产品编号!:)"/>
  <ITEM LINE="18"  COL="11" TYPE="%-14s" FUNCTIONS="T(到期日期 :)"/>

	<ITEM NAME="#CD41" TYPE="%17.2f" FUNCTIONS=""/>
	<ITEM NAME="#CD42" TYPE="%17.2f" FUNCTIONS=""/>

  <ITEM NAME="#ACTNO" 	INPUT="TEXT" 	LINE="7"   COL="17	" TYPE="%-19s" 	FUNCTIONS="T()V(NB)"/>

  <ITEM NAME="#CON1"    TYPE="%-1s" >
  <ONLOSTFOCUS>
 "{
		initfd(); 

		$MSGTYPE='03001';
        $TXNO='9836';
        $FD2=$OPNBR;
        $FD3=$KINBR;
        $FD5=$HDATE;
        $FD6='';
        $FD7=$TLRNO;
        $FD8='';
        $FD9='';
        $FD10=$TTYNAME;
        $FD16='9836';
        $FD17='';
        $FD31=#ACTNO;
        $FD65='3312';
		#CD68 = $FD68;
        callserver();
        if($FD12!='0000')
        {
            showmsg(geterror());
            return(false);
        }

		#NAME=$FD25;
		#CPBM=$FD23;
		#CPMC=$FD26;
		#OPDAY=$FD46;
		#ENDAY=$FD44;
		#ENDAY2=$FD45;
		#SEQNO=$FD35;
		#CD41 = val($FD41, 0.01);
		//showmsg('$FD41 = [' + $FD41 + '#FD41 = [' + itoa(#CD41*100, '%016.0f') + ']');

		#CD71 = $FD71;
		#CD67 = $FD67;
		#CD68 = $FD68;
		#CD69 = $FD69;
		if(atoi($FD35)>1)
		{
			show(#S_SEQNO,true);
			show(#SEQNO,true);
		}

		show(#NAME,true);
		show(#CPBM,true);
		show(#CPMC,true);
		show(#ENDAY,true);
		show(#OPDAY,true);
		enable(#NAME,false);
		enable(#CPBM,false);
		enable(#CPMC,false);
		enable(#OPDAY,false);
		enable(#ENDAY,false);

  }"
  </ONLOSTFOCUS>
  </ITEM>

  <ITEM NAME="#SEQNO" 	INPUT="TEXT" 	LINE="7"    COL="51	" TYPE="%4d" 	FUNCTIONS="" VISABLE="FALSE"/>

  <ITEM NAME="#NAME" 	INPUT="TEXT" 	LINE="8"    COL="15	" TYPE="%-50s" 	FUNCTIONS="" />
  <ITEM NAME="#CPBM" 	INPUT="TEXT" 	LINE="11"   COL="23	" TYPE="%-3s" 	FUNCTIONS="" />
  <ITEM NAME="#CPMC" 	INPUT="TEXT" 	LINE="11"   COL="28	" TYPE="%-50s" 	FUNCTIONS="" />
  <ITEM NAME="#OPDAY" 	INPUT="TEXT" 	LINE="12"   COL="23	" TYPE="%-8s" 	FUNCTIONS="D()" />
  <ITEM NAME="#ENDAY" 	INPUT="TEXT" 	LINE="13"   COL="23	" TYPE="%-8s" 	FUNCTIONS="D()" />

  <!--ITEM NAME="#TERM" 	INPUT="TEXT" 	LINE="16"   COL="16	" TYPE="%3d" 	FUNCTIONS=""/-->
  <ITEM NAME="#TERM"  TYPE="%3d" 	FUNCTIONS="" />
  <ITEM NAME="#CON2"    TYPE="%-1s" >
  <ONLOSTFOCUS>
 "{
	#ENDAY2=#ENDAY;
	show(#ENDAY2, true);
	//#ENDAY2=addmon(#OPDAY, val(#TERM));
	enable(#ENDAY2, false);
	//showmsg('函数空缺');
  }"
  </ONLOSTFOCUS>
  </ITEM>

  <ITEM NAME="#DKFS" 	INPUT="TEXT" 	LINE="16"   COL="23	" TYPE="%-1s" 	FUNCTIONS="T(3)" >
  <SELECT>
  <OPTION VALUE="3" TITLE="抵质押"/>
  <OPTION VALUE="4" TITLE="信用"/>
  <OPTION VALUE="5" TITLE="保证"/>
  <OPTION VALUE="7" TITLE="委托"/>
  <OPTION VALUE="9" TITLE="其他"/>
  </SELECT>
  </ITEM>
  <ITEM NAME="#CON3"    TYPE="%-1s" >
  <ONLOSTFOCUS>
 "{
		dim @tota as string;

		initfd();
		$MSGTYPE='03001';
        $TXNO='9636';
		commsend_001();
		$FD58=#CPBM;
		$FD70=#DKFS;
		$FD68 = #CD68;
		@tota=callserver();
        if($FD12!='0000')
        {
            showmsg(geterror());
            return(false);
        }
		setsel(#CPBM2,@tota,'o5t30o1v3o2');
		show(#CPBM2,true);

  }"
  </ONLOSTFOCUS>
  </ITEM>

  <ITEM NAME="#CPBM2" 	INPUT="SELECT" 	LINE="17"   COL="23	" TYPE="%-3s" 	FUNCTIONS="" />
  <ITEM NAME="#CD67" TYPE="%-1s"/>
  <ITEM NAME="#CD68" TYPE="%-1s"/>
  <ITEM NAME="#CD69" TYPE="%-1s"/>

  <ITEM NAME="#CD71" TYPE="%-1s"/>
  <ITEM NAME="#CPMC2" 	 TYPE="%-50s" 	FUNCTIONS="S(#CPBM2, #CPBM2)" >
  <ONLOSTFOCUS>
  "{
  		dim @tota as string;

		initfd();
		$MSGTYPE='03001';
        $TXNO='9737';
		commsend_001();
		$FD24 = #CPBM2;

		@tota=callserver();
        if($FD12!='0000')
        {
            showmsg(geterror());
            return(false);
        }
		#CD71 = $FD71;
//		showmsg('#CPMC2=['+#CPMC2+'] #CD71 = [' + #CD71 + ']');
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#ENDAY2" 	INPUT="TEXT" 	LINE="18"   COL="23	" TYPE="%-8s" 	FUNCTIONS="D()" />

  <ITEM NAME="#OTXDAY" 	 TYPE="%-10s" 	FUNCTIONS="" />
  <ITEM NAME="#OSTDAY" 	 TYPE="%-10s" 	FUNCTIONS="" />
  <ITEM NAME="#OENDAY" 	 TYPE="%-10s" 	FUNCTIONS="" />
  <ITEM NAME="#OOPAMT" 	 TYPE="%-21s" 	FUNCTIONS="" />
  <ITEM NAME="#OTXAMT" 	 TYPE="%-21s" 	FUNCTIONS="" />
  <ITEM NAME="#OAVBAL" 	 TYPE="%-21s" 	FUNCTIONS="" />
  <ITEM NAME="#UTXAMT" 	 TYPE="%-40s" 	FUNCTIONS="" />

  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
  
  </VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE DEVICE="SCREEN" LINESPACE="38" DESC="显示内容">
NOTHING
</PACKAGE>
<PRINT>"{
print(7,27,'    ★操作成功★ ');
}"
</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER" LINESPACE="38" DESC="请打印贷款产品转换借方凭证">
LNBKCPZC||@actno|@jjno|@name|@lnkd|@prtamt|@stday|@enday|@opamt|@txamt|@avbal|@nomrate|@overrate|@acno|@tp|@wssrno|@crdb|@acttp|@red
</PACKAGE>
<INIT>
"{
    #OTXDAY=substr($HDATE,0,4)+'-'+substr($HDATE,4,2)+'-'+substr($HDATE,6,2);
    #OSTDAY=substr(@stday,0,4)+'-'+substr(@stday,4,2)+'-'+substr(@stday,6,2);
    #OENDAY=substr(@enday,0,4)+'-'+substr(@enday,4,2)+'-'+substr(@enday,6,2);
    #OOPAMT=comma(@opamt,21);
    #UTXAMT=comma(@prtamt,21);
    #OTXAMT=comma(@prtamt,21);
    #OAVBAL=comma(@avbal,21);
}"
</INIT>
<PRINT>"{
print( 1,55,'\H0贷款产品转换借方凭证\H1');
print( 2,14,'     交易日期: [10        ]                                                      流 水 号: [5  ]',#OTXDAY,@wssrno);
print( 3,14,'┍━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┑');
print( 4,14,'┃  机构名称: [60                                                           ]                 ┃',$BRNAME);
print( 5,14,'┃  贷款账号: [19                 ]                               借据号:[20                 ]┃',@actno,@jjno);
print( 6,14,'┃  户    名: [50                                                ]                            ┃',@name);
print( 7,14,'┃  产品名称: [50                                                ]科目号:[7      ]            ┃',@lnkd,@acno);
print(8,14,'┠──────────────────────────────────────────────┨');
print(9,14,'┃  转出金额: 人民币[6      ][30                               ][21                  ]┃',@red,#UTXAMT,#OTXAMT);
print(10,14,'┠──────────────────────────────────────────────┨');
print(11,14,'┃  起止日期:  [10      ]  到  [10      ][4     ]                                             ┃',#OSTDAY,#OENDAY,@tp);
print(12,14,'┃  贷款本金: [21                   ]   合同利率(月):[10         ]   逾期利率(月):[10        ]┃',#OOPAMT,@nomrate,@overrate);
print(13,14,'┃  累计还本: [21                   ]                                                         ┃',#OTXAMT);
print(14,14,'┃  尚欠本金: [21                   ]                                                         ┃',#OAVBAL);
print(15,14,'┕━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┙');
}"
</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER" LINESPACE="38" DESC="请打印贷款产品转换借方凭证">
LNBKCPZR||@actno|@jjno|@name|@lnkd|@prtamt|@stday|@enday|@opamt|@txamt|@avbal|@nomrate|@overrate|@acno|@tp|@wssrno|@crdb|@acttp|@red
</PACKAGE>
<INIT>
"{
    #OTXDAY=substr($HDATE,0,4)+'-'+substr($HDATE,4,2)+'-'+substr($HDATE,6,2);
    #OSTDAY=substr(@stday,0,4)+'-'+substr(@stday,4,2)+'-'+substr(@stday,6,2);
    #OENDAY=substr(@enday,0,4)+'-'+substr(@enday,4,2)+'-'+substr(@enday,6,2);
    #OOPAMT=comma(@opamt,21);
    #UTXAMT=comma(@prtamt,21);
    #OTXAMT=comma(@prtamt,21);
    #OAVBAL=comma(@avbal,21);
}"
</INIT>
<PRINT>"{
print( 1,55,'\H0贷款产品转换借方凭证\H1');
print( 2,14,'     交易日期: [10        ]                                                      流 水 号: [5  ]',#OTXDAY,@wssrno);
print( 3,14,'┍━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┑');
print( 4,14,'┃  机构名称: [60                                                           ]                 ┃',$BRNAME);
print( 5,14,'┃  贷款账号: [19                 ]                               借据号:[20                 ]┃',@actno,@jjno);
print( 6,14,'┃  户    名: [50                                                ]                            ┃',@name);
print( 7,14,'┃  产品名称: [50                                                ]科目号:[7      ]            ┃',@lnkd,@acno);
print(8,14,'┠──────────────────────────────────────────────┨');
print(9,14,'┃  转出金额: 人民币[6      ][30                               ][21                  ]┃',@red,#UTXAMT,#OTXAMT);
print(10,14,'┠──────────────────────────────────────────────┨');
print(11,14,'┃  起止日期:  [10      ]  到  [10      ][4     ]                                             ┃',#OSTDAY,#OENDAY,@tp);
print(12,14,'┃  贷款本金: [21                   ]   合同利率(月):[10         ]   逾期利率(月):[10        ]┃',#OOPAMT,@nomrate,@overrate);
print(13,14,'┃  累计还本: [21                   ]                                                         ┃',#OTXAMT);
print(14,14,'┃  尚欠本金: [21                   ]                                                         ┃',#OAVBAL);
print(15,14,'┕━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┙');
}"
</PRINT>
</RESPONSE>
</TRANSACTION>

