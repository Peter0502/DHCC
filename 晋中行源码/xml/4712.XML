<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11000000" TITLE="4712 更改理财签约账号"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
    commsend_001();
    $FD16='2221';
    $FD30=#ZH1;
    $FD31=#ZH2;
    $FD63=#CPDM;
    $FD66=#CZLX;
    $FD48='1';
    $FD49='1';
    if(#KHLX == '2')
    {
    	$FD69=#DLZJLX;
    	$FD62=#DLZJHM;
    	$FD25=#DLRXM;
    }
}"
</COMMSEND>
<COMMRECV>"{
		commrecv_001();
		if($FD12 != '0000')
		{
			showmsg(geterror());
			return(false);
		}
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-54s" FUNCTIONS=
    "T(4712                         更改理财签约账号)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=2221)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  <ITEM LINE="5"  COL="5"  TYPE="%-10s"  FUNCTIONS="T(操作类型:)"/>
  <ITEM LINE="6"  COL="5"  TYPE="%-10s"  FUNCTIONS="T(产品代码:)"/>
  <ITEM LINE="7"  COL="5"  TYPE="%-12s"  FUNCTIONS="T(旧签约账号:)"/>
  <ITEM LINE="8"  COL="5"  TYPE="%-10s"  FUNCTIONS="T(旧账户名:)"/>
  <ITEM LINE="9"  COL="5"  TYPE="%-10s"  FUNCTIONS="T(证件类型:)"/>
  <ITEM LINE="10" COL="5"  TYPE="%-10s"  FUNCTIONS="T(证件号码:)"/>
  <ITEM LINE="12" COL="5"  TYPE="%-16s"  FUNCTIONS="T(代理人证件类型:)"/>
  <ITEM LINE="13" COL="5"  TYPE="%-16s"  FUNCTIONS="T(代理人证件号码:)"/>
  <ITEM LINE="11" COL="5"  TYPE="%-12s"  FUNCTIONS="T(代理人姓名:)"/>
  <ITEM LINE="14" COL="5"  TYPE="%-10s"  VISABLE="FALSE" NAME="#LDRAW_PWD1" FUNCTIONS="T(账户密码:)"/>
  <!--新账号信息-->
  <ITEM LINE="15" COL="5"  TYPE="%-12s"  FUNCTIONS="T(新签约账号:)"/>
  <ITEM LINE="16" COL="5"  TYPE="%-10s"  FUNCTIONS="T(新账户名:)"/>
  <ITEM LINE="17" COL="5"  TYPE="%-10s"  FUNCTIONS="T(证件类型:)"/>
  <ITEM LINE="18" COL="5"  TYPE="%-10s"  FUNCTIONS="T(证件号码:)"/>
  <ITEM LINE="19" COL="5"  TYPE="%-10s"   VISABLE="FALSE" NAME="#LDRAW_PWD2"FUNCTIONS="T(账户密码:)"/>

  <ITEM NAME="#KHLX" TYPE="%-10s" FUNCTIONS=""/>
  <ITEM NAME="#CZLX" INPUT="SELECT" LINE="5" COL="15" TYPE="%-10s" FUNCTIONS="V(NB)">
    <SELECT>
        <OPTION VALUE="0" TITLE="1.单一产品"/>
        <OPTION VALUE="1" TITLE="2.全部产品"/>
    </SELECT> 
    <ONLOSTFOCUS>
    "{
		if(#CZLX=='0'){
			show(#CPDM,true);
		}else{
		  #CPDM = '';
			show(#CPDM,false);
		}
	}"
    </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#SCZLX" TYPE="%-10s"  FUNCTIONS="S(#CZLX,#CZLX)"/> 
  <ITEM NAME="#CPDM"   INPUT="TEXT"    LINE="6"  COL="15" TYPE="%-10s" FUNCTIONS="V(NB)"/>
  <!--旧账号信息-->
  <ITEM NAME="#ZH1"    INPUT="TEXT"    LINE="7"  COL="15" TYPE="%-20s" FUNCTIONS="V(NB)">
    <ONLOSTFOCUS>
    "{
      dim @tota as string;
      initfd();
	    commsend_001();
      $FD16='8018';
      $FD48='1';
      $FD30=#ZH1;
      $FD65='0003';
      $FD67='2';
      @tota=callserver();
	    if($FD12 != '0000')
	    {
	    	showmsg(geterror());
	    	return(false);
	    }
	    #KHLX   = $FD69;
	    #HM1    = $FD25; 
	    #ZJLX1  = $FD67; 
	    #ZJHM1  = $FD62;
	    #DLZJLX = ''; 
	    #DLZJHM = ''; 
	    #DLRXM  = ''; 
	    #ZHMM1  = ''; 
	    if(#KHLX=='1')
	    {
				show(#DLZJLX,false);
				show(#DLZJHM,false);
				show(#DLRXM,false);
				show(#LDRAW_PWD1,true);
				show(#ZHMM1,true);
				show(#LDRAW_PWD2,true);
				show(#ZHMM2,true);
		  }
		  else
		  {
				show(#DLZJLX,true);
				show(#DLZJHM,true);
				show(#DLRXM,true);
		  }
    }"
    </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#HM1"      INPUT="LABEL"   LINE="8"   COL="15" TYPE="%-60s" FUNCTIONS=""/>
  <!--ITEM NAME="#ZJLX1"    INPUT="LABEL"   LINE="9"   COL="15" TYPE="%-1s" FUNCTIONS=""/-->
  <ITEM NAME="#ZJLX1"    ENABLE="FALSE"  INPUT="SELECT"   LINE="9"   COL="15" TYPE="%-1s" FUNCTIONS="">
  <SELECT>
        <OPTION VALUE="1" TITLE="1.身份证"/>
        <OPTION VALUE="2" TITLE="2.户口簿"/>
        <OPTION VALUE="3" TITLE="3.护照"/>
        <OPTION VALUE="4" TITLE="4.军官证"/>
        <OPTION VALUE="5" TITLE="5.回乡证"/>
        <OPTION VALUE="6" TITLE="6.居住证"/>
        <OPTION VALUE="7" TITLE="7.驾照"/>
        <OPTION VALUE="8" TITLE="8.企业代码证"/>
         <OPTION VALUE="9" TITLE="9.组织机构号"/>
         <OPTION VALUE="A" TITLE="A.营业执照"/>
         <OPTION VALUE="B" TITLE="B.经营许可证"/>
         <OPTION VALUE="C" TITLE="C.事业法人证书"/>
    </SELECT>
  </ITEM>
  <ITEM NAME="#ZJHM1"    INPUT="LABEL"   LINE="10"  COL="15" TYPE="%-20s" FUNCTIONS="">
    	<ONLOSTFOCUS>
  	"{
  			//add 20131030 wudawei start 调用身份核查
  		  dim @res as string;
				if(#ZJLX1=='1' or #ZJLX1=='2')
				{
					@res = idcheck(#ZJHM1,#HM1);
					#HCJGBL = strfld(@res,'|',1);
					@res =  strfld(@res,'|',0);
					if(@res=='02' or @res=='03' or @res=='04' or @res=='05' or @res=='06')
					{
							showmsg('身份核查结果不通过，不能继续办理！');
							return(false);
					}
				}
				//add 20131030 end
  	}"
  	</ONLOSTFOCUS>
  </ITEM>
  <!--输入-->
    <ITEM NAME="#DLRXM"    INPUT="TEXT"    LINE="11"  COL="17" TYPE="%-20s" FUNCTIONS=""/>
  <ITEM NAME="#DLZJLX"   INPUT="SELECT"  LINE="12"  COL="17" TYPE="%-1s"  FUNCTIONS="" >
    <SELECT>
        <OPTION VALUE="1" TITLE="1.身份证"/>
        <OPTION VALUE="2" TITLE="2.户口簿"/>
        <OPTION VALUE="3" TITLE="3.护照"/>
        <OPTION VALUE="4" TITLE="4.军官证"/>
        <OPTION VALUE="5" TITLE="5.回乡证"/>
        <OPTION VALUE="6" TITLE="6.士兵证"/>
    </SELECT>
  </ITEM>
  <ITEM NAME="#DLZJHM"   INPUT="TEXT"    LINE="13"  COL="17" TYPE="%-20s" FUNCTIONS="">
  		<ONLOSTFOCUS>
  	"{
  	
  	 	//add 20131030 wudawei start 调用身份核查
  		  dim @res as string;
				if(#DLZJLX=='1' or #DLZJLX=='2')
				{
					@res = idcheck(#DLZJHM,#DLRXM);
					#HCJGBL = strfld(@res,'|',1);
					@res =  strfld(@res,'|',0);
					if(@res=='02' or @res=='03' or @res=='04' or @res=='05' or @res=='06')
					{
							showmsg('身份核查结果不通过，不能继续办理！');
							return(false);
					}
				}
				//add 20131030 end
				}"
			</ONLOSTFOCUS>
			</ITEM>

  <ITEM NAME="#ZHMM1"    INPUT="TEXT"    LINE="14"  COL="15" TYPE="%-6s" DEVICE="PINPAD" VISABLE="FALSE"  FUNCTIONS="V(NB)i()" >
    <ONLOSTFOCUS>
	  "{
	  	if(len(#ZHMM1) &lt; 6)
	  	{
	  		showmsg('密码长度必须为六位!');
	  		return(false);
	  	}
	  <!--	dim @tota as string;
	  	initfd();
	    commsend_001();
      $FD16='9317';
      $FD30=#ZH1;
      $FD79=#ZHMM1;
      @tota=callserver();
	    if($FD12 != '0000')
	    {
	    	showmsg(geterror());
	    	#ZHMM1 = '';
	    	return(false);
	    }	-->
	     if(substr(#ZH1,0,6)!='621223' and substr(#ZH1,0,6)!='621780')
    {
    dim @baktxno as string;
    @baktxno=$TXNO;
    $TXNO='9317';
    commsend_001();
    $FD30=#ZH1;
    $FD79=getitems('#ZHMM1');
    callserver();
    $TXNO=@baktxno;
    if($FD12!='0000'){
      showmsg(geterror());
      return (false);
    }
    }
    else if(substr(#ZH1,0,6) == '621223' or substr(#ZH1,0,6)=='621780')  //add by hxc 091121
    {
		initfd();
		commsend_001();
		$FD16='7007';
		$FD30=#ZH1;
		$FD68='4';   //#OPTION ='04'
		$FD79=#ZHMM1;
		callagn();
		if( $FD12 != '0000')
		{
			showmsg(geterror());
			return(false);
		}
	    
	   } 
	  }"
	  </ONLOSTFOCUS>
  </ITEM>  
  <!--新账号信息-->
  <ITEM NAME="#ZH2"      INPUT="TEXT"    LINE="15"  COL="15" TYPE="%-20s" FUNCTIONS="">
    <ONLOSTFOCUS>
    "{
      dim @tota as string;
      initfd();
	    commsend_001();
      $FD16='8018';
      $FD48='1';
      $FD30=#ZH2;
      $FD65='0003';
      $FD67='2';
      @tota=callserver();
	    if($FD12 != '0000')
	    {
	    	showmsg(geterror());
	    	return(false);
	    }
	    #KHLX   = $FD69;
	    #HM2    = $FD25; 
	    #ZJLX2  = $FD67; 
	    #ZJHM2  = $FD62;
	    #ZHMM2  = ''; 
    }"
    </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#HM2"      INPUT="LABEL"   LINE="16"  COL="15" TYPE="%-60s" FUNCTIONS=""/>
  <ITEM NAME="#ZJLX2"    ENABLE="FALSE"  INPUT="SELECT"   LINE="17"   COL="15" TYPE="%-1s" FUNCTIONS="">
  <SELECT>
       <OPTION VALUE="1" TITLE="1.身份证"/>
        <OPTION VALUE="2" TITLE="2.户口簿"/>
        <OPTION VALUE="3" TITLE="3.护照"/>
        <OPTION VALUE="4" TITLE="4.军官证"/>
        <OPTION VALUE="5" TITLE="5.回乡证"/>
        <OPTION VALUE="6" TITLE="6.居住证"/>
        <OPTION VALUE="7" TITLE="7.驾照"/>
        <OPTION VALUE="8" TITLE="8.企业代码证"/>
         <OPTION VALUE="9" TITLE="9.组织机构号"/>
         <OPTION VALUE="A" TITLE="A.营业执照"/>
         <OPTION VALUE="B" TITLE="B.经营许可证"/>
         <OPTION VALUE="C" TITLE="C.事业法人证书"/>
    </SELECT>
  </ITEM>
  <!-- 为核查结果中文传值的变量 wudawei 20131101 -->
  <ITEM NAME="#HCJGBL"  TYPE="%-60s" />
  <ITEM NAME="#ZJHM2"    INPUT="LABEL"   LINE="18"  COL="15" TYPE="%-20s" FUNCTIONS="">
  	<ONLOSTFOCUS>
  	"{
  			//add 20131030 wudawei start 调用身份核查
  		  dim @res as string;
				if(#ZJLX2=='1' or #ZJLX2=='2')
				{
					@res = idcheck(#ZJHM2,#HM2);
					#HCJGBL = strfld(@res,'|',1);
					@res =  strfld(@res,'|',0);
					if(@res=='02' or @res=='03' or @res=='04' or @res=='05' or @res=='06')
					{
							showmsg('身份核查结果不通过，不能继续办理！');
							return(false);
					}
				}
				//add 20131030 end
  	}"
  	</ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#ZHMM2"    INPUT="TEXT"    LINE="19"  COL="15" TYPE="%-6s" DEVICE="PINPAD"  VISABLE="FALSE"  FUNCTIONS="V(NB)i()" >
    <ONLOSTFOCUS>
	  "{
	  	if(len(#ZHMM2) &lt; 6)
	  	{
	  		showmsg('密码长度必须为六位!');
	  		return(false);
	  	}
	  	<!--dim @tota as string;
	  	initfd();
	    commsend_001();
      $FD16='9317';
      $FD30=#ZH2;
      $FD79=#ZHMM2;
      @tota=callserver();
	    if($FD12 != '0000')
	    {
	    	showmsg(geterror());
	    	#ZHMM2 = '';
	    	return(false);
	    }	-->
	  if(substr(#ZH2,0,6)!='621223' and substr(#ZH2,0,6)!='621780')
    {
    dim @baktxno as string;
    @baktxno=$TXNO;
    $TXNO='9317';
    initfd();
    commsend_001();
    $FD30=#ZH2;
    $FD79=getitems('#ZHMM2');
    callserver();
    $TXNO=@baktxno;
    if($FD12!='0000'){
      showmsg(geterror());
      return (false);
    }
    }
    else if(substr(#ZH2,0,6) == '621223' or substr(#ZH2,0,6)=='621780')  //add by hxc 091121
    {
		initfd();
		commsend_001();
		$FD16='7007';
		$FD30=#ZH2;
		$FD68='4';   //#OPTION ='04'
		$FD79=#ZHMM2;
		callagn();
		if( $FD12 != '0000')
		{
			showmsg(geterror());
			return(false);
		}
	    
	  }  
	    
	  }"
	  </ONLOSTFOCUS>
  </ITEM>  
  <!--提交-->
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/> 
</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
	<PACKAGE DEVICE="SCREEN" DESC="按任意键继续">
 		NOTHING
	</PACKAGE>
	<PRINT>
	"{
		print(3,25,'更改理财签约账号成功');
		print(5,15,'新签约账号:[20   ]',#ZH2);
		print(6,15,'新账户名:[60     ]',#HM2);
		print(7,15,'旧签约账号:[20   ]',#ZH1);
		print(8,15,'旧账户名:[60     ]',#HM1);
		print(9,15,'产品代码:[8      ]',#CPDM);
		print(10,15,'操作类型:[10    ]',#SCZLX);
	}"
	</PRINT>
</RESPONSE>
<RESPONSE>
  <PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="请打印分配理财产品收益凭证">
  NOTHING
  </PACKAGE>
  <PRINT>
  "{
   dim @txtime  as string;
  @txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	print( 5, 20,'机构名称:[30]',$BRNAME);  
	print( 5, 2,'代码:4712');
	print( 5, 13,'交易:更改理财签约账号成功	');
	print( 7, 20,'新签约账号:[20     ]',#ZH2);
	print( 8, 20,'新账户名:[60] ',#HM2);
	print( 9, 20,'旧签约账号:[20] ',#ZH1);
	print( 11,20,'旧账户名:[60 ]',#HM1);
	print( 11,16,'操作类型:[10     ]',#SCZLX);
	  
	print(19,80,'\H0本人已确认银行打印记录正确无误.\H1');
  print(21,80,'客户签名:_____________________');
	print( 24,20,'备注:');
	print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
	print( 24,5,'柜员:[4]',$FD7);
	print( 24,5,'流水号:[6]',$FD4);
  }"
  </PRINT>
</RESPONSE>
<OUTPUT>
</OUTPUT>
</TRANSACTION>
