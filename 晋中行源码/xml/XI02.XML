<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110000" TITLE="4721 CVN密钥维护"
xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<!--12345678901234567890123456789012345678901234567890123456789012345678901234567890-->
<VARIABLE UPLOOP="FALSE">
  <ITEM LINE="3"  COL="3" TYPE="%-50s" FUNCTIONS=
 "T(4721                           CVN密钥维护)"/>
<!--12345678901234567890123456789012345678901234567890123456789012345678901234567890-->
<!--         1         2         3         4         5         6         7         8-->
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM LINE="6"  COL="15" TYPE="%-60s" FUNCTIONS= "T(┌──────────────────────┐)"/>
  <ITEM LINE="7"  COL="15" TYPE="%-60s" FUNCTIONS= "T(│                                            │)"/>
  <ITEM LINE="8"  COL="15" TYPE="%-60s" FUNCTIONS= "T(│                                            │)"/>
  <ITEM LINE="9"  COL="15" TYPE="%-60s" FUNCTIONS= "T(│                                            │)"/>
  <ITEM LINE="10" COL="15" TYPE="%-60s" FUNCTIONS= "T(│                                            │)"/>
  <ITEM LINE="11" COL="15" TYPE="%-60s" FUNCTIONS= "T(│                                            │)"/>
  <ITEM LINE="12" COL="15" TYPE="%-60s" FUNCTIONS= "T(└──────────────────────┘)"/>
  <ITEM LINE="14"  COL="15" TYPE="%-60s" FUNCTIONS="T(┌──────────────────────┐)"/>
  <ITEM LINE="15"  COL="15" TYPE="%-60s" FUNCTIONS="T(│                                            │)"/>
  <ITEM LINE="16"  COL="15" TYPE="%-60s" FUNCTIONS="T(│                                            │)"/>
  <ITEM LINE="17"  COL="15" TYPE="%-60s" FUNCTIONS="T(│                                            │)"/>
  <ITEM LINE="18" COL="15" TYPE="%-60s" FUNCTIONS= "T(│                                            │)"/>
  <ITEM LINE="19" COL="15" TYPE="%-60s" FUNCTIONS= "T(│                                            │)"/>
  <ITEM LINE="20" COL="15" TYPE="%-60s" FUNCTIONS= "T(└──────────────────────┘)"/>
  <ITEM LINE="7"  COL="17" TYPE="%-12s" FUNCTIONS="T(分管柜员A: )"/>
  <ITEM LINE="9"  COL="17" TYPE="%-12s" FUNCTIONS="T(柜员密码A:)"/>
  <ITEM LINE="11"  COL="17" TYPE="%-12s" FUNCTIONS="T(密钥分量A:)"/>

  <ITEM NAME="#TLRNOA" INPUT="TEXT" LINE="7"  COL="29" TYPE="%6d" FUNCTIONS="V(NB)"/>
  <ITEM NAME="#PASSWDA" INPUT="TEXT" LINE="9"  COL="29" TYPE="%6d" FUNCTIONS="V(NB)i()I()"/>
  <ITEM NAME="#XPASSA" TYPE="%-8s" FUNCTIONS="T($XPASS)"/>
  <ITEM NAME="#KEYA" INPUT="TEXT" LINE="11"  COL="29" TYPE="%-16s" FUNCTIONS="V(NB)I()">
  <ONLOSTFOCUS>"{
	dim @i as number;
	dim @ch as string;
	if(len(#KEYA)!=16){
		showmsg('密钥分量必须是16位');
		return(false);
	}
	@i=0;
	while(@i &lt; 16){
		@ch=substr(#KEYA,@i,1);
		if(@ch &gt;= '0' and @ch &lt;= '9'){
			@i=@i+1;
		}else if(@ch &gt;= 'A' and @ch &lt;= 'F'){
			@i=@i+1;
		}else if(@ch &gt;= 'a' and @ch &lt;= 'f'){
			@i=@i+1;
		}else{
			showmsg('密钥必须由0-9的数字或者A-F的字母组成');
			return(false);
		}
	}	
		
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#OKA" INPUT="BUTTON" LINE="11"  COL="49" TYPE="%-6s" FUNCTIONS="T(确  定)">
  <ONCLICK>"{
	#KEY=#KEYA;	
	#KEYA='';
	showmsg('分量A检查成功,按任意键后请操作员B来输入分量B');
	show(#KEYA,true);
  }"
  </ONCLICK>
  <ONLOSTFOCUS>"{
	if(#KEYA!='' or len(#KEY)!= 16){
		showmsg('分量A还没有输入完成!');
		return(false);
	}	
	enable(#TLRNOA,false);
	enable(#PASSWDA,false);
	enable(#KEYA,false);
	enable(#OKA,false);
  }"
  </ONLOSTFOCUS>
  </ITEM>

  <!--------------------------------------------------------------------->
  <ITEM LINE="15"  COL="17" TYPE="%-12s" FUNCTIONS="T(分管柜员B: )"/>
  <ITEM LINE="17"  COL="17" TYPE="%-12s" FUNCTIONS="T(柜员密码B:)"/>
  <ITEM LINE="19"  COL="17" TYPE="%-12s" FUNCTIONS="T(密钥分量B:)"/>

  <ITEM NAME="#TLRNOB" INPUT="TEXT" LINE="15"  COL="29" TYPE="%6d" FUNCTIONS="V(NB)"/>
  <ITEM NAME="#PASSWDB" INPUT="TEXT" LINE="17"  COL="29" TYPE="%6d" FUNCTIONS="V(NB)i()I()"/>
  <ITEM NAME="#XPASSB" TYPE="%-8s" FUNCTIONS="T($XPASS)"/>
  <ITEM NAME="#KEYB" INPUT="TEXT" LINE="19"  COL="29" TYPE="%-16s" FUNCTIONS="V(NB)I()">
  <ONLOSTFOCUS>"{
	dim @i as number;
	dim @ch as string;
	if(len(#KEYB)!=16){
		showmsg('密钥分量必须是16位');
		return(false);
	}
	@i=0;
	while(@i &lt; 16){
		@ch=substr(#KEYB,@i,1);
		if(@ch &gt;= '0' and @ch &lt;= '9'){
			@i=@i+1;
		}else if(@ch &gt;= 'A' and @ch &lt;= 'F'){
			@i=@i+1;
		}else if(@ch &gt;= 'a' and @ch &lt;= 'f'){
			@i=@i+1;
		}else{
			showmsg('密钥必须由0-9的数字或者A-F的字母组成');
			return(false);
		}
	}
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#OKA" INPUT="BUTTON" LINE="19"  COL="49" TYPE="%-6s" FUNCTIONS="T(确  定)">
  <ONCLICK>"{
	#KEY=#KEY+#KEYB;	
	#KEYB='';
	if(len(#KEY)!=32){
		showmsg('分量输入不完全,无法导入');
		return(false);
	}
	if(msgbox('密钥分量已经输入完毕!'+chr(10)+'是否现在导入?'+chr(10)+'---------------'+chr(10),'提示','yes|no')!=0){
		return(false);
	}
	#KEYAA=substr(#KEY,0,16);
	#KEYBB=substr(#KEY,16,16);
	show(#KEYB,true);
	submit();
  }"
  </ONCLICK>
  </ITEM>

  <ITEM NAME="#KEY" TYPE="%-32s" FUNCTIONS=""/>
  <ITEM NAME="#KEYAA" TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#KEYBB" TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#SUCCESS" TYPE="%-1s" FUNCTIONS=""/>


  <ITEM NAME="#TRMSEQ"  TYPE="%-2s"  FUNCTIONS="T($TRMSEQ)"/>
  <ITEM NAME="#OTRMSEQ" TYPE="%-9s"  FUNCTIONS="T(#KINBR+#TRMSEQ)"/>
  <ITEM NAME="#EJFNO"   TYPE="%-6s"  FUNCTIONS="T($TXTNO)"/>
  <ITEM NAME="#TASKID"  TYPE="%-2s"  FUNCTIONS="T(UT)"/>
  <ITEM NAME="#TMTYPE"  TYPE="%-1s"  FUNCTIONS="T(0)"/>
  <ITEM NAME="#APTYPE"  TYPE="%-1s"  FUNCTIONS="T(c)"/>
  <ITEM NAME="#TXNO"    TYPE="%-2s"  FUNCTIONS="T(21)"/>
  <ITEM NAME="#PTYPE"   TYPE="%-1s"  FUNCTIONS="T(0)"/>
  <ITEM NAME="#HCODE"   TYPE="%-1s"  FUNCTIONS="T(0)"/>
  <ITEM NAME="#RCODE"   TYPE="%-1s"  FUNCTIONS="T(0)"/>
  <ITEM NAME="#MULTTX"  TYPE="%-1s"  FUNCTIONS="T(0)"/>
  <ITEM NAME="#CRDB"    TYPE="%-1s"  FUNCTIONS="T(0)"/>
  <ITEM NAME="#SUPIN1"  TYPE="%-1s"  FUNCTIONS="T(0)"/>
  <ITEM NAME="#SUPIN2"  TYPE="%-1s"  FUNCTIONS="T(0)"/>
  <ITEM NAME="#REASON"  TYPE="%-6s"  FUNCTIONS="T(000000)"/>
  <ITEM NAME="#TLRNO"   TYPE="%-6s"  FUNCTIONS="T($TLRNO)"/>
  <ITEM NAME="#TOTLRNO" TYPE="%-9s"  FUNCTIONS="T(#KINBR+#TLRNO)"/>
  <ITEM NAME="#FTLRNO"  TYPE="%-6s"  FUNCTIONS="T(#TLRNO)"/>
  <ITEM NAME="#TRNMOD"  TYPE="%-1s"  FUNCTIONS="T(0)"/>
  <ITEM NAME="#SBTMOD"  TYPE="%-1s"  FUNCTIONS="T(0)"/>
  <ITEM NAME="#CURCD"   TYPE="%-3s"  FUNCTIONS="T(RMB)"/>
  <ITEM NAME="#XCRT"    TYPE="%-8s"  FUNCTIONS="T($XCRT)"/>
  <ITEM NAME="#TXAMT"   TYPE="%13.2f" FUNCTIONS=""/>
  <ITEM NAME="#DSCPT"   TYPE="%-3s"  FUNCTIONS="T(001)"/>
  <ITEM NAME="#TXTYPE"  TYPE="%-2s"  FUNCTIONS="a( )"/>
  <ITEM NAME="#NBCD"    TYPE="%-1s"  FUNCTIONS="T(0)"/>
  <ITEM NAME="#ACTNO"    TYPE="%-18s"  FUNCTIONS=""/>
</VARIABLE>

<REQUEST><PACKAGE SERVICE="dh47210">
$APCTLHD$HTRMSEQ$HEJFNO$OPNBR$KINBR$TRMSEQ#EJFNO#TASKID#TMTYPE#APTYPE#TXNO$PTYPE#DSCPT$HCODE#ACTNO#TXTYPE#MULTTX#CRDB$SUPCD1$SUPCD2#REASON#TLRNO#NBCD#TRNMOD#SBTMOD#CURCD#XCRT#TXAMT
#TLRNOA#XPASSA#KEYAA#TLRNOB#XPASSB#KEYBB
</PACKAGE>
</REQUEST>

<RESPONSE>
<PACKAGE>
C47211#SUCCESS
</PACKAGE>
</RESPONSE>
<OUTPUT>
<PACKAGE>
001$9999=9T230000A显示内容N505
</PACKAGE>
<FORMAT NAME="T230000A">
"07                             密钥设置成功!
"
</FORMAT>
</OUTPUT>
</TRANSACTION>
