<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11100000000000000000000000000000" TITLE="3603  银行对公短信通知业务签约"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
        initfd();
        commsend_001();
        $FD16='8891';
        $FD31=#AC_NO;  //扣费帐户

	      $FD27 = getitems('#SJNO1#SJNO2#SJNO3#SJNO4');
        $FD25 = getitems('#new_phone1#new_phone2#new_phone3#new_phone4');
        $FD26 = getitems('#DEL_SJNO1#DEL_SJNO2#DEL_SJNO3#DEL_SJNO4');
        $FD40= getitems('#FEEAMT') ;
        $FD71=#AC_TYPE;
        $FD69=#CHARGEFLAG; //收费标志
        $FD86=#FWLX;        
        $FD72=#YW_TYPE;
        $FD70=#LN_TYPE;
        $FD68=#CSTSIND; //转现标志              
        $FD67=#PIN_FLAG;        //是否输入密码标志,标志是否进行授权 0--不授权 1--授权
        if(#AC_TYPE=='1')
        {
                $FD37=#AC_NO1;
        }
        else if(#AC_TYPE=='3')
        {
                if(#LN_TYPE=='2')
                {
                        $FD37=#CONTRACT;
                        $FD71='A';//需要将授信贷款类型和其他贷款类型分开传到后台
                }
                else
                {
                        $FD37=#AC_NO2;
                }
        }       
}"
</COMMSEND>
<COMMRECV>
"{	
	  //if(#YW_TYPE=='2'){
	  //        #SJNO1=$FD27;
	  //}
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-48s" FUNCTIONS=
                "T(3603                       银行对公短信通知业务签约)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
        "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=8891)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  <ITEM NAME="#TXCD"    TYPE="%-4s"  FUNCTIONS="T(3603)"/>    <!---交易代码--->
  <ITEM NAME="#TXNAME"  TYPE="%-30s" FUNCTIONS="T(银行对公短信通知业务签约)"/><!---交易名称--->
  <ITEM NAME="#SRLX"      TYPE="%-1s"  FUNCTIONS="T(0)"/>       
  <ITEM NAME="#FWLX" TYPE="%-6s"   FUNCTIONS=""/>
  <ITEM NAME="#KHMC" TYPE="%-60s" FUNCTIONS=""/>
  <ITEM NAME="#ZJLX"  TYPE="%-1s" />
  <ITEM NAME="#ZJHM" TYPE="%-20s" />
  <ITEM NAME="#TMPNO" TYPE="%-20s" />
  <ITEM NAME="#OPN_BRNO" TYPE="%-5s" />
  <ITEM NAME="#SJ" TYPE="%44s"/>
  <ITEM NAME="#AMT" TYPE="%10.2f"/>
  <ITEM NAME="#XZMC" TYPE="%-5s" />
  <ITEM LINE="6"  COL="6"  TYPE="%-10s" INPUT="LABEL" FUNCTIONS="T(账户类型:)"/>
  <ITEM LINE="6"  COL="16" TYPE="%1s"   INPUT="SELECT" NAME="#AC_TYPE" FUNCTIONS="T(1)V(NB):">
  <SELECT>
        <OPTION VALUE="1" TITLE="活期户"/>
        <OPTION VALUE="3" TITLE="贷款户"/>
  </SELECT>
  <ONLOSTFOCUS>
  "{
        initfd();
        if(#AC_TYPE=='1')
        {
          show(#AC_NO1,true);
        	enable(#AC_NO1,true);
        	show(#YW_TYPE_DE,true);
        	enable(#YW_TYPE_DE,true);
        	show(#AC_NO2,false);  
        	show(#YW_TYPE_LN,false);      	
        }
        if(#AC_TYPE=='3')
        { 
					show(#YW_TYPE_DE,false);
					show(#AC_NO1,false);					
        	show(#YW_TYPE_LN,true);
        	show(#AC_NO2,true);
        	enable(#AC_NO2,true);
        	enable(#YW_TYPE_LN,true);      	
        }
        refresh();
  }"
  </ONLOSTFOCUS>
  </ITEM>
  
  <ITEM LINE="6"  COL="38" TYPE="%-12s"  INPUT="LABEL" FUNCTIONS="T(业务类型:!)"/>
  <ITEM LINE="6" COL="48" NAME="#YW_TYPE" TYPE="%-1s" INPUT="SELECT" FUNCTIONS="T(0)V(NB)">
  <SELECT>
        <OPTION VALUE="0" TITLE="0.开通"/>
        <OPTION VALUE="1" TITLE="1.变更"/>
        <OPTION VALUE="2" TITLE="2.解约"/>
  </SELECT>
  <ONLOSTFOCUS>
  "{	
      #AC_NO1='';
      #AC_NO2='';
      refresh();
  }"
  </ONLOSTFOCUS>
  </ITEM>
	<ITEM NAME="#SYW_TYPE" TYPE="%-6s" FUNCTIONS="S(#YW_TYPE,#YW_TYPE)"/>
	<ITEM LINE="8"  COL="6"  TYPE="%-10s" NAME="#YW_TYPE_DE" INPUT="LABEL" FUNCTIONS="T(账      号:)"/> 
  <ITEM LINE="8"  COL="16" NAME="#AC_NO1" TYPE="%-20s" INPUT="TEXT" FUNCTIONS="T()V(NB)"">
  <ONLOSTFOCUS>
  "{	
      dim @info as string;
      dim @tmp  as string;
      dim @sql  as string;
      dim @buffer as string;
      dim @tmpacid as string;
      #KHMC1='';
      #KHH='';
      #IDNO='';
      #ZJHM='';
      #ZJLX='';
      #AATYPE='';
      #DRAW_PWD='';
      #OPN_BRNO='';
      refresh();
			if(substr(#AC_NO1,0,6)=='621223' or substr(#AC_NO1,0,6)=='621780')
	    {
	       showmsg('请输入对公账户!');
	       return(false);
	    }
	    if(substr(#AC_NO1,0,1)=='1')
	    {
	       showmsg('请输入对公账户!');
	       return(false);
	    }
      initfd();
      commsend_001();
      $FD30=#AC_NO1;
      $FD16='9598';
      $FD123='select id_type,id_no,ac_id  from mdm_ac_rel where ac_no='+chr(39)+#AC_NO1+chr(39);
      @info=callserver();
      if($FD12!='0000')
      {
              showmsg(geterror());
              return(false);
      }
      if(@info=='')
      {
              showmsg('账号不存在,如为老账号,请输入新账号!!');
              return(false);
      }
      #ZJLX=delspace(strfld(@info,'|',0));
      #ZJHM=delspace(strfld(@info,'|',1));
      @tmpacid=delspace(strfld(@info,'|',2));
      initfd();
      commsend_001();
      $FD16='9598';
      @info='';
      $FD123='select name, cif_no from dd_mst where ac_id='+chr(39)+@tmpacid+chr(39);
      @info=callserver();
      if($FD12!='0000')
      {
              showmsg(geterror());
              return(false);
      }
      #KHMC1=delspace(strfld(@info,'|',0));//客户名称
			#KHH=delspace(strfld(@info,'|',1));//客户号
      #KHMC=#KHMC1;
      #AATYPE=#ZJLX;
      enable(#AATYPE,false);

    	#FWLX='1002';
			#TMPNO=#AC_NO1;
  }"
  </ONLOSTFOCUS>
  </ITEM>
    
  <ITEM LINE="9" COL="6"  TYPE="%-12s" INPUT="LABEL" FUNCTIONS="T(客户名称: )"/>
  <ITEM LINE="9" COL="16" NAME="#KHMC1" INPUT="LABEL" TYPE="%-60s" FUNCTIONS="V(NB)"/>
  <ITEM LINE="10" COL="16" TYPE="%-8s"  INPUT="LABEL" FUNCTIONS="V(NB)" NAME="#KHH"/>

  <ITEM LINE="8"  COL="6"  TYPE="%-12s" NAME="#YW_TYPE_LN" INPUT="LABEL" FUNCTIONS="T(贷款合同号:)"/>
  <ITEM LINE="8"  COL="16" NAME="#AC_NO2" TYPE="%-20s" DEVICE="KEYBOARD"  FUNCTIONS="T()V(NB)" >
  <ONGOTFOCUS>
  "{
    	#AC_NO2='';
  }"
  </ONGOTFOCUS>
  <ONLOSTFOCUS>
  "{
	    dim @info as string;
	    dim @temp as string;
	    dim @amt as string;
	    dim @ac_sts as string;
	    dim @intst_type as string;
	    dim @ac_id as string;
	    dim @repay_ac_id as string;

	    #IDNO='';
	    #ZJHM='';
	    #ZJLX='';
	    #AATYPE='';
	    #OPN_BRNO='';
	    refresh();
	    if(substr(#AC_NO2,0,1)=='5')
	    {
	       showmsg('合同号非法!');
	       return(false);
	    }
	    if(substr(#AC_NO1,0,6)=='621223' or substr(#AC_NO1,0,6)=='621780')
	    {
	       showmsg('合同号非法!');
	       return(false);
	    }
	    if(substr(#AC_NO1,0,1)=='1')
	    {
	       showmsg('合同号非法!');
	       return(false);
	    }
	    initfd();
	    commsend_001();
	    $FD16='9598';
	   
	    if(#YW_TYPE == '0'){
	    	$FD123='select cif_no,name,ac_sts,bal,intst_type,ac_id ,repay_ac_id from ln_mst where ac_sts != '+chr(39)+'*'+chr(39)+' and ac_sts != '+chr(39)+'9'+chr(39)+' and pact_no like '+chr(39)+#AC_NO2 +'%'+chr(39);
	    } else {
	    	$FD123='select cif_no,name,ac_sts,bal,intst_type,ac_id, repay_ac_id from ln_mst where  pact_no like '+chr(39)+#AC_NO2+'%'+chr(39);                   
	   	}      
	    @info=callserver();
	    if($FD12!='0000')
	    {
	     showmsg(geterror());
	            return(false);
	    }
	    if(@info=='')
	    {
	            showmsg('贷款合同信息不正确');
	            return(false);
	    }
	    
	    #CIFNO1=strfld(@info,'|',0);
	    #KHMC2 =strfld(@info,'|',1);
	    #KHMC=#KHMC2;
	    @temp  =strfld(@info,'|',2);
	    @ac_sts=strfld(@info,'|',2);
	    @amt   =strfld(@info,'|',3);
	    @intst_type=strfld(@info,'|',4);
	    @ac_id=strfld(@info,'|',5);
			@repay_ac_id = strfld(@info,'|',6);
	    if(#YW_TYPE == '0'){
	    	if(@ac_sts !='1' and @ac_sts!='2')
	    	{
	            	showmsg('账户状态不正常');
	            	return(false);
	    	}
			}
	    #AMT=val(@amt);

	    initfd();
	    commsend_001();
	    $FD16='9598';
	    $FD123='select ac_id,id_type,id_no,opn_br_no,ac_no from mdm_ac_rel where ac_id='+chr(39)+@ac_id+chr(39);
	    @info=callserver();
	    if($FD12!='0000')
	    {
	            showmsg(geterror());
	            return(false);
	    }
	    if(@info=='')
	    {
	            showmsg('输入的合同号没有对应账号记录');
	            return(false);
	    }
	    @temp=strfld(@info,'|',0);
	    #ZJLX=strfld(@info,'|',1);
	    #ZJHM=strfld(@info,'|',2);
	    #OPN_BRNO=strfld(@info,'|',3);
	    //#AC_NO2=strfld(@info,'|',4);
	    #ZJHM = delspace(#ZJHM);
	    #AATYPE=delspace(#ZJLX);
	    //#AC_NO2 = delspace(#AC_NO2);
	    enable(#AATYPE,false);
	    #TMPNO=#AC_NO2;
	    #FWLX='1003';
	    
	    initfd();
	    commsend_001();
	    $FD16='9598';
	    $FD123='select ac_no from mdm_ac_rel where ac_id='+chr(39)+@repay_ac_id+chr(39);
	    @info=callserver();
	    if($FD12!='0000')
	    {
	            showmsg(geterror());
	            return(false);
	    }
	    if(@info=='')
	    {
	            showmsg('结算账户信息不正确');
	            return(false);
	    }
	    #REPAY_AC_NO = strfld(@info,'|',0);
	    refresh();    
	  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="9" COL="16" NAME="#KHMC2" INPUT="LABEL" TYPE="%-60s" FUNCTIONS="V(NB)"/>
  <ITEM LINE="10" COL="6"  TYPE="%-10s" INPUT="LABEL" FUNCTIONS="T(客 户 号:)"/>
  <ITEM LINE="10" COL="16" TYPE="%-8s"  INPUT="LABEL" FUNCTIONS="V(NB)" NAME="#CIFNO1"/>

  <ITEM LINE="11" COL="6"  TYPE="%-9s" INPUT="LABEL" FUNCTIONS="T(证件类型:)"/>
  <ITEM LINE="11"  COL="17" NAME="#AATYPE"  INPUT="SELECT" TYPE="%-1s"  FUNCTIONS="T(1)V(NB)" >
  <SELECT >
        <OPTION VALUE="1" TITLE="身份证"/>
        <OPTION VALUE="2" TITLE="户口本"/>
        <OPTION VALUE="3" TITLE="护照"/>
        <OPTION VALUE="4" TITLE="军人证"/>
        <OPTION VALUE="5" TITLE="回乡证"/>
        <OPTION VALUE="6" TITLE="士兵证"/>
        <OPTION VALUE="8" TITLE="企业代码证"/>
        <OPTION VALUE="9" TITLE="组织机构号"/>
        <OPTION VALUE="A" TITLE="营业执照"/>
        <OPTION VALUE="B" TITLE="经营许可证"/>
        <OPTION VALUE="C" TITLE="事业法人证"/>
        <OPTION VALUE="D" TITLE="其他（对公）"/>
        <OPTION VALUE="H" TITLE="其他(对私)"/>
  </SELECT>
  <ONLOSTFOCUS>
  "{
        if(#AATYPE!=#ZJLX){
          showmsg('证件类型与账户证件类型不一致');
          return(false);
        }
  }"
  </ONLOSTFOCUS>
  </ITEM>

  <ITEM NAME="#TMPSJH1"  TYPE="%-11s" FUNCTIONS="T()"/>
  <ITEM NAME="#TMPSJH2"  TYPE="%-11s" FUNCTIONS="T()"/>
  <ITEM NAME="#TMPSJH3"  TYPE="%-11s" FUNCTIONS="T()"/>
  <ITEM NAME="#TMPSJH4"  TYPE="%-11s" FUNCTIONS="T()"/>
    <ITEM NAME="#DEL_SJNO1"  TYPE="%-11s" FUNCTIONS="T()"/>
  <ITEM NAME="#DEL_SJNO2"  TYPE="%-11s" FUNCTIONS="T()"/>
  <ITEM NAME="#DEL_SJNO3"  TYPE="%-11s" FUNCTIONS="T()"/>
  <ITEM NAME="#DEL_SJNO4"  TYPE="%-11s" FUNCTIONS="T()"/>
  <ITEM LINE="11" COL="38" TYPE="%-10s" INPUT="LABEL" FUNCTIONS="T(证件号码:)"/>
  <ITEM LINE="11"  COL="48" NAME="#ZZZ"  INPUT="LABEL" TYPE="%-18s"  FUNCTIONS="V(NB) ">
  <ONLOSTFOCUS>
  "{	
        #ZZZ = #ZJHM;
   }"
  </ONLOSTFOCUS>
  <ONLOSTFOCUS>
  "{
		  dim @fldcnt as number;
		  dim @info as string;
		  dim @tota as string;
		  dim @phones as string;
			dim @tmplen as string;  			
			if(#YW_TYPE=='0')//开通
		  {
          show(#new_phone1,true);
          show(#new_phone2,true);
          show(#new_phone3,true);
          show(#new_phone4,true);
          enable(#new_phone1,true);
          enable(#new_phone2,true);
          enable(#new_phone3,true);
          enable(#new_phone4,true); 
    			show(#FFLAG,true);
          show(#CHARGEFLAG,true);

		  }
		  else //修改和解约
		  {
		  		  	initfd();

        commsend_001();
        $FD16='9597';
        if(#AC_TYPE == '3')
        {
        	$FD30 = #AC_NO2;
        }
        else
        {
        	$FD30 = #AC_NO1;
        }
        
        @info = callserver();        
        @tmplen = rtrim($FD25);
        if($FD12!='0000')
        {
                showmsg(geterror());
                return(false);
        }
        if(@tmplen == '')
        {
                showmsg('没有签约或签约记录有错误');
                return(false);
        }      
        @fldcnt=strfldcnt($FD25,'|')-1;
        switch(@fldcnt){
        case 5:
        case 4:
                #SJNO4=strfld($FD25,'|',3);
        case 3:
                #SJNO3=strfld($FD25,'|',2);
        case 2:
                #SJNO2=strfld($FD25,'|',1);
        case 1:
                #SJNO1=strfld($FD25,'|',0);
        }
				if(#YW_TYPE=='1')//修改
				{
					show(#BG1,true);
					show(#BG2,true);
					show(#BG3,true);
					show(#BG4,true);
					
					show(#SC1,false);
					show(#SC2,false);
					show(#SC3,false);
					show(#SC4,false);
				}
				else
				{
					show(#SC1,true);
					show(#SC2,true);
					show(#SC3,true);
					show(#SC4,true);
					show(#BG1,false);
					show(#BG2,false);
					show(#BG3,false);
					show(#BG4,false);
				}
				
				show(#upd_flag1,true);
				show(#upd_flag2,true);
				show(#upd_flag3,true);
				show(#upd_flag4,true);

 
				show(#SJNO1,true);
	    	enable(#SJNO1,false);
				show(#SJNO2,true);
	    	enable(#SJNO2,false);
				show(#SJNO3,true);
	    	enable(#SJNO3,false);
				show(#SJNO4,true);
	    	enable(#SJNO4,false);
	    	
        //后台传回phones是多个手机号用|隔开的
        #TMPSJH1 = #SJNO1;
        #TMPSJH2 = #SJNO2;
        #TMPSJH3 = #SJNO3;
        #TMPSJH4 = #SJNO4;
			}		
		refresh();  
  }"
  </ONLOSTFOCUS>
  </ITEM> 
  <ITEM LINE="12" COL="6"  TYPE="%-120s" VISABLE="TRUE" FUNCTIONS="T(------------------------------------------------------------------------------------------------------------)"/>  
  <ITEM LINE="13" COL="6"  TYPE="%-10s" INPUT="LABEL"  NAME="#tel1"   FUNCTIONS="T(手机号码1:)"/>  
  <ITEM LINE="13" COL="16" NAME="#SJNO1" INPUT="TEXT"  TYPE="%11d"  VISABLE="FALSE" FUNCTIONS=""/>
  <ITEM LINE="13" COL="27"  TYPE="%-6s" INPUT="LABEL"  NAME="#BG1" VISABLE="FALSE"  FUNCTIONS="T(变更:!)"/>
  <ITEM LINE="13" COL="27"  TYPE="%-6s" INPUT="LABEL"  NAME="#SC1" VISABLE="FALSE"  FUNCTIONS="T(删除:!)"/>
  <ITEM LINE="13" COL="30"  TYPE="%-1s" INPUT="SELECT"  NAME="#upd_flag1" VISABLE="FALSE" FUNCTIONS="T(0)V(NB)">
  <SELECT>
  <OPTION VALUE="0" TITLE="是"/>
  <OPTION VALUE="1" TITLE="否"/>
  </SELECT>
  <ONLOSTFOCUS>
  "{
	  if(#upd_flag1=='0' and #YW_TYPE != '2')
	  {
	  	show(#new_tel1,true);
	    enable(#new_tel1,true);
	  	show(#new_phone1,true);
	    enable(#new_phone1,true);
	  }
		else
		{
			show(#new_tel1,false);
	    enable(#new_tel1,false);
	  	show(#new_phone1,false);
	    enable(#new_phone1,false);
	    if(#upd_flag1 == '1')
	    {
	    	#DEL_SJNO1 = '';
	    }
	    else
	    {
	    	#DEL_SJNO1 = #SJNO1;
	    }
	    #new_phone1 = #SJNO1;
		}
	  refresh();
  }"
  </ONLOSTFOCUS>
  </ITEM>

 	<ITEM LINE="13" COL="38"  TYPE="%-10s" INPUT="LABEL"  NAME="#new_tel1" VISABLE="FALSE"  FUNCTIONS="T(新手机号1:)"/>
  <ITEM LINE="13" COL="48" NAME="#new_phone1" INPUT="TEXT"  TYPE="%11d" VISABLE="FALSE" FUNCTIONS="V(13000000000,19000000000)I()">
  <ONLOSTFOCUS>
  "{
	  if( len(#new_phone1) &gt; 0 and len(#new_phone1) != 11)
	  {
	          showmsg('手机号必须为11位!!');
	          return(false);
	  }
	  if(#new_phone1=='1' and #new_phone1==#TMPSJH1 )
	  {
	          showmsg('注意:手机号1您没有做任何变更!');
	  }
  }"
  </ONLOSTFOCUS>
  </ITEM>
  
  <ITEM LINE="14" COL="6"  TYPE="%-10s" INPUT="LABEL"  NAME="#tel2"   FUNCTIONS="T(手机号码2:)"/>  
  <ITEM LINE="14" COL="16" NAME="#SJNO2" INPUT="TEXT"  TYPE="%11d" VISABLE="FALSE" FUNCTIONS=""/>
  <ITEM LINE="14" COL="27"  TYPE="%-6s" INPUT="LABEL"  NAME="#BG2" VISABLE="FALSE"  FUNCTIONS="T(变更:!)"/>
  <ITEM LINE="14" COL="27"  TYPE="%-6s" INPUT="LABEL"  NAME="#SC2"  VISABLE="FALSE" FUNCTIONS="T(删除:!)"/>
  <ITEM LINE="14" COL="30"  TYPE="%-1s" INPUT="SELECT"  NAME="#upd_flag2" VISABLE="FALSE"  FUNCTIONS="T(0)V(NB)">
  <SELECT>
  <OPTION VALUE="0" TITLE="是"/> 
  <OPTION VALUE="1" TITLE="否"/>
  </SELECT>
  <ONLOSTFOCUS>
  "{
  	if(#SJNO2 == '')
  	{
  		#upd_flag2 = 1;
  		show(#new_tel2,false);
	    enable(#new_tel2,false);
	  	show(#new_phone2,false);
	    enable(#new_phone2,false);
  	}
  	else
  	{ 	
		  if(#upd_flag2 == '0' and #YW_TYPE != '2')
	  	{
	  		show(#new_tel2,true);
		    enable(#new_tel2,true);
		  	show(#new_phone2,true);
		    enable(#new_phone2,true);
	  	}
			else
			{
				show(#new_tel2,false);
		    enable(#new_tel2,false);
		  	show(#new_phone2,false);
		    enable(#new_phone2,false);
		    if(#upd_flag2 == '1')
		    {
		    	#DEL_SJNO2 = '';
		    }
		    else
		    {	
		    	#DEL_SJNO2 = #SJNO2;
		    }
		    #new_phone2 = #SJNO2;
		  }
		}
	  refresh();
  }"
   
  
  </ONLOSTFOCUS>
  </ITEM>

 	<ITEM LINE="14" COL="38"  TYPE="%-10s" INPUT="LABEL"  NAME="#new_tel2" VISABLE="FALSE"  FUNCTIONS="T(新手机号2:)"/>
  <ITEM LINE="14" COL="48" NAME="#new_phone2" INPUT="TEXT"  TYPE="%11d" VISABLE="FALSE" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
	  if( len(#new_phone2) &gt; 0 and len(#new_phone2) != 11)
	  {
	          showmsg('手机号必须为11位!!');
	          return(false);
	  }
	  if(#new_phone2=='1' and #new_phone2==#TMPSJH2 )
	  {
	          showmsg('注意:手机号2您没有做任何变更!');
	  }
  }"
  </ONLOSTFOCUS>
  </ITEM>
  
  <ITEM LINE="15" COL="6"  TYPE="%-10s" INPUT="LABEL"  NAME="#tel3"   FUNCTIONS="T(手机号码3:)"/>  
  <ITEM LINE="15" COL="16" NAME="#SJNO3" INPUT="TEXT"  TYPE="%11d" VISABLE="FALSE" FUNCTIONS=""/>
  <ITEM LINE="15" COL="27"  TYPE="%-6s" INPUT="LABEL"  NAME="#BG3"  VISABLE="FALSE" FUNCTIONS="T(变更:!)"/>
  <ITEM LINE="15" COL="27"  TYPE="%-6s" INPUT="LABEL"  NAME="#SC3"  VISABLE="FALSE" FUNCTIONS="T(删除:!)"/>
  <ITEM LINE="15" COL="30"  TYPE="%-1s" INPUT="SELECT"  NAME="#upd_flag3" VISABLE="FALSE" FUNCTIONS="T(0)V(NB)">
  <SELECT>
  <OPTION VALUE="0" TITLE="是"/>
  <OPTION VALUE="1" TITLE="否"/>
  </SELECT>
  <ONLOSTFOCUS>
  "{
    if(#SJNO3 == '')
  	{
  		#upd_flag3 = 1;
  		show(#new_tel3,false);
	    enable(#new_tel3,false);
	  	show(#new_phone3,false);
	    enable(#new_phone3,false);
  	}
  	else
  	{ 	
		  if(#upd_flag3 == '0' and #YW_TYPE != '2')
	  	{
	  		show(#new_tel3,true);
		    enable(#new_tel3,true);
		  	show(#new_phone3,true);
		    enable(#new_phone3,true);
	  	}
			else
			{
				show(#new_tel3,false);
		    enable(#new_tel3,false);
		  	show(#new_phone3,false);
		    enable(#new_phone3,false);
		    if(#upd_flag3 == '1')
		    {
		    	#DEL_SJNO3 = '';
		    }
		    else
		    {	
		    	#DEL_SJNO3 = #SJNO3;
		    }
		    #new_phone3 = #SJNO3;
		  }
		}
	  refresh();
  }"
  </ONLOSTFOCUS>
  </ITEM>

 	<ITEM LINE="15" COL="38"  TYPE="%-10s" INPUT="LABEL"  NAME="#new_tel3" VISABLE="FALSE"  FUNCTIONS="T(新手机号3:)"/>
  <ITEM LINE="15" COL="48" NAME="#new_phone3" INPUT="TEXT"  TYPE="%11d" VISABLE="FALSE" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
	  if( len(#new_phone3) &gt; 0 and len(#new_phone3) != 11)
	  {
	          showmsg('手机号必须为11位!!');
	          return(false);
	  }
	  if(#new_phone3=='1' and #new_phone3==#TMPSJH3 )
	  {
	          showmsg('注意:手机号3您没有做任何变更!');
	  }
  }"
  </ONLOSTFOCUS>
  </ITEM>
  
  <ITEM LINE="16" COL="6"  TYPE="%-10s" INPUT="LABEL"  NAME="#tel4"   FUNCTIONS="T(手机号码4:)"/>  
  <ITEM LINE="16" COL="16" NAME="#SJNO4" INPUT="TEXT"  TYPE="%11d" VISABLE="FALSE" FUNCTIONS=""/>
  <ITEM LINE="16" COL="27"  TYPE="%-6s" INPUT="LABEL"  NAME="#BG4" VISABLE="FALSE"  FUNCTIONS="T(变更:!)"/>
  <ITEM LINE="16" COL="27"  TYPE="%-6s" INPUT="LABEL"  NAME="#SC4" VISABLE="FALSE"  FUNCTIONS="T(删除:!)"/>
  <ITEM LINE="16" COL="30"  TYPE="%-1s" INPUT="SELECT"  NAME="#upd_flag4" VISABLE="FALSE" FUNCTIONS="T(0)V(NB)">
  <SELECT>
  <OPTION VALUE="0" TITLE="是"/>
  <OPTION VALUE="1" TITLE="否"/>
  </SELECT>
  <ONLOSTFOCUS>
  "{
  	if(#SJNO4 == '')
  	{
  		#upd_flag4 = 1;
  		show(#new_tel4,false);
	    enable(#new_tel4,false);
	  	show(#new_phone4,false);
	    enable(#new_phone4,false);
  	}
  	else
  	{ 	
		  if(#upd_flag4 == '0' and #YW_TYPE != '2')
	  	{
	  		show(#new_tel4,true);
		    enable(#new_tel4,true);
		  	show(#new_phone4,true);
		    enable(#new_phone4,true);
	  	}
			else
			{
				show(#new_tel4,false);
		    enable(#new_tel4,false);
		  	show(#new_phone4,false);
		    enable(#new_phone4,false);
		    if(#upd_flag4 == '1')
		    {
		    	#DEL_SJNO4 = '';
		    }
		    else
		    {	
		    	#DEL_SJNO4 = #SJNO4;
		    }
		    #new_phone4 = #SJNO4;
		  }
		}
	  refresh();
  }"
  </ONLOSTFOCUS>
  </ITEM>

 	<ITEM LINE="16" COL="38"  TYPE="%-10s" INPUT="LABEL"  NAME="#new_tel4" VISABLE="FALSE"  FUNCTIONS="T(新手机号4:)"/>
  <ITEM LINE="16" COL="48" NAME="#new_phone4" INPUT="TEXT"  TYPE="%11d" VISABLE="FALSE" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
	  if( len(#new_phone4) &gt; 0 and len(#new_phone4) != 11)
	  {
	          showmsg('手机号必须为11位!!');
	          return(false);
	  }
	  if(#new_phone4=='1' and #new_phone4==#TMPSJH1 )
	  {
	          showmsg('注意:手机号1您没有做任何变更!');
	  }
  }"
  </ONLOSTFOCUS>
  </ITEM>
	<ITEM LINE="17" COL="6"  TYPE="%-120s" VISABLE="TRUE" FUNCTIONS="T(------------------------------------------------------------------------------------------------------------)"/>  
  <ITEM LINE="18"  COL="6"  TYPE="%-10s" INPUT="LABEL" NAME="#FFLAG" VISABLE="FALSE" FUNCTIONS="T(收费标志:)"/>
  <ITEM LINE="18"  COL="16" TYPE="%-1s"  INPUT="SELECT" NAME="#CHARGEFLAG" VISABLE="FALSE" FUNCTIONS="T(1)V(NB)">
  <SELECT>
       <OPTION VALUE="0" TITLE="0.免费"/> 
       <OPTION VALUE="1" TITLE="1.收费"/>
  </SELECT>
  <ONLOSTFOCUS>
  "{
        dim @info as string;
        dim @temp as string;
        @temp=substr(#FWLX,0,2);
        
        if( #YW_TYPE=='0')
        {
        	if(#CHARGEFLAG=='1')
        	{
              initfd();
              commsend_001();
              $FD16='9598';//根据123域返回查询结果
              $FD123='select fee_standard from mob_server_type where server_type='+chr(39)+#FWLX+chr(39);
              @info=callserver();
              if($FD12!='0000')
              {
                      showmsg(geterror());
                      return(false);
              }
              if(@info=='')
              {
                      showmsg('服务类型设置不正确，请联系科技部');
                      return(false);
              }
              #FEEAMT=strfld(@info,'|',0);
              //show(#FEEAMTNAME,true);
        			//show(#FEEAMT,true);
              show(#CSTSNM,true);
        			show(#CSTSIND,true);
        	}
        	else
        	{
        			show(#CSTSNM,false);
        			show(#CSTSIND,false);
        	}
                
        }
        else
        {    		                       
        		if(#CHARGEFLAG=='1')
				    {
							showmsg('修改解约时必须选择免费.');
							return(false);
				    }
				    #CHARGEFLAG='0';
        		show(#CSTSNM,false);
        		show(#CSTSIND,false);
        		show(#FEEAMTNAME,false);
        		show(#FEEAMT,false);
        		show(#KKZH2,false);
        		show(#AC_NO,false);
        		show(#ZHHM2,false);
        		show(#NAME,false);
        }
        refresh();
  }"
  </ONLOSTFOCUS>
  </ITEM>
  
  <!---收费主界面,2010-12-28 add by wangxd 20101228--REPAY_AC_NO--->
  
  <ITEM LINE="19"  COL="6" TYPE="%-10s"   INPUT="LABEL" NAME="#CSTSNM"  VISABLE="FALSE"   FUNCTIONS="T(现转标志:!)" />
  <ITEM LINE="19"  COL="16" NAME="#CSTSIND" TYPE="%1s" INPUT="SELECT" DEVICE="KEYBOARD"  VISABLE="FALSE" FUNCTIONS="V(NB)T(2)">
  <SELECT>
  	      <OPTION VALUE="1" TITLE="现金"/>
          <OPTION VALUE="2" TITLE="转帐"/>
  </SELECT>
  <ONLOSTFOCUS>
  "{
  		#AC_NO = '';
      dim @tota as string;
      
    	if(#AC_TYPE == '1')
    	{
    		#AC_NO = rtrim(#AC_NO1);
    	}
    	else
    	{
    		#AC_NO = rtrim(#REPAY_AC_NO);
    	}
      show(#KKZH2,true);
      show(#AC_NO,true);
      enable(#AC_NO,false);
      show(#ZHHM2,true);
      #XZMC = '转帐' ;

      show(#FEEAMTNAME,true);
      enable(#FEEAMTNAME,true);
      show(#FEEAMT,true);
      //enable(#FEEAMT,true);
      initfd();
      commsend_001();
      //$FD16='8889';
      if(#AC_TYPE=='1')
      {
              $FD37=#AC_NO1;
      }
      else if(#AC_TYPE=='3')
      {
              $FD37=#AC_NO2;
      }
      $FD72=#YW_TYPE;
      callserver();
      if($FD12!='0000' )
      {
              showmsg(geterror());
              return(false);
      }

      initfd();
      commsend_001();
      $FD16 ='9792';
      $FD122=#AC_NO;
      @tota=callserver();
      if($FD12!='0000')
      {
              showmsg(geterror());
              return(false);
      }

      #NAME1=delspace(substr($FD122,91,60));
			show(#NAME1,true);

      //#FEEAMT=val($FD41,0.01);
  }"
  </ONLOSTFOCUS>
	</ITEM>
	
	<ITEM LINE="20" COL="6"  NAME="#KKZH2"  VISABLE="FALSE"  INPUT="LABEL" TYPE="%-10s" FUNCTIONS="T(客户帐号:)"/>
	<ITEM NAME="#REPAY_AC_NO" TYPE="%-20s" FUNCTIONS="" />
  <ITEM LINE="20" COL="16" NAME="#AC_NO" TYPE="%-20s" INPUT="LABEL" VISABLE="FALSE" FUNCTIONS="" />

  <ITEM LINE="21" COL="6"  NAME="#ZHHM2"  INPUT="LABEL"   VISABLE="FALSE"   TYPE="%-10s" FUNCTIONS="T(户    名:)"/>
  <ITEM LINE="21" COL="16" NAME="#NAME1" TYPE="%-60s" INPUT="LABEL" VISABLE="FALSE" FUNCTIONS=""/>
  <ITEM LINE="22"  COL="6" TYPE="%-10s"  VISABLE="FALSE"  INPUT="LABEL" NAME="#FEEAMTNAME"     FUNCTIONS="T(收费金额:)" />
  <ITEM LINE="22" COL="16" TYPE="%17.2f"  NAME="#FEEAMT"  VISABLE="FALSE"  INPUT="LABEL" DEVICE="KEYBOARD" FUNCTIONS="" ENABLE="FALSE" />

  <ITEM LINE="23" COL="58" TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
  </VARIABLE>
  
  <RESPONSE>
  <PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="客户短信银行签约/解约成功">
        NOTHING
  </PACKAGE>
  </RESPONSE>
  
<!----PRINTER---->
  <RESPONSE>
  <PACKAGE DEVICE="SCREEN" LINESPACE="24" DESC="请打印业务凭证">
  NOTHING
  </PACKAGE>

  <PRINT>
  "{
        dim @txtime  as string;
        dim @line1   as number;
        dim @line2   as number;
        dim @counter as number;
        dim @tmpstr  as string;
        dim @sfeeamt  as string;
        
				@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
				
        print( 1,16,'机构名称:[24]交易代码:[24   ] 交易名称: [24]',$BRNAME,#TXCD,#TXNAME);
        
        if(#AC_TYPE=='3')
        {
            print(2,16,'通知贷款合同号:[20]   户名:[20]',#TMPNO,#KHMC);
        }
        else
        {
            print(2,16,'通知账号:[24]户名:[20]',#TMPNO,#KHMC);
        }
        print(3,16,'签约状态:[24][4]日期:[10]',#SYW_TYPE,#SYW_TYPE,$HDATE);
        
        if(#YW_TYPE=='0')//开通
        {
        	print(4,16,'手机号码1:[11]  手机号码2:[11]  手机号码3:[11]  手机号码4:[11]',#new_phone1,#new_phone2,#new_phone3,#new_phone4);
        }
        else if(#YW_TYPE=='1')//修改
        {
        	print(4,16,'手机号码1:[11]  手机号码2:[11]  手机号码3:[11]  手机号码4:[11]',#SJNO1,#SJNO2,#SJNO3,#SJNO4);
        	print(5,16,'变更号码1:[11]  变更号码2:[11]  变更号码3:[11]  变更号码4:[11]',#new_phone1,#new_phone2,#new_phone3,#new_phone4);
        }
        else //解约
        {
        	print(4,16,'解约号码1:[11]  解约号码2:[11]  解约号码3:[11]  解约号码4:[11]',#new_phone1,#new_phone2,#new_phone3,#new_phone4);
        }
        
				if(#CHARGEFLAG=='1' and #FEEAMT != 0.00)
        {
                print(5,16,'收费类型:收费                    现转标志:[4]',#XZMC);
                if(#AC_TYPE=='3')
        				{
                	print(6,16,'付款账号:[24]付款人名称:[20]',#AC_NO,#NAME1);
                }
                else
				        {
				          print(6,16,'付款账号:[24]付款人名称:[20]',#AC_NO,#KHMC1);
				        }
                print(7,16,'交易金额:[10]',#FEEAMT);
        }
        else
        {
                print(6,16,'收费 类型: 免费');
                //print(7,16,'短信通知时间段：每天8:00-22:00  存取款及贷款账户金额变动时发送短信通知');
        				//print(9,60,'客户签字:__________________________________');
       					//print(11,16,'备注:                     交易日期:[8] [8]  柜员:[6]   流水号:[6]',$HDATE,@txtime,$FD7,$FD4);
        
        }
        if(#FEEAMT &gt; 0.0)
        {
                printacdtl_1();
        }
        print(12,16,'短信通知时间段：每天8:00-22:00  存取款及贷款账户金额变动时发送短信通知');
        print(13,50,'客户签字:__________________________');
        print(14,16,'备注:                     交易日期:[8] [8]  柜员:[6]   流水号:[6]',$HDATE,@txtime,$FD7,$FD4);
  }"
  </PRINT>
  </RESPONSE>
</TRANSACTION>
