<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="00110000" TITLE="6502 债券投资买入记账"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
  <COMMSEND>"{
  		commsend_001();
		$FD16='4602';
		$FD23=#CPBH;
		
	}"
</COMMSEND>
<COMMRECV>"{
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-60s" FUNCTIONS=
    "T(6502                       债券投资买入记账  )"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
   <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=4601)"/>
   <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
   <!--输入变量-->
  <ITEM LINE="7"   COL="3" TYPE="%-14s" FUNCTIONS="T(投资协议编号:)"/>
  <ITEM LINE="7"  COL="40" TYPE="%-14s" FUNCTIONS="T(买入债券品种: )"/>
  <ITEM LINE="8"  COL="3" TYPE="%-10s" FUNCTIONS="T(产品编号:)"/>
  <ITEM LINE="8"  COL="40" TYPE="%-10s" FUNCTIONS="T(产品名称:)"/>
 
  <ITEM LINE="9"   COL="3" TYPE="%-10s" FUNCTIONS="T(买 入 价:)"/>
  <ITEM LINE="9"   COL="40" TYPE="%-14s" FUNCTIONS="T(票 面 价:)"/>
  
  <ITEM LINE="10"   COL="3" TYPE="%-10s" FUNCTIONS="T(现转标志:)"/>
<!--  <ITEM LINE="10"   COL="36" TYPE="%-14s" FUNCTIONS="T(转账类型)"/> -->
 
   <ITEM LINE="11"   COL="3" TYPE="%-10s" FUNCTIONS="T(贷方帐号:)"/>
  <ITEM LINE="12"   COL="3" TYPE="%-10s" FUNCTIONS="T(对方户名:)"/>

  <ITEM LINE="14"   COL="5" TYPE="%-10s" FUNCTIONS="T(发行日期:)"/>
  <ITEM LINE="14"   COL="36" TYPE="%-14s" FUNCTIONS="T(债券期限:)"/>
   <ITEM LINE="14"   COL="57" TYPE="%-14s" FUNCTIONS="T(月 )"/>

  <ITEM LINE="15"   COL="5" TYPE="%-10s" FUNCTIONS="T(购入日期:)"/>
  <ITEM LINE="15"   COL="36" TYPE="%-14s" FUNCTIONS="T(债券到期日期:)"/>

  <ITEM LINE="16"   COL="5" TYPE="%-14s" FUNCTIONS="T(债券计息方式:)"/>
  <ITEM LINE="16"   COL="36" TYPE="%-14s" FUNCTIONS="T(年 利 率:)"/>
    <ITEM LINE="16"   COL="63" TYPE="%-14s" FUNCTIONS="T(％)"/>

  <ITEM LINE="17"   COL="5" TYPE="%-10s" FUNCTIONS="T(应记利息:)"/>
<!--  <ITEM LINE="17"   COL="36" TYPE="%-14s" FUNCTIONS="T(手续费金额:)"/>  -->
  <ITEM LINE="18"   COL="5" TYPE="%-10s" FUNCTIONS="T(折价金额:)"/>
  <ITEM LINE="18"   COL="36" TYPE="%-14s" FUNCTIONS="T(溢价金额:)"/>

  <ITEM NAME="#XYBH" 	INPUT="TEXT" LINE="7" COL="19" TYPE="%-15s" 	FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
  "{
	$TXNO='9825';
//	$FD23=#CPBH;
	$FD58=#XYBH;
//	initfd();
	commsend_001();
	callserver();
	if($FD12!='0000'){
		showmsg(geterror());
		return(false);
	}

	#CPBH=$FD23;
	#MRJ= val($FD39, 0.01);
	#PMJ = val($FD40, 0.01);	
	#YJLX = val($FD41, 0.01);
	#YJJE = val($FD42, 0.01);	
	#ZJJE = val($FD43, 0.01);
	#FXRQ=$FD44;
	#DQRQ=$FD45;
	#GRRQ=$FD46;
	#ZQQX=$FD48;
	#JXFS=$FD68;
	#NLV=val($FD84, 0.000001);
	#ZQPZ=$FD86;
//	#SXF=val(substr($FD100, 32, 16), 0.01);
//	showmsg('fd68=['+$FD68+']jxfs=['+#JXFS+']');

	enable(#CPBH, false);
	enable(#MRJ, false);
	enable(#PMJ, false);
	enable(#YJLX, false);
	enable(#YJJE, false);
	enable(#ZJJE, false);
	enable(#DQRQ, false);
	enable(#GRRQ, false);
	enable(#FXRQ, false);
	enable(#ZQQX, false);
	enable(#JXFS, false);
	enable(#NLV, false);
	enable(#ZQPZ, false);
	//enable(#SXF, false);
	enable(#XZBZ,false);

  }"
  </ONLOSTFOCUS>

   </ITEM>
    <ITEM NAME="#ZQPZ" 	INPUT="TEXT" LINE="7" COL="54" TYPE="%-10s" FUNCTIONS="V(NB)"/>
   <ITEM NAME="#CPBH" INPUT="SELECT" LINE="8"  COL="13" TYPE="%-3s" 	FUNCTIONS="T(931)V(NB)">
  	<SELECT>
  		<OPTION VALUE="931" TITLE="0.短期国家债券 "/>
  		<OPTION VALUE="932" TITLE="1.短期金融债券 "/>
  		<OPTION VALUE="933" TITLE="2.其他短期债券 "/>
  		<OPTION VALUE="934" TITLE="3.投资长期债券面值 "/>
  	</SELECT>
	</ITEM>
	<ITEM NAME="#CPBHONLOSTFOCUS" TYPE="%-1s">
	<ONLOSTFOCUS>
	"{
		dim @txno as string;

//		initfd();
		$TXNO='9824';
		$FD23=#CPBH;
		commsend_001();
		callserver();
		#CPMC=substr($FD81, 0, 30);	
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		enable(#CPMC, false);
		//goitem(#JCMPC);
	}"
	</ONLOSTFOCUS>
</ITEM>
   <ITEM NAME="#CPMC" INPUT="TEXT" LINE="8" COL="49" TYPE="%-30s" FUNCTIONS="V(NB)"/>
   <ITEM NAME="#JCMPC" TYPE="%-1s"/>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>


  <ITEM NAME="#MRJ"	 LINE="9" COL="13" TYPE="%13.2f"  INPUT="TEXT"	FUNCTIONS="T()V(NB)"/>
  <ITEM NAME="#PMJ"	 LINE="9" COL="51" TYPE="%13.2f" INPUT="TEXT"	FUNCTIONS="T()V(NB)"/>
  <ITEM NAME="#XZBZ"  TYPE="%-1s" 	FUNCTIONS="T(2)"/>
   <ITEM NAME="#XZBZ" INPUT="SELECT" LINE="10"  COL="13" TYPE="%-1s" 	FUNCTIONS="T(2)V(2)">
  	<SELECT>
  		<OPTION VALUE="2" TITLE="0.转账 "/>

  	</SELECT>
	</ITEM>

<!--   <ITEM NAME="#ZZLX" INPUT="SELECT" LINE="10"  COL="47" TYPE="%-1s" 	FUNCTIONS="T(3)V(NB)">
  	<SELECT>
  		<OPTION VALUE="1" TITLE="0.同城 "/>
  		<OPTION VALUE="2" TITLE="1.大额 "/>
  		<OPTION VALUE="3" TITLE="2.本行"/>

  	</SELECT>
	</ITEM>
-->
<ITEM NAME="#DFZH"	 LINE="11" COL="15" TYPE="%-24s" INPUT="TEXT"	FUNCTIONS="T()V(NB)">
<ONLOSTFOCUS>
"{
//		initfd();
		$FD30=#DFZH;
		$TXNO='9812';
		$FD23=#CPBH;
		commsend_001();
		callserver();
		#DFHM=$FD27;	
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		enable(#DFHM, false);
}"
</ONLOSTFOCUS>
</ITEM>
<ITEM NAME="#DFHM"	 LINE="12" COL="15" TYPE="%-48s" DEVICE="KEYBORD"	FUNCTIONS="T()V(NB)"/>
  
  <ITEM NAME="#FXRQ"	 LINE="14" COL="15" TYPE="%-8s" INPUT="TEXT"	FUNCTIONS="T()D()V(NB)"/>
  <ITEM NAME="#ZQQX"	 LINE="14" COL="51" TYPE="%4d" INPUT="TEXT"	FUNCTIONS="T()V(NB)">
  <ONLOSTFOCUS>
  "{
  #DQRQ=addmon(#FXRQ, val(#ZQQX));
  enable(#DQRQ, false);
  }"
  </ONLOSTFOCUS>
  </ITEM>

  <ITEM NAME="#GRRQ"	 LINE="15" COL="15" TYPE="%-8s" INPUT="TEXT"	FUNCTIONS="T()D()V(NB)"/>
  <ITEM NAME="#DQRQ"	 LINE="15" COL="51" TYPE="%-8s" INPUT="TEXT"	FUNCTIONS="T()D()V(NB)"/>

  <ITEM NAME="#JXFS"   INPUT="SELECT" LINE="16" COL="19" TYPE="%-1s" 	FUNCTIONS="T(1)"> 
  	<SELECT>
  		<OPTION VALUE="2" TITLE="2.到期付息 "/>
  		<OPTION VALUE="4" TITLE="3.按期计息 "/>
  	</SELECT>
  </ITEM>
  <ITEM NAME="#NLV"	 LINE="16" COL="51" TYPE="%9.6f" INPUT="TEXT"	FUNCTIONS="T()V(NB)"/>

  <ITEM NAME="#YJLX"	 LINE="17" COL="15" TYPE="%16.2f" INPUT="TEXT"	FUNCTIONS="T()V(NB)">
  <ONLOSTFOCUS>
  "{
//	#ZJJE=#YJLX+#ZJJE;
//	enable(#ZJJE, false);
  }"
  </ONLOSTFOCUS>
  </ITEM>
<!--  <ITEM NAME="#SXF"	 LINE="17" COL="51" TYPE="%16.2f" INPUT="TEXT"	FUNCTIONS="T()V(NB)"/> -->

  <ITEM NAME="#ZJJE"	 LINE="18" COL="15" TYPE="%16.2f" INPUT="TEXT"	FUNCTIONS="T()V(NB)"/>
  <ITEM NAME="#YJJE"	 LINE="18" COL="51" TYPE="%16.2f" INPUT="TEXT"	FUNCTIONS="T()V(NB)"/>
  <ITEM NAME="#XZJJE" TYPE="%-20s"	FUNCTIONS="X(#ZJJE)"/>
  <ITEM NAME="#XYJJE" TYPE="%-20s"	FUNCTIONS="X(#YJJE)"/>
  
  <ITEM NAME="#FD" TYPE="%-1s">
  <ONLOSTFOCUS>
  "{
    if(#ZJJE==#YJJE) //溢价折价都为零
    {
       $FD32='121'; //科目 拆放境外同业
    }
		$FD27=#DFHM;
		$FD30=#DFZH;

		$FD39=itoa(#MRJ*100, '%016.0f');
		$FD40=itoa(#PMJ*100, '%016.0f');
		$FD41=itoa(#YJLX*100, '%016.0f');
		$FD42=itoa(#YJJE*100, '%016.0f');
		$FD43=itoa(#ZJJE*100, '%016.0f');
		$FD44=#FXRQ;
		$FD45=#DQRQ;
		$FD46=#GRRQ;
		$FD48=#ZQQX;
    
		$FD68=#JXFS;
		
		$FD69=#XZBZ;
//		$FD70=#ZZLX;
//    showmsg($FD42);
//    showmsg($FD43);
		$FD81=#CPMC+space(30);
		$FD84=itoa(#NLV*1000000, '%08.0f');
		//showmsg('84=['+$FD84+'?=['+itoa(#NLV*1000000, '%016.0f')+']');
		$FD86=#ZQPZ;
//		$FD100=space(32)+itoa(#SXF*100, '%016.0f');
  }"
  </ONLOSTFOCUS>
  </ITEM>

  <ITEM NAME="#SUBMIT" LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
    </VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
	<PACKAGE DEVICE="SCREEN" DESC="显示内容">
	NOTHING
	</PACKAGE>
	<PRINT>"{
		print( 4, 20,'债券投资买入记账成功');
		print( 6, 10,'流 水 号:[6]', $FD4);
		print( 7, 10,'投资协议编号:[8]',#XYBH);
		print( 8, 10,'贷方帐号: [24]',#DFZH);
		print( 9, 10,'折价金额: [20]',#XZJJE);
		print(10, 10,'溢价金额: [20]',#XYJJE);
   }"
   </PRINT>
 </RESPONSE>

<RESPONSE>
	<PACKAGE DEVICE="PRINTER" DESC="打印业务专用凭证">
	NOTHING
	</PACKAGE>
	<PRINT>"{
		dim @txtime as string;
		@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	print( 5, 20,'机构名称:[30]',$BRNAME);  
	print( 5, 2,'代码:6502');
	print( 5, 13,'交易:债券投资买入记账');

	print( 7,20,'帐号 [24]',$FD30);
	print( 8,20,'帐号 [24]',$FD31);
	print( 9,20,'帐号 [24]',$FD33);
	print(10,20,'帐号 [24]',$FD32);
	print(11,20,'投资协议编号:[15]',#XYBH);
	printacdtl_1();
    
	print( 24,20,'备注:');
	print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
	print( 24,5,'柜员:[4]',$FD7);
	print( 24,5,'流水号:[6]',$FD4);
	}"
	</PRINT>
	</RESPONSE>
<OUTPUT>

</OUTPUT>
</TRANSACTION>
   
   
   
   
    
