<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11000000" TITLE="4506 利率调整"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	commsend_001();
	$MSGTYPE='03001';
	$TXNO='3306';
	$FD16='3306';
	$FD25=#NAME;
	$FD37=#ACTNO;
	$FD65='3306';
	$FD79=#PASSWD;
	$FD84=itoa(#RATE*1000000,'%08.0f');
	}"
</COMMSEND>
<COMMRECV>"{
	commrecv_001();
}"
</COMMRECV>

<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-60s" FUNCTIONS=
   "T(4506                            利率调整)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=3306)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>

  <!--输入变量-->
  <ITEM LINE="09"  COL="19" TYPE="%-14s" FUNCTIONS="T(贷款账号 :)"/>
  <ITEM LINE="10"  COL="19" TYPE="%-14s" FUNCTIONS="T(户    名 :)"/>
  <ITEM LINE="12"  COL="19" TYPE="%-14s" FUNCTIONS="T(帐户状态!:)"/>
  <ITEM LINE="13"  COL="19" TYPE="%-14s" FUNCTIONS="T(贷款类型!:)"/>
  <ITEM LINE="15"  COL="19" TYPE="%-14s" FUNCTIONS="T(利率类型!:)"/>
  <ITEM LINE="16"  COL="19" TYPE="%-14s" FUNCTIONS="T(月 利 率:)"/>
  <ITEM LINE="16"  COL="41" TYPE="%-2s"  FUNCTIONS="T(‰)"/>
  <ITEM NAME="#ACTNO" 	INPUT="TEXT" 	LINE="09"   COL="29	" TYPE="%-19s" 	FUNCTIONS="T()V(NB)"/>
  <ITEM NAME="#CON1"    TYPE="%-1s" >
  <ONLOSTFOCUS>
 "{
	initfd();
	commsend_001();
        $FD16='9807';
        $FD17='';
        $FD37=#ACTNO;
	$FD65=$TXNO;

        callserver();
        if($FD12!='0000')
        {
            showmsg('该帐号不存在! '+$FD12);
            return(false);
        }

	#NAME=$FD25;
	#ACTCLS=$FD70;
	#CLNTP=$FD69;
	if(atoi($FD56) &gt; 0 )
	{
	  showmsg('该帐号积数不为零不能调整利率,先结息! ');
    return(false);
	}
		show(#NAME,true);
		show(#ACTCLS,true);
		show(#CLNTP,true);
		enable(#ACTCLS,false);
		enable(#CLNTP,false);
  }"
  </ONLOSTFOCUS>
  </ITEM>

  <ITEM NAME="#NAME" 	INPUT="LABEL" 	LINE="10"  COL="29	" TYPE="%-60s" 	FUNCTIONS=""/>

  <ITEM NAME="#ACTCLS" 	INPUT="SELECT" 	LINE="12"  COL="29	" TYPE="%-1s" 	VISABLE="FALSE" FUNCTIONS="">
  <SELECT>
     <OPTION VALUE="1" TITLE="正常"/>
     <OPTION VALUE="2" TITLE="展期"/>
     <OPTION VALUE="3" TITLE="逾期"/>
  </SELECT>
  </ITEM>

  <ITEM NAME="#CLNTP" 	INPUT="SELECT" 	LINE="13"  COL="29	" TYPE="%-1s" 	VISABLE="FALSE" FUNCTIONS="">
  <SELECT>
     <OPTION VALUE="1" TITLE="利随本清"/>
     <OPTION VALUE="2" TITLE="按期还息"/>
     <OPTION VALUE="3" TITLE="等额还本付息"/>
     <OPTION VALUE="4" TITLE="等额还本按期还息"/>
     <OPTION VALUE="5" TITLE="按期还本息[不同时间]"/>
  </SELECT>
  </ITEM>

  <ITEM NAME="#RATETP" 	INPUT="SELECT" 	LINE="15"  COL="29	" TYPE="%-1s" 	FUNCTIONS="T(1)">
  <SELECT>
     <OPTION VALUE="1" TITLE="正常"/>
     <OPTION VALUE="2" TITLE="展期"/>
     <OPTION VALUE="3" TITLE="逾期"/>
     <OPTION VALUE="4" TITLE="罚息"/>
  </SELECT>
  </ITEM>

  <ITEM NAME="#CON2"    TYPE="%-1s" >
  <ONLOSTFOCUS>
 "{
		if(#CLNTP=='3' or #CLNTP=='4')
		{
			if(#RATETP!='3' and #RATETP!='4')
			{
				showmsg('按揭贷款只能调整逾期利率和罚息利率!');
				return(false);
			}
		}
		if(#ACTCLS=='2' and #RATETP!='1')
		{
				showmsg('该贷款账户处于展期状态,不可修改正常利率!!');
				return(false);
		}
		if(#ACTCLS=='3' and #RATETP!='3' and #RATETP!='4')
	    {
				showmsg('该贷款账户处于逾期状态,只可修改逾期利率和罚息利率!');
				return(false);
		}
		

		$MSGTYPE='03001';
        $TXNO='9829';
        $FD2=$OPNBR;
        $FD3=$KINBR;
        $FD5=$HDATE;
        $FD6='';
        $FD7=$TLRNO;
        $FD8='';
        $FD9='';
        $FD10=$TTYNAME;
        $FD16='9829';
        $FD17='';
        $FD37=#ACTNO;
        $FD71=#RATETP;

        callserver();
        if($FD12!='0000')
        {
			showmsg(geterror());
            return(false);
        }
		#RATE=atoi($FD84)/1000000;
		show(#RATE,true);

  }"
  </ONLOSTFOCUS>
  </ITEM>

  <ITEM NAME="#RATE" 	INPUT="TEXT" 	LINE="16"  COL="29	" TYPE="%8.5f" 	FUNCTIONS=""/>

  <ITEM NAME="#PASSWD" 	    TYPE="%-6s" 	FUNCTIONS=""/>
  <ITEM NAME="#WSSRNO"      TYPE="%-6s"     />
  <ITEM NAME="#OTXDAY"      TYPE="%-10s"    />

  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
  
</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE DEVICE="SCREEN" LINESPACE="38" DESC="显示内容">
NOTHING
</PACKAGE>
<PRINT>"{
print(7,27,'    ★操作成功★ ');
}"
</PRINT>
</RESPONSE>

<!--
<RESPONSE>
<PACKAGE DEVICE="PRINTER" LINESPACE="38" DESC="请打印贷款利率调整凭证">
LNBKLL||@actno|@jjno|@name|@lnkd|||||||@orate|@nrate||@tp|@wssrno|
</PACKAGE>
<INIT>
"{
    #OTXDAY=substr($HDATE,0,4)+'-'+substr($HDATE,4,2)+'-'+substr($HDATE,6,2);
}"
</INIT>
<PRINT>"{
print( 2,55,'\H0贷款利率调整凭证\H1');
print( 4,14,'      交易日期: [10        ]                                                 流 水 号: [5  ]',#OTXDAY,@wssrno);
print( 5,14,'┍━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┑');
print( 6,14,'┃  机构名称: [60                                                            ]                    ┃',$BRNAME);
print( 7,14,'┃  贷款账号: [19                   ]                          借 据 号: [20                ]     ┃',@actno,@jjno);
print( 8,14,'┃  户    名: [60                                                ]                              ┃',@name);
print( 9,14,'┃  产品名称: [50                                                ]                              ┃',@lnkd);
print(10,14,'┃--------------------------------------------------------------------------------------------┃');
print(11,14,'┃  利率类型: [4                  ]利率                                                                        ┃',@tp);
print(12,14,'┃  原 利 率: [10                   ]                                                                       ┃',@orate);
print(13,14,'┃  现 利 率: [21                   ]                                                            ┃',@nrate);
print(14,14,'┕━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┙');
}"
</PRINT>
</RESPONSE>
-->
<RESPONSE>
<PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="打印业务专用凭证(利率调整)">
LNBKLL||@actno|@jjno|@name|@lnkd|||||||@orate|@nrate||@tp|@wssrno|
</PACKAGE>
<PRINT>
"{
	dim @txtime  as string;
        @txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	print( 5, 20,'机构名称:[30]',$BRNAME);
        print( 5, 2,'代码:4506');
        print( 5, 13,'交易:利率调整')
	print( 7, 20,'贷款帐号:[19]',#ACTNO);
	print( 8, 20,'户    名:[60]',#NAME);
	print( 9, 20,'利率类型:[4]',@tp);
	print( 10, 20,'原 利 率:[10]          现 利 率:[21]',@orate,@nrate);
        print_sq();
        print( 24,20,'备注:')
        print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
        print( 24,5,'柜员:[4]',$FD7);
        print( 24,5,'流水号:[6]',$FD4);
}"
</PRINT>
</RESPONSE>
</TRANSACTION>

