<?xml version="1.0" encoding="GBK" ?> 
<TRANSACTION RIGHTS="11111111011100000000000001100010" TITLE="1812       通存业务)" 
	xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org"> 
<COMMSEND> 
"{ 
}" 
</COMMSEND> 
<COMMRECV> 
"{ 
}" 
</COMMRECV> 
 
<VARIABLE> 
	<ITEM TYPE="%-30s" NAME="#TXNAME" FUNCTIONS="T(通存业务)"/> 
	<ITEM LINE="3" COL="1" TYPE="%-46s" FUNCTIONS="T(1812                           通 存 业 务)"/> 
	<ITEM LINE="4" COL="1" TYPE="%-74s" FUNCTIONS="T(─────────────────────────────────────────―――)"/> 
<BLOCK NAME="block_head" LINE="5" VISABLE="TRUE"> 
	<ITEM LINE="0" COL="3"  TYPE="%-9s" FUNCTIONS="T(通存方式:)"/>  
	<ITEM LINE="0" COL="12" TYPE="%-1s" INPUT="SELECT" DEVICE="KEYBOARD" NAME="#DepositWay" FUNCTIONS="V(NB)T(1)"> 
	 <SELECT> 
		<OPTION VALUE="1" TITLE="0.现金"/> 
		<OPTION VALUE="2" TITLE="1.转账"/> 
	 </SELECT> 
	 <ONLOSTFOCUS> 
	  "{ 
	      if(#DepositWay=='1') 
	      { 
	        showblock('block_pay0',false,false); 
	        showblock('block_pay1',true, true); 
	        showblock('block_pay2',false,false);   
                #PayerAcct='10101';
	         
	      } 
	      else 
	      { 
	        showblock('block_pay0',true,true); 
	        showblock('block_pay1',true,true); 
	        showblock('block_pay2',true,true); 
	      } 
	   }" 
	 </ONLOSTFOCUS> 
  </ITEM>  
</BLOCK> 
 
 
<BLOCK NAME="block_pay0" LINE="6" VISABLE="FALSE">	 
  <ITEM LINE="0" COL="3"  TYPE="%-15s" FUNCTIONS="T(付款人卡折标志)"/>  
	<ITEM LINE="0" COL="18" TYPE="%-1s" INPUT="SELECT" DEVICE="KEYBOARD" NAME="#PayerCardFlag" FUNCTIONS="V(NB)T(0)"> 
	 <SELECT> 
		<OPTION VALUE="0" TITLE="0.卡"/> 
		<OPTION VALUE="1" TITLE="1.折"/> 
	 </SELECT> 
  </ITEM>  	 
  <ITEM LINE="1" COL="3"  TYPE="%-11s"  FUNCTIONS="T(付款人账号)"/>  
	<ITEM LINE="1" COL="14" NAME="#PayerAcct" INPUT="TEXT" TYPE="%-30s" FUNCTIONS="T()V(NB)">  
		<ONLOSTFOCUS> 
		     "{ 
			   //需要callserver 调用核心 
			   initfd(); 
	                   commsend_001(); 
			   $FD16='1404'; 
			   $FD18='pbp'; 
			   $FD30=#PayerAcct; 
			   $FD73='00001000'; 
			   callagnpbp(); 
			   if($FD12 != '0000') 
			   { 
				  showmsg(geterror()); 
				  return(false); 
			   } 
			   #PayerName=$FD25; 
			    
		      }"			  
		</ONLOSTFOCUS> 
	</ITEM>	 
</BLOCK> 
	 
<BLOCK NAME="block_pay1" LINE="8" VISABLE="FALSE">	 
  <ITEM LINE="0" COL="3"  TYPE="%-11s"  NAME="#LabelPayerName" FUNCTIONS="T(付款人名称)"/>  
  <ITEM LINE="0" COL="14" NAME="#PayerName"  INPUT="TEXT" TYPE="%-60s" FUNCTIONS="T()V(NB)"/>  
</BLOCK>	 
 
<BLOCK NAME="block_pay2" LINE="9" VISABLE="FALSE">	 
  <ITEM LINE="0" COL="3" TYPE="%-11s" FUNCTIONS="T(密    码)"/> 
  <ITEM LINE="0" COL="14" NAME="#PayPasswd" INPUT="TEXT" TYPE="%-6s" FUNCTIONS="i()V(NB)"/>   
  <ITEM LINE="0" COL="35" TYPE="%-8s" FUNCTIONS="T(协 议 号)"/> 
  <ITEM LINE="0" COL="43" NAME="#ContractNo" INPUT="TEXT" TYPE="%-20s" FUNCTIONS="T()"/> 
</BLOCK>	 
 
 
 
<BLOCK NAME="block_payee" LINE="10" VISABLE="TRUE">	 
  <ITEM LINE="0" COL="3"  TYPE="%-14s" FUNCTIONS="T(收款人卡折标志)"/>  
	<ITEM LINE="0" COL="18" TYPE="%-1s" INPUT="SELECT" DEVICE="KEYBOARD" NAME="#PayeeCardFlag" FUNCTIONS="V(NB)T(0)"> 
	 <SELECT> 
		<OPTION VALUE="0" TITLE="0.卡"/> 
		<OPTION VALUE="1" TITLE="1.折"/> 
	 </SELECT> 
  </ITEM>   
   
  <ITEM LINE="0" COL="35"  TYPE="%-15s" FUNCTIONS="T(收款人账户类型)"/>  
	<ITEM LINE="0" COL="50" TYPE="%-1s" INPUT="SELECT" DEVICE="KEYBOARD" NAME="#PayeeAcctType" FUNCTIONS="V(NB)T(1)"> 
	 <SELECT> 
		<OPTION VALUE="1" TITLE="0.对公"/> 
		<OPTION VALUE="2" TITLE="1.个人"/> 
	 </SELECT> 
  </ITEM> 
       
  <ITEM LINE="1" COL="3"   TYPE="%-10s" FUNCTIONS="T(收款行行号)"/>  
	<ITEM LINE="1" COL="13"  TYPE="%-16s" INPUT="TEXT" DEVICE="KEYBOARD" NAME="#InBankNo" FUNCTIONS="V(NB)T()"> 
	  <ONLOSTFOCUS> 
	  "{ 
	                //调用平台交易,根据行号查询行名 
	                // #InBankNoName='晋中商业银行'; 
			 initfd();					 
			 commsend_001(); 
			 $FD16='1101'; 
			 $FD18='pbp'; 
			 $FD59=#InBankNo; 
			 callagnpbp(); 
			 if($FD12!='0000') 
			 { 
				 showmsg(geterror()); 
				 return(false); 
			 }     
			 #InBankNoName=$FD76;      
	  }" 
	  </ONLOSTFOCUS> 
	</ITEM> 
 
  <ITEM LINE="2" COL="3"   TYPE="%-10s" FUNCTIONS="T(收款行名称)"/>  
	<ITEM LINE="2" COL="13"  TYPE="%-60s" INPUT="TEXT" DEVICE="KEYBOARD" NAME="#InBankNoName" FUNCTIONS="V(NB)T()"/> 
 
  <ITEM LINE="3" COL="3"    TYPE="%-10s" FUNCTIONS="T(收款人账户)"/>  
	<ITEM LINE="3" COL="13"   NAME="#PayeeAcct" INPUT="TEXT" TYPE="%-30s" FUNCTIONS="T()V(NB)"/> 		 	 
 
	<ITEM LINE="4" COL="3"    TYPE="%-10s" FUNCTIONS="T(收款人名称)"/>  
	<ITEM LINE="4" COL="13"   NAME="#PayeeName" INPUT="TEXT" TYPE="%-60s" FUNCTIONS="T()V(NB)"/> 
	 
	<ITEM LINE="5" COL="3" TYPE="%-9s" FUNCTIONS="T(交易金额)"/> 
  <ITEM LINE="5" COL="13" NAME="#TradeAmt" INPUT="TEXT" TYPE="%14.2f" FUNCTIONS="T()V(NB)">  
  <ONLOSTFOCUS> 
   "{ 
      dim @amt as number; 
       
      showmsg('交易金额:'+itoa(#TradeAmt,'%.2f')); 
    }" 
  </ONLOSTFOCUS> 
  </ITEM> 
   
  <ITEM LINE="6" COL="3" TYPE="%-10s" FUNCTIONS="T(手续费标志)"/> 
  <ITEM LINE="6" COL="14" TYPE="%-1s" INPUT="SELECT" DEVICE="KEYBOARD" NAME="#FeeWay" FUNCTIONS="T(2)V(NB)"> 
	 <SELECT> 
		<OPTION VALUE="0" TITLE="0.现金"/> 
		<OPTION VALUE="1" TITLE="1.账户"/> 
		<OPTION VALUE="2" TITLE="2.不收"/> 
	 </SELECT> 
	 <ONLOSTFOCUS> 
	 	"{ 
	 	   if(#FeeWay=='2') 
	 	   { 
	 	     show(#LabelFeeAmt,false); 
	 	     show(#FeeAmt,false); 
	 	   } 
	 	   else 
	 	   { 
	 	     show(#LabelFeeAmt,true); 
	 	     show(#FeeAmt,true);	 	    
	 	   } 
	 	 }" 
	 </ONLOSTFOCUS> 
  </ITEM>   
  <ITEM LINE="6" COL="30" NAME="#LabelFeeAmt" TYPE="%-6s"    INPUT="LABEL" VISABLE="FALSE" FUNCTIONS="T(手续费)"/> 
  <ITEM LINE="6" COL="37" NAME="#FeeAmt" INPUT="TEXT" VISABLE="FALSE" TYPE="%14.2f" FUNCTIONS="T()V(NB)"/>   
</BLOCK> 
 
 
<BLOCK NAME="block_tx" LINE="17" VISABLE="TRUE">  
  <ITEM LINE="0" COL="3" TYPE="%-9s" FUNCTIONS="T(货币代码)"/> 
	<ITEM LINE="0" COL="12"  TYPE="%-3s"  INPUT="SELECT" DEVICE="KEYBOARD" NAME="#CurrCode" FUNCTIONS="V(NB)T(CNY)"> 
		<SELECT> 
			<OPTION VALUE ="CNY" TITLE="1.人民币" /> 
			<OPTION VALUE ="USD" TITLE="2.美元 " /> 
			<OPTION VALUE ="HKD" TITLE="3.港币" /> 
			<OPTION VALUE ="EUR" TITLE="4.欧元" /> 
			<OPTION VALUE ="GBP" TITLE="5.英镑 " /> 
			<OPTION VALUE ="JPY" TITLE="6.日元" /> 
	  </SELECT> 
	</ITEM> 	 
 
	<ITEM LINE="0" COL="30" TYPE="%-9s" FUNCTIONS="T(钞汇类型)"/> 
	<ITEM LINE="0" COL="39"  TYPE="%-1s"  INPUT="SELECT" DEVICE="KEYBOARD" NAME="#CurrType" FUNCTIONS="V(NB)T(0)"> 
	 <SELECT> 
	  <OPTION VALUE="0" TITLE="丙钞"/> 
	  <OPTION VALUE="2" TITLE="甲汇"/> 
	  <OPTION VALUE="3" TITLE="乙钞"/> 
	  <OPTION VALUE="4" TITLE="乙汇"/> 
	  <OPTION VALUE="6" TITLE="丙汇"/> 
	 </SELECT> 
	</ITEM> 
	 
	<ITEM LINE="1" COL="3" TYPE="%-9s" FUNCTIONS="T(票据种类)"/> 
  <ITEM LINE="1" COL="12" TYPE="%-2s" INPUT="SELECT" DEVICE="KEYBOARD" NAME="#BillType" FUNCTIONS="V(NB)T(71)"> 
	  <SELECT> 
			<OPTION VALUE="71" TITLE="0.现金通存"/> 
			<OPTION VALUE="73" TITLE="1.转账通存"/> 
	  </SELECT> 
	  <ONLOSTFOCUS> 
	   "{ 
	      if((#DepositWay=='1') and (#BillType!='71')) 
	      { 
	        showmsg('通存方式和票据种类不符'); 
	        return(false); 
	      } 
	      if((#DepositWay=='2') and (#BillType!='73')) 
	      { 
	        showmsg('通存方式和票据种类不符'); 
	        return(false); 
	      }	       
	   }" 
	  </ONLOSTFOCUS> 
  </ITEM>    
  <ITEM LINE="1" COL="30" TYPE="%-9s" FUNCTIONS="T(票据号码)"/> 
  <ITEM LINE="1" COL="39" NAME="#CertNo" INPUT="TEXT" TYPE="%-15s" FUNCTIONS="T()V(NB)"/>   
  
  <ITEM LINE="1" COL="55" TYPE="%-9s" FUNCTIONS="T(票据日期)"/> 
  <ITEM LINE="1" COL="64" NAME="#IssueDate" INPUT="TEXT" TYPE="%-8d" FUNCTIONS="T()V(NB)">  
  	<!--ONLOSTFOCUS> 
  		"{ 
  		   showmsg('执行到这里了'); 
  		   dim @ret as boolean; 
  		   $FD28=#IssueDate; 
  		   showmsg('$FD28='+$FD28); 
  		   @ret=CheckDate(); 
  		   if(@ret==false) 
  		   { 
  		     showmsg('日期不合法'); 
  		     return(false); 
  		   } 
  		}" 
  	</ONLOSTFOCUS--> 
  </ITEM>  
</BLOCK> 
 
 
 
<BLOCK NAME="block_ps" LINE="20" VISABLE="TRUE"> 
 <ITEM LINE="0" COL="3" TYPE="%-11s" FUNCTIONS="T(附    言)"/> 
 <ITEM LINE="0" COL="14" NAME="#Ps" INPUT="TEXT" TYPE="%-60s" FUNCTIONS="T()V(NB)"/>  
</BLOCK>	 
 
 
<ITEM  NAME="#OK" LINE="21"  COL="63"  TYPE="%-6s"   FUNCTIONS="T(确  定)" INPUT="BUTTON"> 
	<ONCLICK> 
	"{ 
	  	initfd(); 
			$TXNO='1210'; 
	    $FD18='pbp'; 
	    $FD28='sxps'; 
	    $FD34='C100';  //业务类型,和二代一样 
	    $FD64='09001'; //业务种类,和二代一样 
      $FD70 = #DepositWay	    ; 
      $FD48 = #CurrCode	      ;  
      $FD49 = #CurrType	      ;  
      $FD71 = #PayerCardFlag	;  
      $FD72 = #PayeeCardFlag	;     
      $FD30 = #PayerAcct	    ;  
      $FD31 = #PayeeAcct	    ;  
      $FD25 = #PayerName	    ;  
      $FD26 = #PayeeName	    ;  
      $FD57 = #PayPasswd	    ;  
      $FD81 = #ContractNo	    ;  
      $FD59 = #InBankNo	      ;  
      $FD39 = itoa(#TradeAmt,'%.2f');  
      $FD92 = #BillType	      ;  
      $FD60 = #CertNo	        ;  
      $FD44 = #IssueDate	    ;  
     // $FD105= #Purp	          ;  
     // $FD89 = #Priority	      ;  
      $FD67 = #FeeWay	        ;  
      $FD40 = itoa(#FeeAmt,'%.2f');  
      $FD103= #Ps	            ;  
    //  $FD61 = #AddOriOutBankNo;  
    //  $FD102= #AddPs	        ;  
      $FD77 = #PayeeAcctType  ; 
	    commsend_001(); 
			callagnpbp();  
			if($FD12!='0000') 
			{ 
			  showmsg(geterror()); 
			  return(false); 
			}    
			else 
			{ 
			  showmsg('哈哈,交易成功'); 
			} 
			runoutput(); 
	 	  showall(); 
	}" 
	</ONCLICK> 
</ITEM> 
</VARIABLE> 
 
<REQUEST> 
</REQUEST> 
 
<RESPONSE> 
<PACKAGE DEVICE="SCREEN" DESC="按任意键退出"> 
NOTHING 
</PACKAGE> 
	<PRINT> 
	"{ 
	       
		  PrintTxHead(); 
		  if (#DepositWay == '2') 
		  { 
		  	print( 3, 10,'付款人账号:[20]',#PayerAcct); 
   			print(3, 40,'付款人姓名:[60]',#PayerName); 
   	  } 
   		print(5,10,'收款人账号:[20]',#PayeeAcct); 
   		print(5,40,'收款人姓名:[60]',#PayeeName); 
   		print(7,10,'交易金额:[20]',ltrim(itoa(#TradeAmt,'%.2f'))); 
		  print( 9, 10,'交易序号:[10]',$FD56); 
		  PrintTxTail(); 
		}" 
	</PRINT> 
</RESPONSE> 
</TRANSACTION>
