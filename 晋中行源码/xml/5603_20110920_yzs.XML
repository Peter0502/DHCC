<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110000" TITLE="5603 银行承兑汇票签发"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
		initfd();
		commsend_001();
        $FD26 = #PAYNAME;
        $FD27 = #CASHNAME;
        $FD32 = #BZACTNO;
		$FD33 = #CDXYNUM;
		$FD38 = #PAYACTNO;
		$FD39 = space(16);
		$FD40 = itoa(val(#XBRATE,100),'%08d');	//保证金比例
		$FD41 = itoa(val(#XQFAVBAL,100),'%016d');	//已签发金额
        $FD44 = #EDATE;
//FD50??
        $FD50 = #NUM;
        $FD67 = '2';// 现转标志
        $FD58 = #CDHPNUM;
        $FD81 = #CASHBRNAME;
        $FD83 = #CASHACTNO;
        $FD100 = getitems('#TOAVBAL#ZYTOAVBAL#BZAVBAL#FD100_4#FD100_5#FD100_6#FD100_7#FD100_8#FD100_9#CPAVBAL');
        //$FD113 = getitems('#PRM_AMT');  add by chenchao 2011-7-28 20:32:15 承兑承诺费

}"
</COMMSEND>
<COMMRECV>"{
	commrecv_001();
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-60s" FUNCTIONS=
   "T(5603                        银行承兑汇票签发)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>

  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=4333)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>

  <ITEM LINE="5"  COL="5"   TYPE="%-14s" FUNCTIONS="T(承兑协议编号:)"/>
  <ITEM LINE="5"  COL="45"  TYPE="%-10s"  FUNCTIONS="T(编    号:)"/>
  <ITEM LINE="6"  COL="5"   TYPE="%-14s" FUNCTIONS="T(承兑汇票号码:)"/>
  <ITEM LINE="6"  COL="45"   TYPE="%-10s" FUNCTIONS="T(出票金额:)"/>
  <ITEM LINE="7" COL="5"  TYPE="%-12s" FUNCTIONS="T(出票行地址:)"/><!---为汇票打印添加--->
<!---
  <ITEM LINE="8" COL="5"  TYPE="%-12s" FUNCTIONS="T(承诺费金额:)"/>
  <ITEM LINE="9" COL="5"  TYPE="%-12s" FUNCTIONS="T(手续费金额:)"/>
---->
  <ITEM LINE="9" COL="45"  TYPE="%-10s" FUNCTIONS="T(现转标志:)" INPUT="LABEL" VISABLE="FALSE"/>
  <ITEM LINE="10"  COL="5"   TYPE="%-70s" FUNCTIONS=
	   "T(------------------------- 以下为回显信息 --------------------------)"/>
  <ITEM LINE="11" COL="5"  TYPE="%-12s" FUNCTIONS="T(出票人账号:)"/>
  <ITEM LINE="12" COL="5"  TYPE="%-12s" FUNCTIONS="T(出票人全称:)"/>
  <ITEM LINE="13" COL="5"  TYPE="%-12s" FUNCTIONS="T(收款人帐号:)"/>
  <ITEM LINE="14" COL="5"  TYPE="%-11s" FUNCTIONS="T(收款人全称:)"/>
  <ITEM LINE="15" COL="5"  TYPE="%-12s" FUNCTIONS="T(收款行全称:)"/>
  <ITEM LINE="16" COL="5"  TYPE="%-10s" FUNCTIONS="T(到期日期:)"/>

  <ITEM LINE="17" COL="5"  TYPE="%-12s" FUNCTIONS="T(票面总金额:)"/>
  <ITEM LINE="17" COL="45" TYPE="%-12s" FUNCTIONS="T(已签发金额:)"/>
  <ITEM LINE="18" COL="5"  TYPE="%-12s" FUNCTIONS="T(保证金额:)"/>
  <ITEM LINE="18" COL="45" TYPE="%-12s" FUNCTIONS="T(质押总金额:)"/>

  <ITEM LINE="19" COL="5"  TYPE="%-12s" FUNCTIONS="T(保证金比例:)"/>
  <ITEM LINE="19" COL="26" TYPE="%-1s"  FUNCTIONS="T(%)"/>
  <ITEM LINE="20" COL="5"  TYPE="%-12s" FUNCTIONS="T(担保帐号:)"   NAME="#SDBACT" INPUT="LABEL" VISABLE="FALSE"/>
  <ITEM LINE="20" COL="5"  TYPE="%-12s" FUNCTIONS="T(保证金帐号:)" NAME="#SBZACT" INPUT="LABEL" VISABLE="TRUE"/>


<!-- 定义callserver返回但界面不用的变量 -->
  <ITEM TYPE="%17.2f" NAME="#FD100_1"  FUNCTIONS="V(NB)J(#XFD100_1)"/>
  <ITEM NAME="#XFD100_1" TYPE="%-16s"  FUNCTIONS="X(#FD100_1)"/>
  <ITEM TYPE="%17.2f" NAME="#FD100_2"  FUNCTIONS="V(NB)J(#XFD100_2)"/>
  <ITEM NAME="#XFD100_2" TYPE="%-16s"  FUNCTIONS="X(#FD100_2)"/>
  <ITEM TYPE="%17.2f" NAME="#FD100_3"  FUNCTIONS="V(NB)J(#XFD100_3)"/>
  <ITEM NAME="#XFD100_3" TYPE="%-16s"  FUNCTIONS="X(#FD100_3)"/>
  <ITEM TYPE="%17.2f" NAME="#FD100_4"  FUNCTIONS="V(NB)J(#XFD100_4)"/>
  <ITEM NAME="#XFD100_4" TYPE="%-16s"  FUNCTIONS="X(#FD100_4)"/>
  <ITEM TYPE="%9.6f"  NAME="#FD100_5"  FUNCTIONS="V(NB)J(#XFD100_5)"/>
  <ITEM NAME="#XFD100_5" TYPE="%-8s"   FUNCTIONS="X(#FD100_5)"/>

  <ITEM TYPE="%-2s"   NAME="#FD100_6"  FUNCTIONS="V(NB)"/>
  <ITEM TYPE="%-2s"   NAME="#FD100_7"  FUNCTIONS="V(NB)"/>
  <ITEM TYPE="%-10s"  NAME="#FD100_8"  FUNCTIONS="V(NB)"/>
  <ITEM TYPE="%-10s"  NAME="#FD100_9"  FUNCTIONS="V(NB)"/>
  <ITEM TYPE="%17.2f" NAME="#FD100_10" FUNCTIONS="V(NB)J(#XFD100_10)"/>
  <ITEM NAME="#XFD100_10" TYPE="%-16s" FUNCTIONS="X(#FD100_10)"/>
  <ITEM TYPE="%16.2f" NAME="#POAMT"  FUNCTIONS=""/>

  <ITEM TYPE="%-2s" NAME="#CURCD"  FUNCTIONS="T(01)"/>  <!-- 9910,$FD21 -->

  <ITEM LINE="5"  COL="15" TYPE="%-20s" NAME="#CDXYNUM" DEVICE="KEYBOARD" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
    "{
        dim @baktxno as string;
        @baktxno=$TXNO;
        $TXNO='9909';
        $FD33 = #CDXYNUM;
	$FD65 = '4333'; // add by chenchao 20110807 
        commsend_001();
        callserver();
        $TXNO=@baktxno;
        if($FD12!='0000'){
            showmsg(geterror());
            return(false);
        }
//      #PAYBRNAME = $FD25;
        #PAYNAME = $FD26;
        #CASHNAME = $FD27;
//      #PAYBRNO = $FD30;
	#BZACTNO = $FD32;
        #PAYACTNO = $FD38;
        #XBRATE = itoa(val($FD40,0.01),'%.2f');
        #POAMT=val($FD43,0.01);// 票面金额 
	#CPAVBAL = #POAMT;
        #NUM = $FD50;// add by chenchao 2011-7-28 15:45:23 承兑序号
	//39,41待续
	//$FD42不给值了，因为$FD100中有重复值       #XBZAVBAL = itoa(val($FD42,0.01),'%.2f');
	#EDATE = $FD44;
	#CASHBRNAME = $FD81;
	#CASHACTNO = $FD83;
	//setitems('#PRM_AMT',$FD113);
	setitems('#TOAVBAL#ZYTOAVBAL#BZAVBAL#FD100_4#FD100_5#FD100_6#FD100_7#FD100_8#FD100_9#FD100_10',$FD100);
	#QFAVBAL=val($FD41,0.01);  //已签发金额

	if($FD67=='4')
	{
		show(#SBZACT,false);
		show(#SDBACT,true);
	}else{
		show(#SDBACT,false);
		show(#SBZACT,true);
	}
	//enable(#PRM_AMT,false);
	//enable(#FEE_AMT,false);
	enable(#NUM,false);
	refresh();
	#PAYADDR=delspace(substr($FD96,0,60));
	#PAYBRNO1=delspace(substr($FD96,60,12));
	showmsg(#PAYADDR);
	showmsg(#PAYBRNO1);
  }"
  </ONLOSTFOCUS>
  </ITEM>

  <ITEM LINE="11" COL="17" TYPE="%-19s"  NAME="#PAYACTNO"   INPUT="LABEL" FUNCTIONS=""/>
  <ITEM LINE="12" COL="17" TYPE="%-50s"  NAME="#PAYNAME"    INPUT="LABEL" FUNCTIONS=""/>
  <ITEM NAME="#SPAYNAME"   TYPE="%-40s"  FUNCTIONS="T(#PAYNAME,1,40)"/>

  <ITEM LINE="13" COL="17" TYPE="%-32s"  NAME="#CASHACTNO"  INPUT="LABEL" FUNCTIONS=""/>
  <ITEM LINE="14" COL="17" TYPE="%-50s"  NAME="#CASHNAME"   INPUT="LABEL" FUNCTIONS=""/>
  <ITEM NAME="#SCASHNAME"  TYPE="%-40s"  FUNCTIONS="T(#CASHNAME,1,40)"/>

  <ITEM LINE="15" COL="17" TYPE="%-40s"  NAME="#CASHBRNAME" INPUT="LABEL" FUNCTIONS=""/>
  <ITEM LINE="16" COL="17" TYPE="%-8s"   NAME="#EDATE"      INPUT="LABEL" FUNCTIONS=""/>

  <ITEM LINE="17" COL="17" NAME="#XTOAVBAL" TYPE="%-16s" FUNCTIONS="X(#TOAVBAL)"/>
  <ITEM TYPE="%17.2f" NAME="#TOAVBAL" FUNCTIONS="J(#XTOAVBAL)"/>
  <ITEM LINE="17" COL="57" NAME="#XQFAVBAL" TYPE="%-16s" FUNCTIONS="X(#QFAVBAL)"/>
  <ITEM TYPE="%17.2f" NAME="#QFAVBAL" FUNCTIONS="J(#XQFAVBAL)"/>
  <ITEM LINE="18" COL="17" NAME="#XBZAVBAL" TYPE="%-16s" FUNCTIONS="X(#BZAVBAL)"/>
  <ITEM TYPE="%17.2f" NAME="#BZAVBAL" FUNCTIONS="J(#XBZAVBAL)"/>
  <ITEM LINE="18" COL="57" NAME="#XZYTOAVBAL" TYPE="%-16s" FUNCTIONS="X(#ZYTOAVBAL)"/>
  <ITEM TYPE="%17.2f" NAME="#ZYTOAVBAL" FUNCTIONS="J(#XZYTOAVBAL)"/>
  <ITEM LINE="19" COL="17" NAME="#XBRATE" TYPE="%-8s" FUNCTIONS=""/>

  <ITEM LINE="20" COL="17" TYPE="%-24s" NAME="#BZACTNO"  INPUT="LABEL" FUNCTIONS="V(NB)"/>

  <ITEM LINE="5"  COL="55" TYPE="%3s"    NAME="#NUM"  	   DEVICE="KEYBOARD" FUNCTIONS="V(NB)"/>
  <ITEM LINE="6"  COL="15" TYPE="%16d"   NAME="#CDHPNUM"   DEVICE="KEYBOARD" FUNCTIONS="V(NB)"/>
  <ITEM LINE="6"  COL="55" TYPE="%17.2f" NAME="#CPAVBAL"   DEVICE="KEYBOARD" FUNCTIONS="V(0000000000000001,999999999999999)J(#XCPAVBAL)">
  <ONLOSTFOCUS>
  "{
       if(#POAMT!=#CPAVBAL)
       {
            showmsg('票面金额与信贷审批金额不符!!!');
            return(false);
       }
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#XCPAVBAL"   TYPE="%-21s"  FUNCTIONS="X(#CPAVBAL)"/>
  <ITEM NAME="#SCPAVBAL"   TYPE="%11s"   FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
	dim @i as number;
	dim @len as number;
	dim @len1 as number;
	dim @tmpstr as string;
	dim @tmpstr1 as string;
	@i=0;
	@len=0;
	@len1=0;
	@tmpstr='';
	@tmpstr1='';

	#SCPAVBAL = itoa(#CPAVBAL*100,'%11.0f');
	////@len=len(#SCPAVBAL);REPLACE BY NEXT MODIFY BY ZHGF 2010/5/12 19:20 解决￥后的空格
	////while(@i &lt; @len)
	////{
	////	if(substr(#SCPAVBAL,@i+1,1)!=' ' and substr(#SCPAVBAL,@i,1)==' ')
	////	{
	////		@tmpstr=@tmpstr+'￥';
	////	}else{
	////		@tmpstr=@tmpstr+' '+substr(#SCPAVBAL,@i,1);
	////	}
	////	@i=@i+1;
	////}
	//ADD BY ZHGF 2010/5/12 19:34 BEGIN
	@tmpstr1=ltrim(#SCPAVBAL);
	@len1=len(@tmpstr1);
	//showmsg('len(tmpstr1)=['+itoa(@len1)+']');
	while(@i &lt;= @len1)
	{
		if(@i==0)
		{
			@tmpstr=@tmpstr+'￥';
		}else if(@i==1){
			@tmpstr=@tmpstr+substr(@tmpstr1,@i-1,1);
		}else{
			@tmpstr=@tmpstr+' '+substr(@tmpstr1,@i-1,1);
		}
		@i=@i+1;
	}
	//ADD BY ZHGF 2010/5/12 19:34 END
	#TCPAVBAL=@tmpstr;
	//showmsg('#TCPAVBAL='+#TCPAVBAL);
	
	//showmsg(@tmpstr);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#TCPAVBAL"    TYPE="%22s"  FUNCTIONS=""><!---打印用小写金额--->
  <ONLOSTFOCUS>
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#UCPAVBAL"    TYPE="%-40s" FUNCTIONS="U(#CPAVBAL)"/>
  <ITEM NAME="#PAYBRNO1"    TYPE="%-12s" FUNCTIONS=""/>

  <ITEM LINE="7" COL="15" TYPE="%-40s"  NAME="#PAYADDR"    INPUT="TEXT"  FUNCTIONS=""/><!---为汇票打印添加--->
<!----
  <ITEM LINE="8" COL="15" TYPE="%-17.2f"  NAME="#PRM_AMT"   INPUT="TEXT"  FUNCTIONS="T(#PRM_AMT)"/>
  <ITEM LINE="9" COL="15" TYPE="%-17.2f"  NAME="#FEE_AMT"   INPUT="TEXT"  FUNCTIONS="T(#FEE_AMT)"/>
------>
  <ITEM NAME="#CT_IND" LINE="9"  COL="55" TYPE="%-1s"  VISABLE="FALSE" DEVICE="KEYBOARD" INPUT="SELECT" FUNCTIONS="T()V(NB)" >
     <SELECT>
		<OPTION VALUE="1" TITLE="现金"/>
		<OPTION VALUE="2" TITLE="转账"/>
	</SELECT>
  </ITEM> 
  <!--输出变量--->
  <ITEM NAME="#ZDATE"       TYPE="%-22s" FUNCTIONS="Z($HDATE)"/>
  <ITEM NAME="#UCPAVBAL_20" TYPE="%-20s" FUNCTIONS="T(#UCPAVBAL,1,20)"/>
  <ITEM NAME="#FD26_30"     TYPE="%-30s" FUNCTIONS="T($FD26,1,30)"/>
  <ITEM NAME="#FD27_30"     TYPE="%-30s" FUNCTIONS="T($FD27,1,30)"/>
  <ITEM NAME="#FD81_30"     TYPE="%-30s" FUNCTIONS="T($FD81,1,30)"/>

  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD"  TYPE="%-6s"  FUNCTIONS="T()"/>
  <ITEM NAME="#YEAR"    TYPE="%-4s"  FUNCTIONS="T($FD5,1,4)"/>
  <ITEM NAME="#MON"     TYPE="%-2s"  FUNCTIONS="T($FD5,5,2)"/>
  <ITEM NAME="#DAY"     TYPE="%-2s"  FUNCTIONS="T($FD5,7,2)"/>
  <ITEM NAME="#COMMDAY" TYPE="%-8s"  FUNCTIONS="T()"/><!---用于打印大写日期---专用--->
  <ITEM NAME="#WDAY"    TYPE="%-8s"  FUNCTIONS="T($HDATE)">
  <ONLOSTFOCUS>
  "{
	#COMMDAY = #WDAY;
	BIG5();//这里得到大写出票日期
	//showmsg('BIG1='+#BIGDAY);
	#SBDAY   = #BIGDAY;
	//showmsg(#SBDAY);
	#COMMDAY = #EDATE;
	BIG5();//这里得到大写到期日期
	//showmsg('BIG2='+#BIGDAY);
	#EBDAY   = #BIGDAY;
	#EBDAY2  = substr(#EBDAY,0,8)+'年'+ltrim(substr(#EBDAY,8,6))+'月'+ltrim(substr(#EBDAY,14,6))+'日';
	//showmsg(#EBDAY);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#BIGDAY"  TYPE="%-20s" FUNCTIONS=""/><!---打印用大写日期---专用--->
  <ITEM NAME="#SBDAY"   TYPE="%-20s" FUNCTIONS=""/><!---打印用大写出票日期--->
  <ITEM NAME="#EBDAY"   TYPE="%-20s" FUNCTIONS=""/><!---打印用大写汇票到期日期--->
  <ITEM NAME="#EBDAY2"  TYPE="%-30s" FUNCTIONS=""/><!---打印用大写汇票到期日期--->

  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>

</VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
    <PACKAGE DEVICE="SCREEN" DESC="显示内容">
    NOTHING
    </PACKAGE>
    <PRINT>"{
        print( 8,10,'承兑协议编号:[20]-[3]',#CDXYNUM,#NUM);
        print( 9,10,'承兑汇票号码:[16]',#CDHPNUM);
        print(10,10,'出 票  金 额:[21]',#XCPAVBAL);
    }"
    </PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER" LINESPACE="12" DESC="请打印承兑汇票">
NOTHING
</PACKAGE>
	<PRINT>
	"{

		print( 4,34,'[8       ]  [6    ]    [6     ]',substr(#SBDAY,0,8),substr(#SBDAY,8,6),substr(#SBDAY,14,6));
		print( 8,15,'[40                                      ]  [40                                  ]',#SPAYNAME,#SCASHNAME);
		print(10,15,'[32                              ]          [32                              ]',#PAYACTNO,#CASHACTNO);
		print(12,15,'晋中市商业银行[16              ]            [40                                  ]',$BRNAME,#CASHBRNAME);
		print(14,10,'$');
		print(15,17,'\H0[34                                ]\H1 [22                   ]',#UCPAVBAL,rtrim(#TCPAVBAL));
		print(16,10,'$
');
		print(18,13,'[28                          ]       [12          ]', #EBDAY2,#PAYBRNO1);
		print(20,13,'[20                  ]               [40                                  ]',#CDXYNUM,#PAYADDR);
	}"
	</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER" DESC="请打印业务专用凭证">
NOTHING
</PACKAGE>
	<PRINT>
	"{
 $KINDNO='00';
dim @txtime  as string;
@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	print( 5,20,'机构名称:[30]',$BRNAME);
	print( 5,2,'代码:5603');
	print( 5,13,'交易:银行承兑汇票签发');

	print( 7,20,'承兑协议编号:[20                  ]  签发编号:[3  ]   票号:[8]',#CDXYNUM,#NUM,substr(itoa(#CDHPNUM),9,16));
	//print( 8,20,'手续费:[17]',itoa(#FEE_AMT,'%17.2f'));
	//print( 9,20,'承诺费:[17]',itoa(#PRM_AMT,'%17.2f'));
	printacdtl_1();

	print(24,20,'备注:');
	print(24,27,'交易日期:[8] [8]',$HDATE,@txtime);
	print(24,5,'柜员:[4]',$FD7);
	print(24,5,'流水号:[6]',$FD4);
	}"
	</PRINT>
</RESPONSE>
 </TRANSACTION>


