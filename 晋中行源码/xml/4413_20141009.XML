<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11000000" TITLE="4413 委托贷款还息交易"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
  <COMMSEND>"{
		initfd();		
		$FD108=#WTDKZH;
		
		#FD102_16=#CITYPE;
		#FD102_10=#CINO;
		
		//取款交易赋值D003
		#FD102_1=#HKZH;    //用于取款账户D003
		#FD102_15=#WJLX;  //用于取款金额D003
		
		//存款交易赋值D099
		#FD101_1=#WTCKZH;	//用于存款金额D099	   
		#FD101_3=#CKAMT; //用于存款金额D099
		
		$FD42 = #DKAMT;  //用于代扣代缴税金额L413
		
		//传逾期利息，若有值，更新贷款表中的贷款到期日期
		$FD57=#YQLX;
		
		#FD102_3 = #PZZL;

		$FD102=getitems('#FD102_1#FD102_2#FD102_3#FD102_4#FD102_5#FD102_6#FD102_7#FD102_8#FD102_9#FD102_10#FD102_11#FD102_12#FD102_13#FD102_14#FD102_15#FD102_16#FD102_30');
		$FD101=getitems('#FD101_1#FD101_2#FD101_3#FD101_4#FD101_5');
		
		commsend_001();
    $FD16 = '4403';
    //验印 start 20131212 yaofuqiang

     if(substr(#HKZH,0,1)=='5' )
     {
			dim @rs as string;
			showhelp('系统提示','开始调取验印系统... ');
			if(#VOCTYPE_2 != '002')
			{
				@rs = judgeone(#HKZH,'299','0',$HDATE,#TOTJE,'1');
			}else
			{
				@rs = judgeone(#HKZH,#VOCTYPE_2,#PZHM,$HDATE,#TOTJE,'1');
			}
			if(@rs=='1')
			{
				showmsg('验印不通过！');
				return(false);
			}
			else if(@rs=='0')
			{       
				showmsg('验印通过！');
				return(true);			
			}else
			{       
				showmsg('验印失败请重新验印！');
				return(false);		
			}
			}
			
			//验印 end 20131212 yaofuqiang
	}"
</COMMSEND>
<COMMRECV>"{
	
}"
</COMMRECV>

<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-60s" FUNCTIONS=
    "T(4413                         委托贷款还息交易)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=4403)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>

  <!--输入变量-->
  <ITEM LINE="6"   COL="5"  TYPE="%-14s" FUNCTIONS="T(委托贷款账号:)"/>
  <ITEM LINE="7"  COL="5"  TYPE="%-70s" FUNCTIONS="T(------------------------------------------------------------------)"/>
  <ITEM LINE="8"   COL="5"  TYPE="%-14s" FUNCTIONS="T(委托贷款户名:)"/>
  <ITEM LINE="9"   COL="5" TYPE="%-14s" FUNCTIONS="T(委托贷款余额:)"/>
  <ITEM LINE="10"   COL="5"  TYPE="%-14s" FUNCTIONS="T(还 款  账 号:)"/>
  <ITEM LINE="9"   COL="48" TYPE="%-14s" FUNCTIONS="  T(还息 总 金额:)"/>
  <ITEM LINE="10"   COL="48"  TYPE="%-14s" FUNCTIONS="T(代扣代缴税金:)"/>
  <ITEM LINE="11"   COL="5"  TYPE="%-14s" FUNCTIONS="T(还款账户户名:)"/>
  <ITEM LINE="12"   COL="5" TYPE="%-14s" FUNCTIONS="T(还款账户余额:)"/>   
  <ITEM LINE="15"  COL="5" TYPE="%-14s" FUNCTIONS="T(未 结  利 息:)"/>
  <ITEM LINE="16"  COL="5" TYPE="%-14s" FUNCTIONS="T(逾 期  利 息:)"/>
  <!--<ITEM LINE="17"  COL="5" TYPE="%-10s" FUNCTIONS="T(手 续 费:)"/>-->
  <ITEM LINE="18"  COL="5"  TYPE="%-70s" FUNCTIONS="T(------------------------------------------------------------------)"/>
  <ITEM LINE="19"   COL="5"  TYPE="%-16s" FUNCTIONS="T(委托人存款账号:)"/>
  <ITEM LINE="20"   COL="5"  TYPE="%-16s" FUNCTIONS="T(委托人存款户名:)"/>

	<ITEM NAME="#FD33"     TYPE="%-24s"  FUNCTIONS=""/>
  <ITEM NAME="#FD108_1"  TYPE="%-24s"  FUNCTIONS=""/>
  <ITEM NAME="#FD108_2"  TYPE="%-4s"   FUNCTIONS=""/>
  <ITEM NAME="#FD108_3"  TYPE="%-60s"  FUNCTIONS=""/>
  <ITEM NAME="#FD108_4"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD108_5"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD108_6"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD108_7"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD108_8"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD108_9"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD108_10" TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD108_11" TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD108_12" TYPE="%-3s"   FUNCTIONS=""/>
  <ITEM NAME="#FD108_13" TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD108_14" TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD108_15" TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD108_16" TYPE="%-1s"   FUNCTIONS=""/>
  
  <ITEM NAME="#FD101_1"   TYPE="%-24s"  FUNCTIONS=""/>
  <ITEM NAME="#FD101_2"   TYPE="%-4s"   FUNCTIONS=""/>
  <ITEM NAME="#FD101_3"   TYPE="%-16s"   FUNCTIONS=""/>
  <ITEM NAME="#FD101_4"   TYPE="%-3s"  FUNCTIONS=""/>
  <ITEM NAME="#FD101_5"   TYPE="%-16s"   FUNCTIONS=""/>
  <ITEM NAME="#FD101_6"   TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD101_7"   TYPE="%-6s"   FUNCTIONS=""/>
  <ITEM NAME="#FD101_8"   TYPE="%-6s"   FUNCTIONS=""/>
  <ITEM NAME="#FD101_9"   TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD101_10"  TYPE="%-20s"  FUNCTIONS=""/>
  <ITEM NAME="#FD101_11"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD101_12"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD101_13"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD101_14"  TYPE="%-8s"   FUNCTIONS=""/>
  <ITEM NAME="#FD101_15"  TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#FD101_16"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD101_17"  TYPE="%-60s"  FUNCTIONS=""/>
  
  <ITEM NAME="#FD102_1"   TYPE="%-24s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_2"   TYPE="%-4s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_3"   TYPE="%-3s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_4"   TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_5"   TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_6"   TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_7"   TYPE="%-6s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_8"   TYPE="%-6s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_9"   TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_10"  TYPE="%-20s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_11"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_12"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_13"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_14"  TYPE="%-8s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_15"  TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#FD102_16"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_17"  TYPE="%-60s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_18"  TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#FD102_19"  TYPE="%-2s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_20"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_21"  TYPE="%-3s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_22"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_23"  TYPE="%-4s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_24"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_25"  TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#FD102_26"  TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#FD102_27"  TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#FD102_28"  TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#FD102_29"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_30"  TYPE="%-20s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_31"  TYPE="%-30s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_32"  TYPE="%-24s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_33"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_34"  TYPE="%-20s"  FUNCTIONS=""/>
  <ITEM NAME="#A0"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#A1"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#A2"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#A3"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#A4"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#A5"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#CKAMT"  TYPE="%-16s"  FUNCTIONS=""/>
	<ITEM NAME="#TRUST_NO"  TYPE="%-20s"  FUNCTIONS=""/>
	<ITEM NAME="#IC_DATE"  TYPE="%-8s"  FUNCTIONS=""/>
	<ITEM NAME="#PZZL"  TYPE="%-3s"  FUNCTIONS=""/>
  <!--<ITEM NAME="#CPDATE"  TYPE="%8s"  FUNCTIONS=""/>
  <ITEM NAME="#WJLX"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#YQLX"  TYPE="%-16s"  FUNCTIONS=""/>  
  <ITEM NAME="#MIMA"   TYPE="%-6s"   FUNCTIONS=""/>-->

   <ITEM NAME="#WTDKZH"  LINE="6" COL="18" TYPE="%-20s" INPUT="TEXT"	FUNCTIONS="T()"> 	
   <ONLOSTFOCUS>
   "{
			initfd();
   		dim @baktxno as string;
   		dim @tota as string;
   		dim @list1 as string;
    	dim @list2 as string;
   		dim @i as number;
	  	@baktxno=$TXNO;	    
			$TXNO='4415';
			$FD65='4414';
			$FD108=#WTDKZH;
			$FD44=#CPDATE;
			commsend_001();
			@tota=callserver();
			$TXNO=@baktxno;
			if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}		
		#WTDKHM = substr($FD26,0,30);						//委托贷款户名
		#WTDKYE = itoa(val($FD41,0.01),'%.2f'); //委托贷款余额
		#HKZH = substr($FD31,0,19);							//还款账号
		#HKZHHM = substr($FD25,0,30);						//还款账户户名
		#HKZHJE = itoa(val($FD40,0.01),'%.2f'); //还款账户余额		
		#PZHM = substr($FD32,0,18);							//还款凭证号码
		#PZZL = substr($FD90,0,3);
		#TRUST_NO = substr($FD37,0,20);	
		#IC_DATE = $FD45;							//贷款气息日期
		#WJLX = itoa(val($FD56,0.01),'%.2f');		//未还利息
		#YQLX = itoa(val($FD57,0.01),'%.2f');		//逾期利息
		#TOTJE= itoa(val($FD56,0.01),'%.2f'); //总还款金额
		//#TOTJE=ltrim(itoa((val(#WJLX)+val(#YQLX)),'%16.2f')); //总还款金额
		#A1 = '0.05';#A2 = '0.07';#A3 = '0.03';#A4 = '0.015';#A5 = '0.02'; #A0 = '0.05675';
		//#DKAMT=ltrim(itoa((val(#TOTJE)*val(#A1)) + (val(#TOTJE)*val(#A1)*val(#A2)) + (val(#TOTJE)*val(#A1)*val(#A2)*val(#A3)) + (val(#TOTJE)*val(#A1)*val(#A2)*val(#A3)*val(#A4)) + (val(#TOTJE)*val(#A1)*val(#A2)*val(#A3)*val(#A4)*val(#A5)),'%16.2f'));
		#DKAMT=ltrim(itoa((val(#WJLX)*val(#A0)),'%16.2f')); //代扣代缴税金额
		#CKAMT=ltrim(itoa((val(#WJLX)-val(#DKAMT)),'%16.2f')); //总还款金额
		//showmsg(#TRUST_NO);
		#ZHLX = substr($FD70,0,1);							//账户类型(1个人，2对公)
		#CPDATE=$HDATE;
		show(#WJLX,true);
		show(#TOTJE,true);
		show(#DKAMT,true);
		show(#WTDKHM,true);
		show(#WTDKYE,true);
		show(#HKZH,true);
		show(#HKZHHM,true);
		show(#HKZHJE,true);
		show(#WJLX,true);
		show(#YQLX,true);
		//个人账户是否输入密码验证
		#MIMA = $FD71;
		if('Y' != #MIMA)
		{
			#MIMA='N';
			enable(#DRAW_PWD, false);
		}		
		enable(#CITYPE, false);
		enable(#CINO, false);
		//个人账户是否输入证件验证
		#ZJFLAG_2 = $FD69;
		//if('Y' == #ZJFLAG_2)
		//如果金额大于50000 也需要输入证件验证
		if(#ZJFLAG_2 == 'Y' or atoi(#TOTJE) > 50000)
		{
			#CITYPE=$FD72;
			enable(#CITYPE, true);
			#CINO=$FD33;
			enable(#CINO, true);
			show(#CINO,false);
		}
  	show(#DSCPT, false);	
		enable(#VOCTYPE_2, false);
		enable(#PZHM, false);
		show(#ZHLX,true);

		//对公账户处理
		if('1' != #ZHLX)
    {
    	while(substr(@tota, @i, 4)=='102L')
    	{
      	@i = @i + 31;
      }
      @list2=substr(@tota, 0 , @i+1);  
      setsel(#DSCPT,@list2,'o5t20o1v3o2');
      @list1=substr(@tota, @i, len(@tota)-@i);
      setsel(#VOCTYPE_2,@list1,'o5t20o1v3o2');   
      
      #VOCTYPE_2='002';
      
     	enable(#CITYPE, false);
		  enable(#CINO, false);   
			enable(#VOCTYPE_2, true);
			enable(#PZHM, true);
			show(#L10,true);
			show(#CPDATE,true);			
			//show(#DSCPT,true);
			show(#LCINO, true);
			show(#CINO, true);
			show(#LDRAW_PWD, false);
			show(#DRAW_PWD, false);
		}//个人账户处理
		else
		{				
			#ZJFLAG_2 = $FD69;
			#MMFLAG_2 = $FD71;
			#FD102_3 = #VOCTYPE_2;
			#FD102_4 = #PZHM;
			//showmsg(#PZHM);
			//showmsg(#FD102_4);
			#VOCTYPE_2='010';
			show(#L7,true);
			show(#L8,true);
			show(#MMFLAG_2,true);
			show(#ZJFLAG_2,true);
			show(#DSCPT,false);		
			show(#LCINO, true);
			show(#CINO, true);
			show(#PZHM,true);		
		}		
  }"
  </ONLOSTFOCUS>
  </ITEM>
    
  <ITEM NAME="#ZHLX" LINE="3"  COL="60" TYPE="%-2s"   INPUT="LABEL" VISABLE="FALSE" FUNCTIONS=""/>
  <ITEM NAME="#HKZHHM"    LINE="11"  COL="18"  TYPE="%-30s" INPUT="TEXT"	ENABLE="FALSE" FUNCTIONS=""/>
  <ITEM NAME="#HKZHJE"    LINE="12"  COL="18"  TYPE="%-16s" INPUT="TEXT"	ENABLE="FALSE" FUNCTIONS=""/>
   
  <!-- 对私账号使用 -->
  <ITEM LINE="13"  COL="5"  TYPE="%-14s" NAME="#L13" INPUT="LABEL"  FUNCTIONS="T(凭 证  类 型:!)"/>
  <ITEM LINE="13"  COL="48" TYPE="%-10s" NAME="#L14" INPUT="LABEL"  FUNCTIONS="T(凭证号码:)"/>	
  <!-- 对公账号使用 -->

  <ITEM LINE="11" COL="48"  TYPE="%-10s" NAME="#L7"  INPUT="LABEL" VISABLE="FALSE" FUNCTIONS="T(密码支取:!)"/>
  <ITEM LINE="12" COL="48"  TYPE="%-10s" NAME="#L8"  INPUT="LABEL" VISABLE="FALSE" FUNCTIONS="T(证件支取:!)"/>
  <!--<ITEM LINE="13" COL="40"  TYPE="%-10s" NAME="#L11" INPUT="LABEL" VISABLE="FALSE" FUNCTIONS="T(支付密码:!)"/>-->
  <ITEM LINE="15" COL="48"  TYPE="%-10s" NAME="#L10" INPUT="LABEL" VISABLE="FALSE" FUNCTIONS="T(出票日期:)"/>
       
  <ITEM NAME="#WTDKHM"    LINE="8"   COL="18"  TYPE="%-30s" INPUT="TEXT"  ENABLE="FALSE" FUNCTIONS=""/>
  <ITEM NAME="#WTDKYE"    LINE="9"   COL="18"  TYPE="%-16s" INPUT="TEXT"	ENABLE="FALSE" FUNCTIONS=""/>  	
  <ITEM NAME="#HKZH"    LINE="10"  COL="18"  TYPE="%-19s" INPUT="TEXT"	ENABLE="FALSE" FUNCTIONS=""/>
  <ITEM NAME="#TOTJE"    LINE="9"   COL="62"  TYPE="%-16s" INPUT="TEXT"	ENABLE="FALSE" FUNCTIONS=""/>  
  <ITEM NAME="#UHBJE" TYPE="%-30s" FUNCTIONS="U(#TOTJE)"/>	
  <ITEM NAME="#DKAMT"    LINE="10"  COL="62"  TYPE="%-16s" INPUT="TEXT"	ENABLE="FALSE" FUNCTIONS=""/>
   
   
  <ITEM NAME="#VOCTYPE_2"  LINE="13"  COL="17" TYPE="%-3s"  INPUT="SELECT"  FUNCTIONS="T(010)" >
	<SELECT>
		<OPTION VALUE="010" TITLE="0.储蓄活期存折/卡"/>
	</SELECT>
  </ITEM>
  
  <ITEM NAME="#PZHM"   LINE="13"  COL="58" TYPE="%-16d"  INPUT="TEXT"  FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
  "{
		#FD102_3 = #VOCTYPE_2;
		#FD102_4 = #PZHM;
  }"
  </ONLOSTFOCUS>
  </ITEM> 
  
  <ITEM NAME="#VOCTYPE_2_2"  LINE="14"  COL="17" TYPE="%-3s" VISABLE="FALSE" INPUT="SELECT" FUNCTIONS="" >
	<SELECT>
		<OPTION VALUE="002" TITLE="0.转帐支票"/>
	</SELECT>
  </ITEM>  
	<ITEM NAME="#VOCNUM_2_2" LINE="14"  COL="58" TYPE="%-16d" VISABLE="FALSE" INPUT="TEXT" FUNCTIONS="V(NB)"/>

  <ITEM NAME="#MMFLAG_2" LINE="11"  COL="58" TYPE="%-1s" VISABLE="FALSE" INPUT="SELECT" ENABLE="FALSE" FUNCTIONS="" >
	<SELECT>
		<OPTION VALUE="N" TITLE="否"/>
		<OPTION VALUE="Y" TITLE="是"/>
	</SELECT>
  </ITEM>

  <ITEM NAME="#ZJFLAG_2" LINE="12"  COL="58" TYPE="%-1s" VISABLE="FALSE" INPUT="SELECT" ENABLE="FALSE" FUNCTIONS="" >
	<SELECT>
		<OPTION VALUE="N" TITLE="否"/>
		<OPTION VALUE="Y" TITLE="是"/>
	</SELECT>
  </ITEM>

  <!--<ITEM LINE="15" COL="60  NAME="#CPDATE" TYPE="%-8s" DEVICE="KEYBOARD" MESSAGE="支票有效期限为10天,其它凭证为一天"  INPUT="TEXT" FUNCTIONS="D()"> -->
  <ITEM NAME="#CPDATE" LINE="15"  COL="60" TYPE="%-8s" VISABLE="FALSE" MESSAGE="支票有效期限为10天,其它凭证为一天" INPUT="TEXT" FUNCTIONS="D()">
   <ONLOSTFOCUS>
   "{
      if(atoi(#CPDATE) &gt; atoi($HDATE))
      {
      		showmsg('时间错误!');
          return(false);		
      }
      if(#VOCTYPE_2=='001')
      {
      		if(func(#CPDATE,$HDATE) &gt; 10)
      		{
      				showmsg('支票有效期限已过10天!');
      				return(false);
      		}
      }
		//dim @tota as string;
		//initfd();		
		//commsend_001();
		//$FD16='9982';
		//$FD102=#ACTNO24+#ACTSEQ+#VOCTYPE+#VOCNUM+space(53)+#PRINTDATE;
		//@tota=callserver();
		///if($FD12!='0000'){
		//	showmsg(geterror());
		//	return(false);
		//}
	}"
	</ONLOSTFOCUS>
	</ITEM>
 
  <ITEM NAME="#MIMA" LINE="19" COL="58" TYPE="%-1s" VISABLE="FALSE" INPUT="SELECT" ENABLE="FALSE" FUNCTIONS="T(N)">
	<SELECT>
		<OPTION VALUE="N" TITLE="否"/>
		<OPTION VALUE="Y" TITLE="是"/>
	</SELECT>

  </ITEM>

  <ITEM NAME="#LPWD">
	<ONLOSTFOCUS>
	"{
		enable(#DRAW_PWD, false);
		if('Y' == #MIMA){
			enable(#DRAW_PWD, true);
		}
	}"
	</ONLOSTFOCUS>
  </ITEM>
<!--  
  <ITEM NAME="#LDRAW_PWD" LINE="17"  COL="5"  TYPE="%-14s" INPUT="LABEL"   FUNCTIONS="T(输入密码:)" /> 
  <ITEM NAME="#DRAW_PWD"  LINE="17"  COL="14" TYPE="%-6s"  DEVICE="PINPAD" INPUT="TEXT"  FUNCTIONS="V(NB)i()">
  <ONLOSTFOCUS>
  "{
	#FD102_8=#DRAW_PWD;
  }"
  </ONLOSTFOCUS>
  </ITEM>
-->  
  <ITEM NAME="#LDRAW_PWD" LINE="17"  COL="5"  TYPE="%-14s" INPUT="LABEL"   FUNCTIONS="T(输入密码:)" /> 
  <ITEM NAME="#DRAW_PWD"  LINE="17"  COL="14" TYPE="%6d"  DEVICE="PINPAD" INPUT="TEXT" FUNCTIONS="V(NB)i()">
  <ONLOSTFOCUS>
 "{
    // 直接在这里校验密码了
    // 9317 密码检查
    #FD102_8=#DRAW_PWD;
    if(substr(#HKZH,0,6)!='621223' and substr(#HKZH,0,6)!='621780')
    {
    dim @baktxno as string;
    @baktxno=$TXNO;
    $TXNO='9317';
    commsend_001();
    $FD30=#HKZH;
    $FD79=getitems('#DRAW_PWD');
    callserver();
    $TXNO=@baktxno;
    if($FD12!='0000'){
      showmsg(geterror());
      return (false);
    }
    }
    else if(substr(#HKZH,0,6) == '621223' or substr(#HKZH,0,6)=='621780')  //add by hxc 091121
    {
		initfd();
		commsend_001();
		$FD16='7007';
		$FD30=#HKZH;
		$FD68='4';   //#OPTION ='04'
		$FD79=#DRAW_PWD;
		callagn();
		if( $FD12 != '0000')
		{
			showmsg(geterror());
			return(false);
		}
	}
 }"
 </ONLOSTFOCUS>
</ITEM>
  
  
  
  <ITEM NAME="#LCITYPE" LINE="17"  COL="20"  TYPE="%-10s" INPUT="LABEL"  FUNCTIONS="T(证件类型:)" /> 

	<ITEM NAME="#CITYPE" LINE="17"  COL="30" TYPE="%-1s" INPUT="SELECT" FUNCTIONS="V(NB)j(#CITYPENAME)">
	<SELECT>
		<OPTION VALUE="1" TITLE="1身份证"/>
		<OPTION VALUE="2" TITLE="2户口簿"/>
		<OPTION VALUE="3" TITLE="3护照"/>
		<OPTION VALUE="4" TITLE="4军官证"/>
		<OPTION VALUE="5" TITLE="5回乡证"/>
		<OPTION VALUE="8" TITLE="8企业代码证"/>
		<OPTION VALUE="9" TITLE="9经营许可证"/>
		<OPTION VALUE="A" TITLE="A营业执照"/>
		<OPTION VALUE="B" TITLE="B事业法人证"/>
		<OPTION VALUE="C" TITLE="C工商核准号"/>
	</SELECT>
  </ITEM>

  <ITEM NAME="#CITYPENAME"  TYPE="%-12s" FUNCTIONS="j(#CITYPE=1,T{身份证})j(#CITYPE=2,T{户口簿})j(#CITYPE=3,T{护照})j(#CITYPE=4,T{军官证})j(#CITYPE=5,T{回乡证})j(#CITYPE=8,T{企业代码证})j(#CITYPE=9,T{经营许可证})j(#CITYPE=A,T{营业执照})j(#CITYPE=B,T{事业法人证})j(#CITYPE=C,T{工商核准号})"/>
  <ITEM NAME="#LCINO" LINE="17"  COL="48"  TYPE="%-10s" INPUT="LABEL"   FUNCTIONS="T(证件号码:)" /> 
  
	<ITEM NAME="#C_CERTNO" TYPE="%-20s" FUNCTIONS=""/>
  <ITEM NAME="#C_CERTTYPE" TYPE="%1s" FUNCTIONS=""/>
  <!-- 为核查结果中文传值的变量 wudawei 20131101 -->
  <ITEM NAME="#HCJGBL"  TYPE="%-60s" />
  <ITEM NAME="#CINO" LINE="17"  COL="57"  TYPE="%-20s" DEVICE="KEYBOARD" INPUT="TEXT" VISABLE="FALSE" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
  "{
	initfd();
    	commsend_001();
    	$FD16='9961';
	$FD30=#HKZH;
	callserver();
    	if($FD12!='0000'){
    		showmsg(geterror());
    		return(false);
    	}
	#C_CERTNO=delspace($FD62);
	#C_CERTTYPE=$FD67;
	if(#C_CERTNO != delspace(#CINO))
	{
	    showmsg('输入的证件号与帐户不匹配');
	    return(false);
	}
	if(#C_CERTTYPE != #CITYPE)
	{
	    showmsg('输入的证件类型与帐户不匹配');
	    return(false);
	}
	//add 20131030 wudawei start 调用身份核查
  		  dim @res as string;
				if(#CITYPE=='1' or #CITYPE=='2')
				{
					@res =  idcheck(#CINO,#WTDKHM,'','N');
					#HCJGBL = strfld(@res,'|',1);
					@res =  strfld(@res,'|',0);
					if(@res=='02' or @res=='03' or @res=='04' or @res=='05' or @res=='06')
					{
							showmsg('身份核查结果不通过，不能继续办理！');
							return(false);
					}
				}
				//add 20131030 end
  }"
  </ONLOSTFOCUS>
  </ITEM>
  
  
   
  <ITEM NAME="#DSCPT" LINE="23" COL="53" TYPE="%-3s" INPUT="TABLE" ENABLE="FALSE" VISABLE="FALSE" FUNCTIONS=""/>
  
  <ITEM NAME="#WJLX"  LINE="15"  COL="18"  TYPE="%-16s" INPUT="TEXT"	ENABLE="FALSE" FUNCTIONS=""/>
  <ITEM NAME="#YQLX"  LINE="16"  COL="18"  TYPE="%-16s" INPUT="TEXT"	ENABLE="FALSE" FUNCTIONS=""/>
  <ITEM NAME="#WTCKZH"  LINE="19"  COL="20"  TYPE="%-16s" INPUT="TEXT"	ENABLE="TRUE" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
			initfd();
   		dim @baktxno as string;
   		dim @tota as string;
   		dim @list1 as string;
    	dim @list2 as string;
   		dim @i as number;
	  	@baktxno=$TXNO;
	    
			//$TXNO='9731';
			$TXNO='4416';
			$FD65='4414';
			$FD102=#WTCKZH;
			$FD37 = #TRUST_NO;
			commsend_001();
			@tota=callserver();
			$TXNO=@baktxno;
			if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}			
		#WTCKHM = substr($FD25,0,30);						//委托人存款户名
		show(#WTCKHM,true);
		#FD101_4 = substr($FD90,0,3);
		#FD101_5 = substr($FD59,0,16);
	}"
	</ONLOSTFOCUS>
	</ITEM>
  <ITEM NAME="#WTCKHM"  LINE="20"  COL="20"  TYPE="%-26s" INPUT="TEXT"	ENABLE="FALSE" FUNCTIONS=""/>

  <ITEM NAME="#SUBMIT" LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>  
</VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
   <PACKAGE DEVICE="SCREEN" DESC="显示内容">
   NOTHING
   </PACKAGE>
   <PRINT>"{
		print( 3, 32,'委托贷款还息');
		print( 5, 22,'委托还款帐号: [19]',#HKZH);
		print( 6, 22,'户    名: [60]',#HKZHHM);
		print( 7, 22,'还款金额: [16]',#WJLX);
		print( 8, 22,'流 水 号: [ 6]',$FD4);
		print( 9, 22,'委托存款帐号: [19]',#WTCKZH);
		print( 10, 22,'户    名: [60]',#WTCKHM);
		print( 11, 22,'存款金额: [16]',#CKAMT);
		print( 12, 22,'流 水 号: [ 6]',$FD4);
		print( 13, 22,'代扣代缴税:');
		print( 14, 22,'科    目: [60]','26505');
		print( 15, 22,'代扣金额: [16]',#DKAMT);
		print( 16, 22,'流 水 号: [ 6]',$FD4);
		
	}"
  </PRINT>
</RESPONSE>

<RESPONSE>
   <PACKAGE DEVICE="PRINTER"  LINESPACE="20" DESC="【 请插入客户利息明细清单... 】">
   LNHDHZ|@t|@jjh|@cpmc|@qxsds|@ljhx|@htll|@yqll|
   </PACKAGE>
   <PRINT>"{
print( 5,25,'		                           委托贷款还息明细清单   	');


print( 6,20,'     机构名称:[30                            ]   交易日期:[10         ]   流 水 号:[8       ]', $BRNAME, #CPDATE, $FD4);
print( 7,20,'┍━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┑');
print( 8,20,'┃  贷款账号: [20                  ]                    借 据 号: [20                  ]            ┃', #WTDKZH,@jjh);
print( 9,20,'┃  户    名:[60                                                          ]                       ┃', #WTDKHM);
print(10,20,'┃  还款帐号: [20                  ]   产品名称:[50                                                ]┃',#HKZH,@cpmc);
print(11,20,'┃  还款户名：[60                                                          ]                      ┃', #HKZHHM);
print(12,20,'┃----------------------------------------------------------------------------------------------┃');
print(13,20,'┃  本次还息：[30                            ]          ￥[22                    ]                  ┃', #UHBJE, #WJLX);
print(14,20,'┃----------------------------------------------------------------------------------------------┃');
print(15,20,'┃  还息明细：                                                                                  ┃');
print(16,20,'┃            未结利息：[22                    ]  逾期利息：[22                    ]                ┃', ltrim(comma(#WJLX, 22)), ltrim(comma(#YQLX, 22)));
print(17,20,'┃----------------------------------------------------------------------------------------------┃');
print(18,20,'┃  欠息时段：[4   ]-[2 ]-[2 ]   到   [4   ]-[2 ]-[2 ]                                              ┃', substr(#IC_DATE, 0, 4), substr(#IC_DATE, 4, 2), substr(#IC_DATE, 6, 2), substr(#CPDATE, 0, 4), substr(#CPDATE, 4, 2), substr(#CPDATE, 6, 2));
print(19,20,'┃  欠息总额：[22                    ] 合同利率(月)：[11         ] 逾期利率(月)：[11         ]        ┃', ltrim(comma(#WJLX, 22)), @htll, @yqll);
print(20,20,'┕━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┙');		
	}"
  </PRINT>
</RESPONSE>

<RESPONSE>
<PACKAGE DEVICE="PRINTER" DESC="打印业务专用凭证">
LNHDHZ|@t|@jjh|@cpmc|@qxsds|@ljhx|@htll|@yqll|
</PACKAGE>
<PRINT>
"{
 	dim @txtime  as string;
	@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	
	print( 5, 20,'机构名称:[30]',$BRNAME);
  print( 5, 2,'代码:4413');
  print( 5, 13,'交易:委托贷款还息');
	print( 7, 20,'借 据 号:[20]',@jjh);
  print( 8, 20,'贷款帐号:[20]     户名:[60]',#WTDKZH,#WTDKHM);

	print( 9, 20,'还款帐号:[20]     还款户名:[60]',#HKZH,#HKZHHM);
	print( 10, 20,'本次还息:[30]     ￥[22]',#UHBJE, #WJLX);
	print(11,20,'身份核查结果:[60] ',#HCJGBL);
	printacdtl_1();
        print_sq();
	print( 24,20,'备注:')
        print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
        print( 24,5,'柜员:[4]',$FD7);
        print( 24,5,'流水号:[6]',$FD4);
 }"	
</PRINT>
</RESPONSE>

<RESPONSE>
<PACKAGE DEVICE="PRINTER" DESC="打印业务专用凭证">
LNHDHZ|@t|@jjh|@cpmc|@qxsds|@ljhx|@htll|@yqll|
</PACKAGE>
<PRINT>
"{
 	dim @txtime  as string;
	@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	print( 5, 20,'机构名称:[30]',$BRNAME);
  print( 5, 2,'代码:4413');
  print( 5, 13,'交易:委托贷款还息');
	print( 7, 20,'借 据 号:[20]',@jjh);
  print( 8, 20,'收款帐号:[20]     收款户名:[60]',#WTCKZH,#WTCKHM);

	print( 9, 20,'还款帐号:[20]     还款户名:[60]',#HKZH,#HKZHHM);
	print( 10, 20,'还息金额:[30]     ￥[22]',#UHBJE, #WJLX);
	print(11,20,'身份核查结果:[60] ',#HCJGBL);
	printacdtl_1();
        print_sq();
	print( 24,20,'备注:代扣代缴税')
        print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
        print( 24,5,'柜员:[4]',$FD7);
        print( 24,5,'流水号:[6]',$FD4);
 }"	
</PRINT>
</RESPONSE>

</TRANSACTION>

   
   
   
   
    
   
  
