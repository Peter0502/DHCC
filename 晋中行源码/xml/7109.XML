<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="00000000" TITLE="7109 收回出售的凭证  "
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
  <COMMSEND>"{
 	commsend_001();
  		$FD25=#KHMC;
		$FD31=#NACTNO;
		$FD34=#ZHXH;
		$FD52=#PZSL; 
  		$FD58=#QSHM;
  		$FD59=#ZZHM; 
  		$FD67=#SHFS;
  		$FD89=#PZZL;
  }"
  </COMMSEND>
  <COMMRECV>"{
	 commrecv_001();
}"
</COMMRECV>
  <VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-60s" FUNCTIONS=
    "T(7109                         收回出售的凭证)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
   <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
   <ITEM NAME="#TXNO" 	 TYPE="%-4s" FUNCTIONS="T($TXNO=5109)"/>
   <!--输入变量-->
  <ITEM LINE="7"  COL="10" TYPE="%-10s" FUNCTIONS="T(帐    号:)"/>
<!---要序号没有用，将此项去掉 delete by wanglei 20061009
  <ITEM LINE="7"  COL="45" TYPE="%-10s" FUNCTIONS="T(帐户序号:)"/>
--->
  <ITEM LINE="8"  COL="10" TYPE="%-10s" FUNCTIONS="T(客户名称:)"/>
  <ITEM LINE="10" COL="10" TYPE="%-10s" FUNCTIONS="T(收回方式:)"/>
  <ITEM LINE="11" COL="10" TYPE="%-10s" FUNCTIONS="T(凭证种类:)"/>
  <ITEM LINE="13" COL="10" TYPE="%-10s" FUNCTIONS="T(起始号码:)"/>
  <ITEM LINE="14" COL="10" TYPE="%-10s" FUNCTIONS="T(终止号码:)"/>
  <ITEM LINE="15" COL="10" TYPE="%-10s" FUNCTIONS="T(凭证数量:)"/>
  <ITEM NAME="#ACTNO" INPUT="TEXT" LINE="7" COL="20" TYPE="%-20s" 	FUNCTIONS="T()V(NB)">
  <ONLOSTFOCUS>
	"{
		initfd();
		commsend_001();
		$FD16='9700';
		$FD31=#ACTNO;
		callserver();
		#ZHXH=$FD34;
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		#NACTNO=delspace($FD31);  //得到新帐号
		initfd();
	}"
    </ONLOSTFOCUS>
  </ITEM>
 <!---不要帐户序号显示--->
  <ITEM NAME="#ZHXH" TYPE="%4d"	FUNCTIONS="">
   <ONLOSTFOCUS>
	"{
		dim @txno_bak as string;
		@txno_bak=$TXNO;
		commsend_001();
		$FD16='9702';
		$FD31=#ACTNO;
		$FD34=#ZHXH;
		callserver();	
		$TXNO=@txno_bak;
		#KHMC=$FD25;
		if($FD12!='0000'){
				showmsg(geterror());
				return(false);
		}
		#NACTNO=delspace($FD31);  //得到新帐号
			enable(#KHMC,false);
			initfd();
	}"
    </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#NACTNO" TYPE="%-20s" FUNCTIONS=""/><!---新帐号--->
  <ITEM NAME="#KHMC"	INPUT="TEXT" 	LINE="8" COL="20" 	TYPE="%-50s" 	FUNCTIONS="T()V(NB)"/>
   <ITEM NAME="#SHFS"   INPUT="SELECT" 	LINE="10" COL="20" 	TYPE="%-1s" 	FUNCTIONS="T(0)"> 
  	<SELECT>
  		<OPTION VALUE="0" TITLE="1.零张"/>
  		<OPTION VALUE="1" TITLE="1.整本"/>
  	</SELECT>
  	  <ONLOSTFOCUS>
	"{
		dim @txno_bak as string;
		dim @tota as string;
		@txno_bak=$TXNO;
		$TXNO='9885';
		commsend_001();
		$FD67=#SHFS;
		$TXNO=@txno_bak;
		@tota=callserver();	
		setsel(#PZZL,@tota,'o5t20o1v3o2');
		$FD11='';
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
			}
	}"
    </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#PZZL" 	INPUT="SELECT" LINE="11" COL="20" TYPE="%-3s" 	FUNCTIONS="T(001)V(NB)">
  	<SELECT>
  		<OPTION VALUE="001" TITLE="1.现金支票"/>
  	</SELECT>
  </ITEM>
  <ITEM NAME="#QSHM" 		INPUT="TEXT" 			LINE="13" COL="20" TYPE="%16d" 	FUNCTIONS="T()V(NB)"/>
  <ITEM NAME="#ZZHM" 		INPUT="TEXT" 			LINE="14" COL="20" TYPE="%16d" 	FUNCTIONS="T()V(NB)">
  <ONLOSTFOCUS>
  "{
         if(#ZZHM &lt; #QSHM)
         {
           showmsg('终止号码必须大于起始号码');
           return(false);
         }
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#FLAG"   	TYPE="%-12s"     	FUNCTIONS="T(1)">
   <ONLOSTFOCUS>
  "{
     // #PZSL=itoa((atoi(substr(#ZZHM,8,8))-atoi(substr(#QSHM,8,8))+1),'%12d'); mod 20120103
     initfd(); 
     commsend_001(); 
     $FD16='9204'; 
     $FD58=#QSHM; 
     $FD59=#ZZHM; 
     callserver(); 
     if($FD12!='0000') 
     { 
          showmsg(geterror()); 
          return(false); 
     } 
     #PZSL=$FD60; 
     show(#PZSL,true);
     enable(#PZSL,false);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#PZSL"   	INPUT="TEXT" 	LINE="15" COL="20" TYPE="%12s"  FUNCTIONS="T(0)"/>
  <ITEM NAME="#PASSWD" 	TYPE="%-6s" 			FUNCTIONS="T()"/>
  <ITEM NAME="#NAME2"  TYPE="%-20s" FUNCTIONS="S(#PZZL,#PZZL)"/>
  <ITEM NAME="#NAME3"  TYPE="%-20s" FUNCTIONS="S(#SHFS,#SHFS)"/>
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
  <ITEM NAME="#YEAR"  TYPE="%-4s" FUNCTIONS="T($HDATE,1,4)"/>
  <ITEM NAME="#MON"   TYPE="%-2s" FUNCTIONS="T($HDATE,5,2)"/>
  <ITEM NAME="#DAY"   TYPE="%-2s" FUNCTIONS="T($HDATE,7,2)"/> 
    </VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="出售凭证收回">
 NOTHING
 </PACKAGE>
  <PRINT>"{
          print( 2,  24,'交易名称:出售凭证收回');
          print( 4,  20,'交易机构:[5]',$FD2);
	  			print( 5,  20,'交易日期:[8]',$HDATE);  
	  			print( 6,  20,'流水号码:[6]',$FD4);
	  			print( 7,  20,'操作员号:[4]',$FD7);
	  	  	  
	  			print( 9,  20,'帐    号:[20 ]',$FD31);
	  			print( 9,  20,'帐号序号:[4  ]',#ZHXH);
	  			print( 10, 20,'客户名称:[50 ]',#KHMC);
	  			print( 11, 20,'收回方式:[20 ]',#NAME3);
	  			print( 12, 20,'凭证种类:[20 ]',#NAME2);	   
	  			print( 13, 20,'起始号码:[20 ]',#QSHM);
	  			print( 14, 20,'终止号码:[20 ]',#ZZHM);
	  			print( 15, 20,'凭证数量:[20 ]',#PZSL);
	}"
</PRINT>
</RESPONSE>
<RESPONSE>
	<PACKAGE DEVICE="PRINTER" DESC="请打印凭证" LINESPACE="24">
 NOTHING
 </PACKAGE>
  <PRINT>"{
 $KINDNO='00';
 dim @txtime  as string;
@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	print( 5, 20,'机构名称:[30]',$BRNAME);
  print( 5, 2,'代码:7109');
	print( 5, 13,'交易:出售凭证收回');
	
	print( 8, 25,'[5]',$KINBR);
  print( 9,25,'出售凭证收回'); 
 	print(10,  10,'帐    号:[20  ]     帐号序号:[4  ]',$FD31,#ZHXH);
	print(11,  10,'客户名称:[50 ]',#KHMC);
	print(12,  10,'收回方式:[20 ]',#NAME3);
	print( 13, 10,'凭证种类:[20 ]',#NAME2);
	print( 14, 10,'起始号码:[16 ]',#QSHM);
	print( 15, 10,'终止号码:[16 ]',#ZZHM);
	print( 16, 10,'凭证数量:[12 ]',#PZSL);
	
	print( 24,20,'备注:');
	print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
	print( 24,5,'柜员:[4]',$FD7);
	print( 24,5,'流水号:[6]',$FD4);         
	}"
</PRINT>
</RESPONSE>
 </TRANSACTION>


