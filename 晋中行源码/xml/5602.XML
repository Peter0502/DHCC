<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110000" TITLE="5602 银行承兑汇票审核"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
        commsend_001();
        $MSGTYPE='03001';
        dim @baktxno as string;
        @baktxno=$TXNO;
        $TXNO = '9986';
        $FD12 = '4332';
        $FD21 = #CURCD;
        $FD25 = #PAYBRNAME;
        $FD26 = #PAYNAME;
        $FD27 = #CASHNAME;
        $FD30 = $KINBR;
        $FD32 = #BZACTNO;
        $FD33 = #CDNUM;
        $FD38 = #PAYACTNO;      
        $FD39 = space(16);
        $FD40 = itoa(val(#XBRATE,100),'%08d');	//保证金比例
        $FD44 = #EDATE;
        $FD81 = #CASHBRNAME;
        $FD82 = #PAYNAME;
        $FD83 = #CASHACTNO;
        $FD100 = getitems('#TOAVBAL#ZYAVBAL#BZAVBAL#BZJAVBAL');
        commsend_001();
        callserver();
        $TXNO=@baktxno;
        if($FD12!='0000'){
            showmsg(geterror());
            return(false);
        }

        $FD16 = '4332';
        $MSGTYPE='03001';

}"
</COMMSEND>
<COMMRECV>"{
	commrecv_001();
	$PBLINE='05';
	$KINDNO='02';
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-60s" FUNCTIONS=
   "T(5602                        银行承兑汇票审核)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <PAGE NAME="DEFAULT">

  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=4332)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>

  <ITEM LINE="5"  COL="5"  TYPE="%-14s" FUNCTIONS="T(承兑协议编号:)"/>
  <ITEM LINE="7"  COL="5"  TYPE="%-70s" FUNCTIONS=
	   "T(--------------------------- 以下为回显信息 ----------------------------)"/>
  <ITEM LINE="9"  COL="5"  TYPE="%-11s" FUNCTIONS="T(收款人帐号:)"/>
  <ITEM LINE="10" COL="5"  TYPE="%-11s" FUNCTIONS="T(收款人全称:)"/>
  <ITEM LINE="11" COL="5"  TYPE="%-11s" FUNCTIONS="T(收款行全称:)"/>
  <ITEM LINE="12" COL="5"  TYPE="%-11s" FUNCTIONS="T(出票人账号:)"/>
  <ITEM LINE="13" COL="5"  TYPE="%-11s" FUNCTIONS="T(出票人全称:)"/>
  <ITEM LINE="14" COL="5"  TYPE="%-11s" FUNCTIONS="T(付款行行号:)"/>
  <ITEM LINE="15" COL="5"  TYPE="%-11s" FUNCTIONS="T(付款行全称:)"/>
  <ITEM LINE="16" COL="5"  TYPE="%-11s" FUNCTIONS="T(票面总金额:)"/>
  <ITEM LINE="16" COL="45" TYPE="%-11s" FUNCTIONS="T(保证金比例:)"/>
  <ITEM LINE="16" COL="67" TYPE="%-1s"  FUNCTIONS="T(%)"/>
  <ITEM LINE="17" COL="5"  TYPE="%-10s" FUNCTIONS="T(保证金额:)"/>

  <ITEM LINE="17" COL="45" TYPE="%-11s" FUNCTIONS="T(担保账号:)"       NAME="#SDBACT" INPUT="LABEL" VISABLE="FALSE"/>
  <ITEM LINE="18" COL="5"  TYPE="%-15s" FUNCTIONS="T(担保账户全称:)"   NAME="#SDBNM"  INPUT="LABEL" VISABLE="FALSE"/>
  <ITEM LINE="19" COL="5"  TYPE="%-15s" FUNCTIONS="T(担保账户余额:)"   NAME="#SDBYE"  INPUT="LABEL" VISABLE="FALSE"/>
  <ITEM LINE="17" COL="45" TYPE="%-11s" FUNCTIONS="T(保证金账号:)"     NAME="#SBZACT" INPUT="LABEL" VISABLE="TRUE"/>
  <ITEM LINE="18" COL="5"  TYPE="%-15s" FUNCTIONS="T(保证金账户全称:)" NAME="#SBZNM"  INPUT="LABEL" VISABLE="TRUE"/>
  <ITEM LINE="19" COL="5"  TYPE="%-15s" FUNCTIONS="T(保证金账户余额:)" NAME="#SBZYE"  INPUT="LABEL" VISABLE="TRUE"/>

  <ITEM LINE="20" COL="5"  TYPE="%-10s" FUNCTIONS="T(到期日期:)"/>
  <ITEM LINE="20" COL="45" TYPE="%-11s" FUNCTIONS="T(质押总金额:)"/>


<!-- 定义callserver返回但界面不用的变量 -->
  <ITEM TYPE="%17.2f" NAME="#FD100_1"  FUNCTIONS="V(NB)J(#XFD100_1)"/>
  <ITEM NAME="#XFD100_1" TYPE="%-16s"  FUNCTIONS="X(#FD100_1)"/>
  <ITEM TYPE="%17.2f" NAME="#FD100_2"  FUNCTIONS="V(NB)J(#XFD100_2)"/>
  <ITEM NAME="#XFD100_2" TYPE="%-16s"  FUNCTIONS="X(#FD100_2)"/>
  <ITEM TYPE="%17.2f" NAME="#FD100_3"  FUNCTIONS="V(NB)J(#XFD100_3)"/>
  <ITEM NAME="#XFD100_3" TYPE="%-16s"  FUNCTIONS="X(#FD100_3)"/>

  <ITEM TYPE="%17.2f" NAME="#FD100_4"  FUNCTIONS="V(NB)J(#XFD100_4)"/>
  <ITEM NAME="#XFD100_4" TYPE="%-16s"  FUNCTIONS="X(#FD100_4)"/>

  <ITEM TYPE="%9.6f"  NAME="#FD100_5"  FUNCTIONS="V(NB)J(#XFD100_5)"/>
  <ITEM NAME="#XFD100_5" TYPE="%-8s"   FUNCTIONS="X(#FD100_5)"/>

  <ITEM TYPE="%-2s"   NAME="#FD100_6"  FUNCTIONS="V(NB)"/>
  <ITEM TYPE="%-2s"   NAME="#FD100_7"  FUNCTIONS="V(NB)"/>
  <ITEM TYPE="%-10s"  NAME="#FD100_8"  FUNCTIONS="V(NB)"/>
  <ITEM TYPE="%-10s"  NAME="#FD100_9"  FUNCTIONS="V(NB)"/>
  <ITEM TYPE="%17.2f" NAME="#FD100_10" FUNCTIONS="V(NB)J(#XFD100_10)"/>
  <ITEM NAME="#XFD100_10" TYPE="%-16s" FUNCTIONS="X(#FD100_10)"/>

  <ITEM TYPE="%-2s" NAME="#CURCD"  FUNCTIONS="T(01)"/>  <!-- 9910,$FD21 -->


  <ITEM LINE="5"  COL="19" TYPE="%-20s" NAME="#CDNUM" DEVICE="KEYBOARD" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
		"{
			if(substr(#CDNUM,1,5)!=$KINBR)
			{
					showmsg('承兑交易必须在本行进行！！！');
					return(false);
			}
			dim @baktxno as string;
			@baktxno=$TXNO;
			$TXNO='9909';
			$FD33 = #CDNUM;
			commsend_001();
			callserver();
			$TXNO=@baktxno;
			if($FD12!='0000'){
			    showmsg(geterror());
			    return(false);
			}
			

			#PAYBRNAME = $FD25;
			#PAYNAME = $FD26;
			#CASHNAME = $FD27;
			#PAYBRNO = $FD30;
			#BZACTNO = $FD32;
			#PAYACTNO = $FD38;
			#XBRATE = itoa(val($FD40,0.01),'%.2f');
			//$FD42不给值了，因为$FD100中有重复值		#XBZAVBAL = itoa(val($FD42,0.01),'%.2f');
			#EDATE = $FD44;
			#CASHBRNAME = $FD81;
			#CASHACTNO = $FD83;
			setitems('#TOAVBAL#ZYAVBAL#BZAVBAL#FD100_4#FD100_5#FD100_6#FD100_7#FD100_8#FD100_9#FD100_10',$FD100);

	if($FD67=='4')
	{
		show(#SBZACT,false);	
		show(#SBZNM,false);	
		show(#SBZYE,false);	
		show(#SDBACT,true);	
		show(#SDBNM,true);	
		show(#SDBYE,true);	
	}else{
		show(#SDBACT,false);	
		show(#SDBNM,false);	
		show(#SDBYE,false);	
		show(#SBZACT,true);	
		show(#SBZNM,true);	
		show(#SBZYE,true);	

	}

	//第2次callserver
		initfd();
  		$MSGTYPE='03001';
        @baktxno=$TXNO;
        $TXNO='9910';
        $FD21 = #CURCD;
		$FD32 = #BZACTNO;
        commsend_001();
        callserver();
        $TXNO=@baktxno;
        if($FD12!='0000'){
            showmsg(geterror());
            return(false);
        }
		#BZJNAME = $FD82;
        setitems('#FD100_1#FD100_2#FD100_3#BZJAVBAL#FD100_5#FD100_6#FD100_7#FD100_8#FD100_9#FD100_10',$FD100);
		show(#CASHACTNO,true);
		show(#CASHNAME,true);
		show(#CASHBRNAME,true);
		show(#PAYACTNO,true);
		show(#PAYNAME,true);
		show(#PAYBRNO,true);
		show(#PAYBRNAME,true);
		show(#XTOAVBAL,true);
		show(#XBRATE,true);
		show(#XBZAVBAL,true);
		show(#BZACTNO,true);
		show(#BZJNAME,true);
		show(#XBZJAVBAL,true);
		show(#EDATE,true);
		show(#XZYAVBAL,true);
  }"
  </ONLOSTFOCUS>
  </ITEM>

  <ITEM LINE="9"  COL="17" TYPE="%-32s" NAME="#CASHACTNO"  INPUT="LABEL" 	 FUNCTIONS=""/>
  <ITEM LINE="10" COL="17" TYPE="%-50s" NAME="#CASHNAME"   INPUT="LABEL" 	 FUNCTIONS=""/>
  <ITEM LINE="11" COL="17" TYPE="%-40s" NAME="#CASHBRNAME" INPUT="LABEL" 	 FUNCTIONS=""/>
  <ITEM LINE="12" COL="17" TYPE="%-20s" NAME="#PAYACTNO"   INPUT="LABEL" 	 FUNCTIONS=""/>
  <ITEM LINE="13" COL="17" TYPE="%-50s" NAME="#PAYNAME"    INPUT="LABEL" 	 FUNCTIONS=""/>
  <ITEM LINE="14" COL="17" TYPE="%-5s"  NAME="#PAYBRNO"    INPUT="LABEL" 	 FUNCTIONS=""/>
  <ITEM LINE="15" COL="17" TYPE="%-50s" NAME="#PAYBRNAME"  INPUT="LABEL" 	 FUNCTIONS=""/>

  <ITEM LINE="16" COL="17" NAME="#XTOAVBAL" TYPE="%-16s" FUNCTIONS="X(#TOAVBAL)"/>
  <ITEM TYPE="%17.2f" NAME="#TOAVBAL" FUNCTIONS="J(#XTOAVBAL)"/>

  <ITEM LINE="16" COL="57" NAME="#XBRATE" TYPE="%-8s" FUNCTIONS=""/>

  <ITEM LINE="17" COL="17" NAME="#XBZAVBAL" TYPE="%-16s" FUNCTIONS="X(#BZAVBAL)"/>
  <ITEM TYPE="%17.2f" NAME="#BZAVBAL" FUNCTIONS="V(NB)J(#XBZAVBAL)"/>

  <ITEM LINE="17" COL="57" TYPE="%-19s" NAME="#BZACTNO"  INPUT="LABEL" FUNCTIONS="V(NB)"/>
  <ITEM LINE="18" COL="20" TYPE="%-50s" NAME="#BZJNAME"  INPUT="LABEL" FUNCTIONS="V(NB)"/>

  <ITEM LINE="19" COL="20" NAME="#XBZJAVBAL" TYPE="%-16s" FUNCTIONS="X(#BZJAVBAL)"/>
  <ITEM TYPE="%17.2f" NAME="#BZJAVBAL" FUNCTIONS="J(#XBZJAVBAL)"/>

  <ITEM LINE="20" COL="15" TYPE="%-8s"  NAME="#EDATE"  INPUT="LABEL" FUNCTIONS="V(NB)"/>

  <ITEM LINE="20" COL="57" NAME="#XZYAVBAL" TYPE="%-16s"  FUNCTIONS="X(#ZYAVBAL)"/>
  <ITEM TYPE="%17.2f" NAME="#ZYAVBAL" FUNCTIONS="J(#XZYAVBAL)"/>

  <!--输出变量--->

  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  <ITEM NAME="#YEAR"  TYPE="%-4s" FUNCTIONS="T($FD5,1,4)"/>
  <ITEM NAME="#MON"  TYPE="%-2s" FUNCTIONS="T($FD5,5,2)"/>
  <ITEM NAME="#DAY"  TYPE="%-2s" FUNCTIONS="T($FD5,7,2)"/>
  
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
  </PAGE>
</VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
	<PACKAGE DEVICE="SCREEN" DESC="显示内容">
	NOTHING
	</PACKAGE>

	<PRINT>
	"{
        print( 9,  8,'承兑协议编号: [20]',#CDNUM);
        print(10,  8,'收款人帐号: [32]',#CASHACTNO);
        print(11,  8,'收款人全称: [50]',#CASHNAME);
        print(12,  8,'收款行全称: [40]',#CASHBRNAME);
       
	}"
	</PRINT>
</RESPONSE>

<RESPONSE>
	<PACKAGE DEVICE="PRINTER" DESC="请打印业务专用凭证">
	NOTHING
	</PACKAGE>
	<PRINT>
	"{
 $KINDNO='00';
 dim @txtime  as string;
@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	print( 5,20,'机构名称:[30]',$BRNAME);  
	print( 5,2,'代码:5602');
	print( 5,13,'交易:承兑汇票审核');

	print(07, 20,'承兑协议编号: [20]',#CDNUM);
	print(08, 20,'收款人帐号: [32]',#CASHACTNO);
	print(09, 20,'收款人全称: [50]',#CASHNAME);
	print(10, 20,'收款行全称: [40]',#CASHBRNAME);
	
	print(24,20,'备注:');
	print(24,27,'交易日期:[8] [8]',$HDATE,@txtime);
	print(24,5,'柜员:[4]',$FD7);
	print(24,5,'流水号:[6]',$FD4);
	}"    
	</PRINT>
</RESPONSE>
        
</TRANSACTION>
