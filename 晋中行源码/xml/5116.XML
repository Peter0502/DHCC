<TRANSACTION RIGHTS="11110000" TITLE="5116 汇票编押/核押"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>
"{
  //add by zyl 20110705 
	if(#PO_TYPE == '5')
	{
		#CASH_OPN_BR_NO = '904290099992';//晋中商行 兑付行 904290099992 
	}
	commsend_001();
	commsend_123();
	commsend_hv();
	$FD88 = #PWD;
	$FD72 = #OPTYPE;
}"
</COMMSEND>
<COMMRECV>
"{
	commrecv_001();
	#PWD = $FD88;
}"
</COMMRECV>
<VARIABLE>
<ITEM LINE="3"  COL="3" TYPE="%-52s" FUNCTIONS=
    "T(5116                     汇票编押/核押)"/>
<ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
"T(─────────────────────────────────────)"/>

<ITEM NAME="#MSGTYPE"    TYPE="%-5s"    FUNCTIONS="T($MSGTYPE=03001)"/>
<ITEM NAME="#TXNO"       TYPE="%-4s"    FUNCTIONS="T($TXNO=5816)"/>


<ITEM NAME="#CMTNO"			TYPE="%-3s"	FUNCTIONS="T(302)"/>
<ITEM NAME="#O_CMTNO"			TYPE="%-3s"	FUNCTIONS=""/>
<ITEM NAME="#PAY_QS_NO"			TYPE="%-12s"	FUNCTIONS=""/>
<ITEM NAME="#OR_BR_NO"			TYPE="%-12s"	FUNCTIONS=""/>
<ITEM NAME="#AC_BR_NO"			TYPE="%-12s"	FUNCTIONS=""/>
<ITEM NAME="#SENDCO"			TYPE="%-4s"	FUNCTIONS=""/>
<ITEM NAME="#PAY_AC_NO"			TYPE="%-32s"	FUNCTIONS=""/>
<ITEM NAME="#PAY_NAME"			TYPE="%-60s"	FUNCTIONS=""/>
<ITEM NAME="#PAY_ADDR"			TYPE="%-60s"	FUNCTIONS=""/>
<ITEM NAME="#CASH_QS_NO"		TYPE="%-12s"	FUNCTIONS=""/>
<ITEM NAME="#RECECO"			TYPE="%-4s"	FUNCTIONS=""/>
<ITEM NAME="#CASH_AC_NO"		TYPE="%-32s"	FUNCTIONS=""/>
<ITEM NAME="#CASH_NAME"			TYPE="%-60s"	FUNCTIONS=""/>
<ITEM NAME="#CASH_ADDR"			TYPE="%-60s"	FUNCTIONS=""/>
<ITEM NAME="#YW_TYPE"			TYPE="%-2s"	FUNCTIONS=""/>
<ITEM NAME="#ORDERNO"			TYPE="%-8s"	FUNCTIONS=""/>
<ITEM NAME="#CONTENT"			TYPE="%-60s"	FUNCTIONS=""/>
<ITEM NAME="#RATE"			TYPE="%-7s"		FUNCTIONS=""/>
<ITEM NAME="#RATEDATE"			TYPE="%-5s"		FUNCTIONS=""/>
<ITEM NAME="#OORDERNO"			TYPE="%-8s"		FUNCTIONS=""/>
<ITEM NAME="#PROCODE"			TYPE="%-8s"		FUNCTIONS=""/>
<ITEM NAME="#CR_DATE"			TYPE="%-8s"		FUNCTIONS=""/>
<ITEM NAME="#CR_BR_NO"          TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#QR_BR_NO"          TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#QR_TX_NUM"         TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#TX_TYPE"           TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#NOTPAY_CONTENT"    TYPE="%-255s"     FUNCTIONS=""/>
<ITEM NAME="#NOTPAY_ORDERNO"    TYPE="%-3s"       FUNCTIONS=""/>
<ITEM NAME="#O_NOTPAY_ORDERNO"  TYPE="%-3s"       FUNCTIONS=""/>
<ITEM NAME="#RESP1"             TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#OPERLEVEL"         TYPE="%-1s"       FUNCTIONS=""/><!--优先级别-->
<ITEM NAME="#PROC_STS"          TYPE="%-1s"       FUNCTIONS=""/><!--处理状态-->

<ITEM NAME="#WT_DAY"            TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#O_WT_DAY"          TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#CUR_NO"            TYPE="%-3s"       FUNCTIONS=""/>
<ITEM NAME="#OPCD"              TYPE="%-2s"       FUNCTIONS=""/>
<ITEM NAME="#NOTE_TYPE"         TYPE="%-3s"       FUNCTIONS=""/>
<ITEM NAME="#NOTE_NO"           TYPE="%-16s"      FUNCTIONS=""/>
<ITEM NAME="#LW_IND"            TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#HP_ADD_PWD"    	TYPE="%-1s" 	 FUNCTIONS=""/>
<ITEM NAME="#PACKID"        	TYPE="%8d" 	 FUNCTIONS=""/>
<ITEM NAME="#O_PACKID"          TYPE="%8d"       FUNCTIONS=""/>
<ITEM NAME="#PACK_DATE"     	TYPE="%8d"  	 FUNCTIONS=""/>
<ITEM NAME="#O_PACK_DATE"   	TYPE="%8d"  	 FUNCTIONS=""/>
<ITEM NAME="#TXNUM"     	TYPE="%5d"	 FUNCTIONS=""/>
<ITEM NAME="#O_TXNUM"       	TYPE="%5d"  	 FUNCTIONS=""/>
<ITEM NAME="#LV_YW_IND"     	TYPE="%12s" 	 FUNCTIONS=""/>
<ITEM NAME="#RESP_DATE"     	TYPE="%8d"  	 FUNCTIONS=""/>
<ITEM NAME="#RCP_STS"       	TYPE="%2d"  	 FUNCTIONS=""/>
<ITEM NAME="#RESP2"             TYPE="%8s"       FUNCTIONS=""/>
<ITEM NAME="#RETCODE"           TYPE="%2d"       FUNCTIONS=""/>
<ITEM NAME="#YW_DTL_ID"         TYPE="%8d"       FUNCTIONS=""/>
<ITEM NAME="#ACC_IND"           TYPE="%1d"       FUNCTIONS=""/>
<ITEM NAME="#REQ_TYPE"          TYPE="%1d"       FUNCTIONS=""/>
<ITEM NAME="#DF_FREEAMT"        TYPE="%16s"      FUNCTIONS=""/>
<ITEM NAME="#PROTNO"            TYPE="%60s"      FUNCTIONS=""/>
<ITEM NAME="#OTYPE"             TYPE="%1d"       FUNCTIONS="T(1)"/><!-- 表示大额 -->




<ITEM LINE="08"  COL="9"  TYPE="%-10s" FUNCTIONS="T(功能选择:)"/>
<ITEM LINE="10"  COL="9"  TYPE="%-10s" FUNCTIONS="T(汇票类型:)"/>
<ITEM LINE="11"  COL="9"  TYPE="%-10s" FUNCTIONS="T(签发行号:)"/>
<ITEM LINE="12"  COL="9"  TYPE="%-10s" INPUT="LABEL"  NAME="#LB4" FUNCTIONS="T(汇票号码:)"/>
<ITEM LINE="13"  COL="9"  TYPE="%-10s" FUNCTIONS="T(签发日期:)"/>
<ITEM LINE="14"  COL="9"  TYPE="%-10s" INPUT="LABEL" NAME="#LB2"   FUNCTIONS="T(兑付行号:)"/>
<ITEM LINE="15"  COL="9"  TYPE="%-10s" FUNCTIONS="T(出票金额:)"/>
<ITEM LINE="16"  COL="9"  TYPE="%-10s" INPUT="LABEL" NAME="#LB1"  FUNCTIONS="T(查复书号:)"/>
<ITEM LINE="17"  COL="9"  TYPE="%-10s" INPUT="LABEL" NAME="#LB0"  FUNCTIONS="T(汇票密押: )"/>
<ITEM LINE="18"  COL="9"  TYPE="%-14s" INPUT="LABEL" VISABLE="FALSE" NAME="#LB3"  FUNCTIONS="T(划款凭证编号:)"/>
	
<ITEM LINE="08" COL="19"  NAME="#OPTYPE"   TYPE="%-1s"   INPUT="SELECT"  FUNCTIONS="V(0,3)T(0)">
 <SELECT LINE="7" COL="31" >             
     <OPTION VALUE="0"     TITLE="机器编押"/>
     <OPTION VALUE="1"     TITLE="机器核押"/>
</SELECT>
<ONLOSTFOCUS>
"{
	show(#LB0,true);
	show(#PWD,true);
	if(#OPTYPE == '0')
	{
		show(#LB0,false);
		show(#PWD,false);
	}
}"
</ONLOSTFOCUS>
</ITEM>
<ITEM LINE="10" COL="19"  NAME="#PO_TYPE"   TYPE="%-1s"   INPUT="SELECT"  FUNCTIONS="V(1,5)T(1)">
 <SELECT LINE="7" COL="31" >             
     <OPTION VALUE="1"     TITLE="现金汇票"/>
     <OPTION VALUE="2"     TITLE="不可转让汇票"/>
     <OPTION VALUE="3"     TITLE="可转让汇票"/>
     <OPTION VALUE="4"     TITLE="查复书业务"/>
     <OPTION VALUE="5"     TITLE="划款凭证"/><!-- add by zyl 20110705 -->
</SELECT>
<ONLOSTFOCUS>
"{
	show(#LB1,		true);
	show(#CR_TX_NUM,	true);
	show(#LB2,		true);
	show(#CASH_OPN_BR_NO,	true);
	if(#PO_TYPE != '4')
	{
		show(#LB1,	false);
		show(#CR_TX_NUM,false);
		show(#LB3,	false);
		show(#HK_PZ_NUM,false);
	}
	if(#PO_TYPE !='1')
	{
		show(#LB2,	false);
		show(#CASH_OPN_BR_NO,false);
		show(#LB3,	false);
		show(#HK_PZ_NUM,false);
	}
	//add by zyl 20110705 划款凭证,只能编押.
	if(#OPTYPE == '1' and #PO_TYPE == '5')
	{
		showmsg('划款凭证只能编押.不能核押.');
		return(false);
	}
	//划款凭证时的输入项.
	if(#PO_TYPE == '5')
	{
		show(#LB2,	true);
		show(#CASH_OPN_BR_NO,true);
		show(#LB1,	false);
		show(#CR_TX_NUM,false);
		show(#LB4,	false);
		show(#PO_NO,false);
		show(#LB3,	true);
		show(#HK_PZ_NUM,true);
		
		#CASH_OPN_BR_NO='904290099992';//兑付行 904290099992 
	}
	else
  {
		show(#LB4,	true);
		show(#PO_NO,true);
  }
	//end by zyl 20110705
}"
</ONLOSTFOCUS>
</ITEM>
<ITEM NAME="#SPO_TYPE" TYPE="%-14s" FUNCTIONS="S(#PO_TYPE,#PO_TYPE)"/>
<ITEM LINE="11" COL="19"  NAME="#PAY_OPN_BR_NO"  	TYPE="%-12s"  INPUT="TEXT"   FUNCTIONS="V(NB)T()">
<ONLOSTFOCUS>
"{
	commsend_001();
	$FD32 = #PAY_OPN_BR_NO;
	$FD16 = '9553';
	callserver();
	if($FD12!='0000')
	{
		showmsg(geterror());
		return (false);
	}
	showhelp(3,70,8,3,'支付系统行名信息',substr($FD96,0,60));
}"
</ONLOSTFOCUS>
</ITEM>
<ITEM LINE="12" COL="19"  NAME="#PO_NO"       	TYPE="%8d"   INPUT="TEXT"  FUNCTIONS="V(NB)T()"/>
<ITEM LINE="13" COL="19"  NAME="#NOTPAY_DATE"  	TYPE="%-08s" INPUT="TEXT"  FUNCTIONS="V(NB)D()T()"/>
<ITEM LINE="14" COL="19"  NAME="#CASH_OPN_BR_NO" TYPE="%-12s" INPUT="TEXT"  FUNCTIONS="V(NB)T()">
<ONLOSTFOCUS>
"{

	commsend_001();
	$FD32 = #CASH_OPN_BR_NO;
	$FD16 = '9553';
	callserver();
	if($FD12!='0000')
	{
		showmsg(geterror());
		return (false);
	}
	showhelp(3,70,8,3,'支付系统行名信息',substr($FD96,0,60));
}"
</ONLOSTFOCUS>
</ITEM>
<ITEM LINE="15" COL="19"  NAME="#TX_AMT"    TYPE="%16.2f" INPUT="TEXT"   FUNCTIONS="V(NB)T()"/>
<ITEM LINE="16" COL="19"  NAME="#CR_TX_NUM" TYPE="%08d"    INPUT="TEXT"   FUNCTIONS="V(NB))"/>
<ITEM LINE="17" COL="19"  NAME="#PWD"       TYPE="%-10s"   INPUT="TEXT"   FUNCTIONS="V(NB)T()"/>
<ITEM LINE="18" COL="23"  NAME="#HK_PZ_NUM" TYPE="%08d"  VISABLE="FALSE"  INPUT="TEXT"   FUNCTIONS="V(NB))">
<ONLOSTFOCUS>
"{
    //划款凭证号码.
    #PO_NO = #HK_PZ_NUM;
}"
</ONLOSTFOCUS>
</ITEM>
<ITEM NAME="#PASSWD"   TYPE="%-6s" FUNCTIONS="T()"/>

<ITEM LINE="21"  COL="65"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT" />
</VARIABLE>
 <!--发送信息包-->
<REQUEST>
</REQUEST>

<!--接收信息包-->
<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="按任意键退出">
NOTHING
</PACKAGE>
    <PRINT>"{
		if(#OPTYPE=='0')
		{
       	   print(6,15,'生成汇票密押 :[20]',#PWD);
		}
		else if(#OPTYPE=='1')
		{
           print(6,15,'核押结果:[12]',#PWD);
		}
}"
</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="打印业务专用凭证">
NOTHING
</PACKAGE>
    <PRINT>"{
 $KINDNO='00';
 dim @txtime  as string;
@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
 		
		print( 5,20,'机构名称:[30]',$BRNAME);  
		print( 5,2,'代码:5116');
		print( 5,13,'交易:汇票编押/核押'); 
		
		print( 7,20,'汇票类型:[14]',#SPO_TYPE);
		print( 8,20,'签发行号:[12]     汇票号码:[8]',#PAY_OPN_BR_NO,#PO_NO);
		print( 9,20,'签发日期:[8]     查复书号:[8]',#NOTPAY_DATE,#CR_TX_NUM);
		print(10,20,'兑付行号:[12]     出票金额:[16]',#CASH_OPN_BR_NO,itoa(#TX_AMT,'%16.2f'));
		if(#OPTYPE=='0')
		{
          	   print(11,20,'生成汇票密押 :[20]',#PWD);
		}
		else if(#OPTYPE=='1')
		{
                   print(11,20,'核押结果:[12]',#PWD);
		}
		
		print( 24,20,'备注:');
		print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
		print( 24,5,'柜员:[4]',$FD7);
		print( 24,5,'流水号:[6]',$FD4);
}"
</PRINT>
</RESPONSE>
<OUTPUT>
</OUTPUT>
</TRANSACTION>
