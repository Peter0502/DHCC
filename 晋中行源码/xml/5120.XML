<TRANSACTION RIGHTS="11110000" TITLE="5120 退回应答报文录入"
xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	#CMTNO   = '314';
	#O_CMTNO = '313';
	#RECECO = '';
	#OPCD = '10';
	commsend_001();
	commsend_123();
	commsend_hv();
}"
</COMMSEND>
<COMMRECV>"{
	commrecv_001();
	commrecv_123();
}"
</COMMRECV>

<VARIABLE>

<ITEM LINE="3"  COL="3" TYPE="%-52s" FUNCTIONS=
"T(5120                        大额申请退回应答报文录入)"/>
<ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
"T(─────────────────────────────────────)"/>
<ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=5820)"/>
<ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>


<ITEM NAME="#CMTNO"		TYPE="%-3s"	FUNCTIONS=""/>
<ITEM NAME="#OR_BR_NO"          TYPE="%-12s"	FUNCTIONS=""/>
<ITEM NAME="#PAY_QS_NO"		TYPE="%-12s"	FUNCTIONS=""/>
<ITEM NAME="#SENDCO"		TYPE="%-4s"	FUNCTIONS=""/>
<ITEM NAME="#PAY_OPN_BR_NO"     TYPE="%-12s"	FUNCTIONS=""/>
<ITEM NAME="#PAY_ADDR"		TYPE="%-60s"	FUNCTIONS=""/>
<ITEM NAME="#CASH_QS_NO"	TYPE="%-12s"	FUNCTIONS=""/>
<ITEM NAME="#RECECO"		TYPE="%-4s"	FUNCTIONS=""/>
<ITEM NAME="#ORDERNO"           TYPE="%-08s"	FUNCTIONS=""/>
<ITEM NAME="#CASH_OPN_BR_NO"    TYPE="%-12s"	FUNCTIONS=""/>
<ITEM NAME="#CASH_ADDR"		TYPE="%-60s"	FUNCTIONS=""/>
<ITEM NAME="#YW_TYPE"		TYPE="%-2s"	FUNCTIONS=""/>
<ITEM NAME="#CONTENT"		TYPE="%-60s"	FUNCTIONS=""/>
<ITEM NAME="#RATE"              TYPE="%-7s"	FUNCTIONS=""/>
<ITEM NAME="#RATEDATE"          TYPE="%-5s"	FUNCTIONS=""/>
<ITEM NAME="#PROCODE"           TYPE="%-8s"	FUNCTIONS=""/>
<ITEM NAME="#CR_DATE"           TYPE="%-8s"	FUNCTIONS=""/>
<ITEM NAME="#CR_BR_NO"          TYPE="%-12s"	FUNCTIONS=""/>
<ITEM NAME="#CR_TX_NUM"         TYPE="%-8s"	FUNCTIONS=""/>
<ITEM NAME="#QR_BR_NO"          TYPE="%-12s"	FUNCTIONS=""/>
<ITEM NAME="#QR_TX_NUM"         TYPE="%-8s"	FUNCTIONS=""/>
<ITEM NAME="#TX_TYPE"           TYPE="%-1s"	FUNCTIONS=""/>
<ITEM NAME="#NOTPAY_ORDERNO"    TYPE="%-3s"	FUNCTIONS=""/>
<ITEM NAME="#OPERLEVEL"         TYPE="%-1s"	FUNCTIONS="T(0)"/><!--优先级别-->
<ITEM NAME="#PROC_STS"          TYPE="%-1s"	FUNCTIONS=""/><!--处理状态-->
<ITEM NAME="#WT_DAY"            TYPE="%-8s"	FUNCTIONS="T($HDATE)"/>
<ITEM NAME="#CUR_NO"            TYPE="%-3s"	FUNCTIONS=""/>
<ITEM NAME="#OPCD"              TYPE="%-2s"	FUNCTIONS="T(10)"/>
<ITEM NAME="#NOTE_TYPE"         TYPE="%-3s"	FUNCTIONS=""/>
<ITEM NAME="#NOTE_NO"           TYPE="%-16s	"FUNCTIONS=""/>
<ITEM NAME="#LW_IND"            TYPE="%-1s"	FUNCTIONS="T(1)"/>
<ITEM NAME="#HP_ADD_PWD"    	TYPE="%-1s"	FUNCTIONS=""/>
<ITEM NAME="#PACKID"        	TYPE="%8d"	FUNCTIONS=""/>
<ITEM NAME="#O_PACKID"          TYPE="%8d"	FUNCTIONS=""/>
<ITEM NAME="#PACK_DATE"     	TYPE="%8d"	FUNCTIONS=""/>
<ITEM NAME="#O_PACK_DATE"   	TYPE="%8d"	FUNCTIONS=""/>
<ITEM NAME="#TXNUM"     	TYPE="%5d"	FUNCTIONS=""/>
<ITEM NAME="#O_TXNUM"       	TYPE="%5d"	FUNCTIONS=""/>
<ITEM NAME="#LV_YW_IND"     	TYPE="%12s"	FUNCTIONS=""/>
<ITEM NAME="#RESP_DATE"     	TYPE="%8d"	FUNCTIONS=""/>
<ITEM NAME="#RCP_STS"       	TYPE="%2d"	FUNCTIONS=""/>
<ITEM NAME="#RESP2"             TYPE="%8s"	FUNCTIONS=""/>
<ITEM NAME="#RETCODE"           TYPE="%2d"	FUNCTIONS=""/>
<ITEM NAME="#YW_DTL_ID"         TYPE="%8d"	FUNCTIONS=""/>
<ITEM NAME="#ACC_IND"           TYPE="%1d"	FUNCTIONS=""/>
<ITEM NAME="#REQ_TYPE"          TYPE="%1d"	FUNCTIONS=""/>
<ITEM NAME="#DF_FREEAMT"        TYPE="%16s"	FUNCTIONS=""/>
<ITEM NAME="#PROTNO"            TYPE="%60s"	FUNCTIONS=""/>
<ITEM NAME="#PO_NO"             TYPE="%8d"	FUNCTIONS=""/>
<ITEM NAME="#PO_TYPE"           TYPE="%1d"	FUNCTIONS=""/>
<ITEM NAME="#OTYPE"             TYPE="%1d"	FUNCTIONS="T(1)"/><!-- 表示大额 -->




<ITEM LINE="5"  COL="05"  TYPE="%-13s" FUNCTIONS="T(原退回申请号:)"/>
<ITEM LINE="6"  COL="05"  TYPE="%-11s" FUNCTIONS="T(原申请日期:)"/>
<ITEM LINE="7"  COL="05"  TYPE="%-11s" FUNCTIONS="T(原申请行号:)"/>
<ITEM LINE="8"  COL="05"  TYPE="%-11s" FUNCTIONS="T(应答  结果:)"/>
<ITEM LINE="9"  COL="05"  TYPE="%-11s" FUNCTIONS="T(应答  附言:)"/>

<BLOCK NAME="BLOCK_LB"  LINE="0" COL="0" VISABLE="FALSE">
<ITEM LINE="10" COL="25"  TYPE="%-30s" FUNCTIONS="T(【对应支付交易信息】)"/>
<ITEM LINE="11" COL="05"  TYPE="%-11s" FUNCTIONS="T(原支付日期:)"/>
<ITEM LINE="11" COL="47"  TYPE="%-11s" FUNCTIONS="T(原支付序号:)"/>
<ITEM LINE="12" COL="05"  TYPE="%-11s" FUNCTIONS="T(原发起行号:)"/>
<ITEM LINE="13" COL="05"  TYPE="%-11s" FUNCTIONS="T(发起行名称:)"/>
<ITEM LINE="14" COL="05"  TYPE="%-11s" FUNCTIONS="T(原交易种类:)"/>
<ITEM LINE="15" COL="05"  TYPE="%-12s" FUNCTIONS="T(原收款帐号:)"/>
<ITEM LINE="16" COL="05"  TYPE="%-11s" FUNCTIONS="T(原收款名称:)"/>
<ITEM LINE="17" COL="05"  TYPE="%-11s" FUNCTIONS="T(原付款帐号:)"/>
<ITEM LINE="18" COL="05"  TYPE="%-12s" FUNCTIONS="T(原付款名称:)"/>
<ITEM LINE="19" COL="05"  TYPE="%-12s" FUNCTIONS="T(原清算金额:)"/>
<ITEM LINE="20" COL="05"  TYPE="%-12s" FUNCTIONS="T(原附言内容:)"/>
</BLOCK>


<ITEM NAME="#T_O_NOTPAY_ORDERNO" TYPE="%3d" FUNCTIONS=""/>
<ITEM NAME="#T_NOTPAY_DATE" TYPE="%08s" FUNCTIONS=""/>
<!--<ITEM NAME="#O_CMTNO" TYPE="%-3s" FUNCTIONS="T(313)"/>--><!--同名ITEM liangq注-->
<ITEM NAME="#T_AC_BR_NO" TYPE="%-12s" FUNCTIONS=""/>

<ITEM LINE="05"  COL="18" NAME="#O_NOTPAY_ORDERNO"   TYPE="%3d"  DEVICE="KEYBOARD"  FUNCTIONS="V(NB)T(001)"/>

<ITEM LINE="06"  COL="17" NAME="#NOTPAY_DATE"   TYPE="%-08s"  DEVICE="KEYBOARD" FUNCTIONS="V(NB)D()"/>
<ITEM LINE="07"  COL="17" NAME="#AC_BR_NO"   TYPE="%-12s"  DEVICE="KEYBOARD" FUNCTIONS="T()"> <!--接受行,原发起行--->
<ONLOSTFOCUS>
"{
	showblock('BLOCK_LB',false,true);
	showblock('BLOCK_TX',false,true);
	initfd();
	commsend_001();
	commsend_123();
	commsend_hv();
	$FD16 ='9562';
	callserver();
	if($FD12!='0000'  and  $FD12!='9999')
	{
		showmsg(geterror());
		return (false);
	}
	else if($FD12=='9999')
	{
		showmsg('找不到对应的支付交易,程序继续....');
		return (true);	
	}
	showblock('BLOCK_LB',true,true);
	showblock('BLOCK_TX',true,true);


	#T_O_NOTPAY_ORDERNO = #O_NOTPAY_ORDERNO;
	#T_NOTPAY_DATE      = #NOTPAY_DATE     ;
	#T_AC_BR_NO         = #AC_BR_NO        ;
	commsend_123();
	#TX_AMT = val($FD39)/100;
	#O_WT_DAY = $FD45;
	#O_NOTPAY_CONTENT = substr(#NOTPAY_CONTENT,0,60);


	$FD16 = '9553';
	$FD32 = #AC_BR_NO;
	callserver()
	if($FD12!='0000')
	{
		showmsg(geterror());
		return (false);
	}

	#BR_NAME = substr($FD96,0,60);
	show(#AC_BR_NO,true);
	show(#BR_NAME  ,true);
	show(#PAY_AC_NO,true);
	show(#PAY_NAME,true);
	show(#CASH_AC_NO,true);
	show(#CASH_NAME,true);
	show(#TX_AMT,true);
	show(#AC_BR_NO,true);
	show(#OORDERNO,true);
	show(#O_WT_DAY,true);
	show(#O_NOTPAY_CONTENT,true);
	#O_CMTNO = #CMTNO;//得到原支付交易的cmtno
	#O_NOTPAY_ORDERNO = #T_O_NOTPAY_ORDERNO;
	#NOTPAY_DATE      = #T_NOTPAY_DATE     ;
	#AC_BR_NO         = #T_AC_BR_NO        ;
}"
</ONLOSTFOCUS>
</ITEM>
<ITEM LINE="08"  COL="17" NAME="#RESP1"  	   TYPE="%-01s"  DEVICE="KEYBOARD" FUNCTIONS="T(0)">
	<SELECT LINE="08" COL="20">
		<OPTION VALUE="0"		TITLE="0.同意退回"/>
		<OPTION VALUE="1"		TITLE="1.不同意退回"/>
	</SELECT>
</ITEM>
<ITEM NAME="#S_RESP1" TYPE="%-10s" FUNCTIONS="S(#RESP1,#RESP1)"/>
<ITEM LINE="09"  COL="17" NAME="#T_NOTPAY_CONTENT"   TYPE="%-60s"  DEVICE="KEYBOARD" FUNCTIONS="V(NB)"/>
<ITEM NAME="#NOTPAY_CONTENT" TYPE="%-255s" FUNCTIONS="T(#T_NOTPAY_CONTENT)"/>

<BLOCK NAME="BLOCK_TX" LINE="0" COL="0" VISABLE="FALSE">
<ITEM LINE="11"  COL="17" NAME="#O_WT_DAY"   TYPE="%-08s"   DEVICE="KEYBOARD" FUNCTIONS=""/> 
<ITEM LINE="11"  COL="58" NAME="#OORDERNO"   TYPE="%-08s"   DEVICE="KEYBOARD" FUNCTIONS=""/>
<ITEM LINE="12"  COL="17" NAME="#T_OR_BR_NO"   TYPE="%-12s"   DEVICE="KEYBOARD" FUNCTIONS="T(#AC_BR_NO)"/>
<ITEM LINE="13"  COL="17" NAME="#BR_NAME"   TYPE="%-60s"   DEVICE="KEYBOARD" FUNCTIONS=""/>
<!--原发起行--->
<ITEM LINE="14"  COL="17" NAME="#O_CMTNO"  INPUT="SELECT"  TYPE="%-03s"   DEVICE="KEYBOARD" FUNCTIONS="T(100)">
	<SELECT LINE="06" COL="20">
		<OPTION VALUE="100 大额汇兑" TITLE="0.大额汇兑(100)"/>
		<OPTION VALUE="101 委托收款" TITLE="1.委托收款(101)"/>
		<OPTION VALUE="102 托收承付" TITLE="2.托收承付(102)"/>
		<OPTION VALUE="105 同业拆借" TITLE="3.同业拆借(105)"/>
		<OPTION VALUE="108 退汇支付" TITLE="4.退汇支付(108)"/>
		<OPTION VALUE="109 电子联行" TITLE="5.电子联行(109)"/>
	</SELECT>
</ITEM>
<ITEM LINE="15" COL="17" NAME="#CASH_AC_NO"     TYPE="%-32s" DEVICE="KEYBOARD" FUNCTIONS=""/><!--收款帐号,本行-->
<ITEM LINE="16" COL="17" NAME="#CASH_NAME"      TYPE="%-60s"  DEVICE="KEYBOARD" FUNCTIONS=""/>
<ITEM LINE="17" COL="17" NAME="#PAY_AC_NO"    TYPE="%-32s" DEVICE="KEYBOARD" FUNCTIONS=""/><!--付款帐号 ,他行-->
<ITEM LINE="18" COL="17" NAME="#PAY_NAME"     TYPE="%-60s"  DEVICE="KEYBOARD"
FUNCTIONS=""/>
<ITEM LINE="19" COL="17" NAME="#TX_AMT"      TYPE="%16.2f" DEVICE="KEYBOARD" FUNCTIONS=""/>
<ITEM LINE="20" COL="17" NAME="#O_NOTPAY_CONTENT"    TYPE="%-60s" DEVICE="KEYBOARD" FUNCTIONS=""/>

</BLOCK>

<ITEM LINE="21" COL="59" NAME="#OK"   TYPE="%-6s"  INPUT="SUBMIT"  FUNCTIONS="T(确  定)"/>

</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE>
NOTHING
</PACKAGE>
<PRINT>"{
	print(3,25,'大额退回应答报文录入');
	print(5,15,'交易机构 :[7]',$FD3);
	print(7,15,'委托日期 :[8]',$HDATE);
	print(8,15,'交易序号 :[8]',#ORDERNO);
	print(9,15,'流水号码 :[ 6]',$FD4);
}"
</PRINT>
</RESPONSE>

<RESPONSE>
<PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="打印业务专用凭证">
NOTHING
</PACKAGE>
<PRINT>"{
 $KINDNO='00';
 dim @txtime  as string;
@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
 	print( 5, 20,'机构名称:[30]',$BRNAME);  
	print( 5, 2,'代码:5120');
	print( 5, 13,'交易:大额退回应答报文录入'); 
	
	print(5,10,'交易机构 :[7]     委托日期 :[8]',$FD3,$HDATE);
	print(6,10,'交易序号 :[8]',#ORDERNO);
	print(7,10,'原退回申请号:[3]   原申请日期:[8]',#O_NOTPAY_ORDERNO,#NOTPAY_DATE);
	print(8,10,'原申请行号:[12]     应答  结果:[10]',#AC_BR_NO,#S_RESP1);
	print(9,10,'应答  附言:[60]',#T_NOTPAY_CONTENT);
	
	print( 24,20,'备注:');
	print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
	print( 24,5,'柜员:[4]',$FD7);
	print( 24,5,'流水号:[6]',$FD4);
}"
</PRINT>
</RESPONSE>
</TRANSACTION>


