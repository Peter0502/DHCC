<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11000000" TITLE="8601    批量开户业务处理"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
     commsend_001();
     dim @txno_bak as string;
     @txno_bak=$TXNO;
     $TXNO='9986';
     $FD12='6601';
     $MSGTYPE='03001';
     $FD21=#AGENTYPE;
     $FD23=#PRDTID;
     $FD25=#DWNAME;
     $FD27=#PRDTNAME;
     $FD30=#DWACTNO;
     $FD40=getitems('#TOTAMT');
     $FD55=#TOTNUM;
     $FD70=#PROSTYLE;
     $FD71=#YWTYPE;
     $FD90=#MDMTYPE;
     $FD92=#DWID;
     commsend_001();
     $FD79='111111';
     callserver();
     $TXNO=@txno_bak;
     if($FD12!='0000')
     {
	showmsg(geterror());
	return(false);
     }
     $FD16 = '6601';
     $MSGTYPE='03001';
}"
</COMMSEND>
<COMMRECV>"{
commrecv_001();
}"
</COMMRECV>

<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-52s" FUNCTIONS=
    "T(8601                           批量开户业务处理)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=6601)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  
  <ITEM LINE="5"   COL="5"    TYPE="%-10s"  FUNCTIONS="T(产品编号:!)"/>
  <ITEM LINE="5"   COL="44"   TYPE="%-10s"  FUNCTIONS="T(产品名称:)" />

  <ITEM LINE="7"   COL="5"    TYPE="%-10s"  FUNCTIONS="T(单位编号:)"/>
  <ITEM LINE="7"   COL="21"   TYPE="%-10s"  FUNCTIONS="T(单位名称:)" />
  
  <ITEM LINE="9"   COL="5"    TYPE="%-10s"  FUNCTIONS="T(业务性质:!)" />
  <ITEM LINE="9"   COL="40"   TYPE="%-10s"  FUNCTIONS="T(代理类型:!)" />
  
  <ITEM LINE="11"  COL="5"    TYPE="%-10s"  FUNCTIONS="T(单位账号:)"/>
  <ITEM LINE="11"  COL="40"   TYPE="%-10s"  FUNCTIONS="T(介质种类:!)"/>
  
  <ITEM LINE="13"  COL="5"    TYPE="%-14s"  FUNCTIONS="T(信息录入方式:!)"/>
  <ITEM LINE="13"  COL="40"   INPUT="LABEL" NAME="#FILE"  VISABLE="FALSE" TYPE="%-10s"  FUNCTIONS="T(文件名称:)"/>
  <ITEM LINE="15"  COL="5"    TYPE="%-10s"  FUNCTIONS="T(总 金 额:)"/>
  <ITEM LINE="15"  COL="40"   TYPE="%-10s"  FUNCTIONS="T(总 笔 数:)"/>
  
  <ITEM LINE="5" COL="15" NAME="#PRDTID" TYPE="%-3s" INPUT="SELECT" FUNCTIONS="T(101)">
    <SELECT>
       <OPTION VALUE ="101" TITLE="101.储蓄人民币活期" />
       <OPTION VALUE ="201" TITLE="201.个人整存整取三个月" />
       <OPTION VALUE ="202" TITLE="202.个人整存整取六个月" />
       <OPTION VALUE ="204" TITLE="204.个人整存整取一年期" />
       <OPTION VALUE ="205" TITLE="205.个人整存整取二年期" />
       <OPTION VALUE ="206" TITLE="206.个人整存整取三年期" />
       <OPTION VALUE ="207" TITLE="207.个人整存整取五年期" />
       <OPTION VALUE ="208" TITLE="208.个人整存整取八年期" />
       <OPTION VALUE ="209" TITLE="209.零存整取一年期" />
       <OPTION VALUE ="20A" TITLE="20A.零存整取三年期" />
       <OPTION VALUE ="20B" TITLE="20B.零存整取五年期" />
       <OPTION VALUE ="241" TITLE="241.个人定活两便存款" />
       <!----
       <OPTION VALUE ="102" TITLE="102.储蓄活期无折户" />
       ---->
       
    </SELECT>
    <ONLOSTFOCUS>
		"{
		    dim @txno_bak as string;
        @txno_bak=$TXNO;
		    $TXNO='9879';
		    $FD23=#PRDTID;
		    commsend_001();		
		    callserver();
		    if($FD12!='0000')
		    {
			    showmsg(geterror());
			    return(false);
		    }
		    $TXNO=@txno_bak;
		    #PRDTNAME=delspace($FD27);
		    enable(#PRDTNAME,false);
    	}"
	 </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="5"   COL="54"  NAME="#PRDTNAME"     TYPE="%-20s"       INPUT="TEXT"    FUNCTIONS=""/> 
  <ITEM LINE="7"   COL="15"  NAME="#DWID"         TYPE="%-4s"        INPUT="TEXT"    FUNCTIONS="V(NB)">
   <ONLOSTFOCUS>
		"{
		    dim @txno_bak as string;
                    @txno_bak=$TXNO;
		    $TXNO='9841';
		    $FD92=#DWID;
		    commsend_001();		
		    callserver();
		    if($FD12!='0000')
		    {
			    showmsg(geterror());
			    return(false);
		    }
		    $TXNO=@txno_bak;
		    #DWNAME=delspace($FD25);
		    #YWTYPE=delspace($FD71);
		    #AGENTYPE=delspace($FD21);
		    #DWACTNO=delspace($FD30);
		    enable(#DWNAME,false);
		    enable(#YWTYPE,false);
		    enable(#AGENTYPE,false);
		}"
	 </ONLOSTFOCUS>
  </ITEM> 
  <ITEM LINE="7"  COL="30"  NAME="#DWNAME"      TYPE="%-40s"       INPUT="TEXT" FUNCTIONS=""/>
   
  <ITEM LINE="9"  COL="15"  NAME="#YWTYPE"      TYPE="%-1s"        INPUT="SELECT"  FUNCTIONS="T(0)">
    <SELECT>
       <OPTION VALUE ="0" TITLE="0.代收" />
       <OPTION VALUE ="1" TITLE="1.代付" />
    </SELECT>
  </ITEM>
  <ITEM LINE="9"  COL="50"  NAME="#AGENTYPE"    TYPE="%-2s"        INPUT="SELECT"  FUNCTIONS="T(30)">
   <SELECT>
       <OPTION VALUE ="30" TITLE="30.代发工资       " />
       <OPTION VALUE ="32" TITLE="32.代发自来水工资 " />
       <OPTION VALUE ="33" TITLE="33.批量贷记       " />
       <OPTION VALUE ="35" TITLE="35.现金代发       " />
       <OPTION VALUE ="36" TITLE="36.收益代发       " />
       <OPTION VALUE ="37" TITLE="37.代发定活       " />
       <OPTION VALUE ="38" TITLE="38.代发整整       " />
       <OPTION VALUE ="39" TITLE="39.代发零整       " />
       <OPTION VALUE ="40" TITLE="40.代扣费         " />
       <OPTION VALUE ="41" TITLE="41.代收个人所得税 " />
       <OPTION VALUE ="42" TITLE="42.代收罚款       " />
       <OPTION VALUE ="43" TITLE="43.代收水费       " />
       <OPTION VALUE ="44" TITLE="44.代收煤气费     " />
       <OPTION VALUE ="45" TITLE="45.代收电费       " />
       <OPTION VALUE ="46" TITLE="46.代收税款       " />
       <OPTION VALUE ="47" TITLE="47.代收话费       " />
       <OPTION VALUE ="48" TITLE="48.代收移动费    " />
    </SELECT>          
  </ITEM>
  <ITEM LINE="11"  COL="15"  NAME="#DWACTNO"     TYPE="%-24s"       INPUT="TEXT"  FUNCTIONS="">
   <ONLOSTFOCUS>
  "{
        commsend_001();
	$FD16='9731';
	$FD102=#DWACTNO;
        callserver();
        if($FD12!='0000'){
                showmsg(geterror());
                return(false);
        }
	if($FD72!='0' and $FD72!=''){
		showmsg('帐户被冻结了请做【8102】交易更改单位帐号');
                return(false);
	}
     }"
    </ONLOSTFOCUS>
  </ITEM>  
    
  <ITEM LINE="11"  COL="50"  NAME="#MDMTYPE"     TYPE="%-3s"        INPUT="SELECT"  FUNCTIONS="T(010)">
    <SELECT>
       <OPTION VALUE ="010" TITLE="010.储蓄活期存折" />
       <OPTION VALUE ="013" TITLE="013.储蓄整整定期存单" />
       <!----
       <OPTION VALUE ="015" TITLE="015.储蓄定活两便存单" />
       <OPTION VALUE ="016" TITLE="016.定期一本通" />
       <OPTION VALUE ="020" TITLE="020.储蓄卡" />
       <OPTION VALUE ="011" TITLE="011.储蓄零整存折" />
       <OPTION VALUE ="012" TITLE="012.贺卡定期存单" />
       ---->
    </SELECT>
    <ONLOSTFOCUS>
    "{
	if(#MDMTYPE!='010' and #MDMTYPE!='011' and #MDMTYPE!='012' and  #MDMTYPE!='013' and  #MDMTYPE!='015' 
	and  #MDMTYPE!='016' and  #MDMTYPE!='020')
	{
		showmsg('输入的介质类型错误!请重新输入!'+#MDMTYPE);	
		return  (false);
	}
     }"
    </ONLOSTFOCUS>
  </ITEM>  
  <ITEM LINE="13"  COL="20"  NAME="#PROSTYLE"     TYPE="%-1s"       INPUT="SELECT"  FUNCTIONS="T(0)">
   <SELECT>
       <OPTION VALUE ="0" TITLE="0.手动" />
       <OPTION VALUE ="1" TITLE="1.导磁盘" />
     <!---
       <OPTION VALUE ="2" TITLE="2.科技部" />
     --->
    </SELECT>
   <ONLOSTFOCUS>
  "{
      if(#PROSTYLE!='0'  and #PROSTYLE!='1' and #PROSTYLE!='2')
      {
	    showmsg('录入方式错误!请重新输入!'+#PROSTYLE);
	    return (false);
      }
      if(#PROSTYLE!='0')
      {
       show(#FILENAME,true);
       show(#FILE,true);
      }
      else
      {
       show(#FILENAME,false);
       show(#FILE,false);
      }
   "}
   </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="13"  COL="51"  NAME="#FILENAME"     TYPE="%-15s"       INPUT="TEXT"  FUNCTIONS="" VISABLE="FALSE">
  <ONLOSTFOCUS>
  "{
     		dim @txno_bak as string;
        @txno_bak=$TXNO;
		    $TXNO='6610';
		    $FD38=#FILENAME;
		    commsend_001();		
		    callserver();
		    $TXNO=@txno_bak;
		    if($FD12!='0000')
		    {
			    showmsg(geterror());
			    return(false);
		    }
		    
  "}
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="15"   COL="15"  NAME="#TOTAMT"      TYPE="%17.2f"  INPUT="TEXT"    FUNCTIONS="T(0)"/>
  <ITEM LINE="15"   COL="50"  NAME="#TOTNUM"      TYPE="%8d"     INPUT="TEXT"    FUNCTIONS=""/>
  <ITEM TYPE="%-1s" NAME="#MODIFY" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
	if(#PROSTYLE=='0')
	{
	  editfile('../xml/8601.DLG','../tmp/'+$KINBR+#DWID+'_8601_'+#PROSTYLE+$HDATE);
  	  setvfile(true,true);

        }
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM TYPE="%-1s" NAME="#AAAA">
   <ONLOSTFOCUS>
  "{
        dim @filename1 as string;
        dim @filename2 as string;
	if(#PROSTYLE=='0')
	{
         list_init(17,78,5,1);
	 list_setcolcnt(6);
	 
	 list_setcol(0,'代发编号',24);
	 list_setcol(1,'客户姓名',50);
	 list_setcol(2,'开户金额',17);
	 list_setcol(3,'证件号码',20);
	 list_setcol(4,'单位编号',24);
	 list_setcol(5,'证件类型',1);
	 
	 @filename1='../tmp/'+$KINBR+#DWID+'_8601_'+#PROSTYLE+$HDATE;
	 //showmsg(@filename1);
	 list_load(@filename1); 
	 @filename2='../tmp/'+$KINBR+$TTYNAME;
	 //showmsg(@filename2);
         list_save(@filename2);
        }
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <!--<ITEM NAME="#DOMAN"  TYPE="%1s"  FUNCTIONS="">--><!--手工录入代码-->
  <!--<ONLOSTFOCUS>
  "{
	dim @line as string;
	dim @ch as string;
	dim @selid as number;
	list_init(17,78,5,1);
	list_setcolcnt(4);
	list_setcol(0,'代发编号',25);
	list_setcol(1,'姓名',51);
	list_setcol(2,'金额',17);
	list_setcol(3,'身份证号码',20);
	while(true){
		if(list_getrowcnt()==0){
			list_show();
			@ch=showmsg('1-增加,0-提交');
		}else{
			list_work();
			@ch=showmsg('1-增加,2-修改,3-删除,0-提交');	
		}
		showfooter();
		if(@ch=='0'){
			break;
		}else if(@ch=='1'){
			//增加
			@line=input('1|30|【批量代发工资手工录入-增加】',
						'2|5|单位编号: '+#DWID,
						'4|5|代发编号: |%-24s',
						'6|5|    姓名: |%-50s',
						'8|5|账[卡]号: '+#DWACTNO,
						'10|5|    金额: |%13.2f',
						'12|5|身份证号: |%-19s');
			if(@line!=''){
				list_additem('','','','','','','');
				@selid=list_getrowcnt()-1;
				list_settext(@selid,0,strfld(@line,'|',0));
				list_settext(@selid,1,strfld(@line,'|',1));
				list_settext(@selid,2,itoa(val(strfld(@line,'|',2),0.01),'%.2f'));
				list_settext(@selid,3,strfld(@line,'|',3));
			}
			list_setselid(@selid);
		}else if(@ch=='2'){
			//修改
			@selid=list_getselid();
			if(@selid &lt; 0){
				continue;
			}
			@line=input('1|30|【批量代发工资手工录入-修改】',
					'2|5|单位编号: '+#DWID,
					'4|5|代发编号: |%-24s'+'|T('+list_gettext(@selid,0)+')',
					'6|5|    姓名: |%-50s'+'|T('+list_gettext(@selid,1)+')',
					'8|5|账[卡]号: '+#DWACTNO,
					'10|5|    金额: |%13.2f'
							+'|T('+itoa(val(list_gettext(@selid,2),100),'%.0f')+')',
					'12|5|身份证号: |%-19s'+'|T('+list_gettext(@selid,3)+')');
			if(@line!=''){
				list_settext(@selid,0,strfld(@line,'|',0));
				list_settext(@selid,1,strfld(@line,'|',1));
				list_settext(@selid,2,itoa(val(strfld(@line,'|',2),0.01),'%.2f'));
				list_settext(@selid,3,strfld(@line,'|',3));
			}
			list_setselid(@selid);

		}else if(@ch=='3'){
			@selid=list_getselid();
			if(@selid &lt; 0){
				continue;
			}
			@ch=showmsg('您确定要删除此记录吗?(y/n)');
			if(@ch=='y' or @ch=='Y'){
				list_rmitem(@selid);
			}
			if(list_getrowcnt() &gt; 0 and @selid &lt; list_getrowcnt()){
				list_setselid(@selid);
			}
		}
	}
	if(list_getrowcnt()!=0){
		//保存文件
		setvfile(true,true);
		list_save('../tmp/'+$KINBR+$TTYNAME);
	}
	list_del();
	refresh();
	}"	
  </ONLOSTFOCUS>
  </ITEM>-->
  
	 <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
 
  <ITEM LINE="21"  COL="59" TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
  <ONCLICK>
  "{
     dim @txno_bak as string;
     dim @tota as string;
     dim @f as file;
     @txno_bak=$TXNO;
     $TXNO='9986';
     $FD12='6601';
     $MSGTYPE='03001';
     $FD21=#AGENTYPE;
     $FD23=#PRDTID;
     $FD25=#DWNAME;
     $FD27=#PRDTNAME;
     $FD30=#DWACTNO;
     $FD40=getitems('#TOTAMT');
     $FD55=#TOTNUM;
     $FD70=#PROSTYLE;
     $FD71=#YWTYPE;
     $FD90=#MDMTYPE;
     $FD92=#DWID;
     commsend_001();
     $FD79='111111';
     callserver();
     $TXNO=@txno_bak;
     if($FD12!='0000')
     {
	showmsg(geterror());
	return(false);
     }
     $FD16 = '6601';
     $MSGTYPE='03001';
     $FD21=#AGENTYPE;
     $FD23=#PRDTID;
     $FD25=#DWNAME;
     $FD27=#PRDTNAME;
     $FD30=#DWACTNO;
     $FD40=getitems('#TOTAMT');
     $FD55=#TOTNUM;
     $FD70=#PROSTYLE;
     $FD71=#YWTYPE;
     $FD90=#MDMTYPE;
     $FD92=#DWID;
     commsend_001();
     $FD79='111111';
     @tota=callserver();
     if($FD12!='0000')
	{
		showmsg(geterror());
		return(false);
	}
     @f=openfile('../tmp/批量开户业务处理['+#DWID+']','w');
     writeline(@f,@tota);
     closefile(@f);
     call('fview ../tmp/批量开户业务处理['+#DWID+']');
	runoutput();
    
  }"
  </ONCLICK>
  </ITEM>
</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE  DEVICE="SCREEN"  DESC="注意">
NOTHING
</PACKAGE>
	<PRINT>
	"{
		print( 8,30,'注意:');
		print(10,15,'稍后请补打存折!!!');
	}"
	</PRINT>
</RESPONSE>
</TRANSACTION>
