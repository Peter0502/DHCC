<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11111111011100000000000001100010" TITLE="1429        电子申报机构信息"
	xmlns="http: //www.otd.org/MENU" xmlns: W3CNS="http: //www.w3c.org">
<COMMSEND>
"{
	refresh();
	initfd();
	commsend_001();
}"
</COMMSEND>
<COMMRECV>
"{
	commrecv_001();
}"
</COMMRECV>

<VARIABLE>
	<ITEM TYPE="%-1s"   NAME="#HaveFile" FUNCTIONS=""/>
	<!--ITEM TYPE="%-32s"  NAME="#areafile" FUNCTIONS="T(arealistfile.tmp)"/--><!-- 区域列表文件名 >
	<ITEM TYPE="%-128s" NAME="#areaflag" FUNCTIONS="T()"/>
	<ITEM TYPE="%-256s" NAME="#arealist" FUNCTIONS="T()"/>
	<ITEM TYPE="%-4s"   NAME="#BusTpLs"  FUNCTIONS="T()"/-->
	<ITEM LINE="3" COL="3" TYPE="%-60s" FUNCTIONS="T(1429                           电子申报机构)"/>
	<ITEM LINE="4" COL="3"  TYPE="%-74s" FUNCTIONS="T(--------------------------------------------------------------------------)"/>
	<ITEM LINE="5" COL="6"  TYPE="%-10s" FUNCTIONS="T(变更类型：)"/>
	<ITEM LINE="5" COL="16" NAME="#OperType" TYPE="%-1s" INPUT="SELECT" FUNCTIONS="T(0)V(NB)">
		<SELECT>
			<OPTION VALUE="0" TITLE="新增"/>
			<OPTION VALUE="1" TITLE="更新"/>
			<OPTION VALUE="2" TITLE="撤销"/>
		</SELECT>
	</ITEM>
	
	<ITEM LINE="5"  COL="42"   TYPE="%-10s"     FUNCTIONS="T(机构代码：)"/>
	<ITEM LINE="5"  COL="52"  NAME="#OrgCode"    TYPE="%-20s" INPUT="TEXT"   FUNCTIONS="T()V(NB)">	
	<ONLOSTFOCUS>
		"{
		
		    if(#OperType != '0')
		    {
			       dim @f as file;                                        
			       dim @buffer as string;                                  
			       initfd();                                               
             commsend_001();                                         
             $FD16='2307';                                           
             $FD18='pbp';                                            
             $FD28='sxps';                                                                                        
             $FD74=#OrgCode;                                                                                             
             callagnpbp();                                           
             if($FD12!='0000')                                       
             {                                                       
             		showmsg(geterror());                                
		         		return(false);                                      
		         }																                        
		  	     @buffer=getfiletxt('../tmp/'+$KINBR+$TTYNAME);        
		  	     if(@buffer == '')                                     
		  	     {                                                     
		  	     	   showmsg('未找到记录!');                             
		  	     	   closefile(@f);                                      
      	     	   return(false);                                      
		  	     }
		  	     @buffer=delspace(@buffer);	                
             #OrgCode=strfld(@tota,'|',0);              
             #OrgName=strfld(@tota,'|',1);              
             #OrgShortName=strfld(@tota,'|',2);            
             #BankAlias=strfld(@tota,'|',3);            
             #Batchno=strfld(@tota,'|',4);              
             #OrgLvl=strfld(@tota,'|',5);               
             #UpOrg=strfld(@tota,'|',6);                
             #ClearOrg=strfld(@tota,'|',7);             
             #AgentBrc=strfld(@tota,'|',8);             
             #PresBrc=strfld(@tota,'|',9);              
             #AcptBrc=strfld(@tota,'|',10);             
             #SvcClass=strfld(@tota,'|',11);            
             #Region=strfld(@tota,'|',12);              
             #LinkMan=strfld(@tota,'|',13);             
             #Telephone=strfld(@tota,'|',14);           
             #State=strfld(@tota,'|',15);               
             #ExchFlag=strfld(@tota,'|',16);            
             #ExchArea=strfld(@tota,'|',16);            
                      
            if (#ExchFlag == '0')
			      {
			      	#AcptBrc = '';
			      	#PresBrc = '';
			      	#ExchArea= '';
			      	showblock('TR', false, false);
			      	showblock('TC', false, false);
			      	showblock('JHQY', false, false);
			      }
			      else if (#ExchFlag == '1')
			      {
			      	showblock('TR', true, true);
			      	showblock('TC', true, true);
			      	showblock('JHQY', true, true);
			      }
			      else if (#ExchFlag == '2')
			      {
			      	#AcptBrc = '';
			      	showblock('TR', false, false);
			      	showblock('TC', true, true);
			      	showblock('JHQY', true, true);
			      }
			      else if (#ExchFlag == '3')
			      {
			      	#PresBrc = '';
			      	showblock('TC', false, false);
			      	showblock('TR', true, true);
			      	showblock('JHQY', true, true);
			      }                                                                                          	                                                                	                                                                                                        
      	    closefile(@f);                                                                                                      
		        refresh();    
				}			     	
	   }"
		</ONLOSTFOCUS>
	</ITEM>
	<ITEM LINE="6"  COL="6"   TYPE="%-10s"     FUNCTIONS="T(机构名称：)"/>
	<ITEM LINE="6"  COL="16"  NAME="#OrgName"   TYPE="%-20s" INPUT="TEXT"  FUNCTIONS="T()V(NB)"/>
	<ITEM LINE="6"  COL="42"  TYPE="%-10s"     FUNCTIONS="T(行别代码：)"/>
	<ITEM LINE="6"  COL="52"  NAME="#BankAlias"    TYPE="%-20s" INPUT="TEXT"   FUNCTIONS="T()V(NB)"/>	
	
	<ITEM LINE="7"  COL="6"   TYPE="%-10s"                 FUNCTIONS="T(机构简称：)"/>
	<ITEM LINE="7"  COL="16"  NAME="#OrgShortName" TYPE="%-20s" INPUT="TEXT"   FUNCTIONS="T()V(NB)"/>
	<ITEM LINE="7"  COL="42"  TYPE="%-10s"     FUNCTIONS="T(机构级别：)"/>
	<ITEM LINE="7"  COL="52"  NAME="#OrgLvl"   TYPE="%-1s"  INPUT="SELECT" FUNCTIONS="T(1)V(NB)">
		<SELECT>  
			<OPTION VALUE="1" TITLE="清算行"/>
			<OPTION VALUE="2" TITLE="管辖行"/>
			<OPTION VALUE="3" TITLE="开户行"/>
		</SELECT>
	</ITEM>   
	<ITEM LINE="8" COL="6"  TYPE="%-10s"  FUNCTIONS="T(上级机构：)"/>
	<ITEM LINE="8"   COL="52"  NAME="#Region_txt" TYPE="%-6s" INPUT="TEXT"    FUNCTIONS="T()V(NB)" VISABLE="FALSE"/>
	<ITEM LINE="8" COL="16" NAME="#UpOrg" TYPE="%-20s" INPUT="TEXT" FUNCTIONS="V(NB)"   
	<ITEM LINE="8"   COL="42"  TYPE="%-10s"   FUNCTIONS="T(行政区域：)"/>
	<ITEM LINE="8"   COL="52"  NAME="#Region" TYPE="%-6s" INPUT="SELECT" FUNCTIONS="T()V(NB)">
		<SELECT>  	
			<OPTION VALUE="1" TITLE="榆次区"/>
		</SELECT>
	</ITEM>   
	<ITEM LINE="8"   COL="52"  NAME="#Region_txt" TYPE="%-6s" INPUT="TEXT"    FUNCTIONS="T()V(NB)" VISABLE="FALSE"/>
  <ITEM LINE="9"   COL="6"  TYPE="%-10s"   FUNCTIONS="T(机构类型：)"/>
	<ITEM LINE="9"   COL="16"  NAME="#OrgType" TYPE="%-6s" INPUT="SELECT" FUNCTIONS="T()V(NB)">
		<SELECT>
			<OPTION VALUE="1" TITLE="商业银行机构"/>
			<OPTION VALUE="2" TITLE="清算组织"/>
		</SELECT>
	</ITEM>

  <ITEM LINE="9"   COL="42"  TYPE="%-10s"   FUNCTIONS="T(状态：)"/>
	<ITEM LINE="9"   COL="52"  NAME="#State" TYPE="%-6s" INPUT="SELECT" FUNCTIONS="T()V(NB)">
		<SELECT>
			<OPTION VALUE="0" TITLE="不允许所有提出提入电子信息"/>
			<OPTION VALUE="1" TITLE="允许所有提出提入电子信息"/>
			<OPTION VALUE="2" TITLE="只允许提出电子信息"/>
			<OPTION VALUE="3" TITLE="只允许提入电子信息"/>
			<OPTION VALUE="5" TITLE="待审核"/>
			<OPTION VALUE="9" TITLE="注电子信息"/>
		</SELECT>
	</ITEM> 
  	<ITEM LINE="11" COL="6"  TYPE="%-10s"  FUNCTIONS="T(业务种类:)"/>
	<ITEM LINE="11" COL="16" TYPE="%-4s" NAME="#SvcClass" INPUT="TEXT" FUNCTIONS="T(0000)V(NB)">
				<ONGOTFOCUS>
				"{
					dim @liststr as string;
					dim @selid   as number;
					dim @idx     as number;
					dim @flag    as string;
					@flag = '';

					list_init(11, 32, 10, 17);
					list_setcolcnt(2);
					list_setcol(0, '  开  通', 9);
					list_setcol(1, '     名    称', 20);
					list_additem('', '全选/取消', '');
					list_additem('', '  确定', '');
					if (substr(#SvcClass, 0, 1) == '0')
					{
					list_additem('', '', '人民币单位结算');
					}
					else
					{
					list_additem('', '    √', '人民币单位结算');
					}
					if (substr(#SvcClass, 1, 1) == '0')
					{
					list_additem('', '', '人民币个人结算');
					}
					else
					{
					list_additem('', '    √', '人民币个人结算');
					}
					if (substr(#SvcClass, 2, 1) == '0')
					{
					list_additem('', '', '外币结算业务');
					}
					else
					{
					list_additem('', '    √', '外币结算业务');
					}
					if (substr(#SvcClass, 3, 1) == '0')
					{
					   list_additem('', '', '人民币批量借贷记');
					}
					else
					{
					list_additem('', '    √', '人民币批量借贷记');
					}
					while (true)
					{
					      @selid = list_work();
					      if ((@selid &lt; 0) or (@selid == 1))
					      {
					         @idx = 2;
					         #SvcClass = '';
				          	while (@idx &lt; 6)
				          	{
					                if (list_gettext(@idx, 0) == '')
				          	      {
				                   	  #SvcClass = #SvcClass+'0';
					                }
					                else
					                {
					                    #SvcClass = #SvcClass+'1';
					                }
					                @idx = @idx + 1;
					          }         
					          list_del();
					          refresh();
					          return(true);
				         }
					       if (@selid == 0)
					       {/*全选*/
					            if (@flag == '')
					            {
					                @flag = '    √';
				              }
					            else
					            {
					                 @flag = '';
					            }
					            @idx = 2;
					            while (@idx &lt; 6)
					            {
					                 list_settext(@idx, 0, @flag);
					                 @idx = @idx + 1;
					            }
					       }
					       else
					       {
					             if(list_gettext(@selid, 0) == '')
					             {
					                  list_settext(@selid, 0, '    √');
					             }
					             else
					             {
					                  list_settext(@selid, 0, '');
					             }
					       }
					   }
				}"
				</ONGOTFOCUS>
			</ITEM>
	<ITEM LINE="12"  COL="6"   TYPE="%-14s"       FUNCTIONS="T(业务代理机构：)"/>
	<ITEM LINE="12"  COL="16"  NAME="#AgentBrc"   TYPE="%-20s" INPUT="TEXT"   FUNCTIONS="T()"/>
	<ITEM LINE="12"  COL="42"   TYPE="%-14s"       FUNCTIONS="T(归属清算机构：)"/>
	<ITEM LINE="12"  COL="52"  NAME="#ClearOrg"   TYPE="%-20s" INPUT="TEXT"   FUNCTIONS="T()V(NB)"/>
	<ITEM LINE="13"  COL="6"   TYPE="%-14s"       FUNCTIONS="T(交换允许标志：)"/>
	<ITEM LINE="13"  COL="16"  NAME="#ExchFlag"   TYPE="%-1s"  INPUT="SELECT" FUNCTIONS="T()V(NB)">
		<SELECT>
			<OPTION VALUE="0" TITLE="不允许所有实物票据交换"/>
			<OPTION VALUE="1" TITLE="允许所有提出提入实物票据交换"/>
			<OPTION VALUE="2" TITLE="只允许提出实物票据交换"/>
			<OPTION VALUE="3" TITLE="只允许提入实物票据交换"/>
		</SELECT>
		<ONLOSTFOCUS>
		"{
			if (#ExchFlag == '0')
			{
				#AcptBrc = '';
				#PresBrc = '';
				#ExchArea= '';
				showblock('TR', false, false);
				showblock('TC', false, false);
				showblock('JHQY', false, false);
			}
			else if (#ExchFlag == '1')
			{
				showblock('TR', true, true);
				showblock('TC', true, true);
				showblock('JHQY', true, true);
			}
			else if (#ExchFlag == '2')
			{
				#AcptBrc = '';
				showblock('TR', false, false);
				showblock('TC', true, true);
				showblock('JHQY', true, true);
			}
			else if (#ExchFlag == '3')
			{
				#PresBrc = '';
				showblock('TC', false, false);
				showblock('TR', true, true);
				showblock('JHQY', true, true);
			}
		}"
		</ONLOSTFOCUS>
	</ITEM>

	<BLOCK NAME="TR" VISABLE="FALSE">
		<ITEM LINE="14"  COL="6"   TYPE="%-14s"    FUNCTIONS="T(提出交换机构：)"/>
		<ITEM LINE="14"  COL="16"  NAME="#PresBrc" TYPE="%-20s" INPUT="TEXT" FUNCTIONS="V(NB)"/>
	</BLOCK>

	<BLOCK NAME="TC" VISABLE="FALSE">
		<ITEM LINE="14"  COL="42"   TYPE="%-14s"    FUNCTIONS="T(提入交换机构：)"/>
		<ITEM LINE="14"  COL="52"   NAME="#AcptBrc" TYPE="%-20s" INPUT="TEXT" FUNCTIONS="V(NB)"/>
	</BLOCK>


	<ITEM LINE="17"  COL="6"   TYPE="%-10s"      FUNCTIONS="T(联 系 人：)"/>
	<ITEM LINE="17"  COL="16"  NAME="#LinkMan"   TYPE="%-20s" INPUT="TEXT" FUNCTIONS="T()V(NB)"/>
	<ITEM LINE="17"  COL="42"  TYPE="%-10s"      FUNCTIONS="T(联系电话：)"/>
	<ITEM LINE="17"  COL="52"  NAME="#Telephone" TYPE="%-20s" INPUT="TEXT" FUNCTIONS="V(NB)"/>
	<BLOCK NAME="JHQY" VISABLE="FALSE">
		  <ITEM LINE="19"  COL="6"   TYPE="%-10s" FUNCTIONS="T(交换区域：)"/>
		  <ITEM LINE="19"  COL="16"  TYPE="%-58s" NAME="#ExchArea" INPUT="TEXT">
			<!--ONGOTFOCUS>
			"{
				//短交易到平台查出区域列表
				dim @filename as string;
				dim @flag     as string;
				dim @id       as string;
				dim @line     as string;
				dim @f        as file;
				dim @selid as number;
				dim @cnt   as number;
				dim @lines as number;
				@filename = '../tmp/'+#areafile;
				@f = openfile(@filename);
				if(@f &lt; 0){
						showmsg('未找到区域列表!');
						return(true);
				}
				//设置列表规格
				list_init(10, 50, 10, 16);
				list_setcolcnt(3);
				list_setcol(0, '选中状态', 9);
				list_setcol(1, '区域代码', 9);
				list_setcol(2, '区域名称', 20);
				list_additem('', '', '全选', '全选');
				list_additem('', '', '全部取消', '全部取消');
				//添加纪录
				@cnt = 0;
				while (true)
				{
					@line = readline(@f);
					if (@line == '')
					{
						break;
					}
					if (substr(#areaflag, @cnt, 1) == '0')
					{
						@flag = '';
					}
					else
					{
						@flag = '    √';
					}
					list_additem('', @flag, delspace(strfld(@line, '|', 0)), delspace(strfld(@line, '|', 1)));
					@cnt = @cnt + 1;
				}
				@lines = @cnt;
				closefile(@f);
				//显示列表
				while (true)
				{
					@selid=list_work();
					if(@selid &lt; 0)
					{
						//保存选中状态，组区域信息
						#arealist = '';
						@cnt = 0;
						while (@cnt &lt; @lines)
						{
							@flag = list_gettext(@cnt+2, 0);
							if (@flag != '')
							{
								@id = list_gettext(@cnt+2, 1);
								#arealist = #arealist + @id + ',';
								#areaflag = substr(#areaflag, 0, @cnt) + '1' + substr(#areaflag, @cnt+1, len(#areaflag)-@cnt-1);
							}
							else
							{
								#areaflag = substr(#areaflag, 0, @cnt) + '0' + substr(#areaflag, @cnt+1, len(#areaflag)-@cnt-1);
							}
							@cnt = @cnt + 1;
						}
						if (#arealist != '')
						{
							//去除逗号
							#arealist = substr(#arealist, 0, len(#arealist)-1);
						}
						break;
					}
					if (@selid &gt; 1)
					{
						@flag = list_gettext(@selid, 0);
						if (@flag == '')
						{
							list_settext(@selid, 0, '    √');
						}
						else if(@flag == '    √')
						{
							list_settext(@selid, 0, '');
						}
					}
					else if (@selid &lt; 2)
					{
						@cnt = 2;
						if (@selid == 0)
						{
							@flag = '    √';
						}
						else
						{
							@flag = '';
						}
						while (@cnt &lt; @lines+2)
						{
							list_settext(@cnt, 0, @flag);
							@cnt = @cnt+1;
						}
					}
				}
				if (len(#arealist) &gt; 58)
				{
					#ExchArea = substr(#arealist, 0, 55)+'...';
				}
				else
				{
					#ExchArea = #arealist;
				}
				show(#ExchArea, true);
				list_del();
				refresh();
			}"
			</ONGOTFOCUS>
			<ONLOSTFOCUS>
			"{
				if (#ExchArea == '')
				{
					showmsg('请选择或输入交换区域!');
					return(false)
				}
				if (#arealist != #ExchArea)
				{
					if (substr(#ExchArea, len(#ExchArea)-3, 3) == '...')
					{
						return(true);
					}
					else
					{
						//如果柜员手动修改或录入
						//暂时不检查录入格式
						#arealist = #ExchArea;
					}
				}
			}"
			</ONLOSTFOCUS-->
		</ITEM>
	</BLOCK>
	<ITEM LINE="21"  COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON" >
		<ONCLICK>
		"{
				initfd();
				commsend_001();
				$FD16='2306';
				$FD18='pbp';
				$FD28='sxps';
				$FD19=#ClearOrg;
				$FD30=#OrgCode;
				$FD25=#OrgShortName;
				$FD23=#OrgType;
				$FD118=#OrgName;
				$FD98=#OrgLvl;
				$FD31=#UpOrg;
				$FD32=#AgentBrc;
				$FD99=#ExchFlag;
				$FD39=#PresBrc;
				$FD40=#AcptBrc;
				$FD44=#SvcClass;
				//if (#HaveFile == '1')
				//{
				//	$FD45=#Region;
				//}
			//	else if (#HaveFile == '0')
				//{
			//		$FD45=#Region_txt;
			//	}
				$FD45=#Region;
				$FD119=#LinkMan;
				$FD58=#BankAlias;
				$FD62=#Telephone;
				$FD66=#OperType;
				$FD95=#arealist;
				$FD67=#State;
				callagnpbp();
				if($FD12 != '0000')
				{
						showmsg(geterror());
						return(false);
				}
				showmsg('机构申请成功');
				//#ChgNo=$FD75;
				//#ReqTm=$FD61;
				runoutput();
			}"
		</ONCLICK>
	</ITEM>
</VARIABLE>

<!--RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="按任意键退出">
NOTHING
</PACKAGE>
	<PRINT>
	"{
			print(1,25, '1641 电子申报机构申报结果');
			print(2,3,'------------------------------------------------------------------------');
			print(3,3,'机构代码:[30]  机构名称:[20]',#OrgCode,#OrgName);
			print(5,3,'机构类型:[30]  机构级别:[20]','1',#OrgLvl);
			print(7,3,'开通业务种类列表:[22]  状态:[20]',#SvcClass,'1');
			//print(9,3,'启用日期:[30]  停用日期:[20]','20100102','20140203');
			print(11,3,'变更序号:[30]  变更类型:[20]',$FD75,'1');
			print(13,3,'申请时间:[30]',$FD61); 
	}"
	</PRINT>
</RESPONSE-->
</TRANSACTION>
