<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11000000" TITLE="8606      批量开户补打存折"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	initfd();
	$MSGTYPE='03001';
	dim @baktxno as string;
	@baktxno=$TXNO;
	$FD12='6606';
	$TXNO='9986';
	commsend_001();
     	$FD37=#ACTNO;
     	$FD58=#NOTENUM; 
        $FD92=#DWID;
        $FD25=#DWNAME;
        $FD63=#AGENTID;
        $FD116=getitems('#MDMTYPE');
     	callserver();
     	$TXNO=@baktxno;
     	if($FD12!='0000')
	{
		showmsg(geterror());
		return(false);
	}
	$FD16 = '6606';
  	$MSGTYPE='03001';
}"
</COMMSEND>
<COMMRECV>"{
commrecv_001();
}"
</COMMRECV>

<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-52s" FUNCTIONS=
    "T(8606                      批量开户补打存折（单笔）)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=6606)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  <ITEM LINE="7"    COL="10"   TYPE="%-10s" FUNCTIONS="T(单位编号:)"/>
  <ITEM LINE="8"    COL="10"   TYPE="%-10s" FUNCTIONS="T(单位户名:)"/> 
  <ITEM LINE="9"    COL="10"   TYPE="%-10s" FUNCTIONS="T(代理编号:)"/>
  <ITEM LINE="10"    COL="10"   TYPE="%-10s" FUNCTIONS="T(账    号:)"/>
  <ITEM LINE="11"    COL="10"   TYPE="%-10s" FUNCTIONS="T(户    名:)"/>
  <ITEM LINE="12"    COL="10"   TYPE="%-10s" FUNCTIONS="T(介质种类:!)" />
  <ITEM LINE="15"   COL="10"   TYPE="%-10s" FUNCTIONS="T(凭 证 号:)" /> 
  <ITEM LINE="7"   COL="21"  NAME="#DWID"        TYPE="%-4s"        INPUT="TEXT"    FUNCTIONS="">
  <ONLOSTFOCUS>
		"{
		    dim @txno_bak as string;
                @txno_bak=$TXNO;
		    $TXNO='9841';
		    $FD92=#DWID;
		    commsend_001();		
		    callserver();
		    if($FD12!='0000')
		    {
			    showmsg(geterror());
			    return(false);
		    }
		    $TXNO=@txno_bak;
		    #DWNAME=delspace($FD25);
		    enable(#DWNAME,false);
		   
		}"
  </ONLOSTFOCUS>
  </ITEM>
  
  <ITEM LINE="8"   COL="21"  NAME="#DWNAME"        TYPE="%-50s"        INPUT="TEXT"    FUNCTIONS=""/> 
  <ITEM LINE="9"  COL="21"  NAME="#AGENTID"     TYPE="%-20s"       INPUT="TEXT"  FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
		"{
		    dim @txno_bak as string;
        	    @txno_bak=$TXNO;
		    $TXNO='9876';
		    $FD92=#DWID;
		    $FD63=#AGENTID;
		    commsend_001();		
		    callserver();
		    if($FD12!='0000')
		    {
			    showmsg(geterror());
			    return(false);
		    }
		    $TXNO=@txno_bak;
		    #NAME=delspace($FD27);
		    #ACTNO=delspace($FD31);
		    show(#NAME,true);
		    show(#ACTNO,true);
		    enable(#NAME,false);
		    enable(#ACTNO,false);
		    
		}"
	</ONLOSTFOCUS>
  </ITEM>  
  <ITEM LINE="10"   COL="21"  NAME="#ACTNO"     TYPE="%-24s"     INPUT="TEXT"    FUNCTIONS=""/>
  
  <ITEM LINE="11"   COL="21"  NAME="#NAME"     TYPE="%-24s"     INPUT="TEXT"    FUNCTIONS=""/>
  <ITEM NAME="#AAAA" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
 	dim @txno_bak as string;
 	@txno_bak=$TXNO;
 	$TXNO='6700';
 	$FD30=#ACTNO;
 	$FD67='1';
 	commsend_001();
                      callserver();
                      if($FD12!='0000')
                      {
                                        showmsg(geterror());
                                        return(false);
                      }
                      $TXNO=@txno_bak;
                      #MDMTYPE=delspace($FD49);
                      #NOTENUM=delspace($FD58);
                      enable(#MDMTYPE,false);
                      enable(#NOTENUM,false);

  }"
  </ONLOSTFOCUS>
  </ITEM>    
  <ITEM LINE="12"   COL="21"  NAME="#MDMTYPE"      TYPE="%-4s"        INPUT="SELECT"  FUNCTIONS="T(0010)">
    <SELECT>
	   <OPTION VALUE ="0010" TITLE="0010.活期存折" />
       <OPTION VALUE ="0013" TITLE="0013.整整定期存单" />
      <!--
       <OPTION VALUE ="0011" TITLE="0011.零整存折" />
       <OPTION VALUE ="0012" TITLE="0012.贺卡定期存单" />
       <OPTION VALUE ="0015" TITLE="0015.储蓄定活两便存单" />
       <OPTION VALUE ="0016" TITLE="0016.定期一本通" />
     -->
    </SELECT>
  </ITEM>
  <ITEM LINE="15"   COL="21"   NAME="#NOTENUM"         TYPE="%16d"       INPUT="TEXT"  FUNCTIONS=""/>  
	 <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD"   TYPE="%-6s"    FUNCTIONS="T()"/>
  <ITEM NAME="#NAME1"   TYPE="%-20s"    FUNCTIONS="S(#MDMTYPE,#MDMTYPE)"/>
  <ITEM NAME="#YEAR"  TYPE="%-4s" FUNCTIONS="T($HDATE,1,4)"/>
  <ITEM NAME="#MON"   TYPE="%-2s" FUNCTIONS="T($HDATE,5,2)"/>
  <ITEM NAME="#DAY"   TYPE="%-2s" FUNCTIONS="T($HDATE,7,2)"/>
  <ITEM LINE="21"  COL="59" TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
  

</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE DEVICE="SCREEN"  DESC="批量开户补打存折"> 
 CZFY|@ac_no|@name|@cif_no|@sttl_type|@opn_date|@draw_type|@title|@brf|@tx_amt|@tel|@br_tele|@bal|
</PACKAGE>
<INIT>
"{
}"
</INIT>
<PRINT>
"{
print(4 ,20,'账 /卡号:  [24                       ]',@ac_no);
print(5 ,20,'客户名称:  [24                       ]',@name);
print(6 ,20,'客 户 号:  [24                       ]',@cif_no);
print(7 ,20,'结算类型:  [24                       ]',@sttl_type);
print(8 ,20,'开户日期:  [24                       ]',@opn_date);
print(9 ,20,'支取方式:  [24                       ]',@draw_type);
print(10,20,'产品描述:  [24                       ]',@title);
print(11,20,'交易金额:  [24                       ]',@tx_amt);
print(12,20,'操 作 员:  [24                       ]',@tel);
print(13,20,'电话号码:  [24                       ]',@br_tele);
print(14,20,'账户余额:  [24                       ]',@bal);


}"
</PRINT>
</RESPONSE>
<RESPONSE><!----开户时增加打印大额行号 20071120---->
<PACKAGE DEVICE="PRINTER"  LINESPACE="24" DESC="请打印存折首页"> 
CZFY|@ac_no|@name|@cif_no|@sttl_type|@opn_date|@draw_type|@title|@brf|@tx_amt|@tel|@br_tele|@bal|@cur_name|@rate|@br_name|@mbfebkno
</PACKAGE>
<INIT>
"{
	$KINDNO = '00';
}"
</INIT>
<PRINT>
"{
dim @txamt  as string;
dim @avbal  as string; //余额
dim @mtxamt as string; //月存金额
dim @tctd   as string; //通存通兑标志
//不用￥符号
@txamt=ltrim(comma(substr(@tx_amt,0,len(@tx_amt)-4),16));
@avbal=ltrim(comma(substr(@bal,0,len(@bal)-4),16));
if(len(@txamt)&lt;21)
{
	@txamt=space(21-len(@txamt))+@txamt;
}
if(@draw_type == '凭密支取' or @draw_type =='密码兼证件支取')
{
	@tctd = '通存通兑';
}
else
{
	@tctd = '        ';
}

@title = '活期'; //储种为活期

print( 0, 3,'\L0[8]    [13           ]\L1',@title,@ac_no);
print( 3,10,'\L0[20]\L1',@name);
print( 6,1,'支付行号:[12]',@mbfebkno);
print( 8,10,'[10]',@cif_no);
print( 9,10,'[30                            ]                [8]',@br_name,@opn_date);
print(10,10,'[30                            ]                [8]',$BRNAME,$HDATE);
print(11,10,'[20 ]',@draw_type);
print(23,10,'[10]',@cif_no);
print(24,10,'[30                            ]                [8]',@br_name,@opn_date);
print(25,10,'[30                            ]                [8]',$BRNAME,$HDATE);
print(26,10,'[20]',@draw_type);
}"
</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER"  LINESPACE="13" DESC="请翻页(储蓄存折第一笔)"> 
CZFY|@ac_no|@name|@cif_no|@sttl_type|@opn_date|@draw_type|@title|@brf|@tx_amt|@tel|@br_tele|@bal|@cur_name|@rate|@br_name|@mbfebkno
</PACKAGE>
<INIT>
"{
	$KINDNO = '00';
}"
</INIT>
<PRINT>
"{
dim @txamt  as string;
dim @avbal  as string; //余额
dim @mtxamt as string; //月存金额
dim @tctd   as string; //通存通兑标志
//不用￥符号
@txamt=ltrim(comma(substr(@tx_amt,0,len(@tx_amt)-4),16));
@avbal=ltrim(comma(substr(@bal,0,len(@bal)-4),16));
if(len(@txamt)&lt;21)
{
	@txamt=space(21-len(@txamt))+@txamt;
}

print(6, 0,'[10        ] [4   ]                   [15             ][15            ] [4   ]',substr(@opn_date,0,4)+'/'+substr(@opn_date,4,2)+'/'+substr(@opn_date,6,2),@brf,substr(@txamt,6,15),substr(@txamt,6,15),@tel);
}"
</PRINT>
</RESPONSE>
<LASTWORK>
"{
	showmsg('请按任意键刷存折...');
	writemsr(#ACTNO,'');
}"
</LASTWORK>

</TRANSACTION>
