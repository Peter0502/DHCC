<?xml version="1.0"  encoding="GBK" ?>
<TRANSACTION RIGHTS="11111111011100000000000001100010" TITLE="供热缴费"
xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<VARIABLE>
	<ITEM LINE="3" COL="3"   TYPE="%-70s"    FUNCTIONS="T(9931                            供热缴费)"/>
	<ITEM LINE="4" COL="3"   TYPE="%-70s"    FUNCTIONS="T(────────────────────────────────────────)"/>
  <ITEM NAME="#TXNO"       TYPE="%-4s"     FUNCTIONS="T($TXNO=1100)"/>
  <ITEM NAME="#MSGTYPE"    TYPE="%-5s"     FUNCTIONS="T($MSGTYPE=03001)"/>
	<ITEM LINE="5"   COL="3" TYPE="%-12s"    FUNCTIONS="T(用  户  号:)"/>
	 
  <ITEM LINE="5"   COL="15" NAME="#USR_NO" INPUT="TEXT" TYPE="%-20s"  FUNCTIONS="T()V(NB)">
   <ONLOSTFOCUS>
  "{
    if(#USR_NO==''){
		showmsg('用户号不能为空!');
		 return(false);
	  }
	  initfd();
	  commsend_001();
	  $FD16='1100';
	  $FD30=#USR_NO;  
	  $FD60='RYGR';
		callagnpt();
		if($FD12!='0000')
		{
			showmsg($FD13);
			return(false);
		}
		#YHNAME=$FD25;
		#ADDRESS=$FD26;
		#YEAR=$FD34;
		#MONTH=$FD35;
		#FWMJ=val($FD84);
		#MJDJ=val($FD85);
		#MJYS=val($FD97);
		#JLDJ=val($FD94);
		#JLYL=val($FD39);
		#JLYS=val($FD40);
		#YSBJ=val($FD41);
		#JMJE=val($FD42);
		#YHJE=val($FD43);
		#AMT=val($FD44);
		#BZ=$FD27;
		show(#YHNAME,true);
		show(#ADDRESS,true);
		show(#YEAR,true);
		show(#MONTH,true);
		show(#FWMJ,true);
		show(#MJDJ,true);
		show(#MJYS,true);
		show(#JLDJ,true);
		show(#JLYL,true);
		show(#JLYS,true);
		show(#YSBJ,true);
		show(#JMJE,true);
		show(#YHJE,true);
		show(#AMT,true);
		show(#BZ,true);
		enable(#YHNAME,false);
		enable(#ADDRESS,false);
		enable(#YEAR,false);
		enable(#MONTH,false);
		enable(#FWMJ,false);
		enable(#MJDJ,false);
		enable(#MJYS,false);
		enable(#JLDJ,false);
		enable(#JLYL,false);
		enable(#JLYS,false);
		enable(#YSBJ,false);
		enable(#JMJE,false);
		enable(#YHJE,false);
		enable(#AMT,false);
		enable(#BZ,false);	
		
		
	}"
  </ONLOSTFOCUS>
  </ITEM>
  <PAGE NAME="DEFAULT">	
  <ITEM LINE="5" COL="41"  TYPE="%-12s"    FUNCTIONS="T(用  户  名:)"/>	
  <ITEM LINE="5" COL="53"  TYPE="%-10s"    NAME="#YHNAME"    INPUT="TEXT"  FUNCTIONS="T()"/>
	<ITEM LINE="6"  COL="3"  TYPE="%-12s"    FUNCTIONS="T(地       址:)"/>	
	<ITEM LINE="6"  COL="15" TYPE="%-60s"    NAME="#ADDRESS"    INPUT="TEXT"  FUNCTIONS="T()"/>
	<ITEM LINE="7"  COL="3"  TYPE="%-12s"    FUNCTIONS="T(年       度:)"/>	
	<ITEM LINE="7"  COL="15" TYPE="%-20s"    NAME="#YEAR"  INPUT="TEXT"    FUNCTIONS="T()"/>
	<ITEM LINE="7"  COL="41" TYPE="%-12s"    FUNCTIONS="T(月       数:)"/>	
	<ITEM LINE="7"  COL="53" TYPE="%-10s"    NAME="#MONTH"    INPUT="TEXT"  FUNCTIONS="T()"/>
	<ITEM LINE="8"  COL="3"  TYPE="%-12s"    FUNCTIONS="T(房 屋 面 积:)"/>	
	<ITEM LINE="8"  COL="15" TYPE="%-16.2f"  NAME="#FWMJ"  INPUT="TEXT"  FUNCTIONS="V(0000000000000001,9999999999999999)"/>
	<ITEM LINE="9"  COL="3"  TYPE="%-12s"    FUNCTIONS="T(面 积 单 价:)"/>	
	<ITEM LINE="9"  COL="15" TYPE="%-16.2f"  NAME="#MJDJ"  INPUT="TEXT"  FUNCTIONS="V(0000000000000001,9999999999999999)"/>
	<ITEM LINE="9"  COL="41"  TYPE="%-12s"   FUNCTIONS="T(面 积 应 收:)"/>	
	<ITEM LINE="9"  COL="53" TYPE="%-16.2f"  NAME="#MJYS"  INPUT="TEXT"  FUNCTIONS="V(0000000000000001,9999999999999999)"/>
	<ITEM LINE="10"  COL="3" TYPE="%-12s"    FUNCTIONS="T(计 量 用 量:)"/>	
	<ITEM LINE="10"  COL="15" TYPE="%-16.2f" NAME="#JLYL"  INPUT="TEXT"   FUNCTIONS="V(0000000000000001,9999999999999999)"/>
	<ITEM LINE="10"  COL="41" TYPE="%-12s"   FUNCTIONS="T(计 量 单 价:)"/>	
	<ITEM LINE="10"  COL="53" TYPE="%-16.3f" NAME="#JLDJ"  INPUT="TEXT"   FUNCTIONS="V(0000000000000001,9999999999999999)"/>		
	<ITEM LINE="11" COL="3"  TYPE="%-12s"    FUNCTIONS="T(计 量 应 收:)"/>	
	<ITEM LINE="11" COL="15" TYPE="%-16.2f"  NAME="#JLYS"  INPUT="TEXT"    FUNCTIONS="V(0000000000000001,9999999999999999)"/>
	<ITEM LINE="11" COL="41"  TYPE="%-12s"   FUNCTIONS="T(应 收 本 金:)"/>	
	<ITEM LINE="11" COL="53" TYPE="%-16.2f"  NAME="#YSBJ" INPUT="TEXT"  FUNCTIONS="V(0000000000000001,9999999999999999)"/>
	<ITEM LINE="12" COL="3"  TYPE="%-12s"    FUNCTIONS="T(减 免 金 额:)"/>	
	<ITEM LINE="12" COL="15" TYPE="%-16.2f"  NAME="#JMJE" INPUT="TEXT"  FUNCTIONS="V(0000000000000001,9999999999999999)"/>
	<ITEM LINE="12" COL="41"  TYPE="%-12s"   FUNCTIONS="T(优 惠 金 额:)"/>	
	<ITEM LINE="12" COL="53" TYPE="%-16.2f"  NAME="#YHJE" INPUT="TEXT"  FUNCTIONS="V(0000000000000001,9999999999999999)"/>
	<ITEM LINE="13" COL="3"  TYPE="%-12s"    FUNCTIONS="T(应 收 金 额:)"/>	
	<ITEM LINE="13" COL="15" TYPE="%-16.2f"  NAME="#AMT" INPUT="TEXT" FUNCTIONS="V(0000000000000001,9999999999999999)"/>		
	<ITEM LINE="14" COL="3"  TYPE="%-12s"    FUNCTIONS="T(备       注:)"/>	
	<ITEM LINE="14" COL="15" TYPE="%-60s"    NAME="#BZ"  INPUT="TEXT"  FUNCTIONS="T()"/>
	<ITEM LINE="15" COL="3" TYPE="%-12s"     FUNCTIONS="T(缴 款 方 式:)"/>	
	<ITEM LINE="15" COL="15" TYPE="%-8s"     NAME="#JKFS"     INPUT="SELECT" FUNCTIONS="T(1)V(NB)">
		<SELECT>
				<OPTION VALUE="1" TITLE="1.现金"/>
				<OPTION VALUE="2" TITLE="2.转账"/>	
		</SELECT>
	<ONLOSTFOCUS>
	"{
		 if(#JKFS=='2')
     {
        show(#LDQFS,true);
        show(#DQFS,true);
        show(#LACTNO,true);
        show(#LMM,true);
        show(#DRAW_PWD,true);
      }
      else
      {
        show(#LDQFS,false);
        show(#DQFS,false);
        show(#LACTNO,false);
        show(#LMM,false);
        show(#DRAW_PWD,false);
        show(#LACNAME,false);
        show(#AC_NAME,false);
        show(#LACBAL,false);
        show(#AC_BAL,false);
        show(#ACTNO1,false);
        show(#ACTNO2,false);
      }
	}"
	</ONLOSTFOCUS>
  </ITEM>		
	<ITEM LINE="15" COL="41" TYPE="%-10s" NAME="#LDQFS" VISABLE="FALSE"  INPUT="LABEL"  FUNCTIONS="T(读取方式: )"/>
  <ITEM LINE="15" COL="50" TYPE="%-1s"  NAME="#DQFS"  VISABLE="FALSE"  INPUT="SELECT" FUNCTIONS="V(NB)T(1)">
    <SELECT>
      <OPTION VALUE="0" TITLE="读取磁条方式"/>
      <OPTION VALUE="1" TITLE="读取芯片方式"/>
    </SELECT>
    <ONLOSTFOCUS>"{
      if(#DQFS=='1')
      {
        enable(#ACTNO1,false);
        enable(#ACTNO2,true);
        show(#ACTNO1,false);
        show(#ACTNO2,true);
      }
      if(#DQFS=='0')
      {
        enable(#ACTNO1,true);
        enable(#ACTNO2,false);
        show(#ACTNO1,true);
        show(#ACTNO2,false);
      }
      refresh();
    }"
    </ONLOSTFOCUS>
  </ITEM>
   <ITEM LINE="16"  COL="3" NAME="#LACTNO" TYPE="%-10s"  VISABLE="FALSE" INPUT="LABEL"  FUNCTIONS="T(支付账号:)" />

  <ITEM NAME="#MSR2BAK" TYPE="%-37s"   FUNCTIONS=""/>
  <ITEM NAME="#MSR3BAK" TYPE="%-104s"  FUNCTIONS=""/>
  <ITEM LINE="16" COL="15" TYPE="%-19s"  NAME="#ACTNO1" DEVICE="FIXMSR" INPUT="TEXT" FUNCTIONS="V(NB)M($MSR2,1)" VISABLE="FALSE" >
    <ONLOSTFOCUS>
    "{
      #AC_NO=#ACTNO1;
    }"
    </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="16" COL="15" TYPE="%-19s"  NAME="#ACTNO2" DEVICE="FIXICC" INPUT="TEXT" FUNCTIONS="V(NB)M($MSR2,1)" VISABLE="FALSE">
    <ONLOSTFOCUS>
    "{
      #AC_NO=#ACTNO2;
    }"
    </ONLOSTFOCUS>
  </ITEM>

  <ITEM NAME="#AC_NO"  TYPE="%-19s"  FUNCTIONS="" >
    <ONLOSTFOCUS>
    "{
      //IC卡bin=621780  ,磁条卡bin=621223
      dim @baktxno as string;
      #MSR2BAK=$MSR2;
      #MSR3BAK=$MSR3;
      $MSR2='';
      $MSR3='';
      //showmsg('#MSR2='+#MSR2);
      //showmsg('#MSR3='+#MSR3);
    }"
    </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="16" COL="41" NAME="#LMM" TYPE="%-10s" INPUT="LABEL"  VISABLE="FALSE" FUNCTIONS="T(密    码:)"/>
  <ITEM LINE="16" COL="50" NAME="#DRAW_PWD" TYPE="%6d" VISABLE="FALSE" INPUT="TEXT" DEVICE="PINPAD" FUNCTIONS="V(NB)i()">
    <ONLOSTFOCUS>
    "{
      if(substr(#AC_NO,0,6)!='621223' and substr(#AC_NO,0,6)!='621780')  //存折验密
      {
        dim @baktxno as string;
        @baktxno=$TXNO;
        $TXNO='9317';
        commsend_001();
        $FD30=#AC_NO;
        $FD79=getitems('#DRAW_PWD');
        callserver();
        $TXNO=@baktxno;
        if($FD12!='0000'){
          showmsg(geterror());
          return (false);
        }
      }
      else if(substr(#AC_NO,0,6) == '621223' or substr(#AC_NO,0,6)=='621780')  //卡验密
      {
        initfd();
        commsend_001();
        $FD16='7007';         //卡验密接口
        $FD30=#AC_NO;         //签约卡号
        $FD68='4';
        $FD79=#DRAW_PWD;      //卡密码
        callagn();
        if( $FD12 != '0000')
        {
          showmsg(geterror());
          return(false);
        }
      }

      show(#LACNAME,true);
      show(#AC_NAME,true);
      show(#LACBAL,true);
      show(#AC_BAL,true);

      //核心查询已签约卡户名及余额
      dim @info as string;
      dim @tmpacid as string;
      #AC_NAME='';
      #AC_BAL='';
      #OPN_BR_NO='';
      refresh();

      initfd();
      commsend_001();
      $FD16='9598';
      $FD123='select ac_id, opn_br_no  from mdm_ac_rel where ac_no='+chr(39)+#AC_NO+chr(39);
      @info=callserver();
      if($FD12!='0000')
      {
          showmsg(geterror());
          return(false);
      }
      if(@info=='')
      {
          showmsg('账号不存在,请核对后重新输入!!');
          return(false);
      }
      @tmpacid=delspace(strfld(@info,'|',0));
      #OPN_BR_NO=delspace(strfld(@info,'|',1));

      initfd();
      commsend_001();
      $FD16='9598';
      @info='';
      $FD123='select name, bal from dd_mst where ac_id='+chr(39)+@tmpacid+chr(39);
      @info=callserver();
      if($FD12!='0000')
      {
          showmsg(geterror());
          return(false);
      }
      #AC_NAME=delspace(strfld(@info,'|',0));
      #AC_BAL=delspace(strfld(@info,'|',1));
    }"
    </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="17" COL="3"  NAME="#LACNAME" VISABLE="FALSE"  INPUT="LABEL"  TYPE="%-10s" FUNCTIONS="T(户    名:)" />
  <ITEM LINE="17" COL="15" NAME="#AC_NAME" VISABLE="FALSE"  INPUT="LABEL"  TYPE="%-60s" FUNCTIONS="V(NB)"/>
  <ITEM LINE="17" COL="41" NAME="#LACBAL"  VISABLE="FALSE"  INPUT="LABEL"  TYPE="%-10s" FUNCTIONS="T(余    额:)" />
  <ITEM LINE="17" COL="50" NAME="#AC_BAL"  VISABLE="FALSE"  INPUT="LABEL"  TYPE="%-18s" FUNCTIONS="V(NB)"/>
	

  <ITEM LINE="20"  COL="3"  NAME="#HEDUI2"  TYPE ="%-20s" FUNCTIONS = "T(是 否 缴 款:!)"/>	 
  <ITEM LINE="20"  COL="15"  NAME="#HEDUI3"  TYPE="%-1s"   INPUT="SELECT"   FUNCTIONS="T(0)V(NB)" >
	  <SELECT>
			<OPTION VALUE ="0" TITLE="0.是" />
			<OPTION VALUE ="1" TITLE="1.否" />
	  </SELECT>
	  <ONLOSTFOCUS>
    "{
       if(#HEDUI3=='0')
       {
         showmsg('开始缴款！');
       }
       else
       {
         showmsg('退出缴款！');
         rerun();
  			 return(false);
       }
	  }"
		</ONLOSTFOCUS>
  </ITEM> 
 </PAGE>
 

 <ITEM  NAME="#BTN" LINE="21"  COL="63" TYPE="%-6s"    FUNCTIONS="T(确  定)" INPUT="BUTTON">
	<ONCLICK>"{
	
	initfd();
	commsend_001();
	$FD16='1200';
	$FD60='RYGR';
	$FD30=#USR_NO;
	$FD25=#YHNAME;
	$FD26=#ADDRESS;
	$FD34=#YEAR;
	$FD35=#MONTH;
	$FD84=itoa(#FWMJ,'%-6.2f');
	      
	$FD85=itoa(#MJDJ,'%-.2f');                            
	$FD97=itoa(#MJYS,'%-10.2f');
	$FD94=itoa(#JLDJ,'%-10.2f');
	$FD39=itoa(#JLYL,'%-5.3f');
	$FD40=itoa(#JLYS,'%-10.2f');
	$FD41=itoa(#YSBJ,'%-10.2f');
	$FD42=itoa(#JMJE,'%-10.2f');
	$FD43=itoa(#YHJE,'%-10.2f');
	$FD44=itoa(#AMT,'%-10.2f');
	$FD27=#BZ;
	$FD67='1';
	$FD68=#JKFS;
	$FD31=#AC_NO;                        //支付账号
  $FD33=#AC_NAME;                      //户名
  $FD79=#DRAW_PWD;                     //密码
	
	callagnpt();	
	if($FD12!='0000'){
		showmsg(geterror());
		rerun();
		return(false);
	}	
	
	#YHNAME_2=$FD25;											   
	#ADDRESS_2=$FD26;                     
	#YEAR_2=$FD34;                        
	#MONTH_2=$FD35;                       
	#FWMJ_2=val($FD84);                      
	#MJDJ_2=val($FD85);                   
	#MJYS_2=val($FD97);                   
	#JLDJ_2=val($FD94);                   
	#JLYL_2=val($FD39);                   
	#JLYS_2=val($FD40);                   
	#YSBJ_2=val($FD41);                   
	#JMJE_2=val($FD42);                   
	#YHJE_2=val($FD43);                   
	#AMT_2=val($FD44);                    
	#BZ_2=$FD27;                          
	
	#TRACE_NO=$FD31;											
	
	runoutput();                           
	rerun();
  }"
  </ONCLICK>
 </ITEM>
	<ITEM NAME="#USR_NO_2"    TYPE="%-20s"  FUNCTIONS="T(#USR_NO)"/> 				
	<ITEM NAME="#YHNAME_2"    TYPE="%-50s"  FUNCTIONS=""/>              		
	<ITEM NAME="#ADDRESS_2"    TYPE="%-50s" FUNCTIONS=""/>           					
 	<ITEM NAME="#YEAR_2"    TYPE="%-4s"  		FUNCTIONS=""/>                    
 	<ITEM NAME="#FWMJ_2"    TYPE="%-12.2f"  FUNCTIONS=""/> 										
 	<ITEM NAME="#MONTH_2"    TYPE="%-2s"  	FUNCTIONS=""/> 									
 	<ITEM NAME="#MJDJ_2"    TYPE="%-12.2f"  FUNCTIONS=""/> 										
 	<ITEM NAME="#MJYS_2"    TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#JLYL_2"    TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#JLDJ_2"    TYPE="%-12.3f"  FUNCTIONS=""/> 										
	<ITEM NAME="#JLYS_2"    TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#YSBJ_2"    TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#JMJE_2"    TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#YHJE_2"    TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#AMT_2"    TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#BZ_2"    TYPE="%-60s"  FUNCTIONS=""/>    										
	<ITEM NAME="#TRACE_NO"    TYPE="%-24s"  FUNCTIONS=""/>    								

</VARIABLE>


<REQUEST>
	<PACKAGE DEVICE="SCREEN"  DESC="银行向瑞阳供热公司提交单笔缴款成功">
       NOTHING
  </PACKAGE>
  <PRINT>
   "{
    }"
  </PRINT>
</REQUEST>

<RESPONSE>
  <PACKAGE DEVICE="SCREEN" DESC="显示内容">
   NOTHING
  </PACKAGE>
  <PRINT>
  	"{
			print(3,20,'晋中银行瑞阳供热缴款凭条');
		  print(5,6,'机构:[12]  柜员:[12]  用户号:[24]',$FD3,$FD7,#USR_NO); 
		  print(6,6,'日期:[8]  平台流水:[20]',$FD5,#TRACE_NO);
			print(7,6,'用户名:[60]',#YHNAME_2); 
			print(8,6,'用户住址:[60]',#ADDRESS_2); 
			print(9,6,'缴款年份:[16]  缴款月数:[4]',#YEAR_2,#MONTH_2);
			print(10,6,'房屋面积:[16]  面积单价:[16]',delspace(comma(itoa(#FWMJ_2,'%.2f'))),delspace(comma(itoa(#MJDJ_2,'%.2f'))));
			print(11,6,'计量用量:[16]  计量单价:[16]',delspace(comma(itoa(#JLYL_2,'%.2f'))),delspace(comma(itoa(#JLDJ_2,'%.3f'))));
			print(12,6,'面积应收:[16]  计量应收:[16]',delspace(comma(itoa(#MJYS_2,'%.2f'))),delspace(comma(itoa(#JLYS_2,'%.2f'))));
			print(13,6,'应收本金:[16]',delspace(comma(itoa(#YSBJ_2,'%.2f')))); 
			print(14,6,'减免金额:[16]  优惠金额:[16]',delspace(comma(itoa(#JMJE,'%.2f'))),delspace(comma(itoa(#YHJE,'%.2f'))));
			print(15,6,'实收金额:[16]',delspace(comma(itoa(#AMT_2,'%.2f'))));
			print(16,6,'备注:[60]',#BZ_2);
		
     }"
	</PRINT>
</RESPONSE>
<RESPONSE>
  <PACKAGE DEVICE="PRINTER" LINESPACE="22" DESC="请打印业务专用凭证"> 
    NOTHING
  </PACKAGE> 
  <PRINT>
   "{
			print(3,20,'晋中银行瑞阳供热缴款凭条');
	    print(5,6,'机构:[12]  柜员:[12]  用户号:[24]',$FD3,$FD7,#USR_NO); 
	    print(6,6,'日期:[8]  平台流水:[20]',$FD5,#TRACE_NO);
			print(7,6,'用户名:[60]',#YHNAME_2); 
			print(8,6,'用户住址:[60]',#ADDRESS_2); 
			print(9,6,'缴款年份:[16]  缴款月数:[4]',#YEAR_2,#MONTH_2);
			print(10,6,'房屋面积:[16]  面积单价:[16]',delspace(comma(itoa(#FWMJ_2,'%.2f'))),delspace(comma(itoa(#MJDJ_2,'%.2f'))));
			print(11,6,'计量用量:[16]  计量单价:[16]',delspace(comma(itoa(#JLYL_2,'%.2f'))),delspace(comma(itoa(#JLDJ_2,'%.2f'))));
			print(12,6,'面积应收:[16]  计量应收:[16]',delspace(comma(itoa(#MJYS_2,'%.2f'))),delspace(comma(itoa(#JLYS_2,'%.2f'))));
			print(13,6,'应收本金:[16]',delspace(comma(itoa(#YSBJ_2,'%.2f')))); 
			print(14,6,'减免金额:[16]  优惠金额:[16]',delspace(comma(itoa(#JMJE,'%.2f'))),delspace(comma(itoa(#YHJE,'%.2f'))));
			print(15,6,'实收金额:[16]',delspace(comma(itoa(#AMT_2,'%.2f'))));
			print(16,6,'备注:[60]',#BZ_2);
    }"
  </PRINT>
</RESPONSE>

<OUTPUT>
</OUTPUT>
</TRANSACTION>
