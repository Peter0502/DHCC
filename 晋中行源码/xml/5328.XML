<TRANSACTION RIGHTS="11110000" TITLE="5328 小额实时信息录入"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
  commsend_001();
	$FD3 =$KINBR;
	$FD44=$HDATE;
	$FD20='1';
	$FD7=$TLRNO;
	lvsend_123();
}"
</COMMSEND>
<COMMRECV>"{
    commrecv_001();
    lvrecv_123();
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-54s" FUNCTIONS=
    "T(5328                         小额账户查询录入)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(------------------------------------------------------------------------------------------)"/>
  <ITEM NAME="#TXNO" 	TYPE="%-4s" FUNCTIONS="T($TXNO=5868)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  <ITEM LINE="5"  COL="3"   TYPE="%-9s" FUNCTIONS="T(接收行号:)"/>
  <ITEM LINE="7" COL="3" TYPE="%-16s"  FUNCTIONS="T(帐号类型:)"/>
  <ITEM LINE="9" COL="3" TYPE="%-16s"  FUNCTIONS="T(帐    号:)"/>
  <ITEM LINE="11" COL="3" TYPE="%-16s" FUNCTIONS="T(密码算法:)"/>
  <ITEM LINE="13" COL="3" TYPE="%-16s" FUNCTIONS="T(密    码:)"/>
  <ITEM LINE="15" COL="3" TYPE="%-16s" FUNCTIONS="T(查询类型:!)"/>
  <ITEM LINE="17" COL="3" TYPE="%-9s"  FUNCTIONS="T(查询附言:)"/>
  <ITEM NAME="#STEP"   		TYPE="%1d"	FUNCTIONS="T(0)"/><!--0查询,1应答-->
 
  <ITEM NAME="#CRDB"   		TYPE="%1d"	FUNCTIONS="T(1)"/>
  <ITEM NAME="#OPCD"		TYPE="%2d"	FUNCTIONS="T(10)"/>
  <ITEM NAME="#PKGNO"		TYPE="%3d"	FUNCTIONS="T(013)"/>
  <ITEM NAME="#ORDERNO"		TYPE="%8d"	FUNCTIONS="T()"/>    <!--交易序号-->
  <ITEM NAME="#OR_BR_NO"	TYPE="%-12s"    FUNCTIONS="T()"/>    <!--发起行行号-->
  <ITEM NAME="#TX_AMT"		TYPE="%15s"     FUNCTIONS="T()"/>    <!--交易金额--->
  <ITEM NAME="#PAY_OPN_BR_NO"   TYPE="%-12s"    FUNCTIONS="T()"/>    <!--付款人开户行   ---->
  <ITEM NAME="#PAY_QS_NO"	TYPE="%-12s"    FUNCTIONS="T()"/>    <!--付款清算行行号 ---->
  <ITEM NAME="#PAY_AC_NO"       TYPE="%-32s"    FUNCTIONS="T()"/>    <!--付款帐号 ---->
  <ITEM NAME="#PAY_NAME"	TYPE="%-60s"    FUNCTIONS="T()"/>    <!--付款人名称 ---->
  <ITEM NAME="#PAY_ADDR"	TYPE="%-60s"    FUNCTIONS="T()"/>    <!--付款人地址     ---->
  <ITEM NAME="#PWD"		TYPE="%-8s"     FUNCTIONS="T()"/>    <!--支取密码-->
  <ITEM NAME="#CASH_QS_NO"	TYPE="%-12s"    FUNCTIONS="T()"/>    <!--收款清算行行号 ---->
  <ITEM NAME="#CASH_OPN_BR_NO"	TYPE="%-12s"    FUNCTIONS="T()"/>    <!--收款人开户行   ---->
  <ITEM NAME="#CASH_AC_NO"	TYPE="%-32s"    FUNCTIONS="T()"/>    <!--收款帐号 ---->
  <ITEM NAME="#CASH_NAME" 	TYPE="%-60s"    FUNCTIONS="T()"/>    <!--收款人名称 ---->
  <ITEM NAME="#CASH_ADDR"	TYPE="%-60s"    FUNCTIONS="T()"/>    <!--收款人地址  ---->
  <ITEM NAME="#YW_TYPE"		TYPE="%-12s"    FUNCTIONS="T()"/>    <!--业务描述-->
  <ITEM NAME="#BRF"		TYPE="%-60s"    FUNCTIONS=""/>       <!--附言--->
  <ITEM NAME="#WT_DATE"		TYPE="%-8s"      FUNCTIONS="T($HDATE)"/> <!--委托日期-->
  <ITEM NAME="#OPERLEVEL"	TYPE="%-1s"     FUNCTIONS="T()"/>    <!--优先级---->
  <ITEM NAME="#AUTH_TEL"	TYPE="%-6s"     FUNCTIONS="T()"/>    <!--授权操作员号   ---->
  <ITEM NAME="#AUTH_PWD"	TYPE="%-8s"     FUNCTIONS="T()"/>    <!--授权操作员密码 ---->
  <ITEM NAME="#NOTE_TYPE"	TYPE="%-2s"     FUNCTIONS="T()"/>    <!--凭证种类---->
  <ITEM NAME="#NOTE_NO"		TYPE="%-12s"    FUNCTIONS="T()"/>    <!--凭证号码---->
  <ITEM NAME="#PACK_DATE"	TYPE="%-8s"     FUNCTIONS="T()"/>    <!--包日期,定期用  ---->
  <ITEM NAME="#PACK_ID"		TYPE="%-8s"     FUNCTIONS="T()"/>    <!--包id,定期用    ---->
  <ITEM NAME="#CHRG_IND"	TYPE="%-1s"     FUNCTIONS="T()"/>    <!--手续费标志     ---->
  <ITEM NAME="#CHRG_AMT"        TYPE="%-15s"    FUNCTIONS="T()"/>    <!--手续费金额     ---->
  <ITEM NAME="#RESP_DAY"	TYPE="%-8s"     FUNCTIONS="T()"/>    <!--期待应答日期  ---->
  <ITEM NAME="#PO_TYPE"		TYPE="%-2s"     FUNCTIONS="T()"/>    <!--票据类型     ---->
  <ITEM NAME="#PO_DATE"		TYPE="%-8s"     FUNCTIONS="T()"/>    <!--票据日期     ---->
  <ITEM NAME="#PO_NUM"		TYPE="%-8s"     FUNCTIONS="T()"/>    <!--票据号码     ---->
  <ITEM NAME="#PC_TX_AMT"	TYPE="%-15s"  FUNCTIONS="T()"/>    <!--赔偿金额---->
  <ITEM NAME="#JF_TX_AMT"	TYPE="%-15s"  FUNCTIONS="T()"/>    <!--拒付金额---->
  <ITEM NAME="#O_WT_DATE"	TYPE="%-8s"     FUNCTIONS="T()"/>    <!--原委托日期    ---->
  <ITEM NAME="#O_TXNUM"		TYPE="%-5s"     FUNCTIONS="T()"/>    <!--原业务编号    ---->
  <ITEM NAME="#O_ORDERNO"	TYPE="%-8s"     FUNCTIONS="T()"/>    <!--原支付交易序号---->
  <ITEM NAME="#RET_CODE"	TYPE="%-2s"     FUNCTIONS="T()"/>    <!--退汇原因代码  ---->
  <ITEM NAME="#RCP_STS"		TYPE="%-2s"     FUNCTIONS="T()"/>    <!--业务回执状态  ---->
  <ITEM NAME="#RESP1"		TYPE="%-8s"     FUNCTIONS="T()"/>    <!--Mbfe应答码    ---->
  <ITEM NAME="#RESP2"		TYPE="%-8s"     FUNCTIONS="T()"/>    <!--Ccpc应答码    ---->
  <ITEM NAME="#PACK_END"	TYPE="%-1s"     FUNCTIONS="T()"/>    <!--包结束标志    ---->
  <ITEM NAME="#LV_STS"		TYPE="%-1s"     FUNCTIONS="T()"/>    <!--交易状态      ---->
  <ITEM NAME="#DFXYNO"		TYPE="%-60s"    FUNCTIONS="T()"/>    <!--多方协议号-->
  <ITEM NAME="#LW_IND"		TYPE="%-1s"    FUNCTIONS="T(1)"/>    <!--多方协议号-->
  <ITEM NAME="#OORBRNO"     	TYPE="%-12s"   	FUNCTIONS="T()"/>	<!--原发起行行号 -->
  <ITEM NAME="#OACBRNO"      	TYPE="%-12s"   	FUNCTIONS=""/>		<!--原接收行行号-->

  <ITEM LINE="5" COL="13" NAME="#AC_BR_NO" TYPE="%-12s"   DEVICE="KEYBOARD" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
  "{
  	
    
    $FD32=#AC_BR_NO;
    commsend_001();
    $FD16='9553';
    callserver();
    if($FD12!='0000'){
    	showmsg(geterror());
    	return(false); 
    }
    showhelp(3,70,8,3,'支付系统行名信息',substr($FD96,0,60));
  	}"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#TXNUM"   TYPE="%-5s" FUNCTIONS="T(30502)"/>


  <ITEM LINE="7" COL="13" TYPE="%-1s"  NAME = "#ADD_ACTTYPE"  INPUT="SELECT"	FUNCTIONS="T(0)"> 
  <SELECT>
	<OPTION VALUE="0" TITLE="0.银行帐号"/>
	<OPTION VALUE="1" TITLE="1.贷记卡"/>
	<OPTION VALUE="2" TITLE="2.借记卡"/>
	<OPTION VALUE="9" TITLE="9.其他"/>
  </SELECT>
  </ITEM>
  <ITEM LINE="9" COL="13" TYPE="%-32s"  NAME = "#ADD_AC_NO"  INPUT="TEXT" 		FUNCTIONS="T()V(NB)"/>
  <ITEM LINE="11" COL="13" TYPE="%2d"  NAME="#ADD_PSWDMETHOD" INPUT="SELECT"   DEVICE="KEYBOARD"	FUNCTIONS="T(01)">
	<SELECT>
            <OPTION VALUE="01" TITLE="01.客户密码"/>
            <OPTION VALUE="02" TITLE="02.支付密码单密码"/>
			<OPTION VALUE="03" TITLE="03.支付密码器密码"/>
			<OPTION VALUE="04" TITLE="04.授权码"/>
			<OPTION VALUE="05" TITLE="05.其他"/>
		</SELECT>
	</ITEM>                  
  <ITEM LINE="13" COL="13" TYPE="%6d"  NAME = "#ADD_PSWD"  INPUT="TEXT" DEVICE="PINPAD" FUNCTIONS="i()T()V(NB)"/>
  <ITEM LINE="15" COL="13" TYPE="%-1s"  INPUT="SELECT"  NAME = "#QRYTYPE"  DEVICE="KEYBOARD"		FUNCTIONS="T(1)V(NB)">
		<SELECT>
				<OPTION VALUE="1" TITLE="1.查询余额"/>
				<OPTION VALUE="2" TITLE="2.查询帐户状态"/>
		</SELECT>
	</ITEM>
  <ITEM LINE="17" COL="13" TYPE="%-60s" NAME = "#ADD_CONTENT"     DEVICE="KEYBOARD" 	FUNCTIONS="T()"/>

  <ITEM NAME="#PRINT_1" TYPE="%-78s" FUNCTIONS=""/>
  <ITEM NAME="#PRINT_2" TYPE="%-78s" FUNCTIONS=""/>
  <ITEM NAME="#PRINT_3" TYPE="%-78s" FUNCTIONS=""/>
  <ITEM NAME="#PRINT_4" TYPE="%-78s" FUNCTIONS=""/>
  <ITEM NAME="#PRINT_5" TYPE="%-78s" FUNCTIONS=""/>
  <ITEM NAME="#PRINT_6" TYPE="%-78s" FUNCTIONS=""/>
  <ITEM NAME="#ADD_RESULT" TYPE="%-1s" FUNCTIONS="J(#UADD_RESULT)"/><!--查询结果-->
  <ITEM NAME="#ADD_AC_STS" TYPE="%-2s" FUNCTIONS="J(#UADD_AC_STS)"/><!--账户状态-->
  <ITEM NAME="#ADD_AC_BAL" TYPE="%-15s" FUNCTIONS=""/><!--余额-->
  <ITEM NAME="#UADD_RESULT"  TYPE="%-10s" FUNCTIONS="T(其他)j(#ADD_RESULT=0,T{成功})j(#ADD_RESULT=1,T{账户不存在})j(#ADD_RESULT=2,T{密码错误})j(#ADD_RESULT=3,T{禁止查询})"/>
  <ITEM NAME="#UADD_AC_STS"  TYPE="%-4s" FUNCTIONS="T()j(#ADD_AC_STS=00,T{正常})j(#ADD_AC_STS=01,T{冻结})j(#ADD_AC_STS=99,T{其他})"/>
  
  <ITEM LINE="21"  COL="69"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON" >
    <ONCLICK>"{
	dim @add as string;
	dim @ch as string;
	dim @tota as string;
	#STEP='0';
	setvfile(true,true);                                        
	@add=getitems('#ADD_ACTTYPE#ADD_AC_NO#ADD_PSWDMETHOD')+'00000008'+getitems('#ADD_PSWD')+'00'+getitems('#QRYTYPE#ADD_CONTENT');
	addvfile(@add);
	commsend_001();
	$FD44=$HDATE;
	$FD20='1';
	lvsend_123();
	callserver();
	if($FD12!='0000'){
		showmsg(geterror());
		return(false);
	}
	commrecv_001();
	lvrecv_123();
	#PACK_ID=itoa(val(#PACK_ID),'%08d');
	runoutput();
	while(true){
		@ch=showmsg('账户查询报文录入成功,下一步请选择[1.发送,2.取消]');	
		if(@ch=='2'){
			return(false);
		}else if(@ch=='1'){
			break;
		}else{
			continue;
		}
	}
	commsend_001();
	$FD16='5873';
	$FD44=#PACK_DATE;
	$FD23='013';
	$FD29=#PACK_ID;
	callserver();
	if($FD12!='0000'){
		showmsg(geterror());
		return(false);
	}
	while(true){
		while(true){
			@ch=showmsg('账户查询报文发送成功,下一步请选择[1.查看结果,2.取消]');
			if(@ch=='2'){
				return(false);
			}else if(@ch=='1'){
				break;
			}else{
				continue;
			}
		}
		commsend_001();
		$FD123='select tagdata from lv_addit where tx_date=' + #PACK_DATE +
				' and tagname='+chr(39)+'000'+chr(39)+' and addid in'+
				'(select addid from lv_pkgreg where wt_date='+#PACK_DATE +
				' and pkgno=013 and lw_ind=2 and  txnum=30503) ' +
				' and substr(tagdata,1,16)=' +chr(39)+ #PACK_DATE+#PACK_ID+chr(39);
		$FD16='9598';
		@tota=callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			continue;
		}
		if(@tota==''){
			showmsg('尚未收到账户查询应答,请稍等后再试');
			continue;
		}
		setitems('#ADD_RESULT',substr(@tota,65,1));
		setitems('#ADD_AC_BAL',substr(@tota,69,15));
		setitems('#ADD_AC_STS',substr(@tota,84,2));
		#STEP='1';
		runoutput();
		break;
	}
	#STEP='0';
	rerun();
  	}"
  </ONCLICK>
</ITEM>
</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
  <PACKAGE DEVICE="SCREEN" DESC="账户查询录入" CHECK="#STEP=0">
    NOTHING
  </PACKAGE>
  <PRINT>"{
        print(6,25, '账户查询业务录入');
        print(8,15, '组包  日期:[8]',#PACK_DATE);
        print(9,15, '组包  序号:[8]',#PACK_ID);
        print(10,15, '接受清算行:[12]',#AC_BR_NO);
        print(11,15, '交易  序号:[8]',#ORDERNO);
        print(11,15, '查询  帐号:[32]',#ADD_AC_NO);
      }"
  </PRINT>
</RESPONSE>
<RESPONSE>
  <PACKAGE DEVICE="PRINTER" DESC="请打印业务专用凭证(账户查询录入)" CHECK="#STEP=0">
    NOTHING
  </PACKAGE>
  <PRINT>"{
        $KINDNO='00';
	dim @txtime as string;
	@txtime = substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
  
	print( 5,20,'机构名称:[30]',$BRNAME);  
	print( 5,2,'代码:5328');
	print( 5,13,'交易:账户查询录入');
        print( 8,20, '组包  日期:[8]',#PACK_DATE);
        print( 9,20, '组包  序号:[8]',#PACK_ID);
        print(10,20, '接受清算行:[12]',#AC_BR_NO);
        print(11,20, '查询  帐号:[32]',#ADD_AC_NO);
        print(24,20,'备注:');
        print(24,27,'交易日期:[8] [8]',$HDATE,@txtime);
	print(24,5,'柜员:[4]',$FD7);
	print(24,5,'流水号:[6]',$FD4);
      }"
  </PRINT>
</RESPONSE>
<RESPONSE>
  <PACKAGE DEVICE="SCREEN" DESC="账户查询应答" CHECK="#STEP=1">
    NOTHING
  </PACKAGE>
  <PRINT>"{
        print(6,25, '账户查询业务应答');
        print(8,15, '原查询日期:[8]',#PACK_DATE);
        print(9,15, '原查询包号:[8]',#PACK_ID);
        print(10,15, '接受清算行:[12]',#AC_BR_NO);
        print(11,15, '原交易序号:[8]',#ORDERNO);
        print(12,15, '原查询帐号:[32]',#ADD_AC_NO);
		
        print(14,15, '查询  结果:[10]',#UADD_RESULT);
        print(15,15, '账户  状态:[4]',#UADD_AC_STS);
        print(16,15, '账户  余额:[16]',delspace(comma(itoa(val(#ADD_AC_BAL,0.01),'%.2f'))));
      }"
  </PRINT>
</RESPONSE>
<RESPONSE>
  <PACKAGE DEVICE="PRINTER" DESC="请打印业务专用凭证(账户查询应答)" CHECK="#STEP=1">
    NOTHING
  </PACKAGE>
  <PRINT>"{
       $KINDNO='00';
	dim @txtime as string;
	@txtime = substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
  
	print( 5,20,'机构名称:[30]',$BRNAME);  
	print( 5,2,'代码:5328');
	print( 5,13,'交易:账户查询录入');
        print( 7,20, '组包  日期:[8]',#PACK_DATE);
        print( 8,20, '组包  序号:[8]',#PACK_ID);
        print( 9,20, '接受清算行:[12]',#AC_BR_NO);
        print(10,20, '交易  序号:[8]',#ORDERNO);
        print(11,20, '原查询帐号:[32]',#ADD_AC_NO);
        print(12,20, '查询  结果:[10]',#UADD_RESULT);
        print(13,20, '账户  状态:[4]',#UADD_AC_STS);
        print(14,20, '账户  余额:[16]',delspace(comma(itoa(val(#ADD_AC_BAL,0.01),'%.2f'))));
        print(24,20,'备注:');
        print(24,27,'交易日期:[8] [8]',$HDATE,@txtime);
	print(24,5,'柜员:[4]',$FD7);
	print(24,5,'流水号:[6]',$FD4);
      }"
  </PRINT>
</RESPONSE>
</TRANSACTION>

