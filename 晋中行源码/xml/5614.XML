<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110000" TITLE="5614 质押存单入库"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	$MSGTYPE='03001';
	commsend_001();
	$FD39=space(16);
	$FD63=#ZYNUM;
	$FD100=getitems('#5614_FD100_1#ZYAVBAL');
	$FD42=#IN_BAL;
	$FD64='70400';//抵质押分录
}"
</COMMSEND>
<COMMRECV>"{
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-60s" FUNCTIONS=
    "T(5614                            质押存单入库)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>

  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=4345)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>

  <ITEM  NAME="#SELID" TYPE="%5d"  FUNCTIONS=""/><!--ListWin选中的ID-->
  <ITEM NAME="#MODIFLAG" TYPE="%-1s" />
  <ITEM NAME="#VALUE0" TYPE="%-24s" />
  <ITEM NAME="#VALUE1" TYPE="%-50s" />
  <ITEM NAME="#VALUE2" TYPE="%-16s" />
  <ITEM NAME="#VALUE3" TYPE="%-16s" />
  <ITEM NAME="#5614_RAM_NAME" TYPE="%4s" />
  <ITEM TYPE="%17.2f" NAME="#5614_FD100_1"  FUNCTIONS="V(NB)J(#X5614_FD100_1)"/>
  <ITEM NAME="#X5614_FD100_1" TYPE="%-16s"  FUNCTIONS="X(#5614_FD100_1)"/>

  <ITEM TYPE="%17.2f" NAME="#ZY_BAL"  FUNCTIONS=""/>
  <ITEM TYPE="%17.2f" NAME="#IN_AMT"  FUNCTIONS=""/>

  <ITEM LINE="9"  COL="15"  TYPE="%-10s" FUNCTIONS="T(质押编号:)"/>
  <ITEM LINE="12" COL="15"  TYPE="%-15s" FUNCTIONS="T(质押存单总金额:)"/>
  <ITEM LINE="15" COL="15"  TYPE="%-10s" FUNCTIONS="T(入库金额:)"/>


  <ITEM LINE="9"  COL="25" TYPE="%-16s"  NAME="#ZYNUM"    DEVICE="KEYBOARD" FUNCTIONS="T()V(NB)">
  <ONLOSTFOCUS>"{
	dim @tota as string;
	dim @zybal as string;
	dim @in_amt as string;
	commsend_001();
	$FD16='9598';
	$FD123 = 'select to_char(sum(bal),'+chr(39)+'99999999999.00'+chr(39)+') from td_mst where ac_id in (select ac_id from mdm_ac_rel where ac_no in (select bill_no from pact_gaga_rel where pact_no='+chr(39)+#ZYNUM+chr(39)+' and stsvar='+chr(39)+'X'+chr(39)+'))';
	@tota = callserver();
	if($FD12!='0000')
	{
		showmsg(geterror());
		return(false);
	}
	if(@tota!='')
	{
		@zybal = strfld(@tota,'|',0);
		showmsg(@zybal);
		#ZY_BAL = val(@zybal);
		if(#ZY_BAL &lt;= 0.00)
		{
			showmsg('此借据未审批!!!');
			return(false);
		}
//showmsg('#ZY_BAL=='+itoa(#ZY_BAL));
	}
	initfd();
	commsend_001();
	$FD16='9598';
	$FD123 = 'select to_char(sum(gaga_bal),'+chr(39)+'99999999999.00'+chr(39)+')  from  pact_gaga_rel where pact_no='+chr(39)+#ZYNUM+chr(39)+' and stsvar='+chr(39)+'X'+chr(39)+' and pact_type='+chr(39)+'2'+chr(39)+' and io_ind='+chr(39)+'120'+chr(39)+'';
	@tota = callserver();
	if($FD12!='0000')
	{
		showmsg(geterror());
		return(false);
	}
	if(@tota!='')
	{
		@in_amt = strfld(@tota,'|',0);
		#IN_AMT=val(@in_amt);
		//showmsg(@in_amt);
	}
	
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="12"  COL="30" TYPE="%16.2f" NAME="#ZYAVBAL"  DEVICE="KEYBOARD" FUNCTIONS="V(NB)J(#XZYAVBAL)">
  <ONLOSTFOCUS>"{
	if(#ZY_BAL != #ZYAVBAL)
	{
		showmsg('总金额与审批不符!!');
		return(false);
	}
  }"
    </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="15"  COL="30" TYPE="%16.2f" NAME="#IN_BAL"  DEVICE="KEYBOARD" INPUT="TEXT" FUNCTIONS="V(NB)J(#XIN_BAL)">
  <ONLOSTFOCUS>"{
	if(#IN_AMT != #IN_BAL)
	{
		showmsg('入库金额与审批不符!!');
		return(false);
	}
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM TYPE="%-16s" NAME="#XZYAVBAL" FUNCTIONS="X(#ZYAVBAL)"/>  
  <ITEM TYPE="%-16s" NAME="#XIN_BAL" FUNCTIONS="X(#IN_BAL)"/>
  <ITEM TYPE="%-1s" NAME="#MODIFY" FUNCTIONS="">
  <ONLOSTFOCUS>"{

	editfile('../xml/DEMOWANG.DLG','../tmp/'+$KINBR+$TTYNAME+'_5614_'+#ZYNUM)
	call('mv  ../tmp/'+$KINBR+$TTYNAME+'_5614_'+#ZYNUM+'  ../tmp/'+$KINBR+$TTYNAME);
	setvfile(true,false);

  }"
  </ONLOSTFOCUS>
  </ITEM>

  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  
  <ITEM NAME="#YEAR"  TYPE="%-4s" FUNCTIONS="T($FD5,1,4)"/>
  <ITEM NAME="#MON"  TYPE="%-2s" FUNCTIONS="T($FD5,5,2)"/>
  <ITEM NAME="#DAY"  TYPE="%-2s" FUNCTIONS="T($FD5,7,2)"/>

  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>

</VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
	<PACKAGE DEVICE="SCREEN" DESC="显示内容">
	NOTHING
	</PACKAGE>
	<PRINT>
	"{
    	print(5,20,'质押存单录入成功!');
    	print(7, 8,'质押编号: [20]',#ZYNUM);
    	print(8, 8,'质押存单总金额: [16]',#XZYAVBAL);
	}"
	</PRINT>
</RESPONSE>
<RESPONSE>
    <PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="请打印业务专用凭证">
        NOTHING
    </PACKAGE>
    <PRINT>"{
 $KINDNO='00';
 dim @txtime  as string;
@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	print( 5,20,'机构名称:[30]',$BRNAME);  
	print( 5,2,'代码:5614');
	print( 5,13,'交易:质押存单录入');

	print( 7,20,'质押编号: [20]',#ZYNUM);
	print( 8,20,'质押存单总金额: [16]',#XZYAVBAL);
	print( 9,20,'入库总金额: [16]',#XIN_BAL);
	printacdtl_1();
	print(24,20,'备注:');
	print(24,27,'交易日期:[8] [8]',$HDATE,@txtime);
	print(24,5,'柜员:[4]',$FD7);
	print(24,5,'流水号:[6]',$FD4);
	}"
	</PRINT>
</RESPONSE>

</TRANSACTION>
