<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11100000" TITLE="8103    代理编号管理"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
     $FD21=#AGENTYPE;
     $FD25=#DWNAME;
     $FD27=#NAME;
     $FD31=#ACTNO;
     $FD63=#AGENTID;
     $FD70=#PROTYPE;
     $FD71=#YWTYPE;
     $FD72=#BATCHFG;
     $FD92=#DWID;
     commsend_001();
     $FD16 = '6103';
}"
</COMMSEND>
<COMMRECV>"{
}"
</COMMRECV>

<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-52s" FUNCTIONS=
    "T(8103                        个人代理编号管理)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=6103)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  
  <ITEM LINE="5"   COL="10"   TYPE="%-10s" FUNCTIONS="T(处理类型:!)"/>
  <ITEM LINE="7"   COL="10"   TYPE="%-10s" FUNCTIONS="T(单位编号:)"/>
  <ITEM LINE="7"   COL="28"   TYPE="%-10s" FUNCTIONS="T(业务性质:!)" />
  <ITEM LINE="7"   COL="51"   TYPE="%-10s" FUNCTIONS="T(代理类型:!)" />
  <ITEM LINE="9"   COL="10"   TYPE="%-10s" FUNCTIONS="T(单位名称:)" />
 
  <ITEM LINE="11"  COL="10"   TYPE="%-10s" FUNCTIONS="T(代理编号:)"/>
  <ITEM LINE="11"  COL="42"   TYPE="%-12s" FUNCTIONS="T(批处理标志:!)"/>
  
  <ITEM LINE="13"  COL="10"   TYPE="%-10s" FUNCTIONS="T(个人账号:)"/>
 <!-- <ITEM LINE="13"  COL="46"   TYPE="%-5s" FUNCTIONS="T(密码:)"/>-->
  <ITEM LINE="15"  COL="10"   TYPE="%-5s" FUNCTIONS="T(姓名:)"/>
  <ITEM LINE="17"  COL="10"   TYPE="%-5s" FUNCTIONS="T(说明:)"/>
  
  <ITEM LINE="5" COL="22" NAME="#PROTYPE" TYPE="%-1s" INPUT="SELECT" FUNCTIONS="T(0)">
    <SELECT>
       <OPTION VALUE ="0" TITLE="增加" />
       <OPTION VALUE ="1" TITLE="修改" />
       <OPTION VALUE ="2" TITLE="删除" />
    </SELECT>
  </ITEM>
  <ITEM NAME="#SPROTYPE"  TYPE="%-4s"     FUNCTIONS="S(#PROTYPE,#PROTYPE)"/>
  <ITEM LINE="7" COL="21" NAME="#DWID"    TYPE="%-4s"        INPUT="TEXT"    FUNCTIONS="">
   <ONLOSTFOCUS>
		"{
		    dim @txno_bak as string;
        @txno_bak=$TXNO;
		    $TXNO='9841';
		    $FD92=#DWID;
		    commsend_001();		
		    callserver();
		    if($FD12!='0000')
		    {
			    showmsg(geterror());
			    return(false);
		    }
		    $TXNO=@txno_bak;
		    #DWNAME=delspace($FD25);
		    #YWTYPE=delspace($FD71);
		    #AGENTYPE=delspace($FD21);
		    enable(#DWNAME,false);
		    enable(#YWTYPE,false);
		    enable(#AGENTYPE,false);
		}"
	 </ONLOSTFOCUS>
  </ITEM>  
  <ITEM LINE="7"  COL="37"  NAME="#YWTYPE"      TYPE="%-1s"        INPUT="SELECT"  FUNCTIONS="T(0)">
    <SELECT>
       <OPTION VALUE ="0" TITLE="0.代收" />
       <OPTION VALUE ="1" TITLE="1.代付" />
    </SELECT>
  </ITEM>
  <ITEM LINE="7"  COL="60"  NAME="#AGENTYPE"    TYPE="%-2s"        INPUT="SELECT"  FUNCTIONS="T(30)">
   <SELECT>
       <OPTION VALUE ="30" TITLE="30.代发工资       " />
       <OPTION VALUE ="31" TITLE="31.财政工资       " />
       <OPTION VALUE ="32" TITLE="32.代发自来水工资 " />
       <OPTION VALUE ="33" TITLE="33.批量贷记       " />
       <OPTION VALUE ="35" TITLE="35.现金代发       " />
       <OPTION VALUE ="37" TITLE="37.代发定活       " />
       <OPTION VALUE ="38" TITLE="38.代发整整       " />
       <OPTION VALUE ="39" TITLE="39.代发零整       " />
       <OPTION VALUE ="40" TITLE="40.代扣费         " />
       <OPTION VALUE ="41" TITLE="41.代收个人所得税 " />
       <OPTION VALUE ="42" TITLE="42.代收罚款       " />
       <OPTION VALUE ="43" TITLE="43.代收水费       " />
       <OPTION VALUE ="44" TITLE="44.代收煤气费     " />
       <OPTION VALUE ="45" TITLE="45.代收电费       " />
       <OPTION VALUE ="46" TITLE="46.代收税款       " />
       <OPTION VALUE ="47" TITLE="47.代收话费       " />
       <OPTION VALUE ="48" TITLE="48.代收移动费    " />
       <OPTION VALUE ="49" TITLE="49.代收理财费    " />
    </SELECT>          
  </ITEM>
  <ITEM LINE="9"   COL="21"  NAME="#DWNAME"      TYPE="%-50s"       INPUT="TEXT"  FUNCTIONS=""/>  
  <ITEM LINE="11"  COL="21"  NAME="#AGENTID"     TYPE="%-20s"       INPUT="TEXT"  FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
		"{
		    dim @txno_bak as string;
        	    @txno_bak=$TXNO;
		    $TXNO='9876';
		    $FD70=#PROTYPE;
		    $FD92=#DWID;
		    $FD63=#AGENTID;
		    commsend_001();		
		    callserver();
		    if($FD12!='0000')
		    {
			    showmsg(geterror());
			    return(false);
		    }
		    $TXNO=@txno_bak;
		    #BATCHFG=delspace($FD72);
		    #NAME=delspace($FD27);
		    #ACTNO=delspace($FD31);
		    show(#NAME,true);
		    show(#ACTNO,true);
		    
		}"
	</ONLOSTFOCUS>
  </ITEM>  
  <ITEM LINE="11"  COL="54"  NAME="#BATCHFG"     TYPE="%-1s"       INPUT="SELECT" ENABLE="FALSE" FUNCTIONS="T(1)">
   <SELECT>
       <OPTION VALUE ="0" TITLE="0.非批处理" />
       <OPTION VALUE ="1" TITLE="1.批处理" />
    </SELECT>
  </ITEM>
  <ITEM LINE="13"   COL="21"  NAME="#ACTNO"     TYPE="%-24s"     INPUT="TEXT"    FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
  "{
   		    dim @txno_bak as string;
        	    @txno_bak=$TXNO;
		          $TXNO='9978';
		    
		    if(#PROTYPE=='0')
		    {
		       $FD31=#ACTNO;
		       $FD20='1';
		       $FD71='';
		       commsend_001();		
		       callserver();
		       if($FD12!='0000')
		       {
			    		showmsg(geterror());
			    		return(false);
		       }
		       $TXNO=@txno_bak;
		       if($FD71=='1')
		       {
		        showmsg('该帐号与该单位已经关联,不能再进行关联!');
		        return(false);
		       }
		       //#NAME=delspace($FD25);
		       #NAME=delspace(substr($FD96,120,60));
		       show(#NAME,true);
		    }
  }"
  </ONLOSTFOCUS>
  </ITEM>
 <!-- <ITEM LINE="13"   COL="52"  NAME="#PWD"       TYPE="%-6s"      INPUT="TEXT"    FUNCTIONS=""/>-->
  <ITEM LINE="15"   COL="16"  NAME="#NAME"      TYPE="%-50s"     INPUT="TEXT"    FUNCTIONS=""/>
  
  <ITEM LINE="17"   COL="16"  NAME="#SHM"       TYPE="%-60s"     INPUT="TEXT"    FUNCTIONS=""/>
	 <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s"  FUNCTIONS="T()"/>
  <ITEM NAME="#GRNAME" TYPE="%-50s" FUNCTIONS="T()"/>
  <ITEM NAME="#GRACTNO" TYPE="%-24s" FUNCTIONS="T()"/>
  <ITEM NAME="#PRONAME"  TYPE="%-4s" FUNCTIONS="T()"/>
  <ITEM NAME="#YWNAME" TYPE="%-4s" FUNCTIONS="S(#YWTYPE,#YWTYPE)"/>
  <ITEM NAME="#AGENTNAME" TYPE="%-20s" FUNCTIONS="S(#AGENTYPE,#AGENTYPE)"/>
  <ITEM LINE="21"  COL="59" TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="代理编号管理">
      NOTHING
	</PACKAGE>
	    <!-- 打印格式还需要格式调整 -->
	<PRINT>"{
	  print(1,30,'代理编号管理')
	  print(3,20,'个人    账号:[24]',#ACTNO);	  
	  print(4,20,'个人账号名称:[50]',#NAME);
	}"
	</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER" DESC="请打印业务专用凭证">
      NOTHING
	</PACKAGE>
	    <!-- 打印格式还需要格式调整 -->
	<PRINT>"{
                 $KINDNO='00';
                 dim @txtime  as string;
                 @txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	         print( 5,20,'机构名称:[30]',$BRNAME);
                 print( 5,2,'代码:8103');
                 print( 5,13,'交易:代理编号管理');
	         print( 7,36,'单位编号管理--[4    ]',#SPROTYPE);
	         print( 8,20,'交易日期:[8]',$HDATE);
	         print( 9,20,'单位编号:[4   ]',#DWID);
	         print(10,20,'单位名称:[50]',#DWNAME);
	         print(11,20,'业务类型:[4   ]      代理类型:[20 ]',#YWNAME,#AGENTNAME);
	         print(12,20,'代理编号:[20]',#AGENTID);
	         print(13,20,'个人账号:[24]',#ACTNO);
	         print(14,20,'个人姓名:[50]',#NAME);
	         print(24,20,'备注:')
                 print(24,27,'交易日期:[8] [8]',$HDATE,@txtime);
                 print(24,5,'柜员:[4]',$FD7);
                 print(24,5,'流水号:[6]',$FD4);

           }"
	</PRINT>
</RESPONSE>

</TRANSACTION>
