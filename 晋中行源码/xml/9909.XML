<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110000" TITLE="9909 异地交易传票打印"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org"> 
<COMMSEND>"{    
}"
</COMMSEND>
<COMMRECV>"{

}"
</COMMRECV>
<VARIABLE>
<ITEM NAME="#DOLIST" TYPE="%-1s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
  		dim @selid as number;
  		dim @tota as string;
  		dim @prtflg as string;
  		dim @cnt as number;
  		@prtflg='';
  		if(#DOLIST!='')
  		{
  			  		

  			//list_show();
  			@selid=list_getselid();
	  		#NEXTORDERNO=delspace(list_gettext(@selid,0));
	  		#TX_DATE    =delspace(list_gettext(@selid,1));
	  		#OPN_BR_NO  =delspace(list_gettext(@selid,2));
	  		#TX_BR_NO   =delspace(list_gettext(@selid,3));
	  		#AC_NO1     =delspace(list_gettext(@selid,4));
	  		#NAME1      =delspace(list_gettext(@selid,5));
	  		#AC_NO2     =delspace(list_gettext(@selid,6));
	  		#NAME2      =delspace(list_gettext(@selid,7));
	  		#TX_AMT     =delspace(list_gettext(@selid,8));
	  		#ADD_IND    =delspace(list_gettext(@selid,9));
	  		#CT_IND     =delspace(list_gettext(@selid,10));
	  		#BRF        =delspace(list_gettext(@selid,12));
	  		#NOTE_NO		=delspace(list_gettext(@selid,13));
  			while(true)
  			{
  					@selid=list_getselid();
  					if(@selid &lt; 0)
  					{
  						list_del();
  						break;
  					}
  					@prtflg=delspace(list_gettext(@selid,11));
	  				if(@prtflg=='已打印')
	  				{
	  			    	if(msgbox('此笔交易已打印!确定重新打印吗!'+chr(10)+
	  							'    流水序号:'+#NEXTORDERNO+chr(10)+
	  							'─────────────'
	  							,'提示','yes|no')!=0)
	  						{
	      	  		   break;
	      	 			}
	      	 			#CPRTFLAG='重复打印';
	  				}
	  				else
	  				{
								#CPRTFLAG='    ';
								if(msgbox('打印此笔交易吗?'+chr(10)+
	  							'    流水序号:'+#NEXTORDERNO+chr(10)+
	  							'─────────────'
	  							,'提示','yes|no')!=0)
	  						{
	        					break;
	       				}
	  				}
	  				initfd();
	       		commsend_001();
	       		$FD44=#TX_DATE;
	        	$FD53=#NEXTORDERNO;
	        	//$FD49=#TX_CODE;
     				//$FD68=#SE_TYPE;
     				$FD67=#PRTFLAG;
	        	$FD16='5924';
	  				callserver();
						if($FD12!='0000')
    	    	{
							showmsg(geterror());
							goitem('#DOLIST',false);
		  				return(true);			
    	    	}
    	    	   	    	   	    	
	        	runoutput();
	        	list_rmitem(@selid);	        	        	        
	      		@selid=list_getselid();
	      		@cnt=list_getrowcnt();
	      		if(@cnt==0)
	      		{
	        			msgbox('          打印完毕    '+chr(10)+'─────────────');
	        			break;
	        	 }
	  				#NEXTORDERNO=delspace(list_gettext(@selid,0));
	  				#TX_DATE    =delspace(list_gettext(@selid,1));
	  				#OPN_BR_NO  =delspace(list_gettext(@selid,2));
	  				#TX_BR_NO   =delspace(list_gettext(@selid,3));
	  				#AC_NO1     =delspace(list_gettext(@selid,4));
	  				#NAME1      =delspace(list_gettext(@selid,5));
	  				#AC_NO2     =delspace(list_gettext(@selid,6));
	  				#NAME2      =delspace(list_gettext(@selid,7));
	  				#TX_AMT     =delspace(list_gettext(@selid,8));
	  				#ADD_IND    =delspace(list_gettext(@selid,9));
	  				#CT_IND     =delspace(list_gettext(@selid,10));
	  				#BRF        =delspace(list_gettext(@selid,12));
	  				#NOTE_NO     =delspace(list_gettext(@selid,13));
  		}
  		list_del();
  		
  		#DOLIST='';
  	}
  
  }"
  </ONLOSTFOCUS>
</ITEM>
<ITEM NAME="#DOLIST1" TYPE="%-1s" FUNCTIONS="">
   <ONLOSTFOCUS>
   "{
 			showall();
  	}"
  </ONLOSTFOCUS>
  </ITEM>
<!---
  <ITEM NAME="#START"  TYPE="%-1s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
 			showall();
  }"
  </ONLOSTFOCUS>
  </ITEM>
--->
  <ITEM LINE="3"  COL="3" TYPE="%-46s" FUNCTIONS=
    "T(9909                       异地交易传票打印)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
    "T(─────────────────────────────────────)"/>
   <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=5923)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
 
  <ITEM LINE="8"  COL="15" TYPE="%-14s" FUNCTIONS="T(交 易  行 号:)"/>
  <ITEM LINE="10" COL="15" TYPE="%-14s" FUNCTIONS="T(交 易  日 期:)"/>
 <!--
  <ITEM LINE="10" COL="39" TYPE="%-2s"  FUNCTIONS="T(→)"/>
  --->
  <ITEM LINE="12" COL="15" TYPE="%-14s" FUNCTIONS="T(打 印  标 志:!)"/>
  <!---
  <ITEM LINE="14" COL="15" TYPE="%-14s" FUNCTIONS="T(交 易  种 类:!)"/>
  <ITEM LINE="16" COL="15" TYPE="%-14s" FUNCTIONS="T(交 易  名 称:!)"/>
  --->
  <ITEM LINE="8"  COL="29" NAME="#BR_NO"     TYPE="%-5s"    INPUT="LABEL" FUNCTIONS="T($KINBR)"/>
  <ITEM LINE="10" COL="29" NAME="#TX_BDATE"  TYPE="%8d"    INPUT="TEXT" FUNCTIONS="T($HDATE)D()"/>
  <!--
  <ITEM LINE="10" COL="43" NAME="#TX_EDATE"  TYPE="%8d"    INPUT="TEXT" FUNCTIONS="T($HDATE)D()">
  <ONLOSTFOCUS>
  "{
   if(#TX_EDATE!=#TX_BDATE)
    {
    	showmsg('开始日期与结束日期必须一致');
    	return (false);
    }
  }"
  </ONLOSTFOCUS>
  </ITEM>
  --->
  <ITEM LINE="12" COL="29" NAME="#PRTFLAG"   TYPE="%-1s"     DEVICE="KEYBOARD" FUNCTIONS="T(0)V(0,3)">
       <SELECT LINE="12" COL="29">
            <OPTION VALUE="0 未打印"  TITLE="0 未打印"/>
            <OPTION VALUE="2 已打印"  TITLE="2 已打印"/>
            <OPTION VALUE="3 全  部 " TITLE="3 全  部"/>
       </SELECT>
  </ITEM>
  <!---       
  <ITEM NAME="#SE_TYPE"  LINE="14" COL="29" TYPE="%-1s"  INPUT="SELECT"  FUNCTIONS="T(0)V(NB)">
	<SELECT LINE="14" COL="31">
		<OPTION VALUE="0 存款"    TITLE="0.存款"/>
		<OPTION VALUE="1 转帐"    TITLE="1.转帐"/>
	</SELECT>
	<ONLOSTFOCUS>
	"{
		dim @tota_txtype as string;
		dim @tota_txstat as string;
		if(#SE_TYPE=='0')
		{
			@tota_txtype = '0000|对公存款        |2205|*'; 
		}
		else if(#SE_TYPE=='1')
		{
			@tota_txtype = '0000|对公取款转帐    |2206|*0000|对公部提转帐    |2207|*0000|对公销户转帐    |2208|*0000|内部帐记帐转帐  |2502|*';
		}	
		setsel(#TX_CODE,@tota_txtype,'o5t16o1v4o2');
	}"
	</ONLOSTFOCUS>

</ITEM>

<ITEM LINE="16" COL="29" NAME="#TX_CODE" TYPE="%-4s" DEVICE="KEYBOARD" FUNCTIONS="T(2205)V(NB)">
   <SELECT LINE="16" COL="31">
	   <OPTION VALUE="2205"            TITLE="4201.对公存款"/>     
   </SELECT>
</ITEM>
--->
   <ITEM NAME="#PRTF" TYPE="%-6s" FUNCTIONS=""/>
   <ITEM NAME="#CPRTFLAG" TYPE="%-8s" FUNCTIONS=""/>
 <ITEM LINE="21"  COL="65" TYPE="%-6s" NAME="#SUREDO" FUNCTIONS="T(确  定)" INPUT="BUTTON">
  <ONCLICK>
  "{
        dim @pkgcnt  as number;
        dim @recdcnt as number;
        dim @step   as number;
        dim @tota   as string;
        dim @relapos as number;
        dim @pkgcntpos as number; 
        dim @tmptxamt as string;
        dim @txamt as string;
        //list_init(18,78,4,1);
        //list_setcolcnt(13);
        //list_setcol(0, '流 水 号',10);
        //list_setcol(1, '交易日期',9);
        //list_setcol(2, '开户机构',6);
        //list_setcol(3, '交易机构',6);
        //list_setcol(4, '交易账号',20);
        //list_setcol(5, '户    名',30);
        //list_setcol(6, '存转帐号',20);
        //list_setcol(7, '户    名',30);
        //list_setcol(8, '交易金额',20);
        //list_setcol(9, '现转标志',8);
        //list_setcol(10, '借贷标志',4);
        //list_setcol(11, '打印标志',8);
        //list_setcol(12, '摘要备注',20);
        initfd();
        commsend_001();
     		//$FD49=#TX_CODE;//交易代码
     		$FD44=#TX_BDATE;//交易起始日期
     		//$FD45=#TX_EDATE;//交易终止日期
     		$FD67=#PRTFLAG;//打印标志
     		//$FD68=#SE_TYPE;//交易类型
     		@tota=callserver();
     		if($FD12!='0000')
    	 {
					showmsg(geterror());
					return(false);
    	 }    	 
    	 autolist(@tota);
	    		list_work();
	    		
	        #DOLIST='1';
  }"
 </ONCLICK>
  </ITEM>
	<ITEM NAME="#AC_NO1" 				TYPE="%-24s"  		FUNCTIONS=""/>            
	<ITEM NAME="#AC_NO2" 				TYPE="%-24s"  		FUNCTIONS=""/>
	<ITEM NAME="#TX_DATE"       TYPE="%-8s"       FUNCTIONS=""/>
	<ITEM NAME="#CT_IND" 				TYPE="%-4s"   		FUNCTIONS=""/>
	<ITEM NAME="#ADD_IND"				TYPE="%-2s"   		FUNCTIONS=""/>																							
	<ITEM NAME="#NAME1"  				TYPE="%-50s" 		  FUNCTIONS=""/>						
	<ITEM NAME="#NAME2"  				TYPE="%-50s" 		  FUNCTIONS=""/>																							
  <ITEM NAME="#NEXTORDERNO"   TYPE="%-10s"   	  FUNCTIONS=""/>
  <ITEM NAME="#TX_AMT"    		TYPE="%-20s"      FUNCTIONS=""/> 
  <ITEM NAME="#OPN_BR_NO" 		TYPE="%-5s"  		  FUNCTIONS=""/>
  <ITEM NAME="#TX_BR_NO"  		TYPE="%-5s"  		  FUNCTIONS=""/>
  <ITEM NAME="#BRF"           TYPE="%-20s"      FUNCTIONS=""/>
  <ITEM NAME="#NOTE_NO"       TYPE="%-16s"      FUNCTIONS=""/>
</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="异地交易传票打印!">
 NOTHING
</PACKAGE>
  <PRINT>
  "{
       
			    print(1, 7,'	                                        异地交易[4]传票 ',#CT_IND);			 
					print(3, 7,'   交易日期: [10          ]    流水号: [6      ]   凭证号[16              ]     [8]',#TX_DATE,#NEXTORDERNO,#NOTE_NO,#CPRTFLAG);
					print(4, 7,' ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓');
					print(5, 7,' ┃  机构  号: [5 ]                                                                           ┃',#OPN_BR_NO);
					print(6, 7,' ┃  贷方账号: [20]                                                            ┃',#AC_NO1);
					print(7, 7,' ┃  户    名: [50]                              ┃',#NAME1);
					print(8, 7,' ┃--------------------------------------------------------------------------------------------┃');
					print(9, 7,' ┃  交易金额：￥[16]                             摘要:[20]                                 ┃',#TX_AMT,#BRF);
					print(10,7,' ┃--------------------------------------------------------------------------------------------┃');
					print(11,7,' ┃  机构  号: [5 ]                                                                           ┃',#TX_BR_NO);
					print(12,7,' ┃  借方账号: [20]                                                            ┃',#AC_NO2);
					print(13,7,' ┃  户    名: [50]                                  ┃',#NAME2);
					print(14,7,' ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛');
					print(15,7,'             会    计:                    复    核:                      记    帐:  [4      ]',$FD7);
}"
</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER"  LINESPACE="20" DESC="异地交易传票打印!">
 NOTHING
</PACKAGE>
  <PRINT>"{

			
					print(1, 7,'	                                        异地交易[4]传票 ',#CT_IND);
					print(3, 7,'   交易日期: [10          ]   流水号: [6      ]   凭证号[16              ]     [8]',#TX_DATE,#NEXTORDERNO,#NOTE_NO,#CPRTFLAG);
					print(4, 7,' ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓');
					print(5, 7,' ┃  机构  号: [5 ]                                                                           ┃',#OPN_BR_NO);
					print(6, 7,' ┃  贷方账号: [20]                                                            ┃',#AC_NO1);
					print(7, 7,' ┃  户    名: [50]                              ┃',#NAME1);
					print(8, 7,' ┃--------------------------------------------------------------------------------------------┃');
					print(9, 7,' ┃  交易金额：￥[16              ]             摘要:[20]                        ┃',#TX_AMT,#BRF);
					print(10,7,' ┃--------------------------------------------------------------------------------------------┃');
					print(11,7,' ┃  机构  号: [5 ]                                                                           ┃',#TX_BR_NO);
					print(12,7,' ┃  借方账号: [20]                                                            ┃',#AC_NO2);
					print(13,7,' ┃  户    名: [50]                              ┃',#NAME2);
					print(14,7,' ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛');
					print(15,7,'             会    计:                    复    核:                      记    帐:  [4      ]',$FD7);
}"
</PRINT>
</RESPONSE>

</TRANSACTION>
