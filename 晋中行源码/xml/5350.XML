<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110000" TITLE="5350 小额交易历史查询"
xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>
"{
  commsend_001();

  $FD67 = #LW_IND;
  $FD28  = #TX_BRNO;
  $FD44 = #TX_DATE;
  $FD68 = #ZF_TYPE;
  $FD23 = #TXTYPE;
  $FD69 = #TX_STS;

}"
</COMMSEND>
<COMMRECV>
"{
  commrecv_001();
}"
</COMMRECV>

<VARIABLE>
<ITEM LINE="3"  COL="3" TYPE="%-46s" FUNCTIONS=
"T(5350                        小额交易历史查询)"/>
<ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
"T(─────────────────────────────────────)"/>

<ITEM NAME="#MSGTYPE"   TYPE="%-5s"    FUNCTIONS="T($MSGTYPE=03001)"/>
<ITEM NAME="#TXNO"      TYPE="%-4s"    FUNCTIONS="T($TXNO=5890)"/>


<ITEM NAME="#DOLIST" TYPE="%1s" FUNCTIONS="">
<ONLOSTFOCUS>
"{
  dim @selid as number;
  dim @ldxml as string;
  dim @filename as string;
  dim @tota as string;
  dim @CMTNO as string;
  if(#DOLIST !='')
  {
    @selid=list_work();
    if(@selid &lt; 0)
    {
      list_del();
      rerun();
      return(true);
    }
    @selid=list_getselid();
    if(@selid &lt; 0)
    {
      list_del();
      rerun();
      return(true);
    }
      initfd();
      commsend_001();
      @CMTNO = rtrim(list_gettext(@selid,0));
      switch(@CMTNO)
      {
        case '001':
        case '002':
        case '003':
        case '004':
        case '005':
        case '006':
        case '007':
        case '008':
        case '009':
        case '010':
        case '011':
        case '012':
        case '013':
            $FD16 = '9568';
            #ORDERNO = rtrim(list_gettext(@selid,3));
            #WT_DATE = rtrim(list_gettext(@selid,4));
            #OR_BR_NO=rtrim(list_gettext(@selid,6));
            $FD123 = getitems('#CRDB#OPCD#PKGNO#ORDERNO#TXNUM#OR_BR_NO#AC_BR_NO#TX_AMT#PAY_OPN_BR_NO#PAY_QS_NO#PAY_AC_NO#PAY_NAME#PAY_ADDR#PWD#CASH_QS_NO#CASH_OPN_BR_NO#CASH_AC_NO#CASH_NAME#CASH_ADDR#YW_TYPE1#BRF#WT_DATE#OPERLEVEL#AUTH_TEL#AUTH_PWD#NOTE_TYPE#NOTE_NO#PACK_DATE#PACK_ID#CHRG_IND#CHRG_AMT#RESP_DAY#PO_TYPE#PO_DATE#PO_NUM#PC_TX_AMT#JF_TX_AMT#O_WT_DATE#O_TXNUM#O_ORDERNO#RET_CODE#RCP_STS#LV_RESP#RESP2#PACK_END#LV_STS#LW_IND#DFXYNO#OORBRNO#OACBRNO');
            callserver();
            if($FD12!='0000')
            {
              showmsg(geterror());  
              return (false);
            }
            $BUFFER = $FD123;
            break;
        case '301':
        case '302':
        case '303':
        case '319':
        case '320':
        case '321':
        case '322':
        case '323':
        case '324':
        case '325':
        case '327':
        case '328':
            $FD16 = '9563';
            #CMTNO = rtrim(list_gettext(@selid,0));
            #ORDERNO = rtrim(list_gettext(@selid,3));
            #WT_DAY = rtrim(list_gettext(@selid,4));
            $FD44 = #WT_DAY;
            $FD68 = '2';
            $FD67 = #LW_IND;
            #OR_BR_NO=rtrim(list_gettext(@selid,6));
            commsend_123();
            callserver();
            if($FD12!='0000')
            {
              showmsg(geterror());  
              return (false);
            }
            $BUFFER = $FD123;
            break;
      }

      switch(@CMTNO)
      {
        case '001':
        case '002':
        case '003':
        case '004':
        case '005':
        case '006':
        case '007':
        case '008':
        case '009':
        case '010':
        case '011':
        case '012':
        case '013':
          @filename = 'LVZF.XML';
          break;
        case '301':
        case '302':
        case '303':
        case '319':
        case '320':
        case '321':
        case '322':
        case '323':
        case '324':
        case '325':
        case '327':
        case '328':
          @filename = 'LVFZF.XML';
          break;
      }
      open(@filename,'#TX_DATE='+$FD44+';#TMP_TXAMT='+$FD39+';#OWTDATE='+$FD45+';#RES_NOTPAY_CONTENT='+$FD125+';');  
      
      return(true);
  }
  list_del();
  #DOLIST='';
}"
</ONLOSTFOCUS>
</ITEM>  
<ITEM NAME="#DOLIST1" TYPE="%-1s" FUNCTIONS="">
<ONLOSTFOCUS>
"{
  showall();
}"
</ONLOSTFOCUS>
</ITEM>

<!---输入要素--->
<ITEM LINE="6"  COL="26" TYPE="%-14s"  FUNCTIONS="T(数据来源:)"/>
<ITEM LINE="8"  COL="26" TYPE="%-14s"  FUNCTIONS="T(交易行号:)"/>
<ITEM LINE="10"  COL="26"  TYPE="%-14s" FUNCTIONS="T(交易日期:)"/>
<ITEM LINE="12" COL="26" TYPE="%-14s"  FUNCTIONS="T(支付标志:!)"/>
<ITEM LINE="14" COL="26" TYPE="%-14s"  FUNCTIONS="T(交易类型:)"/>
<ITEM LINE="16" COL="26" TYPE="%-14s" FUNCTIONS="T(交易状态:!)"/>

<!---输入项定义--->
<ITEM NAME="#LW_IND"  LINE="6"  COL="36" TYPE="%-1s"  INPUT="SELECT"   FUNCTIONS="T(1)">
  <SELECT LINE="06" COL="41">
    <OPTION VALUE="1 往帐"     TITLE="1.本行系统(往帐)"/>
    <OPTION VALUE="2 来帐"    TITLE="2.它行系统(来帐)"/>
  </SELECT>
</ITEM>
<ITEM NAME="#TX_BRNO" LINE="8"  COL="36" TYPE="%-5s"  INPUT="TEXT"   FUNCTIONS="T($KINBR)"/>

<ITEM NAME="#TX_DATE"  LINE="10" COL="36" TYPE="%-8s"  INPUT="TEXT"   FUNCTIONS="T($HDATE)D()"/>

<ITEM NAME="#ZF_TYPE"  LINE="12" COL="36" TYPE="%-1s"  INPUT="SELECT"  FUNCTIONS="T(0)V(NB)">
  <SELECT LINE="11" COL="41">
    <OPTION VALUE="0 支付类"      TITLE="0.支付类"/>
    <OPTION VALUE="1 非支付类"    TITLE="1.非支付类"/>
  </SELECT>
  <ONLOSTFOCUS>
  "{
    dim @tota_txtype as string;
    dim @tota_txstat as string;
    if(#ZF_TYPE=='0')
    {
  @tota_txtype = '0000|全部类型        |888|*0000|普通贷记        |001|*0000|普通借记        |002|*0000|实时贷记        |003|*0000|实时借记        |004|*0000|定期贷记        |005|*0000|定期借记        |006|*0000|贷记退汇        |007|*0000|普通借记回执    |008|*0000|实时贷记回执    |009|*0000|实时借记回执    |010|*0000|定期借记回执    |011|*0000|通用信息        |012|*0000|实时信息        |013|*'; 
      
      if(#LW_IND=='1')
      {
@tota_txstat = '0000|全部状态        |E|*0000|无效状态        |0|*0000|往帐录入        |1|*0000|往帐复核        |2|*0000|往帐发送        |4|*0000|往帐拒绝        |5|*0000|往帐轧差        |6|*0000|往帐排队        |7|*0000|往帐撤销等待    |8|*0000|往帐撤销        |9|*0000|退汇冲正止付等待|A|*0000|往帐退回        |B|*0000|往帐已冲正      |C|*0000|往帐已止付      |D|*0000|往帐异常挂帐      |G|*';   
      }
      else if(#LW_IND=='2')
      {
@tota_txstat = '0000|全部状态        |E|*0000|临时接受        |H|*0000|正式接受        |I|*0000|地方押错        |K|*0000|全国押错        |J|*0000|中心挂帐        |M|*0000|支行挂帐        |N|*0000|来帐退回等待      |O|*0000|来帐退回        |P|*0000|同意未发送      |Q|*0000|同意已发送      |R|*0000|不同意未发送    |S|*0000|不同意已发送    |T|*0000|来帐已冲正      |U|*0000|来帐已止付      |V|*0000|来帐已付款      |W|*0000|来帐异常挂帐    |C|*';
      @tota_txtype = @tota_txtype+'0000|汇票资金移存    |121|*0000|汇票资金信息    |122|*0000|汇票多余资金划回|123|*';  
        
      }
    }
    else if(#ZF_TYPE=='1')
    {
  @tota_txtype = '0000|全部类型        |888|*0000|小额查询        |301|*0000|小额查复        |302|*0000|小额自由格式    |303|*0000|退回申请        |319|*0000|退回应答        |320|*0000|申请撤销        |321|*0000|撤销应答        |322|*0000|冲正申请        |323|*0000|冲正应答        |324|*0000|冲正通知        |325|*0000|止付申请        |327|*0000|止付应答        |328|*0000|汇票全额兑付通知|725|*';
      if(#LW_IND=='1')
      {
        @tota_txstat = '0000|全部状态        |E|*0000|往帐录入        |1|*0000|往帐发送        |4|*0000|往帐排队        |7|*';
      }
      else if(#LW_IND=='2')
      {
        @tota_txstat = '0000|全部状态        |E|*0000|来帐接收        |B|*0000|地方押错        |K|*0000|全国押错        |J|*';
      }
    }
  
    setsel(#TXTYPE,@tota_txtype,'o5t16o1v3o2');
    setsel(#TX_STS,@tota_txstat,'o5t16o1v1o2');
  }"
  </ONLOSTFOCUS>

</ITEM>

<ITEM NAME="#TXTYPE"  LINE="14" COL="36" TYPE="%-3s" INPUT="SELECT"  FUNCTIONS="T(888)V(NB)">
  <SELECT LINE="14" COL="37">
    <OPTION VALUE="888 全部类型"      TITLE="E.全部类型"/>
  </SELECT>
</ITEM>



<ITEM NAME="#TX_STS" LINE="16" COL="36" TYPE="%-1s" INPUT="SELECT" FUNCTIONS="T(W)V(NB)T(E)">
  <SELECT LINE="16" COL="37">
    <OPTION VALUE="Z 全    部" TITLE="0.全    部"/>
  </SELECT>
</ITEM>

<ITEM NAME="#WT_DAY"            TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#ORDERNO"     TYPE="%8d"      FUNCTIONS=""/>
<ITEM NAME="#IORDERNO"    TYPE="%-6s"    FUNCTIONS=""/>
<ITEM NAME="#OTYPE"       TYPE="%-1s"      FUNCTIONS="T(1)"/>
<ITEM NAME="#CMTNO"             TYPE="%-3s"       FUNCTIONS=""/>
<ITEM NAME="#O_CMTNO"           TYPE="%-3s"       FUNCTIONS=""/>
<ITEM NAME="#PAY_QS_NO"         TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#OR_BR_NO"          TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#SENDCO"            TYPE="%-4s"       FUNCTIONS=""/>
<ITEM NAME="#PAY_OPN_BR_NO"     TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#PAY_AC_NO"         TYPE="%-32s"      FUNCTIONS=""/>
<ITEM NAME="#PAY_NAME"          TYPE="%-60s"      FUNCTIONS=""/>
<ITEM NAME="#PAY_ADDR"          TYPE="%-60s"      FUNCTIONS=""/>
<ITEM NAME="#CASH_QS_NO"        TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#AC_BR_NO"          TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#RECECO"            TYPE="%-4s"       FUNCTIONS=""/>
<ITEM NAME="#CASH_OPN_BR_NO"    TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#CASH_AC_NO"        TYPE="%-32s"      FUNCTIONS=""/>
<ITEM NAME="#CASH_NAME"         TYPE="%-60s"      FUNCTIONS=""/>
<ITEM NAME="#CASH_ADDR"         TYPE="%-60s"      FUNCTIONS=""/>
<ITEM NAME="#YW_TYPE"           TYPE="%-2s"       FUNCTIONS=""/>
<ITEM NAME="#YW_TYPE1"           TYPE="%-12s"       FUNCTIONS=""/>
<ITEM NAME="#CONTENT"           TYPE="%-60s"      FUNCTIONS=""/>
<ITEM NAME="#RATE"              TYPE="%-7s"       FUNCTIONS=""/><!--拆借利率-->
<ITEM NAME="#RATEDATE"          TYPE="%-5s"       FUNCTIONS=""/><!--拆借期限-->
<ITEM NAME="#OORDERNO"          TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#PROCODE"           TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#CR_DATE"           TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#CR_BR_NO"          TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#CR_TX_NUM"         TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#QR_BR_NO"          TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#QR_TX_NUM"         TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#TX_TYPE"           TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#NOTPAY_CONTENT"    TYPE="%-255s"     FUNCTIONS=""/>
<ITEM NAME="#NOTPAY_ORDERNO"    TYPE="%-3s"       FUNCTIONS=""/>
<ITEM NAME="#O_NOTPAY_ORDERNO"  TYPE="%-3s"       FUNCTIONS=""/>
<ITEM NAME="#LV_RESP"           TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#RESP1"             TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#OPERLEVEL"         TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#PROC_STS"          TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#OPCD"              TYPE="%-2s"       FUNCTIONS="T()"/>
<ITEM NAME="#HP_ADD_PWD"        TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#PACKID"            TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#O_PACKID"          TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#PACK_DATE"         TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#PACK_ID"           TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#O_PACK_DATE"       TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#TXNUM"             TYPE="%-5s"       FUNCTIONS=""/>
<!--<ITEM NAME="#O_TXNUM"           TYPE="%-5s"       FUNCTIONS=""/>--><!--同名ITEM liangq注-->
<ITEM NAME="#LV_YW_IND"         TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#RESP_DATE"         TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#RCP_STS"           TYPE="%-2s"       FUNCTIONS=""/>
<ITEM NAME="#RESP2"             TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#RETCODE"           TYPE="%-2s"       FUNCTIONS=""/>
<ITEM NAME="#YW_DTL_ID"         TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#ACC_IND"           TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#REQ_TYPE"          TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#DF_FREEAMT"        TYPE="%-16s"      FUNCTIONS=""/>
<ITEM NAME="#PROTNO"            TYPE="%-60s"      FUNCTIONS=""/>
<ITEM NAME="#PO_NO"             TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#PO_TYPE"           TYPE="%-2s"       FUNCTIONS=""/>
<!--<ITEM NAME="#OTYPE"             TYPE="%-1s"       FUNCTIONS=""/>--><!--同名ITEM liangq注-->
<ITEM NAME="#VTYPE"             TYPE="%3d"        FUNCTIONS="" />
<ITEM NAME="#VOCNUM"            TYPE="%16d"       FUNCTIONS="" />
<ITEM NAME="#TXDAY"             TYPE="%-8s"       FUNCTIONS="T($HDATE)"/>
<ITEM NAME="#NEXTORDERNO"       TYPE="%8s"        FUNCTIONS=""/>
<ITEM NAME="#NEXTVOCNUM"        TYPE="%16d"       FUNCTIONS=""/>
<ITEM NAME="#TXAMT"             TYPE="%17.2f"     FUNCTIONS="J(#UTXAMT)J(#XTXAMT)"/>
<ITEM NAME="#XTXAMT"            TYPE="%-21s"      FUNCTIONS="X(#TXAMT)"/>
<ITEM NAME="#UTXAMT"            TYPE="%-40s"      FUNCTIONS="U(#TXAMT)"/>


<!--下面是小额的123域对应的一些内容,其中与大额123域重复的地方省了-->
  <ITEM NAME="#CRDB"      TYPE="%1d"  FUNCTIONS="T(1)"/>
  <ITEM NAME="#PKGNO"      TYPE="%3s"  FUNCTIONS=""/>
  <ITEM NAME="#TX_AMT"      TYPE="%15s"   FUNCTIONS="T()"/>   <!--交易金额--->
  <ITEM NAME="#PWD"      TYPE="%-8s"     FUNCTIONS="T()"/>    <!--支取密码-->
  <ITEM NAME="#BRF"      TYPE="%-60s"    FUNCTIONS="T(123456789012345678901234567890123456789012345678901234567890)"/>  <!--附言--->
  <ITEM NAME="#WT_DATE"                 TYPE="-8s"      FUNCTIONS="T($HDATE)"/> <!--委托日期-->
  <ITEM NAME="#AUTH_TEL"                TYPE="%-6s"     FUNCTIONS="T()"/>    <!--授权操作员号   ---->
  <ITEM NAME="#AUTH_PWD"                TYPE="%-8s"     FUNCTIONS="T()"/>    <!--授权操作员密码 ---->
  <ITEM NAME="#NOTE_TYPE"               TYPE="%-2s"     FUNCTIONS="T()"/>    <!--凭证种类---->
  <ITEM NAME="#NOTE_NO"                 TYPE="%-12s"    FUNCTIONS="T()"/>    <!--凭证号码---->
  <ITEM NAME="#CHRG_IND"          TYPE="%-1s"     FUNCTIONS="T()"/>    <!--手续费标志     ---->
  <ITEM NAME="#CHRG_AMT"          TYPE="%-15s"    FUNCTIONS="T()"/>    <!--手续费金额     ---->
  <ITEM NAME="#RESP_DAY"        TYPE="%-8s"     FUNCTIONS="T()"/>    <!--期待应答日期  ---->
  <ITEM NAME="#PO_DATE"         TYPE="%-8s"     FUNCTIONS="T()"/>    <!--票据日期     ---->
  <ITEM NAME="#PO_NUM"          TYPE="%-8s"     FUNCTIONS="T()"/>    <!--票据号码     ---->
  <ITEM NAME="#PC_TX_AMT"       TYPE="%-16.2f"  FUNCTIONS="T()"/>   <!--赔偿金额---->
  <ITEM NAME="#JF_TX_AMT"       TYPE="%-16.2f"  FUNCTIONS="T()"/>   <!--拒付金额---->
  <ITEM NAME="#O_WT_DATE"       TYPE="%-8s"     FUNCTIONS="T()"/>    <!--原委托日期    ---->
  <ITEM NAME="#O_TXNUM"         TYPE="%-5s"     FUNCTIONS="T()"/>    <!--原业务编号    ---->
  <ITEM NAME="#O_ORDERNO"       TYPE="%-8s"     FUNCTIONS="T()"/>    <!--原支付交易序号---->
  <ITEM NAME="#RET_CODE"        TYPE="%-2s"     FUNCTIONS="T()"/>    <!--退汇原因代码  ---->
  <ITEM NAME="#PACK_END"        TYPE="%-1s"     FUNCTIONS="T()"/>    <!--包结束标志    ---->
  <ITEM NAME="#LV_STS"          TYPE="%-1s"     FUNCTIONS="T()"/>    <!--交易状态      ---->
  <ITEM NAME="#DFXYNO"          TYPE="%-60s"    FUNCTIONS="T()"/>               <!--多方协议号-->
  <ITEM NAME="#OORBRNO"         TYPE="%-12s"    FUNCTIONS="T()"/>       <!--原发起行行号 -->
  <ITEM NAME="#OACBRNO"         TYPE="%-12s"    FUNCTIONS=""/>          <!--原接收行行号-->


<ITEM LINE="21"  COL="65" TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON" >
<ONCLICK>"{
  dim @tota as string;
  dim @offset as number;
  dim @cnt as number;
  dim @packlen as number;
  dim @flag as string;
  dim @id as number;
  list_init(17,78,5,1);
  list_setcolcnt(6);
  list_setcol(0,'交易行',9);
  list_setcol(1,'顺序号',8);
  list_setcol(2,'交   易   金   额',20);
  list_setcol(3,'开户行( 付 )',14);
  list_setcol(4,'开户行( 收 )',14);
  list_setcol(5,'状    态',8);
  initfd();

  commsend_001();
  $FD67 = #LW_IND;
  $FD28  = #TX_BRNO;
  $FD44 = #TX_DATE;
  $FD68 = #ZF_TYPE;
  $FD23 = #TXTYPE;
  $FD69 = #TX_STS;
  @tota=callserver();
  if($FD12!='0000')
  {
    showmsg(geterror());
    return(false);
  }
  if(substr(@tota,36,1)=='E')
  {
    showmsg(substr(@tota,36,5) +'  '+substr(@tota,44,40))
    list_del();
    return(true);
  }
  if(autolist(@tota))
  {
//    list_work();
  }

  #DOLIST='1';
  }"
</ONCLICK>
</ITEM>

</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
</RESPONSE>
</TRANSACTION>

