<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11000000" TITLE="0008  七天通知存款签约"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
  <COMMSEND>"{
  //showmsg('a');
	commsend_001();
	$FD30=#ACNO;
  $FD38=#ZJHM;
  $FD68=#CZLX;
  $FD89=#ZJLX;
  
	$FD26=#LXDZ;
	$FD33=#YDDH;
  $FD41=getitems('#LCJE');
	showmsg($FD41);
  
  $FD79=#TXPASSWORD;
 // $FD103=space(33,' ')+#BZ+#ZHLX+space(1,' ')+#JXLX+space(16,' ')+#HM+space(60-len(#HM));
 // $FD103=space(30,' ')+#ZH+space(30,' ')+#BZ+#ZHLX+space(1,' ')+#JXLX+space(16,' ')+#HM+space(60-len(#HM))+#ZKH+space(10,' ')+#XZBZ+space(24,' ');
 // $FD102=space(128,' ')+#JE+space(268,' ');
 // $FD116=#JZDH+space(31,' ')+#ZJLX+#ZJHM+space(56,' ')+#HM+space(60-len(#HM));
 // $FD115=#RYZQ+#PZZQ+#CXMM+#ZQMM+#ZJZQ+space(55,' ')+#YJZQ+space(1,' ')+#ZFM+space(1,' ');
	}"
</COMMSEND>
<COMMRECV>"{
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-52s" FUNCTIONS=
    "T(0008                             七天通知存款签约)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=0008)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  <ITEM NAME="#TXNAME"  TYPE="%-24s" FUNCTIONS="T(七天通知存款签约)"/>
  <ITEM NAME="#UNAME"    TYPE="%-20s"   FUNCTIONS=""/>
  <ITEM NAME="#UBAL"    TYPE="%-20s"   FUNCTIONS=""/>
  <ITEM NAME="#UNAME"    TYPE="%-20s"   FUNCTIONS=""/>
     <!--输入变量-->
  <ITEM LINE="5"  COL="5"  TYPE="%-14s"  FUNCTIONS="T(客户类型:)" />
  <ITEM LINE="5"  COL="20" NAME="#CZLX" TYPE="%-1s" INPUT="SELECT" FUNCTIONS="T(0) V(NB)">  
  <SELECT>
    <OPTION VALUE ="0" TITLE="0.个人" />
    <!--OPTION VALUE ="1" TITLE="1.对公" /-->
  </SELECT>
  </ITEM>
   <!-----此处需要调用短交易---->
  <ITEM NAME="#LDQFS" LINE="6"  COL="5"  TYPE="%-10s" VISABLE="TRUE" FUNCTIONS="T(读取方式: )"/>
   <ITEM LINE="6" COL="20" TYPE="%-1s"  NAME="#DQFS" INPUT="SELECT"   FUNCTIONS="V(NB)T(0)">
        <SELECT>
           <OPTION VALUE="0" TITLE="读取磁条方式"/>
           <OPTION VALUE="1" TITLE="读取芯片方式"/>
        </SELECT>
     <ONLOSTFOCUS>"{
    if(#DQFS=='1')
    {
    enable(#ACTNO1,false);
    enable(#ACTNO2,true);
    show(#ACTNO1,false);
    show(#ACTNO2,true);
    }
    if(#DQFS=='0')
    {
    enable(#ACTNO1,true);
    enable(#ACTNO2,false);
    show(#ACTNO1,true);
    show(#ACTNO2,false);
     
    }
    refresh();
     }"
     </ONLOSTFOCUS>
     </ITEM>
   <ITEM NAME="#ACTNO1"   DEVICE="MSR" INPUT="TEXT" LINE="7" COL="20" TYPE="%-19s"   FUNCTIONS="V(NB)M($MSR2,1)" VISABLE="FALSE" >
     <ONLOSTFOCUS>
      "{
         #ACNO=#ACTNO1;
        }"
      </ONLOSTFOCUS>
    </ITEM>
   <ITEM NAME="#ACTNO2"   INPUT="TEXT" DEVICE="ICC" LINE="7"  COL="20" TYPE="%-19s" VISABLE="FALSE" FUNCTIONS="V(NB)M($MSR2,1)">
     <ONLOSTFOCUS>
     "{
        #ACNO=#ACTNO2;
     }"
     </ONLOSTFOCUS>
   </ITEM>
   
  <ITEM LINE="7" COL="5" TYPE="%-16s" FUNCTIONS="T(账  号 :)"/>
  <ITEM NAME="#ACNO" TYPE="%-19s" "> 
    <ONLOSTFOCUS>
    "{
      dim @name as string;
      dim @bal as string;
      dim @title as string;
      dim @note_type as string;
      dim @note_no as string;
      dim @id_no as string;
      dim @buffer as string;
      initfd();
      commsend_001();
      $FD16='0009';
      $FD30=#ACNO;
      @buffer=callserver();
      if($FD12 != '0000')
      {
      	showmsg(geterror());
      	//return(false);
      }
      else
      {
        @bal=itoa(val($FD42,0.01),'%-17.2f');
        #UBAL=itoa(val($FD42,0.01),'%-17.2f');
        @name=delspace($FD25);
        #UNAME=delspace($FD25);
        @title=delspace($FD81);
        @note_type=delspace($FD89);
        @note_no=delspace($FD59);
        @id_no=delspace($FD62);
        showhelp(4,70,7,5,'产品信息','户名:'+@name+chr(9)+'余额:'+@bal+chr(9)+'产品名称:'+@title+chr(10)+'凭证类型:'+@note_type+chr(9)+'凭证号码:'+@note_no+'');
       }
       //晋中 20110512 0009 得到账号信息. 移动电话,联系地址.
       #YDDH = delspace($FD33);
       #LXDZ = delspace($FD26);
       #LCJE = 1000.00;
      }"
    </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="9" COL="5" TYPE="%-16s" FUNCTIONS="T(密  码 :)"/>
  <ITEM NAME="#TXPASSWORD" INPUT="TEXT" LINE="9" COL="20" TYPE="%-6d" DEVICE="PINPAD" FUNCTIONS="T()i()V(NB)">
    <ONLOSTFOCUS>
    "{
        //验证账号的卡折密码是否正确
        initfd();
        commsend_001();
				showmsg(substr(#ACNO,0,6));
				
        if(substr(#ACNO,0,6)!='621223' and substr(#ACNO,0,6)!='621780')
        {
            $FD30=#ACNO;
            $FD79=#TXPASSWORD;
            $FD16='9317';
            callserver();
            if($FD12!='0000')
            {
              showmsg(geterror());
              return(false);
            }
        }
        else if(substr(#ACNO,0,6) == '621223' or substr(#ACNO,0,6)=='621780')
        {
		        $FD16='7007';
		        $FD30=#ACNO;
		        $FD68='4';
		        $FD79=#TXPASSWORD;
		        callagn();
		        if( $FD12 != '0000')
		        {
		        	showmsg(geterror());
		        	//return(false);
		        }
		    }
      //by zyl
      show(#YDDH1,true);
      show(#YDDH,true);
      show(#LXDZ1,true);
      show(#LXDZ,true);
      show(#A5,true);
      show(#LCJE,true);
      
    }"
    </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="11" COL="5" TYPE="%-16s" FUNCTIONS="T(证件类型:)"/>
  <ITEM NAME="#ZJLX" INPUT="SELECT" LINE="11" COL="20" TYPE="%-19s" FUNCTIONS="T(1)V(NB)"> 
  <SELECT>
  <OPTION VALUE="1" TITLE="身份证"/>
  </SELECT>
  </ITEM>
  <ITEM  NAME="#TMP_IDNO" TYPE="%-20s" FUNCTIONS=""/>
  <ITEM  NAME="#MIN_BAL" TYPE="%-20s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
  		      initfd();
            commsend_001();
            
          	$FD16='0009';
            $FD30=#ACNO;
            $FD89=#ZJLX;
            callserver();
          	if($FD12 != '0000')
          	{
          	  showmsg(geterror());
          	  return(false);
          	}
          	#TMP_IDNO=delspace($FD62);
          	#MIN_BAL=itoa(val($FD41,0.01),'%-17.2f');
            
          	show(#A4,true);
          	show(#ZJHM,true);

            
   }"
  </ONLOSTFOCUS>
  </ITEM>
  <!-- 为核查结果中文传值的变量 wudawei 20131101 -->
  <ITEM NAME="#HCJGBL"  TYPE="%-60s" />
  <ITEM  LINE="13"  COL="5"  NAME="#A4" TYPE="%-10s" INPUT="LABEL" FUNCTIONS="T(证件号码:)"/>
  <ITEM  LINE="13"  COL="20"  NAME="#ZJHM" TYPE="%-20s" INPUT="TEXT" FUNCTIONS="T()V(NB)">
	<ONLOSTFOCUS>
	"{
		if(delspace(#ZJHM)!=#TMP_IDNO)
		{
			showmsg('输入证件号码错误!');
			return(false);
		}
		 //add 20131030 wudawei start 调用身份核查
  		  dim @res as string;
				if(#ZJLX=='1' or #ZJLX=='2')
				{
					@res = idcheck(#ZJHM,$FD25);
					#HCJGBL = strfld(@res,'|',1);
					@res = strfld(@res,'|',0);
					if(@res=='02' or @res=='03' or @res=='04' or @res=='05' or @res=='06')
					{
							showmsg('身份核查结果不通过，不能继续办理！');
							return(false);
					}
				}
				//add 20131030 end
	}"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#YDDH1" INPUT="LABEL" LINE="15" COL="5" TYPE="%-16s" VISABLE="FALSE" FUNCTIONS="T(移动电话:)"/>
  <ITEM NAME="#YDDH"  INPUT="TEXT" LINE="15" COL="20" TYPE="%-20s" VISABLE="FALSE" FUNCTIONS=""/> 
  <ITEM NAME="#LXDZ1" INPUT="LABEL" LINE="17" COL="5" TYPE="%-16s" VISABLE="FALSE" FUNCTIONS="T(联系地址:)"/>
  <ITEM NAME="#LXDZ"  INPUT="TEXT" LINE="17" COL="20" TYPE="%-58s" VISABLE="FALSE" FUNCTIONS=""/>
  <ITEM INPUT="LABEL" LINE="19" COL="5"  NAME="#A5" TYPE="%-16s" INPUT="LABEL" VISABLE="FALSE"  FUNCTIONS="T(留存金额:)"/>
  <ITEM NAME="#LCJE" INPUT="TEXT"  LINE="19" COL="20" TYPE="%17.2f" VISABLE="FALSE" FUNCTIONS="V(0000000000000001,9999999999999999)">
  <ONLOSTFOCUS>
  "{
     if(#LCJE &lt; 1000)
     {
       showmsg('留存金额最低1000.00元');
       return(false);
     }
   }"
  </ONLOSTFOCUS>
  </ITEM>

  <!-- 输入客户信息 
  <ITEM NAME="#JE"     TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#BZ"     TYPE="%-2s"  FUNCTIONS=""/>
  <ITEM NAME="#ZHLX"   TYPE="%-1s"  FUNCTIONS=""/>
  <ITEM NAME="#JXLX"   TYPE="%-1s"  FUNCTIONS=""/>
  <ITEM NAME="#JZDH"   TYPE="%-4s"  FUNCTIONS=""/>
  <ITEM NAME="#ZJLX"   TYPE="%-1s"  FUNCTIONS=""/>
  <ITEM NAME="#ZJHM"   TYPE="%-20s" FUNCTIONS=""/>
  <ITEM NAME="#RYZQ"   TYPE="%-1s"  FUNCTIONS=""/>
  <ITEM NAME="#PZZQ"   TYPE="%-1s"  FUNCTIONS=""/>
  <ITEM NAME="#CXMM"   TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#ZQMM"   TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#ZJZQ"   TYPE="%-1s"  FUNCTIONS=""/>
  <ITEM NAME="#YJZQ"   TYPE="%-1s"  FUNCTIONS=""/>
  <ITEM NAME="#ZFM"    TYPE="%-1s"  FUNCTIONS=""/> -->
  
    <!--类型转化-->
  <ITEM NAME="#SCZLX"    TYPE="%-10s"   FUNCTIONS="S(#CZLX,#CZLX)"/>
  <ITEM NAME="#SLCJE"    TYPE="%-20s"   FUNCTIONS="X(#LCJE)"/>
  <ITEM NAME="#SUBAL"    TYPE="%-20s"   FUNCTIONS="X(#UBAL)"/>
  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="七天通知存款签约交易">
NOTHING
</PACKAGE>
  <PRINT>
  "{
     print( 2,22,'七天通知存款签约交易成功');
     print( 4,22,'七天通知存款账号:[19]',#ACNO);
     print( 6,22,'户    名:[60]',$FD25);
     print( 8,22,'留存金额:[30]',#SLCJE);
   }"
  </PRINT>
</RESPONSE>
<RESPONSE>
  <PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="请打印七天通知存款签约凭证">
  NOTHING
  </PACKAGE>
  <PRINT>
  "{
   dim @txtime  as string;
  @txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	print( 5, 20,'机构名称:[30]',$BRNAME);  
	print( 5, 2,'代码:0008');
	print( 5, 13,'交易:七天通知存款协议签约');

	print( 9, 20,'客 户 名:[60] ',#UNAME);
	print( 10,20,'协议账号:[20] ',#ACNO);
	print( 11,20,'账户余额:[20] ',#SUBAL);
	print( 12,20,'留存金额:[20] ',#SLCJE);
	print( 13,20,'移动电话:[20] ',#YDDH);
	print( 14,20,'联系地址:[60] ',#LXDZ);
	print( 15,20,'身份核查结果:[60] ',#HCJGBL);
	
	print(19,80,'\H0本人已确认银行打印记录正确无误.\H1');
	print(21,80,'客户签名:_____________________');
	print( 24,20,'备注:');
	print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
	print( 24,5,'柜员:[4]',$FD7);
	print( 24,5,'流水号:[6]',$FD4);
  }"
  </PRINT>
</RESPONSE>
<OUTPUT>
</OUTPUT>
</TRANSACTION>
