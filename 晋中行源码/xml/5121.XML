<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110000" TITLE="5121 大额查询报文录入"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
  commsend_001();
  $FD39=itoa(#TX_AMT*100, '%016.0f');
  $FD46=#NOTPAY_DATE;
  $FD45=#O_WT_DAY;
  $FD44=$HDATE;
  $FD21=#CUR_NO;
  $FD20='1';
  $FD3 =$KINBR;
  $FD7=$TLRNO;
  commsend_123();
}"
</COMMSEND>
<COMMRECV>"{
  commrecv_001();
  commrecv_v123();
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(5121                        大额查询报文录入)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=5821)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  <ITEM LINE="6"  COL="3"  TYPE="%-12s" FUNCTIONS="T(原交易序号:)"/>
  <ITEM LINE="6"  COL="30" TYPE="%-12s" FUNCTIONS="T(原委托日期:)"/>
  <ITEM LINE="7"  COL="3"  TYPE="%-12s" FUNCTIONS="T(原发起行号:)"/>
  <ITEM LINE="7"  COL="30" TYPE="%-12s" FUNCTIONS="T(原交易类型:!)"/>
  
  <ITEM LINE="8"  COL="3" TYPE="%-12s" FUNCTIONS="T(原付款帐号:)"/>
  <ITEM LINE="9"  COL="3" TYPE="%-12s" FUNCTIONS="T(原付款人名:)"/>
  <ITEM LINE="10" COL="3" TYPE="%-12s" FUNCTIONS="T(原收款帐号:)"/>
  <ITEM LINE="11" COL="3" TYPE="%-12s" FUNCTIONS="T(原收款人名:)"/>
  <ITEM LINE="12" COL="3" TYPE="%-12s" FUNCTIONS="T(原交易金额:)"/>
  <ITEM LINE="13" COL="3" TYPE="%-12s" FUNCTIONS="T(原接收行号:)"/>
  <ITEM LINE="14" COL="3" TYPE="%-12s" FUNCTIONS="T(原货币符号:!)"/>
  
  <ITEM LINE="15" COL="3" TYPE="%-12s" FUNCTIONS="T(查复  行号:)"/>
  <ITEM LINE="16" COL="3" TYPE="%-12s" FUNCTIONS="T(内      容:)"/>
  
  
  <!--查询报文录入输入项输入定义-->
  <ITEM   NAME="#NOTPAY_DATE"   TYPE="%8d"   FUNCTIONS="T($HDATE)"/>      <!----查询日期--->
  <ITEM   NAME="#CMTNO"         TYPE="%-3s"  FUNCTIONS="T(301)"/>         <!----CMTNO--->
  
  
  <ITEM LINE="6" COL="15" NAME="#OORDERNO"  TYPE="%8d"  DEVICE="KEYBOARD" FUNCTIONS="V(NB)"/>
  <ITEM LINE="6" COL="42" NAME="#O_WT_DAY"  TYPE="%8d"   DEVICE="KEYBOARD" FUNCTIONS="V(NB)D()"/>
  <ITEM LINE="7" COL="15" NAME="#OR_BR_NO" TYPE="%-12s"  DEVICE="KEYBOARD" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
  "{
    dim @baktxno as string;
    @baktxno=$TXNO;
    $TXNO='9553';
    $FD32=#OR_BR_NO;
    commsend_001();
    callserver();
    $TXNO=@baktxno;
    if($FD12!='0000'){
    	showmsg(geterror());
    	return(false);
    }
    showhelp(3,70,8,3,'支付系统行名信息',substr($FD96,0,60));
  }"
  </ONLOSTFOCUS>
  </ITEM>
   <ITEM LINE="7" COL="42" NAME="#O_CMTNO"   TYPE="%-3s"   DEVICE="KEYBOARD" FUNCTIONS="V(NB)T(100)">
     <SELECT>
          <OPTION VALUE="100 大额汇兑"           TITLE="0.大额汇兑"/>
          <OPTION VALUE="101 委托收款"           TITLE="1.委托收款"/>
          <OPTION VALUE="102 托收承付"           TITLE="2.托收承付"/>
          <OPTION VALUE="105 同业拆借"           TITLE="3.同业拆借"/>
          <OPTION VALUE="121 汇票资金移存"       TITLE="5.汇票资金移存"/>
          <OPTION VALUE="122 银行资金清算"       TITLE="6.汇票资金清算"/>
          <OPTION VALUE="123 多余资金退回"       TITLE="7.汇票多余资金退回"/>
          <OPTION VALUE="124 汇票未用退回"       TITLE="8.汇票未用退回"/>
          <OPTION VALUE="721 汇票申请清算"       TITLE="9.汇票申请清算"/>
          <OPTION VALUE="724 汇票申请退回"       TITLE="a.汇票申请退回"/>
          <OPTION VALUE="725 全额兑付通知"       TITLE="b.汇票全额兑付通知"/>
     </SELECT>
     <ONLOSTFOCUS>"{
      dim @baktxno as string;
      dim @bakcmtno as string;
      dim @bakocmtno as string;
      dim @bakcrbrno as string;
      dim @bakoorderno as string;
      dim @bakowtday as string;
      dim @line as string;
      dim @f as file;
      
      @line='';
      @baktxno=$TXNO;
      @bakcmtno=#CMTNO;
      @bakocmtno=#O_CMTNO;
      @bakoorderno=#OORDERNO;
      @bakowtday=#O_WT_DAY;
      $TXNO='9561';
      $FD44=#O_WT_DAY;
      #ORDERNO=#OORDERNO;
      #CMTNO=#O_CMTNO;
      @bakcrbrno=#CR_BR_NO;
      commsend_001();
      commsend_123();
      @line=callserver();
  
      commrecv_123();
      #TX_AMT=val($FD39,0.01);
      #CUR_NO=$FD21;
      enable(#TX_AMT,true);
      $TXNO=@baktxno;
      #CMTNO=@bakcmtno;
      #ORDERNO='';
      #RECECO='';
      $FD44=$HDATE;
      #O_CMTNO=@bakocmtno;
      enable(#O_CMTNO,true);
      #CR_BR_NO=@bakcrbrno;
      #O_WT_DAY=@bakowtday;
      $TXNO=@baktxno;
      #OORDERNO=@bakoorderno;enable(#OORDERNO,true);  
  }"
  </ONLOSTFOCUS>
   </ITEM>
  <ITEM NAME="#SO_CMTNO" TYPE="%-16s" FUNCTIONS="S(#O_CMTNO,#O_CMTNO)"/> 
  <ITEM LINE="8"  COL="15" NAME="#PAY_AC_NO"    TYPE="%-32s"   DEVICE="KEYBOARD" FUNCTIONS="V(NB)"/>
  <ITEM LINE="9"  COL="15" NAME="#PAY_NAME"   TYPE="%-60s"    DEVICE="KEYBOARD" FUNCTIONS="V(NB)"/>
  <ITEM LINE="10" COL="15" NAME="#CASH_AC_NO"   TYPE="%-32s"   DEVICE="KEYBOARD" FUNCTIONS="V(NB)"/>
  <ITEM LINE="11" COL="15" NAME="#CASH_NAME"    TYPE="%-60s"   DEVICE="KEYBOARD" FUNCTIONS="V(NB)"/>
  
  
  <ITEM LINE="12" COL="15" NAME="#TX_AMT"  TYPE="%16.2f" DEVICE="KEYBOARD" FUNCTIONS="V(NB)"/>
  <ITEM LINE="13" COL="15" NAME="#AC_BR_NO" TYPE="%-12s"  DEVICE="KEYBOARD" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
  "{
      dim @baktxno1 as string;
    @baktxno1='';
    $FD96='';
       @baktxno1=$TXNO;
       $FD32=#AC_BR_NO;
       $TXNO='9553';
      commsend_001();
      callserver();
      $TXNO=@baktxno1;
      if($FD12!='0000'){
        showmsg(geterror());
        return(false);
       }
      showhelp(3,70,8,3,'支付系统行名信息',substr($FD96,0,60));
    }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="14" COL="15" NAME="#CUR_NO"    TYPE="%-3s" DEVICE="KEYBOARD" FUNCTIONS="T(RMB)">
   <SELECT>
           <OPTION VALUE="RMB 人民币" TITLE="0.人民币"/>
   </SELECT>
   </ITEM>
  <ITEM LINE="15"  COL="15"  NAME="#CR_BR_NO"   TYPE="%-12s" DEVICE="KEYBOARD" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
  "{
      dim @baktxno1 as string;
    @baktxno1='';
    $FD96='';
       @baktxno1=$TXNO;
       $FD32=#CR_BR_NO;
       $TXNO='9553';
      commsend_001();
      callserver();
      $TXNO=@baktxno1;
      if($FD12!='0000'){
        showmsg(geterror());
        return(false);
       }
      showhelp(3,70,8,3,'支付系统行名信息',substr($FD96,0,60));
    }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="16" COL="17" LINES="4" COLS="50" NAME="#NOTPAY_CONTENT"   TYPE="%-255s"  DEVICE="KEYBOARD" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
  "{
    if (strfldcnt(#NOTPAY_CONTENT,':') != 1 or strfldcnt(#NOTPAY_CONTENT,'{') != 1 or strfldcnt(#NOTPAY_CONTENT,'}') != 1) 
    {
      showmsg('输入内容中不能含有半角:{}字符,请修改为全角其它字符');
    return(false);
    }
  }"
  </ONLOSTFOCUS>
  </ITEM>
  
  <!-----占位字段---------------> 
  <ITEM NAME="#PAY_QS_NO"     TYPE="%-12s"      FUNCTIONS=""/><!--(原)发起清算行行号-->
  <ITEM NAME="#RECECO"        TYPE="%-4s"       FUNCTIONS=""/><!--发报中心代码-->
  <ITEM NAME="#SENDCO"        TYPE="%-4s"       FUNCTIONS=""/><!--发报中心代码-->
  <ITEM NAME="#PAY_OPN_BR_NO" TYPE="%-12s"      FUNCTIONS=""/><!--付款人开户行-->
<!--  <ITEM NAME="#PAY_AC_NO"  TYPE="%-32s"  FUNCTIONS=""/><!--付款人帐号(原收款人帐号)--><!--同名ITEM liangq注-->
<!--  <ITEM NAME="#PAY_NAME"  TYPE="%-60s"  FUNCTIONS=""/><!--付款人名称(原收款人名称)--><!--同名ITEM liangq注-->
  <ITEM NAME="#PAY_ADDR"      TYPE="%-60s"      FUNCTIONS=""/><!--付款人地址(原收款人地址)-->
  
  <ITEM NAME="#CASH_QS_NO"    TYPE="%-12s"      FUNCTIONS=""/><!--接受清算行号-->
  <ITEM NAME="#CASH_OPN_BR_NO" TYPE="%-12s"     FUNCTIONS=""/><!--收款人开户行号-->
<!--  <ITEM NAME="#CASH_AC_NO"  TYPE="%-32s"   FUNCTIONS=""/><!--收款人帐号,原付款人帐号--><!--同名ITEM liangq注-->
<!--  <ITEM NAME="#CASH_NAME" TYPE="%-60s"      FUNCTIONS=""/><!--收款人姓名,原付款人姓名--><!--同名ITEM liangq注-->
  <ITEM NAME="#CASH_ADDR"     TYPE="%-60s"      FUNCTIONS=""/><!--收款人地址-->
  
  <ITEM NAME="#YW_TYPE"       TYPE="%-2s"       FUNCTIONS=""/><!--业务种类-->
  <ITEM NAME="#ORDERNO"       TYPE="%-8s"       FUNCTIONS=""/><!--支付交易序号   撤销支付交易序号-->
  <ITEM NAME="#CONTENT"       TYPE="%-60s"      FUNCTIONS=""/><!--附言-->
  <ITEM NAME="#RATE"          TYPE="%-7s"       FUNCTIONS=""/><!--拆借利率-->
  <ITEM NAME="#RATEDATE"      TYPE="%-5s"       FUNCTIONS=""/><!--拆借期限-->
  <ITEM NAME="#PROCODE"           TYPE="%-8s"       FUNCTIONS=""/><!--处理码-->
  <ITEM NAME="#CR_DATE"           TYPE="%-8s"       FUNCTIONS=""/><!--查复日期-->
  <ITEM NAME="#CR_TX_NUM"         TYPE="%-8s"       FUNCTIONS=""/><!--查复书号-->
  <ITEM NAME="#QR_BR_NO"          TYPE="%-12s"      FUNCTIONS=""/><!--查询行号  原查询行号-->
  <ITEM NAME="#QR_TX_NUM"         TYPE="%-8s"       FUNCTIONS=""/><!--原查询书号 查询书号-->
  <ITEM NAME="#TX_TYPE"           TYPE="%-1s"       FUNCTIONS="T(1)"/><!--原交易种类-->
  <ITEM NAME="#NOTPAY_ORDERNO"    TYPE="%-3s"       FUNCTIONS=""/><!--撤销申请号   退回申请号-->
  <ITEM NAME="#O_NOTPAY_ORDERNO"  TYPE="%-3s"       FUNCTIONS=""/><!--原撤销申请号  原退回申请号-->
  <ITEM NAME="#RESP1"             TYPE="%-1s"       FUNCTIONS=""/><!--撤销应答 退回应答-->
  <ITEM NAME="#OPERLEVEL"         TYPE="%-1s"       FUNCTIONS=""/><!---->
  <ITEM NAME="#PROC_STS"          TYPE="%-1s"       FUNCTIONS=""/><!---->
  
  <ITEM NAME="#OPCD"              TYPE="%-2s"       FUNCTIONS="T(10)"/>
  <ITEM NAME="#NOTE_NO"           TYPE="%-16s"      FUNCTIONS=""/>
  <ITEM NAME="#LW_IND"            TYPE="%-1s"       FUNCTIONS="T(1)"/>
  <ITEM NAME="#HP_ADD_PWD"        TYPE="%-1s"       FUNCTIONS=""/>
  <ITEM NAME="#O_PACKID"          TYPE="%8d"        FUNCTIONS=""/>
  <ITEM NAME="#PACKID"            TYPE="%8d"        FUNCTIONS=""/>
  <ITEM NAME="#PACK_DATE"         TYPE="%8d"        FUNCTIONS=""/>
  <ITEM NAME="#O_PACK_DATE"       TYPE="%8d"        FUNCTIONS=""/>
  <ITEM NAME="#TXNUM"             TYPE="%5d"        FUNCTIONS=""/>
  <ITEM NAME="#O_TXNUM"           TYPE="%5d"        FUNCTIONS=""/>
  <ITEM NAME="#LV_YW_IND"         TYPE="%12s"       FUNCTIONS=""/>
  <ITEM NAME="#RESP_DATE"         TYPE="%8d"        FUNCTIONS=""/>
  <ITEM NAME="#RCP_STS"           TYPE="%2d"        FUNCTIONS=""/>
  <ITEM NAME="#RESP2"             TYPE="%8s"        FUNCTIONS=""/>
  <ITEM NAME="#RETCODE"           TYPE="%2d"        FUNCTIONS=""/>
  <ITEM NAME="#YW_DTL_ID"         TYPE="%8d"        FUNCTIONS=""/>
  <ITEM NAME="#ACC_IND"           TYPE="%1d"        FUNCTIONS=""/>
  <ITEM NAME="#REQ_TYPE"          TYPE="%1d"        FUNCTIONS=""/>
  <ITEM NAME="#DF_FREEAMT"        TYPE="%16s"       FUNCTIONS=""/>
  <ITEM NAME="#PROTNO"            TYPE="%60s"       FUNCTIONS=""/>
  <ITEM NAME="#PO_NO"             TYPE="%8d"        FUNCTIONS=""/>
  <ITEM NAME="#PO_TYPE"           TYPE="%1d"        FUNCTIONS=""/>
  <ITEM NAME="#OTYPE"             TYPE="%1d"        FUNCTIONS="T(1)"/><!-- 表示大额 -->
   <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
  </VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
    <PACKAGE>
    NOTHING
    </PACKAGE>
    <PRINT>"{
        print(6,25,'发送成功!');
        print(8,15,'--------------------------------------');
        print(9,15,'查询书号:[8]',#ORDERNO);
        print(10,15,'内容:');
        print(11,21,#NOTPAY_CONTENT);
        }"
    </PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER"  LINESPACE="24" DESC="打印业务专用凭证">
NOTHING
</PACKAGE>
 <PRINT>"{
	 dim @txtime  as string;
@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	print( 5, 20,'机构名称:[30]',$BRNAME);  
	print( 5, 2,'代码:5121');
	print( 5, 13,'交易:大额查询报文录入');

        print( 5,20,'原交易序号:[8]   原委托日期:[8]   原发起行号:[12]',#OORDERNO,#O_WT_DAY,#OR_BR_NO);
        print( 6,20,'原交易类型:[16]   原付款帐号:[32]',#SO_CMTNO,#PAY_AC_NO);
        print( 7,20,'原付款人名:[60]',#PAY_NAME);
        print( 8,20,'原收款帐号:[32]',#CASH_AC_NO);
        print( 9,20,'原收款人名:[60]',#CASH_NAME);
        print(10,20,'原交易金额:[16]  原接收行号:[12]  原货币符号:人民币',itoa(#TX_AMT,'%16.2f'),#AC_BR_NO);
        print(11,20,'操作员号:[4]     流 水 号:[6]',$FD7,$FD4);
        print(12,20,'查复  行号:[12]  内      容:[255]',#CR_BR_NO,delspace(#NOTPAY_CONTENT));
        
        print( 24,20,'备注:');
	print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
	print( 24,5,'柜员:[4]',$FD7);
	print( 24,5,'流水号:[6]',$FD4);
	}"
    </PRINT>
</RESPONSE>
<OUTPUT>
</OUTPUT>
</TRANSACTION>
