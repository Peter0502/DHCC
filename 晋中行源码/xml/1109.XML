<?xml version="1.0" encoding="GBK" ?> 
<TRANSACTION RIGHTS="11111000" TITLE="1109  传票的查询打印"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>
  "{ commsend_001();
     $MSGTYPE='03001';
     $FD47=#DATE;
     $FD91=#BRNO;
   }" 
</COMMSEND>
<COMMRECV>
  "{ commrecv_001();
     runoutput();
   }"
</COMMRECV>
<VARIABLE UPLOOP="TRUE">
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
	 "T(1109                          传票的查询打印)"/>
	<ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
	 "T(─────────────────────────────────────)"/>
	<ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=5883)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  <!--输入变量-->
  <ITEM LINE="10" COL="24" TYPE="%-10s" FUNCTIONS="T(传票日期:)"/>

  <ITEM NAME="#BRNO" TYPE="%-5s" FUNCTIONS="T($KINBR)"/>
  <ITEM NAME="#DATE" INPUT="TEXT" LINE="10" COL="34" TYPE="%8s" FUNCTIONS="V(NB)D()"/>
  
  <!--------------有些变量没有用,只是为了公共脚本执行时不报错------------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  
  <ITEM LINE="20" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
  <ONCLICK>
  "{
      	dim @tota as string;
        dim @ch as string;
        dim @f as string;
        commsend_001();
       	$FD47=#DATE;
        $FD91=#BRNO;
        @tota=callserver();
        @f=openfile('../tmp/tmp'+$KINBR+$TTYNAME+'.tmp','w');
        writeline(@f,@tota);
        closefile(@f);
      	if($FD12!='0000')
      	{
            showmsg(geterror());
            return(false);	
        }
        else
        {
             showall();
             @ch=showmsg('请选择打印方式：0:退出 1:主机 2:终端 ');
             if(@ch == '0')
             {
               autolist(@tota);
               list_work();
               return(true);
             }
             else if(@ch == '1')
             {
                autolist(@tota);
                list_work();
                return(true);
             }
             else
             {
                 autolist(@tota);
                 list_work();
                 runoutput();
             }
        }
   }"       
  </ONCLICK>
 </ITEM>
  <!-- 用到的传送变量-->
 <ITEM NAME="#TOTA" TYPE="%-5000s" FUNCTIONS=""/>
 </VARIABLE>
 <REQUEST>
 </REQUEST>
 <RESPONSE>
 <PACKAGE DEVICE="PRINTER" DESC="网点汇总打印">
  NOTHING
 </PACKAGE>
       
 <PRINT>
 "{
    dim @brname as string;
    dim @accno as string;
    dim @flg as string;
    dim @date as string;
    dim @brno as string;
    dim @txamt as string;
    dim @cnt as string;
    dim @brmxprint as string;
    dim @tota as string;
    dim @fldcnt as number;
    dim @stnum as number;
    dim @row as number;
    dim @colnum as string;
    dim @datenum as number;
    dim @tmp as number;
    dim @f as file;
    @f='';
    @f=openfile('../tmp/tmp'+$KINBR+$TTYNAME+'.tmp','r');
    @tota=readline(@f);

    @stnum=8;

    @row=0;
    @colnum=0;
    @tmp=0;
    
    while (1)
    {   
        @tota=readline(@f);
     		if(@tota==''){
     			closefile(@f);
     			break;
     		}
        @accno  =strfld(@tota,'|' ,0);
        @flg    =strfld(@tota,'|' ,1);
        @brno   =strfld(@tota,'|' ,2);
        @brname =strfld(@tota,'|' ,3);
        @date   =strfld(@tota,'|' ,4);
        @txamt  =strfld(@tota,'|' ,5);
        @cnt    =strfld(@tota,'|' ,6);
        @accno  =strfld(@tota,'|' ,7);
        
        print (3+@row,5,'           支行[7] [2]方传票                                   ',@accno,@flg);
        print (4+@row,5,' 机构号:[5]   机构名:[30]日期:[8]       ',@brno,@brname,@date);
        print (5+@row,5,'┍━━━━━━━━━━━━━━━━━━━━┯━━━━━━━━━━━━┑  ');
        print (6+@row,5,'│金额:[21]              │笔数:[4]               │  ',@txamt,@cnt);
        print (7+@row,5,'┝━━━━━━━━━━━━━━━━━━┯━┿━━━━━━━━━━━━┥  ');
        print (8+@row,5,'│                                    │会│                        │  ');
        print (9+@row,5,'│    上列款项已收取                  │计│科目:[7]            │  ',@accno);
        print(10+@row,5,'│                                    │分│                        │  ');
        print(11+@row,5,'│                (开户行盖章)        │录│                        │  ');
        print(12+@row,5,'┕━━━━━━━━━━━━━━━━━━┷━┷━━━━━━━━━━━━┙  ');
        print(13+@row,5,'                           复核:               经办:      ');
        @stnum=@stnum+8;
        @row=@tmp*12+12;
        @tmp=@tmp+1;
        @brmxprint='';
        @colnum=0;
    }
 }"
</PRINT>
</RESPONSE>
</TRANSACTION>

