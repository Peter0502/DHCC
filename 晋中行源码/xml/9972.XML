<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11111001" TITLE="9972 发票调剂 "
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
  <COMMSEND>"{
  		
   	}"
</COMMSEND>
<COMMRECV>"{
	commrecv_001();
}"
</COMMRECV>
<FIRSTWORK>"{
	
}"
</FIRSTWORK>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-60s" FUNCTIONS=
    "T(9972                            发票调剂)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
   <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
   <ITEM NAME="#TXNO" 	 TYPE="%-4s" FUNCTIONS="T($TXNO=5104)"/>
   <!--输入变量-->
  <ITEM LINE="7"  	COL="20" TYPE="%-10s" FUNCTIONS="T(操 作 码:!)"/>
  <ITEM LINE="8"  	COL="20" TYPE="%-10s" FUNCTIONS="T(凭证种类:!)"/>
  <ITEM LINE="10"  	COL="20" TYPE="%-10s" FUNCTIONS="T(起始号码:)"/>
  <ITEM LINE="11"	COL="20" TYPE="%-10s" FUNCTIONS="T(终止号码:)"/>
  <ITEM LINE="12" 	COL="20" TYPE="%-10s" FUNCTIONS="T(凭证数量:)"/>
  <ITEM LINE="14" 	COL="20" TYPE="%-10s" FUNCTIONS="T(对方柜员:)"/>
  <ITEM LINE="15" 	COL="20" TYPE="%-10s" FUNCTIONS="T(柜员姓名:)"/>
  <ITEM NAME="#CZTYPE" ENABLE="FALSE"  INPUT="SELECT" LINE="7" COL="30" TYPE="%-1s" 	FUNCTIONS="T(0)"> 
  	<SELECT>
  		<OPTION VALUE="0" TITLE="付出"/>
  		<!--<OPTION VALUE="1" TITLE="收入"/>-->
  	</SELECT>
  </ITEM>
  <ITEM NAME="#NAME1"  TYPE="%-4s" FUNCTIONS="S(#CZTYPE,#CZTYPE)"/>

  <ITEM NAME="#PZZL" 	INPUT="SELECT" LINE="8" COL="30" TYPE="%-3s" 	FUNCTIONS="T(901)V(NB)">
  	<SELECT>
		<OPTION VALUE="901" TITLE="天燃气发票"/>
  		<OPTION VALUE="900" TITLE="自来水发票"/>	
  	</SELECT>
  </ITEM>
  <ITEM NAME="#NAME2"  TYPE="%-20s" FUNCTIONS="S(#PZZL,#PZZL)"/>

  <ITEM NAME="#QSHM" 	INPUT="TEXT" LINE="10"  COL="30" TYPE="%16d" 	FUNCTIONS="T()V(NB)"/>
  <ITEM NAME="#ZZHM" 	INPUT="TEXT" LINE="11" 	COL="30" TYPE="%16d" 	FUNCTIONS="T()V(NB)">
  <ONLOSTFOCUS>
  "{
         if(#ZZHM &lt; #QSHM)
         {
           showmsg('终止号码必须大于起始号码');
           return(false);
         }
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#FLAG"   TYPE="%-12s"     FUNCTIONS="G(#CZTYPE=1,#SUBMIT)">
   <ONLOSTFOCUS>
  "{
     // #PZSL=itoa((atoi(substr(#ZZHM,8,8))-atoi(substr(#QSHM,8,8))+1),'%12d'); mod 20120103
     initfd(); 
     commsend_001(); 
     $FD16='9204'; 
     $FD58=#QSHM; 
     $FD59=#ZZHM; 
     callserver(); 
     if($FD12!='0000') 
     { 
          showmsg(geterror()); 
          return(false); 
     } 
     #PZSL=$FD60; 
     show(#PZSL,true);
      enable(#PZSL,false);

  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#PZSL"   INPUT="TEXT" LINE="12" COL="30" TYPE="%12s" 	FUNCTIONS="T(0)"/>
  <ITEM NAME="#BRNO"  TYPE="%5s" FUNCTIONS="T($KINBR)"/>
  <ITEM NAME="#TLRNO" 	INPUT="TEXT" LINE="14" COL="30" TYPE="%4d" 	FUNCTIONS="T()V(NB)">
      <ONLOSTFOCUS>
	"{
		dim @txno_bak as string;
		@txno_bak=$TXNO;
		$TXNO='9803';
		commsend_001();
		$FD92=#TLRNO;
		$TXNO=@txno_bak;
		callserver();
		#GYXM=$FD26;	
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
			}
			enable(#GYXM,false);
		if(#TLRNO == $TLRNO)
		{
			showmsg('对方柜员不能是自己!');
			return(false);
		}

		if($KINBR != $FD91)
		{
			showmsg('该柜员与当前柜员不在同一机构,不允许调剂!');
			return(false);
		}

		initfd();
	}"
    </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#GYXM" 	INPUT="TEXT" LINE="15" COL="30" TYPE="%-10s" 	FUNCTIONS="T()V(NB)"/>

   
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  
  <ITEM NAME="#SUBMIT" LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
    <ONLOSTFOCUS>
	"{
		initfd();
      commsend_001();

	   $FD16='6617';              //平台凭证调剂
      $FD60='AGENT';             //平台交易类型
      $FD21='01';                //柜面发起标志
  		$FD89=#PZZL;
  		$FD58=#QSHM;
  		$FD59=#ZZHM;
  		$FD52=#PZSL;
  		$FD91=#BRNO;
  		$FD92=#TLRNO;
  		$FD26=#GYXM;
  		$FD67=#CZTYPE;


	 callagnpt();
      if($FD12!='0000'){
        showmsg(geterror());
        return(false);
      }

	   runoutput();
      rerun();
	 }"
    </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#YEAR"  TYPE="%-4s" FUNCTIONS="T($HDATE,1,4)"/>
  <ITEM NAME="#MON"   TYPE="%-2s" FUNCTIONS="T($HDATE,5,2)"/>
  <ITEM NAME="#DAY"   TYPE="%-2s" FUNCTIONS="T($HDATE,7,2)"/>
  
    </VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="发票调剂">
 NOTHING
</PACKAGE>
<PRINT>"{
        if(#CZTYPE == '0')
        {
          print( 2,  24,'交易名称:发票调剂([4])',#NAME1);
          print( 4,  20,'交易机构:[5]',$FD2);
	  print( 5,  20,'交易日期:[4]年[2]月[2]日',#YEAR,#MON,#DAY);  
	  print( 6,  20,'流水号码:[6]',$FD4);
	  print( 7,  20,'操作员号:[4]',$FD7);
	  
	  print( 9,  20,'凭证种类:[20 ]',#NAME2);
	  print( 10, 20,'对方柜员:[4  ]',#TLRNO);
	  print( 11, 20,'柜员姓名:[30 ]',#GYXM);
	  print( 12, 20,'起始号码:[16 ]',#QSHM);
	  print( 13, 20,'终止号码:[16 ]',#ZZHM);
	  print( 14, 20,'凭证数量:[12 ]',#PZSL);
        }
        else
        {
          print( 2,  24,'交易名称:发票调剂([4])',#NAME1);
          print( 4,  20,'交易机构:[5]',$FD2);
	  print( 5,  20,'交易日期:[4]年[2]月[2]日',#YEAR,#MON,#DAY);  
	  print( 6,  20,'流水号码:[6]',$FD4);
	  print( 7,  20,'操作员号:[4]',$FD7);
	  
	  print( 9,  20,'凭证种类:[20 ]',#NAME2);
	  print( 10, 20,'起始号码:[16 ]',#QSHM);
	  print( 11, 20,'终止号码:[16 ]',#ZZHM);
	  print( 12, 20,'凭证数量:[12 ]',#PZSL);
        }
}"
</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER" DESC="请打印业务专用凭证" LINESPACE="24">
 NOTHING
</PACKAGE>
<PRINT>"{
 $KINDNO='00';
 dim @txtime  as string;
@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	
	print( 5, 20,'机构名称:[30]',$BRNAME);
	print( 5, 2,'代码:9972');
	print( 5, 13,'交易:发票调剂([4])',#NAME1);
        if(#CZTYPE == '0')
        {
	print( 7, 20,'凭证种类:[20 ]',#NAME2);
	print( 8, 20,'对方柜员:[4  ]',#TLRNO);
	print( 9, 20,'柜员姓名:[30 ]',#GYXM);
	print(10, 20,'起始号码:[16 ]',#QSHM);
	print(11, 20,'终止号码:[16 ]',#ZZHM);
	print(12, 20,'凭证数量:[12 ]',ltrim(#PZSL));
        }
        else
        {
	print( 7, 20,'凭证种类:[20 ]',#NAME2);
	print( 8, 20,'起始号码:[16 ]',#QSHM);
	print( 9, 20,'终止号码:[16 ]',#ZZHM);
	print(10, 20,'凭证数量:[12 ]',ltrim(#PZSL));
        }
	print( 24,20,'备注:');
	print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
	print( 24, 5,'柜员:[4]',$FD7);
	print( 24, 5,'平台流水号:[6]',$FD32);           
}"
</PRINT>
</RESPONSE>
</TRANSACTION>
