<TRANSACTION RIGHTS="11110000" TITLE="5322 小额止付应答报文录入/发送"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
			#RECECO ='';
			lv_reset_item();
			commsend_001();
			$FD44 = #O_WT_DAY;
			commsend_123();
			commsend_hv();
}"
</COMMSEND>
<COMMRECV>"{
			commrecv_001();
			commrecv_123();

}"
</COMMRECV>

<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-70s" FUNCTIONS=
    "T(5322                        小额申请止付报文录入/发送)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=5862)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>


<ITEM  NAME="#T_CMTNO"  		TYPE="%3s"    		FUNCTIONS=""/>
<ITEM NAME="#CMTNO"				TYPE="%-3s"			FUNCTIONS="T(327)"/>
<ITEM NAME="#PAY_QS_NO"			TYPE="%-12s"		FUNCTIONS=""/>
<ITEM NAME="#OR_BR_NO"			TYPE="%-12s"		FUNCTIONS=""/>
<ITEM NAME="#SENDCO"			TYPE="%-4s"			FUNCTIONS=""/>


<ITEM NAME="#PAY_OPN_BR_NO" 	TYPE="%-12s"		FUNCTIONS=""/>
<ITEM NAME="#PAY_ADDR"			TYPE="%-60s"		FUNCTIONS=""/>
<ITEM NAME="#CASH_QS_NO"		TYPE="%-12s"		FUNCTIONS=""/>


<ITEM NAME="#RECECO"			TYPE="%-4s"			FUNCTIONS=""/>
<ITEM NAME="#CASH_OPN_BR_NO"    TYPE="%-12s"		FUNCTIONS=""/>
<ITEM NAME="#CASH_ADDR"			TYPE="%-60s"		FUNCTIONS=""/>
<ITEM NAME="#YW_TYPE"			TYPE="%-2s"			FUNCTIONS=""/>
<ITEM NAME="#ORDERNO"			TYPE="%-8s"			FUNCTIONS=""/>
<ITEM NAME="#T_ORDERNO"			TYPE="%-8s"			FUNCTIONS=""/>
<ITEM NAME="#CONTENT"			TYPE="%-60s"		FUNCTIONS=""/>


<ITEM NAME="#RATE"				TYPE="%-7s"			FUNCTIONS=""/>
<ITEM NAME="#RATEDATE"			TYPE="%-5s"			FUNCTIONS=""/>
<ITEM NAME="#PROCODE"			TYPE="%-8s"			FUNCTIONS=""/>
<ITEM NAME="#CR_DATE"           TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#CR_BR_NO"          TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#CR_TX_NUM"         TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#QR_BR_NO"          TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#QR_TX_NUM"         TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#TX_TYPE"           TYPE="%-1s"       FUNCTIONS="T(1)"/>
<ITEM NAME="#NOTPAY_ORDERNO"    TYPE="%-3s"       FUNCTIONS=""/>
<ITEM NAME="#O_NOTPAY_ORDERNO"  TYPE="%-3s"       FUNCTIONS=""/>
<ITEM NAME="#RESP1"             TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#OPERLEVEL"         TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#PROC_STS"          TYPE="%-1s"       FUNCTIONS=""/>



<ITEM NAME="#WT_DAY"            TYPE="%-8s"       FUNCTIONS="T($HDATE)"/>
<ITEM NAME="#T_WT_DAY"          TYPE="%-8s"       FUNCTIONS="T($HDATE)"/>
<ITEM NAME="#NOTPAY_DATE"       TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#CUR_NO"            TYPE="%-3s"       FUNCTIONS=""/>
<ITEM NAME="#OPCD"           	TYPE="%-2s"       FUNCTIONS="T(10)"/>
<ITEM NAME="#NOTE_TYPE"         TYPE="%-3s"       FUNCTIONS=""/>
<ITEM NAME="#NOTE_NO"           TYPE="%-16s"      FUNCTIONS=""/>
<ITEM NAME="#LW_IND"            TYPE="%-1s"       FUNCTIONS="T(1)"/>

<ITEM NAME="#HP_ADD_PWD"    	TYPE="%-1s" 		FUNCTIONS=""/>
<ITEM NAME="#PACKID"       		TYPE="%8d"  		FUNCTIONS=""/>
<ITEM NAME="#O_PACKID"          TYPE="%8d"       	FUNCTIONS=""/>
<ITEM NAME="#PACK_DATE"     	TYPE="%8d"  		FUNCTIONS=""/>
<ITEM NAME="#O_PACK_DATE"   	TYPE="%8d"  		FUNCTIONS=""/>
<ITEM NAME="#TXNUM"     		TYPE="%5d"  		FUNCTIONS=""/>
<ITEM NAME="#LV_YW_IND"     	TYPE="%12s" 		FUNCTIONS=""/>
<ITEM NAME="#RESP_DATE"     	TYPE="%8d"  		FUNCTIONS=""/>
<ITEM NAME="#RCP_STS"       	TYPE="%2d"  		FUNCTIONS=""/>
<ITEM NAME="#RESP2"             TYPE="%8s"       FUNCTIONS=""/>
<ITEM NAME="#RETCODE"           TYPE="%2d"       FUNCTIONS=""/>
<ITEM NAME="#YW_DTL_ID"         TYPE="%8d"       FUNCTIONS=""/>
<ITEM NAME="#ACC_IND"           TYPE="%1d"       FUNCTIONS=""/>
<ITEM NAME="#DF_FREEAMT"        TYPE="%16s"      FUNCTIONS=""/>
<ITEM NAME="#PROTNO"            TYPE="%60s"      FUNCTIONS=""/>
<ITEM NAME="#PO_NO"             TYPE="%8d"       FUNCTIONS=""/>
<ITEM NAME="#PO_TYPE"           TYPE="%1d"       FUNCTIONS=""/>
<ITEM NAME="#OTYPE"             TYPE="%1d"       FUNCTIONS="T(1)"/><!-- 表示大额 -->






  <ITEM LINE="5"  COL="05"  TYPE="%-11s" FUNCTIONS="T(止付类型:)"/>

  <BLOCK NAME="MUL_LB" COL="0" LINE="0" VISABLE="FALSE"><!--整包-->
  <ITEM LINE="6"  COL="05"  TYPE="%-11s" FUNCTIONS="T(原包序号:)"/>
  <ITEM LINE="6"  COL="47"  TYPE="%-11s" FUNCTIONS="T(原组包日期:)"/>
  <ITEM LINE="8"  COL="05"  TYPE="%-11s" FUNCTIONS="T(原包类型号:)"/>
  </BLOCK >

  <BLOCK NAME="SIGN_LB" COL="0" LINE="0" VISABLE="TRUE" ><!--单笔-->
  <ITEM LINE="6"  COL="05"  TYPE="%-11s" FUNCTIONS="T(原支付序号:)"/>
  <ITEM LINE="6"  COL="47"  TYPE="%-11s" FUNCTIONS="T(原委托日期:)"/>
  <ITEM LINE="7"  COL="05"  TYPE="%-11s" FUNCTIONS="T(原业务编号:)"/>
  </BLOCK >

  <ITEM LINE="9"  COL="05"  TYPE="%-11s" FUNCTIONS="T(附      言:)"/>

  <BLOCK NAME="BLOCK_DETAIL_LB" COL="0" LINE="0" VISABLE="FALSE">
  <ITEM LINE="10"  COL="05"  TYPE="%-60s"  FUNCTIONS=
		"T(                   【支付交易详细信息】)"/>
  <ITEM LINE="11" COL="5"  TYPE="%-11s" FUNCTIONS="T(接收行行号:)"/>
  <ITEM LINE="12" COL="5"  TYPE="%-11s" FUNCTIONS="T(接受行名称:)"/>
  <ITEM LINE="13" COL="5"  TYPE="%-11s" FUNCTIONS="T(原付款帐号:)"/>
  <ITEM LINE="14" COL="5"  TYPE="%-12s" FUNCTIONS="T(原付款名称:)"/>
  <ITEM LINE="15" COL="5"  TYPE="%-12s" FUNCTIONS="T(原收款帐号:)"/>
  <ITEM LINE="16" COL="5"  TYPE="%-11s" FUNCTIONS="T(原收款名称:)"/>
  <ITEM LINE="17" COL="5"  TYPE="%-11s" FUNCTIONS="T(原清算金额:)"/>
  </BLOCK>	


  <ITEM LINE="05"  COL="17" NAME="#REQ_TYPE"   TYPE="%1s" INPUT="SELECT"  DEVICE="KEYBOARD"  FUNCTIONS="V(NB)T(0)V(0,1)">
 	 <SELECT LINE="05" COL="20">
      		<OPTION VALUE="0" TITLE="0.单笔"/>
      		<OPTION VALUE="1" TITLE="1.整包"/>
    </SELECT>
	<ONLOSTFOCUS>
	"{
		dim @txnum as string;
		@txnum = #O_TXNUM;
		showblock('MUL_LB',false,false);

		show(#O_TXNUM	  ,false);

		showblock('BLOCK_DETAIL_LB',false,true);
		showblock('BLOCK_DETAIL_TX',false,true);

		if(#REQ_TYPE=='0')
		{
			showblock('MUL_LB',false,false);
			showblock('SIGN_LB',true,true);
			#O_TXNUM = @txnum;
			show(#O_TXNUM	  ,true);
			show(#O_CMTNO		,false);

			
		}
		else if(#REQ_TYPE=='1')
		{
			showblock('BLOCK_DETAIL_LB',false,true);
			showblock('BLOCK_DETAIL_TX',false,true);
			showblock('SIGN_LB',false,false);
			showblock('MUL_LB',true,true);
			show(#O_CMTNO		,true);
			show(#O_TXNUM	  ,false);
			
		}
	}"
	</ONLOSTFOCUS>
	</ITEM>
		
  <ITEM LINE="06"  COL="17" NAME="#OORDERNO"   TYPE="%8d"  DEVICE="KEYBOARD"  FUNCTIONS="V(NB)"/>
  <ITEM  NAME="#T_OORDERNO"   TYPE="%8s"    FUNCTIONS=""/>
  <ITEM LINE="06"  COL="58" NAME="#O_WT_DAY"   TYPE="%-8s"  DEVICE="KEYBOARD" FUNCTIONS="V(NB)D()">
</ITEM>
  <ITEM LINE="07"  COL="17" NAME="#O_TXNUM"   TYPE="%5s" INPUT="SELECT"   DEVICE="KEYBOARD" FUNCTIONS="V(NB)T(00113)">
 	 <SELECT LINE="06" COL="20">
                <OPTION VALUE="00113 "      TITLE="0.国库资金借记划拨 "/>
                <OPTION VALUE="00119 "      TITLE="0.其他借记业务     "/>
                <OPTION VALUE="20103 "      TITLE="0.财政直接支付     "/>
                <OPTION VALUE="20104 "      TITLE="0.财政授权支付     "/>
                <OPTION VALUE="30102 "      TITLE="0.支票截留业务     "/>
                <OPTION VALUE="00114 "      TITLE="0.定期借记业务     "/>
                <OPTION VALUE="20102 "      TITLE="0.批量扣税         "/>
	
    </SELECT>
  <ONLOSTFOCUS>
  "{
		if(#REQ_TYPE=='0')
		{

			initfd();
			commsend_001();


			dim @req_type  as string;

			@req_type = #REQ_TYPE;

			#T_CMTNO = #O_CMTNO; //备份
			#T_WT_DAY = #O_WT_DAY;//备份
			#T_ORDERNO=#OORDERNO;//备份

			#ORDERNO = #OORDERNO;
			#CMTNO   = #O_CMTNO;
			#WT_DAY  = #O_WT_DAY;


			commsend_123();
			commsend_hv();

			$FD16 = '9564';
			callserver();

			if($FD12=='9999')
			{
				showmsg('原支付交易不存在,交易终止!');
				return (false);
			}
			if($FD12!='0000')
			{
				showmsg(geterror());
				return (false);
			}


			showblock('BLOCK_DETAIL_LB',true,true);
			showblock('BLOCK_DETAIL_TX',true,true);
			setitems('#CMTNO#T_CMTNO#PAY_QS_NO#OR_BR_NO#SENDCO#PAY_OPN_BR_NO#PAY_AC_NO#PAY_NAME#PAY_ADDR#CASH_QS_NO#AC_BR_NO#RECECO#CASH_OPN_BR_NO#CASH_AC_NO#CASH_NAME#CASH_ADDR#YW_TYPE#ORDERNO#CONTENT#RATE#RATEDATE#T_OORDERNO#PROCODE#CR_DATE#CR_BR_NO#CR_TX_NUM#QR_BR_NO#QR_TX_NUM#TX_TYPE#NOTPAY_CONTENT#NOTPAY_ORDERNO#O_NOTPAY_ORDERNO#RESP1#OPERLEVEL#PROC_STS#OPCD#LW_IND#HP_ADD_PWD#PACKID#O_PACKID#PACK_DATE#O_PACK_DATE#TXNUM#O_TXNUM#LV_YW_IND#RESP_DATE#RCP_STS#RESP2#RETCODE#YW_DTL_ID#ACC_IND#REQ_TYPE#DF_FREEAMT#PROTNO#PO_NO#PO_TYPE#OTYPE',$FD123);
			#TX_AMT =val($FD39)/100;
			
			#REQ_TYPE = @req_type;

			
			$FD16 = '9553';
			$FD32 = #AC_BR_NO;
			callserver()
			if($FD12!='0000')
			{
				showmsg(geterror());
				return (false);
			}

			#BR_NAME = substr($FD96,0,60);
			show(#AC_BR_NO,true);
			show(#BR_NAME  ,true);
			show(#PAY_AC_NO,true);
			show(#PAY_NAME,true);
			show(#CASH_AC_NO,true);
			show(#CASH_NAME,true);
			show(#TX_AMT,true);
			show(#AC_BR_NO,true);

			enable(#AC_BR_NO,false);
			enable(#BR_NAME ,false);
			enable(#PAY_AC_NO,false);
			enable(#PAY_NAME,false);
			enable(#CASH_AC_NO,false);
			enable(#CASH_NAME,false);
			enable(#TX_AMT,false);

			#CMTNO = '327';
			#O_WT_DAY = #T_WT_DAY;
			#ORDERNO  = '';
		}
	}"
</ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="08"  COL="17" NAME="#O_CMTNO"   TYPE="%-3s" INPUT="SELECT" VISABLE="FALSE"   DEVICE="KEYBOARD" FUNCTIONS="V(NB)T(002)">
 	 <SELECT LINE="06" COL="20">
           <OPTION VALUE="002 "      TITLE="0.普通借记"/>
           <OPTION VALUE="006 "      TITLE="1.定期借记"/>
	
    </SELECT>
  </ITEM>
  <ITEM LINE="09" COL="17" NAME="#T_NOTPAY_CONTENT"     TYPE="%-60s"   DEVICE="KEYBOARD" FUNCTIONS="V(NB)J(#CASH_NAME)"/>
<ITEM NAME="#NOTPAY_CONTENT" TYPE="%-255s" FUNCTIONS="T(#T_NOTPAY_CONTENT)"/>

  <!------上面到这里都是要输入的项目---------->
   <BLOCK NAME="BLOCK_DETAIL_TX" LINE="0" COL="0" VISABLE="FALSE"> 
  <ITEM LINE="11" COL="17" NAME="#AC_BR_NO"     TYPE="%-12s" DEVICE="KEYBOARD" FUNCTIONS=""/>
  <ITEM LINE="12" COL="17" NAME="#BR_NAME"      TYPE="%-50s"  DEVICE="KEYBOARD" FUNCTIONS=""/>

  <ITEM LINE="13" COL="17" NAME="#PAY_AC_NO"     TYPE="%-32s" DEVICE="KEYBOARD" FUNCTIONS=""/>
  <ITEM LINE="14" COL="17" NAME="#PAY_NAME"      TYPE="%-60s"  DEVICE="KEYBOARD" FUNCTIONS=""/>
  <ITEM LINE="15" COL="17" NAME="#CASH_AC_NO"    TYPE="%-32s" DEVICE="KEYBOARD" FUNCTIONS=""/>
  <ITEM LINE="16" COL="17" NAME="#CASH_NAME"     TYPE="%-60s"  DEVICE="KEYBOARD" FUNCTIONS=""/>
  <ITEM NAME ="#VAL" TYPE="%-16s" FUNCTIONS=""/>
  
  <ITEM LINE="17" COL="17" NAME="#TX_AMT"    	 TYPE="%16.2f" DEVICE="KEYBOARD" FUNCTIONS=""/>
  </BLOCK>

  <ITEM LINE="21" COL="59" NAME="#OK"   TYPE="%-6s"  INPUT="SUBMIT"  FUNCTIONS="T(确  定)"/>

 </VARIABLE>

<!--接收信息包-->
<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="按任意键退出">
NOTHING
</PACKAGE>
    <PRINT>"{
    dim @txtime as string;
  @txtime = substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
   print(3,25,'小额止付申请报文录入/发送');
        print(5,15,'交易机构 :[7]',$FD3);
        print(6,15,'发起行号 :[12]',#OR_BR_NO);
        print(7,15,'委托日期 :[8]',#WT_DAY);
        print(8,15,'交易序号 :[8]',#ORDERNO);
        print(9,15,'流水号码 :[ 6]',$FD4);
        print(10,15,'附    言 :[60]',#T_NOTPAY_CONTENT);
        print(13,15,'时     间: [10         ]   操作员号:[4]',@txtime,$FD7);
}"
</PRINT>
</RESPONSE>

<RESPONSE>
<PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="请打印业务专用凭证">
NOTHING
</PACKAGE>
    <PRINT>"{
    $KINDNO='00';
    dim @txtime as string;
  @txtime = substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
   
   print( 5,20,'机构名称:[30]',$BRNAME);  
   print( 5,2,'代码:5322');
   print( 5,13,'交易:小额止付申请报文录入/发送');

   print(07,20,'委托日期:[8       ]',$HDATE);
   print(08,20,'发起行号:[12]',#OR_BR_NO);
   print(09,20,'交易序号:[8]',#ORDERNO);
   print(10,20,'附    言:[60                                                          ]',#T_NOTPAY_CONTENT);
   print(24,20,'备注:');
   print(24,27,'交易日期:[8] [8]',$HDATE,@txtime);
   print(24,5,'柜员:[4]',$FD7);
   print(24,5,'流水号:[6]',$FD4);
   
}"
</PRINT>
</RESPONSE>

</TRANSACTION>
	

