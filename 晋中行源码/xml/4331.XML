<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110100" TITLE="4331 小区信息查询打印"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
}"
</COMMSEND>
<COMMRECV>"{
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(4331                        小区信息查询打印)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO"    TYPE="%-4s"  FUNCTIONS="T($TXNO=8126)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s"  FUNCTIONS="T($MSGTYPE=03001)"/>

	<ITEM NAME="#LACNO" LINE="06" COL="10" TYPE="%-10s" INPUT="LABEL" FUNCTIONS="T(主 账 户:)" />
	<ITEM NAME="#ACTNO" LINE="06" COL="20" TYPE="%-19s" INPUT="TEXT"  FUNCTIONS="T()V(NB)" >
		<ONLOSTFOCUS>
		"{
				initfd();
				commsend_001();
				$FD16='9706';
				$FD30=#ACTNO;
				callserver();
				if($FD12!='0000')
				{
					showmsg(geterror());
					return(false);
				}
				if($FD2!=$KINBR)
				{
					showmsg('请到开户网点办理业务');
					return(false);
				}
				if(substr($FD88,0,1)!='1')
				{
					showmsg('此账户不能开立子账户');
					return(false);
				}
				// if(substr($FD88,9,1)!='1')
				// {
				// 	showmsg('此账户不能关联小区');
				// 	return(false);
				// }
				#ZHMC=delspace($FD25);
				#TEMP1=delspace($FD30);

		}"
		</ONLOSTFOCUS>
	</ITEM>
	<ITEM NAME="#TEMP1" TYPE="%-50s" FUNCTIONS=""/>
	<ITEM NAME="#LZHMC"  LINE="07" COL="10" TYPE="%-10s" INPUT="LABEL" FUNCTIONS="T(客户名称:)"/>
	<ITEM NAME="#ZHMC"   LINE="07" COL="20" TYPE="%-50s" INPUT="LABEL" FUNCTIONS=""/>
	<ITEM NAME="#LXQH" LINE="09" COL="10" TYPE="%-10s" INPUT="LABEL" FUNCTIONS="T(小区编号:)" />
	<ITEM NAME="#XQBH" LINE="09" COL="20" TYPE="%-6s" INPUT="TEXT"  FUNCTIONS="T()" >
		<ONLOSTFOCUS>
		"{
			dim @tota  as string;
			if(#XQBH!='')
			{
				initfd();
				commsend_001();
				$FD16='9598';
				$FD123='select xqdz15 from xqdz where xqdz100 in('+chr(39)+#ACTNO+chr(39)+','+chr(39)+#TEMP1+chr(39)+') and xqdz101='+chr(39)+#XQBH+chr(39);
				@tota=callserver();
				if($FD12!='0000')
				{
					showmsg(geterror());
					return(false);
				}
				#XQMC=strfld(@tota,'|',0);
				if(#XQMC=='')
				{
					showmsg('小区信息错误');
					return(false);
				}
				refresh();
			}
		}"
		</ONLOSTFOCUS>
	</ITEM>
	<ITEM NAME="#LXQMC" LINE="10" COL="10" TYPE="%-10s" INPUT="LABEL" FUNCTIONS="T(小区名称:)" />
	<ITEM NAME="#XQMC"  LINE="10" COL="20" TYPE="%-10s" INPUT="LABEL" FUNCTIONS="" />
	<ITEM NAME="#LLPH" LINE="11" COL="10" TYPE="%-10s" INPUT="LABEL" FUNCTIONS="T(楼盘编号:)" />
	<ITEM NAME="#LPBH" LINE="11" COL="20" TYPE="%-6s" INPUT="TEXT"  FUNCTIONS="T()" />
	<ITEM NAME="#LDYH" LINE="11" COL="30" TYPE="%-10s" INPUT="LABEL" FUNCTIONS="T(单元编号:)" />
	<ITEM NAME="#DYBH" LINE="11" COL="40" TYPE="%-6s" INPUT="TEXT"  FUNCTIONS="T()" />
	<ITEM NAME="#LFJH" LINE="12" COL="10" TYPE="%-10s" INPUT="LABEL" FUNCTIONS="T(房间编号:)" />
	<ITEM NAME="#FJBH" LINE="12" COL="20" TYPE="%-6s" INPUT="TEXT"  FUNCTIONS="T()" />
	<ITEM LINE="13" COL="10" TYPE="%-18s" INPUT="LABEL" FUNCTIONS="T(是否保留数据文件:)" />
	<ITEM NAME="#FLAG" LINE="13" COL="30" TYPE="%-1s" INPUT="SELECT"  FUNCTIONS="T(1)">
     <SELECT>
           <OPTION VALUE="0" TITLE="0.不保留"/>
           <OPTION VALUE="1" TITLE="1.保留数据文件"/>
     </SELECT>
	</ITEM>
	<!--日期没用到 先注释掉吧...要用的时候再放开吧
	<ITEM NAME="#LDATE" LINE="12" COL="10" TYPE="%-10s" INPUT="LABEL" FUNCTIONS="T(日期范围:)"/>
	<ITEM NAME="#START" LINE="12" COL="20" TYPE="%8d"   INPUT="TEXT"  FUNCTIONS=""/>
	<ITEM LINE="12"    COL="29"  TYPE="%-3s" INPUT="LABEL" FUNCTIONS="T(-->)"/>-->
  <!--
	<ITEM NAME="#END"   LINE="12" COL="32" TYPE="%8d"   INPUT="TEXT"  FUNCTIONS="">
		<ONLOSTFOCUS>
		"{
			if(#START &gt; #END)
			{
				showmsg('输入日期错误');
				return(false);
			}
		}"
		</ONLOSTFOCUS>
	</ITEM>-->
<!-------------------
	<ITEM NAME="#CLFS"  TYPE="%-1s"   FUNCTIONS="" >
		<ONLOSTFOCUS>
		"{
	 			dim @tota as string;
				dim @f    as string;
				dim @selid as number;
				dim @xq_no as string;

	  		initfd();
	  		commsend_001();
	  		$FD16='8126';
	  		$FD30=#ACTNO;
	  		$FD46=#START;
	  		$FD47=#END;
	  		$FD71='1';
	  		$FD72='1';
	  		$FD86=#XQBH;
	  		@tota=callserver();
	  		if($FD12!='0000')
	  		{
	  			showmsg(geterror());
	  			return(false);
	  		}
		  	#TEMP3='';
		  	autolist(@tota);
		  	if(list_work() &gt;= 0)
		  	{
		  		//list_work();
		  		@selid=list_getselid();
		  		#TEMP3=list_gettext(@selid,0);
		  	}
		  	else
		  	{
		  		list_del();
			  	rerun();
			  	return(true);
		  	}
		}"
		</ONLOSTFOCUS>
	</ITEM>
--------------------->
	<ITEM NAME="#CLFS"  TYPE="%-1s"   FUNCTIONS="" >
		<ONLOSTFOCUS>
		"{
			if((#XQBH=='') and (#LPBH=='') and (#DYBH=='') and (#FJBH==''))
			{
	 			dim @tota as string;
				dim @f    as string;
				dim @selid as number;
				dim @xq_no as string;
				dim @filename as string;
				dim @file     as file;
				dim @line     as string;
				@filename='../tmp/'+$KINBR+$TTYNAME;
	  		initfd();
	  		commsend_001();
	  		$FD16='8126';
	  		$FD30=#ACTNO;
	  		$FD46=#START;
	  		$FD47=#END;
	  		$FD71='1';
	  		$FD72='1';
	  		$FD86=#XQBH;
	  		@tota=callserver();
	  		if($FD12!='0000')
	  		{
	  			showmsg(geterror());
	  			return(false);
	  		}
				savefiletxt(@filename,@tota);///
		  	#TEMP3='';
		  	list_init(16,70,7,2);
		  	list_setcolcnt(4);
		  	list_setcol(0,'小区编号',10);
		  	list_setcol(1,'小区名称',30);
		  	list_setcol(2,'子户数量',12);
		  	list_setcol(3,'余额小计',20);
				@file=openfile(@filename,'rb');
				if(@file &lt; 0)
				{
					showmsg(geterror());
					return(false);
				}
				@line=readline(@file);
				while(@line!='')
				{
					@line=readline(@file);
					list_additem('',strfld(@line,'|',0),strfld(@line,'|',1),strfld(@line,'|',2),strfld(@line,'|',3));
				}
				closefile(@file);
		  	if(list_work() &gt;= 0)
		  	{
		  		//list_work();
		  		@selid=list_getselid();
		  		#TEMP3=list_gettext(@selid,0);
		  	}
		  	else
		  	{
		  		list_del();
			  	rerun();
			  	return(true);
		  	}
			}
		}"
		</ONLOSTFOCUS>
	</ITEM>
	<ITEM NAME="#TEMP3" TYPE="%5s" FUNCTIONS=""/>
	<ITEM NAME="#TEMP2" TYPE="%1s"  FUNCITIONS="">
		<ONLOSTFOCUS>
		"{
	 			dim @tot  as string;
				initfd();
		  	commsend_001();
		  	$FD16='8126';
		  	$FD30=#ACTNO;
		  	$FD46=#START;
		  	$FD47=#END;
		  	$FD71='2';
		  	$FD72='1';
				if((#XQBH=='') and (#LPBH=='') and (#DYBH==''))
				{
		  		$FD86=#TEMP3;
				}else
				{
					$FD86=#XQBH;
				}
				$FD87=#LPBH;
				$FD88=#DYBH;
				$FD73=#FJBH;
			  @tot=callserver();
			  if($FD12!='0000')
			  {
			  	showmsg(geterror());
			  	return(false);
			  }
				call('rm -f ../tmp/tmp_4331');
			  savefiletxt('../tmp/tmp_4331',@tot);
			  autolist(@tot);
			  list_work();
			  list_del();
			  return(true);
		}"
		</ONLOSTFOCUS>
	</ITEM>
	<ITEM NAME="#TEMP2" TYPE="%1s"  FUNCITIONS="">
		<ONLOSTFOCUS>
		"{
				if(#FLAG=='1')
				{
					call('fview ../tmp/tmp_4331');
				}
		}"
		</ONLOSTFOCUS>
	</ITEM>
  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
</VARIABLE>
</TRANSACTION>

