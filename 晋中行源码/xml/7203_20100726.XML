<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11111001" TITLE="7203 现金调剂"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	initfd();
	commsend_001();
   	$FD16='5203';
	$FD92=#DFGY;
	$FD86=#DFGYTC;
	$FD67=#TJFS;
	$FD21=#BZ;
	$FD41=getitems('#TJJE');
}"
</COMMSEND>
<COMMRECV>"{
		commrecv_001();
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(7203                            现金调剂)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=5203)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  <!--输入变量-->
  <ITEM LINE="6"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(                             【 现金调剂 】)"/>
  <ITEM LINE="8"  COL="3" TYPE="%-74s" FUNCTIONS=
   "T(--------------------------------------------------------------------------)"/>
  
  <ITEM LINE="10" COL="16" TYPE="%-9s" FUNCTIONS="T(调剂方式!)"/>
  <ITEM LINE="12" COL="16" TYPE="%-9s" FUNCTIONS="T(对方柜员:)"/>
  <ITEM LINE="14" COL="16" TYPE="%-9s" FUNCTIONS="T(币    种!)"/>
  <ITEM LINE="16" COL="16" TYPE="%-9s" FUNCTIONS="T(调剂金额:)"/>
  <ITEM NAME="#TJFS" INPUT="SELECT" LINE="10" COL="25" TYPE="%-1s" FUNCTIONS="T(1)">
  <SELECT>
		<OPTION VALUE="1" TITLE="1.付出"/>
		<OPTION VALUE="2" TITLE="2.收入"/>
		<OPTION VALUE="3" TITLE="3.收回"/>
	</SELECT>
  </ITEM>
  <ITEM NAME="#DFGY" INPUT="TEXT" LINE="12" COL="25" TYPE="%-4s" FUNCTIONS="V(NB)T()">
  <ONLOSTFOCUS>
 "{	initfd();	
    commsend_001();
 		$FD16='9718';
		$FD92=#DFGY;
		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		#DFGYTC=delspace($FD86);
		#DFBRNO=delspace($FD91);
		show(#DFGYTC,true);
		enable(#DFGYTC,false);
		if(#DFGY == $TLRNO)
		{
			showmsg('对方柜员不能是自己!');
			return(false);
		}
		if($KINBR != #DFBRNO)
		{
			showmsg('该柜员与当前柜员不在同一机构,不允许调剂!');
			return(false);
		}
 }"
 </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#DFBRNO" TYPE="%-5s" FUNCTIONS=""/><!---对方柜员机构号--->

  <ITEM NAME="#DFGYTC" INPUT="TEXT" LINE="12" COL="31" TYPE="%-10s" FUNCTIONS=""/>
  <ITEM NAME="#BZ" INPUT="SELECT" LINE="14" COL="25" TYPE="%-2s" FUNCTIONS="T(01)">
  <SELECT>
		<OPTION VALUE="01" TITLE="人民币"/>

		<!----现在只留下人民币选项
		<OPTION VALUE="12" TITLE="英镑"/>
		<OPTION VALUE="13" TITLE="港元"/>
		<OPTION VALUE="14" TITLE="美元"/>
		<OPTION VALUE="15" TITLE="瑞士法郎"/>
		<OPTION VALUE="27" TITLE="日元"/>
		<OPTION VALUE="28" TITLE="加元"/>
		<OPTION VALUE="29" TITLE="澳元"/>
		<OPTION VALUE="38" TITLE="欧元"/>
		---->
	</SELECT>
  <ONLOSTFOCUS>
 "{	initfd();
 		dim @tota as string;	
    commsend_001();
 		$FD16='9714';
 		$FD21=#BZ;
 		$FD67=#TJFS;
 		$FD92=#DFGY;
		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		commsend_001();
 		$FD16='9300';
 		$FD21=#BZ;
 		$FD92=#DFGY;
		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		if (#TJFS!='1') 
		{
		#TJJE= val($FD41, 0.01);
		enable(#TJJE, false);
		}
 }"
 </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#TJJE" INPUT="TEXT" LINE="16" COL="25" TYPE="%17.2f" FUNCTIONS="V(0000000000000001,0000999999999999)"/>
  <!--------
  <ONLOSTFOCUS>
  "{
	open('7205.XML','#BOX='+@monyebox+';');
	return(true);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#MONEYBOX" TYPE="%-1s" FUNCTIONS="T(1)"/>
  -------->
  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  <ITEM NAME="#NAME1"  TYPE="%-20s" FUNCTIONS="S(#TJFS,#TJFS)"/>
  <ITEM NAME="#NAME5"  TYPE="%-20s" FUNCTIONS="S(#BZ,#BZ)"/>
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
   <ITEM NAME="#YEAR"  TYPE="%-4s" FUNCTIONS="T($FD5,1,4)"/>
  <ITEM NAME="#MON"   TYPE="%-2s" FUNCTIONS="T($FD5,5,2)"/>
  <ITEM NAME="#DAY"   TYPE="%-2s" FUNCTIONS="T($FD5,7,2)"/>
</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="现金调剂">
 NOTHING
 </PACKAGE>
  <PRINT>"{
          print( 2,  24,'交易名称:现金调剂');
          print( 4,  20,'交易机构:[5]',$FD2);
	  print( 5,  20,'交易日期:[4]年[2]月[2]日',#YEAR,#MON,#DAY);  
	  print( 6,  20,'流水号码:[6]',$FD4);
	  print( 7,  20,'操作员号:[4]',$FD7);
	  print( 8,  20,'调剂方式:[20 ]',#NAME1);
	  print( 9,  20,'对方柜员:[4  ]  [10]',#DFGY,#DFGYTC);
	  print( 10, 20,'币    种:[20 ]',#NAME5); 
	  print( 11, 20,'调剂金额:[20 ]',ltrim(comma(itoa(#TJJE,'%17.2f'),16)));
	}"
</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="请打印业务专用凭证">
 NOTHING
 </PACKAGE>
  <PRINT>"{
	$KINDNO='00';
	dim @txtime  as string;
	@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
                print( 5, 20,'机构名称:[30]',$BRNAME);  
                print( 5, 2,'代码:7203');
                print( 5, 13,'交易:现金调剂');

	        print( 7, 20,'调剂方式:[20 ]',#NAME1);
	        print( 8, 20,'对方柜员:[4  ]  [10]',#DFGY,#DFGYTC);
	        print( 9, 20,'币    种:[20 ]',#NAME5); 
	        print(10, 20,'调剂金额:[20 ]',ltrim(comma(itoa(#TJJE,'%17.2f'),16)));
		print(24,20,'备注:');
		print(24,27,'交易日期:[8] [8]',$HDATE,@txtime);
                print(24,5,'柜员:[4]',$FD7);
                print(24,5,'流水号:[6]',$FD4); 
	}"
</PRINT>
</RESPONSE>
<OUTPUT>
</OUTPUT>
<LASTWORK>
"{
	dim @moneybox as string;
	@moneybox = '1';
	#TJFS='1';
	#DFGY='';
	#DFGYTC='';
	#TJJE='0';
	open('7205.XML','#BOX='+@moneybox+';');

}"
</LASTWORK>
</TRANSACTION>
