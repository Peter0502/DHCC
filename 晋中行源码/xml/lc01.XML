<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11111001" TITLE="2702 理财产品认购"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
    commsend_001();
    $FD16='2219';
    $FD67='1';
    $FD34='1';
    $FD39=#RGJE;
    $FD30=#ZH;
    $FD68=#KHLX;
    $FD63=#CPDM;
    $FD86=#XYBH;
    $FD92=#KHJL;
    if(#KHLX == '2')
    {
    	$FD69=#DLZJLX;
    	$FD62=#DLZJHM;
    	$FD25=#DLRXM;
    }
}"
</COMMSEND>
<COMMRECV>"{
		commrecv_001();
		if($FD12 != '0000')
		{
			showmsg(geterror());
			return(false);
		}
		#YQSYL=$FD84;
		#YQSY=$FD100_1;
}"
</COMMRECV>
<FIRSTWORK>
"{
	dim @sel_buf as string;
	dim @tota as string;
	initfd();
	commsend_001();
	$FD16='8018';
	$FD65='0002';
	@tota=callserver();
	if($FD12 != '0000')
	{
		showmsg(geterror());
		return(false);
	}
	//showmsg('buf=['+@sel_buf+']');
	setsel(#CPDM,@tota,'o5t20o1v4o2');
	show(#CPDM,true);
}"
</FIRSTWORK>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-54s" FUNCTIONS=
    "T(2702                         理财产品认购)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=2219)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  <PAGE NAME="DEFAULT"> 
  <BLOCK NAME="COMMON" LINE="6" COL="3">
  <!--显示变量-->
  <ITEM LINE="0"  COL="5"  TYPE="%-10s"  FUNCTIONS="T(产品代码:)"/>
  <ITEM LINE="0"  COL="35" TYPE="%-10s"  FUNCTIONS="T(产品名称:)"/>
  <ITEM LINE="1"  COL="5"  TYPE="%-10s"  FUNCTIONS="T(产品类型:)"/>
  <ITEM LINE="1"  COL="35" TYPE="%-10s"  FUNCTIONS="T(收益类型:)"/>
  <ITEM LINE="2"  COL="5"  TYPE="%-12s"  FUNCTIONS="T(募集起始日:)"/>
  <ITEM LINE="2"  COL="35" TYPE="%-12s"  FUNCTIONS="T(募集结束日:)"/>
  <ITEM LINE="3"  COL="5"  TYPE="%-12s"  FUNCTIONS="T(产品起息日:)"/>
  <ITEM LINE="3"  COL="35" TYPE="%-12s"  FUNCTIONS="T(产品到期日:)"/>
  <ITEM LINE="4"  COL="5"  TYPE="%-10s"  FUNCTIONS="T(期    限:)"/>
  <ITEM LINE="4"  COL="35" TYPE="%-10s"  FUNCTIONS="T(币    种:)"/>
  <ITEM LINE="5"  COL="5"  TYPE="%-10s"  FUNCTIONS="T(客户类型:)"/>
  <ITEM LINE="5"  COL="35" TYPE="%-10s"  FUNCTIONS="T(风险等级:)"/>
  <ITEM LINE="6"  COL="5"  TYPE="%-10s"  FUNCTIONS="T(投资方向:)"/>
  <ITEM LINE="6"  COL="35" TYPE="%-12s"  FUNCTIONS="T(预期收益率:)"/>
  <ITEM LINE="7"  COL="5"  TYPE="%-10s"  FUNCTIONS="T(手续费率:)"/>
  <ITEM LINE="7"  COL="35" TYPE="%-10s"  FUNCTIONS="T(托管费率:)"/>
  <ITEM LINE="8"  COL="5"  TYPE="%-10s"  FUNCTIONS="T(发售总额:)"/>
  <ITEM LINE="8"  COL="35" TYPE="%-10s"  FUNCTIONS="T(单份金额:)"/>
  <ITEM LINE="9"  COL="5"  TYPE="%-12s"  FUNCTIONS="T(总行剩余额:)"/>
  <ITEM LINE="9"  COL="35" TYPE="%-12s"  FUNCTIONS="T(机构剩余额:)"/>
  <ITEM LINE="10" COL="5"  TYPE="%-12s"  FUNCTIONS="T(个人最低额:)"/>
  <ITEM LINE="10" COL="35" TYPE="%-12s"  FUNCTIONS="T(对公最低额:)"/>
  <ITEM LINE="11" COL="5"  TYPE="%-10s"  FUNCTIONS="T(递增金额:)"/>
  <ITEM LINE="11" COL="35" TYPE="%-10s"  FUNCTIONS="T(允许赎回:)"/>
  <ITEM LINE="12" COL="5"  TYPE="%-10s"  FUNCTIONS="T(允许撤销:)"/>
  <ITEM LINE="12" COL="35" TYPE="%-10s"  FUNCTIONS="T(管理费率:)"/>
  <!--输入产品代码-->
  <ITEM  LINE="0"   COL="15" TYPE="%-8s"  NAME="#CPDM" DEVICE="KEYBOARD" INPUT="TEXT" FUNCTIONS="V(NB)">
    <ONLOSTFOCUS>
	  "{
	  	dim @tota as string;
	    initfd();
	  	commsend_001();
	  	$FD16='8018';
	  	$FD62=#CPDM;
	  	$FD65='0001';	  	
	  	@tota=callserver();
	  	if($FD12 != '0000')
	  	{
	  		showmsg(geterror());
	  		goitem(#NT_PAGE);
	  		//return(false);
	  	}
	  	//#CPMC =  $FD25;
	  	//#CPLX =  $FD67;
	  	//#SYLX =  $FD68;
	  	//#MJQSR=  $FD44;
	  	//#MJJSR=  $FD45;
	  	//#CPQXR=  $FD46;
	  	//#CPDQR=  $FD47;
	  	//#QX   =  $FD28;
	  	//#BZ   =  $FD22;
	  	//#KHLX =  $FD70;
	  	//#FXDJ =  $FD69;
	  	//#TZFX =  $FD72;
	  	//#YQSYL=  $FD21;
	  	//#SXFL =  $FD84;
	  	//#TGFL =  $FD85;
	  	//#FSZE =  $FD39;
	  	//#DFJE =  $FD40;
	  	//#ZHSYE=  #FSZE - $FD43;
	  	//#JGSYE=  $FD100_1;
	  	//#GRZDE=  $FD41;
	  	//#DGZDE=  $FD42;
	  	//#DZJE =  $FD100_2;
	  	//#YXSH =  $FD93;
	  	//#YXCX =  $FD71;
	  	//#GLFL =  $FD97	
	  }"
    </ONLOSTFOCUS>
  </ITEM>
  <!--回显变量-->
  <ITEM NAME="#CPMC"  INPUT="LABEL"   LINE="0"   COL="45" TYPE="%-30s" FUNCTIONS=""/>
  <ITEM NAME="#CPLX"  INPUT="LABEL"   LINE="1"   COL="15" TYPE="%-20s" FUNCTIONS=""/>
  <ITEM NAME="#SYLX"  INPUT="LABEL"   LINE="1"   COL="45" TYPE="%-20s" FUNCTIONS=""/>
  <ITEM NAME="#MJQSR" INPUT="LABEL"   LINE="2"   COL="17" TYPE="%-10s" FUNCTIONS=""/>
  <ITEM NAME="#MJJSR" INPUT="LABEL"   LINE="2"   COL="47" TYPE="%-10s" FUNCTIONS=""/>
  <ITEM NAME="#CPQXR" INPUT="LABEL"   LINE="3"   COL="17" TYPE="%-10s" FUNCTIONS=""/>
  <ITEM NAME="#CPDQR" INPUT="LABEL"   LINE="3"   COL="47" TYPE="%-10s" FUNCTIONS=""/>
  <ITEM NAME="#QX"    INPUT="LABEL"   LINE="4"   COL="15" TYPE="%-10s" FUNCTIONS=""/>
  <ITEM NAME="#BZ"    INPUT="LABEL"   LINE="4"   COL="45" TYPE="%-20s" FUNCTIONS=""/>
  <ITEM NAME="#KHLX"  INPUT="LABEL"   LINE="5"   COL="15" TYPE="%-20s" FUNCTIONS=""/>
  <ITEM NAME="#FXDJ"  INPUT="LABEL"   LINE="5"   COL="45" TYPE="%-20s" FUNCTIONS=""/>
  <ITEM NAME="#TZFX"  INPUT="LABEL"   LINE="6"   COL="15" TYPE="%-20s" FUNCTIONS=""/>
  <ITEM NAME="#YQSYL" INPUT="LABEL"   LINE="6"   COL="47" TYPE="%-10s" FUNCTIONS=""/>
  <ITEM NAME="#SXFL"  INPUT="LABEL"   LINE="7"   COL="15" TYPE="%-10s" FUNCTIONS=""/>
  <ITEM NAME="#TGFL"  INPUT="LABEL"   LINE="7"   COL="45" TYPE="%-10s" FUNCTIONS=""/>
  <ITEM NAME="#FSZE"  INPUT="LABEL"   LINE="8"   COL="15" TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#DFJE"  INPUT="LABEL"   LINE="8"   COL="45" TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#ZHSYE" INPUT="LABEL"   LINE="9"   COL="17" TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#JGSYE" INPUT="LABEL"   LINE="9"   COL="47" TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#GRZDE" INPUT="LABEL"   LINE="10"  COL="17" TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#DGZDE" INPUT="LABEL"   LINE="10"  COL="47" TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#DZJE"  INPUT="LABEL"   LINE="11"  COL="15" TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#YXSH"  INPUT="LABEL"   LINE="11"  COL="45" TYPE="%-10s" FUNCTIONS=""/>
  <ITEM NAME="#YXCX"  INPUT="LABEL"   LINE="12"  COL="15" TYPE="%-10s" FUNCTIONS=""/>
  <ITEM NAME="#GLFL"  INPUT="LABEL"   LINE="12"  COL="45" TYPE="%-10s" FUNCTIONS=""/>
  </BLOCK>
  <ITEM NAME="#NT_PAGE"  INPUT="BUTTON"  LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(下一页)">
  	<ONCLICK>"{
			loadpage('PAGE1');  
  	}"
  	</ONCLICK>
  </ITEM>
  </PAGE>
  
  <PAGE NAME="PAGE1">
  <ITEM LINE="6"  COL="5"  TYPE="%-10s"  FUNCTIONS="T(账    号:)"/>
  <ITEM LINE="7"  COL="5"  TYPE="%-10s"  FUNCTIONS="T(户    名:)"/>
  <ITEM LINE="8"  COL="5"  TYPE="%-14s"  FUNCTIONS="T(风险评估等级:)"/>
  <ITEM LINE="9"  COL="5"  TYPE="%-14s"  FUNCTIONS="T(风险评估日期:)"/>
  <ITEM LINE="10"  COL="5"  TYPE="%-10s"  FUNCTIONS="T(余    额:)"/>
  <ITEM LINE="11"  COL="5"  TYPE="%-10s"  FUNCTIONS="T(可用余额:)"/>
  <ITEM LINE="12"  COL="5"  TYPE="%-10s"  FUNCTIONS="T(证件类型:)"/>
  <ITEM LINE="13" COL="5"  TYPE="%-10s"  FUNCTIONS="T(证件号码:)"/>
  <ITEM LINE="14" COL="5"  TYPE="%-16s"  FUNCTIONS="T(代理人证件类型:)"/>
  <ITEM LINE="15" COL="5"  TYPE="%-16s"  FUNCTIONS="T(代理人证件号码:)"/>
  <ITEM LINE="16" COL="5"  TYPE="%-12s"  FUNCTIONS="T(代理人姓名:)"/>
  <ITEM LINE="17" COL="5"  TYPE="%-10s"  FUNCTIONS="T(账户密码:)"/>
  <ITEM LINE="18" COL="5"  TYPE="%-10s"  FUNCTIONS="T(认购金额:)"/>
  <ITEM LINE="19" COL="5"  TYPE="%-10s"  FUNCTIONS="T(协议编号:)"/>
  <ITEM LINE="20" COL="5"  TYPE="%-10s"  FUNCTIONS="T(客户经理:)"/>
  <!--输入账号-->
  <ITEM NAME="#ZH"    INPUT="TEXT"    LINE="6"  COL="15" TYPE="%-20s" FUNCTIONS="">
    <ONLOSTFOCUS>
    "{
      dim @tota as string;
      initfd();
	    commsend_001();
      $FD16='8018';
      $FD48='1';
      $FD30=#ZH;
      $FD65='0003';
      $FD67='2';
      @tota=callserver();
	    if($FD12 != '0000')
	    {
	    	showmsg(geterror());
	    	return(false);
	    }
	    #KHLX   = $FD69;
	    #HM     = $FD25; 
	    #FXPGDJ = $FD68;
	    #FXPGRQ = $FD44;
	    #YE     = $FD39;
	    #KYYE   = $FD40;
	    #ZJLX   = $FD67; 
	    #ZJHM   = $FD62;
	    #DLZJLX = ''; 
	    #DLZJHM = ''; 
	    #DLXM   = ''; 
	    #MM     = ''; 
	    #RGJE   = ''; 
	    #XYBH   = ''; 
	    #KHJL   = ''; 
    }"
    </ONLOSTFOCUS>
  </ITEM>
  <!--回显-->
  <ITEM NAME="#HM"      INPUT="LABEL"   LINE="7"   COL="15" TYPE="%-20s" FUNCTIONS=""/>
  <ITEM NAME="#FXPGDJ"  INPUT="LABEL"   LINE="8"   COL="19" TYPE="%-10s" FUNCTIONS=""/>
  <ITEM NAME="#FXPGRQ"  INPUT="LABEL"   LINE="9"   COL="19" TYPE="%-10s" FUNCTIONS=""/>
  <ITEM NAME="#YE"      INPUT="LABEL"   LINE="10"  COL="15" TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#KYYE"    INPUT="LABEL"   LINE="11"  COL="15" TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#ZJLX"    INPUT="SELECT"  LINE="12"  COL="15" TYPE="%-10s" FUNCTIONS=""/>
  <SELECT>
        <OPTION VALUE="1" TITLE="1.身份证"/>
        <OPTION VALUE="2" TITLE="2.户口簿"/>
        <OPTION VALUE="3" TITLE="3.护照"/>
        <OPTION VALUE="4" TITLE="4.军官证"/>
        <OPTION VALUE="5" TITLE="5.回乡证"/>
        <OPTION VALUE="6" TITLE="6.士兵证"/>
    </SELECT>
   </ITEM>
  <ITEM NAME="#ZJHM"    INPUT="LABEL"   LINE="13"  COL="15" TYPE="%-20s" FUNCTIONS=""/>
  <!--输入-->
  <ITEM NAME="#DLZJLX"  INPUT="SELECT"  LINE="14"  COL="21" TYPE="%-1s"  FUNCTIONS="" >
    <SELECT>
        <OPTION VALUE="1" TITLE="1.身份证"/>
        <OPTION VALUE="2" TITLE="2.户口簿"/>
        <OPTION VALUE="3" TITLE="3.护照"/>
        <OPTION VALUE="4" TITLE="4.军官证"/>
        <OPTION VALUE="5" TITLE="5.回乡证"/>
        <OPTION VALUE="6" TITLE="6.士兵证"/>
    </SELECT>
  </ITEM>
  <ITEM NAME="#DLZJHM"  INPUT="TEXT"    LINE="15"  COL="21" TYPE="%-20s" FUNCTIONS=""/>
  <ITEM NAME="#DLRXM"   INPUT="TEXT"    LINE="16"  COL="17" TYPE="%-20s" FUNCTIONS=""/>
  <ITEM NAME="#ZHMM"    INPUT="TEXT"    LINE="17"  COL="15" TYPE="%-6s"  FUNCTIONS="V(NB)i()" >
    <ONLOSTFOCUS>
	  "{
	  	if(len(#ZHMM) &lt; 6)
	  	{
	  		showmsg('密码长度必须为六位!');
	  		return(false);
	  	}
	  	dim @tota as string;
	  	initfd();
	    commsend_001();
      $FD16='9317';
      $FD30=#ZH;
      $FD79=#ZHMM;
      @tota=callserver();
	    if($FD12 != '0000')
	    {
	    	showmsg(geterror());
	    	#ZHMM = '';
	    	return(false);
	    }	
	  }"
	  </ONLOSTFOCUS>
  </ITEM>  
  <ITEM NAME="#RGJE"    INPUT="TEXT"   LINE="18"   COL="15" TYPE="%-16s" FUNCTIONS="">
   <ONLOSTFOCUS>
	  "{
	  	dim @min_amt as string;
	    if(#RGJE > #KYYE)
	    {
	    	showmsg('账户可用余额不足');
	    	return(false);
	    }
	  	if(#RGJE > #JGSYE)
	  	{
	    	showmsg('该机构没有配额了');
	    	return(false);
	    }
	    if(#KHLX == '1')
	    {
	    	if(#RGJE < #GRZDE)
	    	{
	    		showmsg('认购金额必须大于起购金额');
	    		return(false);
	    	}
	    	@min_amt = #GRZDE;
	    }
	    else
	    {
	    	if(#RGJE < #DGZDE)
	    	{
	    		showmsg('认购金额必须大于起购金额');
	    		return(false);
	    	}
	    	@min_amt = #DGZDE;
	    }
	    if((#RGJE - @min_amt) % #DZJE > 0)
	    {
	    	showmsg('认购金额必须以递增金额整数倍递增');
	    	return(false);
	    }
	    if(#DFJE <= 0)
	    {
	    	showmsg('单份金额配置错误');
	    	return(false);
	    }
	    if(#RGJE % #DFJE > 0)
	    {
	    	showmsg('认购金额必须是单份的整数倍');
	    	return(false);
	    }
	  }"
	  </ONLOSTFOCUS> 
	 </ITEM>  
  <ITEM NAME="#XYBH"    INPUT="TEXT"   LINE="19"   COL="15" TYPE="%-20s" FUNCTIONS=""/>
  <ITEM NAME="#KHJL"    INPUT="TEXT"   LINE="20"   COL="15" TYPE="%-10s" FUNCTIONS=""/>
  <!--提交-->
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
 </PAGE>
  
</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
	<PACKAGE DEVICE="SCREEN" DESC="按任意键继续">
 		NOTHING
	</PACKAGE>
	<PRINT>
	"{
		print(3,25,'理财产品认购成功');
		print(5,15,'账    号:[20     ]',#ZH);
		print(6,15,'产品代码:[8      ]',#CPDM);
		print(6,40,'产品名称:[40     ]',#CPMC);
		print(7,15,'认购金额:[20     ]',#RGJE);
		print(7,40,'预期收益率:[10   ]',#YQSYL);
		print(8,15,'上浮利率:[10     ]',#GLFL);
		print(8,40,'预期收益:[20     ]',#YQSY);
	}"
	</PRINT>
</RESPONSE>
<OUTPUT>
</OUTPUT>
</TRANSACTION>
