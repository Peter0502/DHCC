<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11111111011100000000000001100010" TITLE="1860         自由格式查询"
	xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>
	"{
		refresh();
		initfd();
		commsend_001();
	}"
</COMMSEND>
<COMMRECV>
	"{
		commrecv_001();
	}"
</COMMRECV>

<VARIABLE>
  <ITEM LINE="3" COL="3"   TYPE="%-70s" FUNCTIONS=
  	"T(1860                           自由格式查询)"/>
	<ITEM LINE="4" COL="3"   TYPE="%-74s" FUNCTIONS=
	"T(--------------------------------------------------------------------------)"/>
	<ITEM NAME="#TXNAME"        TYPE="%-30s"  FUNCTIONS="T(自由格式查询)" >
		<ONLOSTFOCUS>
			"{
				//$KINBR = '10001';
				showblock('Qsblock', false, true);
				if($KINBR == '10001')
				{
					showblock('Qsblock', true, true);
				}
			}"
		</ONLOSTFOCUS>
	</ITEM>
	
	<ITEM LINE="6" COL="20"  TYPE="%-12s" FUNCTIONS="T(委托  日期: )"/>
	<ITEM LINE="6" COL="32"  TYPE="%-8s"  NAME="#DATE" INPUT="TEXT" FUNCTIONS="T()D()">
	</ITEM>
	
	<ITEM LINE="8" COL="20" TYPE="%-12s" FUNCTIONS="T(交易  序号: )"/>
	<ITEM LINE="8" COL="32" TYPE="%-32s"  NAME="#TradeNo" INPUT="TEXT" FUNCTIONS="T()">
	</ITEM>
	
	<ITEM LINE="10" COL="20"  TYPE="%-12s" FUNCTIONS="T(发起行行号: )"/>
	<ITEM LINE="10" COL="32"  TYPE="%-32s" NAME="#OutBankNo" INPUT="TEXT" FUNCTIONS="T()"/>
	
	<ITEM LINE="12" COL="20"  TYPE="%-10s" FUNCTIONS="T(往来  标志: )"/>
	<ITEM LINE="12" COL="32"  TYPE="%-4s"  NAME="#Srflag" INPUT="SELECT" FUNCTIONS="T(SR00)">
		<SELECT>
			<OPTION VALUE="SR00" TITLE="往账"/>
			<OPTION VALUE="SR01" TITLE="来账"/>
		</SELECT>
	</ITEM>
	
	<BLOCK NAME="Qsblock" LINE="14"  COL="0" VISABLE="FALSE">
	<ITEM LINE="0"  COL="20"  TYPE="%-12s"  FUNCTIONS="T(查询机构号：)" />
	<ITEM LINE="0"  COL="32"  NAME="#Brno" TYPE="%-8s" INPUT="TEXT" FUNCTIONS="T()">
	</ITEM>
	</BLOCK>
	
	<ITEM LINE="20"  COL="59" TYPE="%-6s" NAME="#OK" INPUT="BUTTON" FUNCTIONS="T(确定)">
		<ONCLICK>
			"{
				initfd();
				commsend_001();
				$FD16='1116';
				$FD18='pbp';
				$FD45=#DATE;
				$FD27=#TradeNo;
				$FD58=#OutBankNo;
				$FD35=#Srflag;
				
				if(delspace(#Brno) != '')
				{
					$FD85=#Brno;
				}
				callagnpbp();
				if($FD12!='0000')
				{
					showmsg(geterror());
					return(false);
				}
				
				#DOLIST='1';
				goitem('#DOLIST');
				return(true);
			}"
		</ONCLICK>	
	</ITEM>
	
	<ITEM NAME="#DOLIST" TYPE="%1s" FUNCTIONS="">
		<ONLOSTFOCUS>
		"{
			dim @total as string;
			dim @selid as number;
			dim @a0 as string;
			dim @a1 as string;
			dim @a2 as string;
			dim @a3 as string;
			dim @a4 as string;
			dim @a5 as string;
			dim @a6 as string;
			dim @a7 as string;
			dim @a8 as string;
			dim @a9 as string;
			dim @a10 as string;
			dim @a11 as string;
			dim @a12 as string;
			dim @a13 as string;
			dim @a14 as string;
			dim @a15 as string;
			dim @a16 as string;
			dim @a17 as string;
			dim @a18 as string; 
			dim @a19 as string;
			dim @a20 as string;
				
			if(#DOLIST == '1')
			{
				@total=getfiletxt('../tmp/'+$KINBR+$TTYNAME);
				if(@total =='')
				{
					showmsg('读取回传文件失败！');
					return(false);
				}
				autolist('~'+@total);
				
				@selid=list_work();
				if(@selid &lt; 0)
				{
					closeall();
					return(true);
				}
				else
				{
					@selid=list_getselid();
					@a0=ltrim(list_gettext(@selid,0));
					@a1=ltrim(list_gettext(@selid,1));
					@a2=ltrim(list_gettext(@selid,2));
					@a3=ltrim(list_gettext(@selid,3));
					@a4=ltrim(list_gettext(@selid,4));
					@a5=ltrim(list_gettext(@selid,5));
					@a6=ltrim(list_gettext(@selid,6));
					@a7=ltrim(list_gettext(@selid,7));
					@a8=ltrim(list_gettext(@selid,8));
					@a9=ltrim(list_gettext(@selid,9));
					@a10=ltrim(list_gettext(@selid,10));
					@a11=ltrim(list_gettext(@selid,11));
					@a12=ltrim(list_gettext(@selid,12));
					@a13=ltrim(list_gettext(@selid,13));
					@a14=ltrim(list_gettext(@selid,14));
					@a15=ltrim(list_gettext(@selid,15));
					@a16=ltrim(list_gettext(@selid,16));
					@a17=ltrim(list_gettext(@selid,17));
					@a18=$FD7;
					@a19=$FD5;
					@a20=$FD56;
					open('1860_1.XML','#XTLX='+@a0+';#WLFLG='+@a1+';#WTRQ='+@a2+';#ZFJYXH='+@a3+';#FQHJGM='+@a4+';#JSHJGM='+@a5+';#FQHHH='+@a6+';#JSHHH='+@a7+';#FQQSHHH='+@a8+';#JSQSHHH='+@a9+';#XXNR='+@a10+';#YWZT='+@a11+';#CLZT='+@a12+';#CLXX='+@a13+';#LRGY='+@a14+';#DYCS='+@a15+';#JYSJ='+@a16+';#BZ='+@a17+';#Teller='+@a18+';#Date='+@a19+';#Trace='+@a20+';');
					list_del();
					#DOLIST='';
					return(true);
				}
			}

		}"
		</ONLOSTFOCUS>
	</ITEM>
	
	</VARIABLE>	
</TRANSACTION>
