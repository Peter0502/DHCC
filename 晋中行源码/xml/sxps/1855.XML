<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11111111011100000000000001100010" TITLE="1855         支付业务查询"
	xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>
	"{
		refresh();
		initfd();
		commsend_001();
	}"
</COMMSEND>
<COMMRECV>
	"{
		commrecv_001();
	}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3" COL="3"   TYPE="%-70s" FUNCTIONS=
  	"T(1855                          支付业务查询)"/>
	<ITEM LINE="4" COL="3"   TYPE="%-74s" FUNCTIONS=
	"T(--------------------------------------------------------------------------)"/>
	<ITEM NAME="#TXNAME"        TYPE="%-30s"  FUNCTIONS="T(支付业务查询)" >
		<ONLOSTFOCUS>
			"{
				//$KINBR = '10001';
				showblock('Qsblock', false, true);
				if($KINBR == '10001')
				{
					showblock('Qsblock', true, true);
				}
			}"
		</ONLOSTFOCUS>
	</ITEM>
	<ITEM NAME="#DOLIST" TYPE="%1s" FUNCTIONS="">
	<ONLOSTFOCUS>
	"{
		dim @selid as number;
		if(#DOLIST=='1')
		{
			@selid=list_work();     
			if(@selid &lt; 0)       
			{                     
				list_del();            
				rerun();               
				return(true);          
			}           
			@selid=list_getselid();
			if(@selid &lt; 0)
			{
				list_del();
				rerun();
				return(true);
			}
		}
		#DOLIST='';
		list_del();
	}"
	</ONLOSTFOCUS>
	</ITEM>
	<ITEM LINE="6" COL="3"  TYPE="%-12s" FUNCTIONS="T(交易  日期：)"/>
	<ITEM LINE="6" COL="15" NAME="#TxDt" TYPE="%-8s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()D()"/>
	<ITEM LINE="6" COL="35"  TYPE="%-12s" FUNCTIONS="T(交易  序号：)"/>
	<ITEM LINE="6" COL="47" NAME="#TxNo" TYPE="%-18s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()"/>
	<ITEM LINE="7" COL="3"  TYPE="%-12s" FUNCTIONS="T(委托  日期：)"/>
	<ITEM LINE="7" COL="15" NAME="#EntDate" TYPE="%-8s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()D()"/>
	<ITEM LINE="7" COL="35"  TYPE="%-12s" FUNCTIONS="T(交易  金额：)"/>
	<ITEM LINE="7" COL="47" NAME="#TradeAmt" TYPE="%-18s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()"/>
	<ITEM LINE="8" COL="3"  TYPE="%-12s" FUNCTIONS="T(发起行行号：)"/>
	<ITEM LINE="8" COL="15" NAME="#OutBankNo" TYPE="%-24s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()"/>
	<ITEM LINE="8" COL="35"  TYPE="%-12s" FUNCTIONS="T(接收行行号：)"/>
	<ITEM LINE="8" COL="47" NAME="#InBankNo" TYPE="%-24s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()"/>
	<ITEM LINE="9" COL="3"  TYPE="%-12s" FUNCTIONS="T(往来  标志：)"/>
	<ITEM LINE="9" COL="15" NAME="#SrFlag" TYPE="%-12s" INPUT="SELECT" DEVICE="KEYBOARD" FUNCTIONS="T(SR00)">
		<SELECT>
			<OPTION VALUE="SR00" TITLE="往账"/>
			<OPTION VALUE="SR01" TITLE="来账"/>
		</SELECT>
	</ITEM>
	<ITEM LINE="9" COL="35"  TYPE="%-12s" FUNCTIONS="T(交易流水：)"/>
	<ITEM LINE="9" COL="47" NAME="#Traceno" TYPE="%-24s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()"/>
	<ITEM LINE="10" COL="3"  TYPE="%-12s" FUNCTIONS="T(付款人账号：)"/>
	<ITEM LINE="10" COL="15" NAME="#PayerAcct" TYPE="%-24s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()"/>
	<ITEM LINE="11" COL="3"  TYPE="%-12s" FUNCTIONS="T(付款人名称：)"/>
	<ITEM LINE="11" COL="15" NAME="#PayerName" TYPE="%-60s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()"/>
	<ITEM LINE="12" COL="3"  TYPE="%-12s" FUNCTIONS="T(收款人账号：)"/>
	<ITEM LINE="12" COL="15" NAME="#PayeeAcct" TYPE="%-24s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()"/>
	<ITEM LINE="13" COL="3"  TYPE="%-12s" FUNCTIONS="T(收款人名称：)"/>
	<ITEM LINE="13" COL="15" NAME="#PayeeName" TYPE="%-60s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()"/>
	<ITEM LINE="14" COL="3"  TYPE="%-12s" FUNCTIONS="T(录入  柜员：)"/>
	<ITEM LINE="14" COL="15" NAME="#OTeller" TYPE="%-18s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()"/>
	<ITEM LINE="14" COL="35"  TYPE="%-12s" FUNCTIONS="T(复核  柜员：)"/>
	<ITEM LINE="14" COL="47" NAME="#OChecker" TYPE="%-18s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()"/>

	<BLOCK NAME="Qsblock" LINE="15"  COL="0" VISABLE="FALSE">
	<ITEM LINE="0"  COL="3"  TYPE="%-15s"  FUNCTIONS="T(查询机构号：)" />
	<ITEM LINE="0"  COL="15"  NAME="#Brno" TYPE="%-8s" INPUT="TEXT" FUNCTIONS="T()">
	</ITEM>
	</BLOCK>
	<ITEM LINE="20"  COL="59" TYPE="%-6s" FUNCTIONS="T(确定)" INPUT="BUTTON" NAME="#OK" DEVICE="KEYBOARD" >
		<ONCLICK>
			"{			
				initfd();
				commsend_001();
				$FD16 ='1115';
				$FD18 ='pbp';
				$FD28 = 'sxps';
				$FD46 =#TxDt;
				$FD83 =#TxNo;
				$FD47 =#EntDate;
				$FD58 =#OutBankNo;
				$FD39 =#TradeAmt;
				$FD59 =#InBankNo;
				$FD28 =#SrFlag;
				$FD56 =#Traceno;
				$FD31 =#PayerAcct;
				$FD37 =#OTeller;
				$FD25 =#PayerName;
				$FD38 =#OChecker;
				$FD32 =#PayeeAcct;
				$FD26 =#PayeeName;
				
				if(delspace(#Brno) != '')
				{
					$FD85=#Brno;
				}
				
				dim @rcvbuffer as string;
				dim @filename1 as string;
				dim @ret as number;
				//showmsg($KINBR+$TTYNAME);
				
				callagnpbp();
				
				
				if($FD12!='0000')
				{
					showmsg(geterror());
					return(false); 
				}
				
				@rcvbuffer=getfiletxt('../tmp/'+$KINBR+$TTYNAME);
				
				
				if(@rcvbuffer =='')
				{
					showmsg('读取回传文件失败！');
					return(false);
				}
				
				autolist('~'+@rcvbuffer);
				#DOLIST='1';
				goitem('#DOLIST');
				
				return(true);

			}"
		</ONCLICK>	
	</ITEM>	
	<ITEM NAME="#DOLIST" TYPE="%1s" FUNCTIONS="">
	<ONLOSTFOCUS>
			"{
				dim @selid as number;
				dim @data as string;
				dim @file as file;
				dim @count as number;
				dim @line as string;
				dim @a0 as string;
				dim @a1 as string;
				dim @a2 as string;
				dim @a3 as string;
				dim @a4 as string;
				dim @a5 as string;
				dim @a6 as string;
				dim @a7 as string;
				dim @a8 as string;
				dim @a9 as string;
				dim @a10 as string;
				dim @a11 as string;
				dim @a12 as string;
				dim @a13 as string;
				dim @a14 as string;
				dim @a15 as string;
				dim @a16 as string;
				dim @a17 as string;
				dim @a18 as string;
				dim @a19 as string;
				dim @a20 as string;
				dim @a21 as string;
				dim @a22 as string;
				dim @a23 as string;
				dim @a24 as string;
				dim @a25 as string;
				dim @a26 as string;
				dim @a27 as string;
				if(#DOLIST =='1')
				{
					@selid=list_work();
					if(@selid &lt; 0)
					{
						list_del();
						rerun();
						return(true);
					}
					@selid=list_getselid();
					if(@selid &lt; 0)
					{
						list_del();
						rerun();
						return(true);
					}
					@a0=ltrim(list_gettext(@selid,0));
					@a1=ltrim(list_gettext(@selid,1));
					@a2=ltrim(list_gettext(@selid,2));
					@a3=ltrim(list_gettext(@selid,3));
					@a4=ltrim(list_gettext(@selid,4));
					@a5=ltrim(list_gettext(@selid,5));
					@a6=ltrim(list_gettext(@selid,6));
					@a7=ltrim(list_gettext(@selid,7));
					@a8=ltrim(list_gettext(@selid,8));
					@a9=ltrim(list_gettext(@selid,9));
					@a10=ltrim(list_gettext(@selid,10));
					@a11=ltrim(list_gettext(@selid,11));
					@a12=ltrim(list_gettext(@selid,12));
					@a13=ltrim(list_gettext(@selid,13));
					@a14=ltrim(list_gettext(@selid,14));
					@a15=ltrim(list_gettext(@selid,15));
					@a16=ltrim(list_gettext(@selid,16));
					@a17=ltrim(list_gettext(@selid,17));
					@a18=ltrim(list_gettext(@selid,18));
					@a19=ltrim(list_gettext(@selid,19));
					@a20=ltrim(list_gettext(@selid,20));
					@a21=ltrim(list_gettext(@selid,21));
					@a22=ltrim(list_gettext(@selid,22));
					@a23=ltrim(list_gettext(@selid,23));
					@a24=ltrim(list_gettext(@selid,24));
					@a25=$FD7;
					@a26=$FD5;
					@a27=$FD56;
					open('1855_1.XML','#MesTp='+@a0+';#TxDt='+@a1+';#MsgId='+@a2+';#SrFlag='+@a3+';#EntDate='+@a4+';#OrderNo='+@a5+';#TxTp='+@a6+';#BusKind='+@a7+';#OutBankNo='+@a8+';#InBankNo='+@a9+';#Instgclr='+@a10+';#Instdclr='+@a11+';#Dbtrid='+@a12+';#Cdtrid='+@a13+';#Cur='+@a14+';#Amt='+@a15+';#FeeWay='+@a16+';#FeeAmt='+@a17+';#MsgSts='+@a18+';#TxSts='+@a19+';#HgSts='+@a20+';#CreTp='+@a21+';#CreNo='+@a22+';#CdFlag='+@a23+';#TxPri='+@a24+';#Teller='+@a25+';#Date='+@a26+';#Trace='+@a27+';');
				
					return(true);
				}
					list_del();
					#DOLIST='';
		}"
		</ONLOSTFOCUS>
	</ITEM>
	</VARIABLE>	
</TRANSACTION>
