<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11111111011100000000000001100010" TITLE="1841       账户导出)"
	xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>
	"{
	}"
</COMMSEND>
<COMMRECV>
	"{
	}"
</COMMRECV>
<VARIABLE>
	<ITEM LINE="3" COL="3" TYPE="%-54s" FUNCTIONS=
		"T(1841                             账户导出)"/>
	<ITEM LINE="4" COL="3" TYPE="%-74s" FUNCTIONS=
		"T(─────────────────────────────────────)"/>
	<ITEM NAME="#TXCODE" TYPE="%-30s" FUNCTIONS="T(1841)"/>
	<ITEM NAME="#TXNAME"   TYPE="%-30s"  FUNCTIONS="T(账户导出)"/>
	<ITEM NAME="#DOLIST" TYPE="%1s" FUNCTIONS="">
		<ONLOSTFOCUS>
		"{
			dim @selid as number;
			if(#DOLIST=='1')
			{
				@selid=list_work();     
				if(@selid &lt; 0)       
				{                     
					list_del();            
					rerun();               
					return(true);          
				}           
				@selid=list_getselid();
				if(@selid &lt; 0)
				{
					list_del();
					rerun();
					return(true);
				}
				runoutput();
				showall();
				rerun();
				refresh();
			}
			#DOLIST='';
			list_del();
		}"
		</ONLOSTFOCUS>
	</ITEM>
	<ITEM LINE="8" COL="29" TYPE="%-32s" FUNCTIONS="T(是否导出所有对公账户信息)">
		<ONLOSTFOCUS>
			"{
				if (delspace($KINBR) == '10001')
				{
					showblock('Qsblock',true,true);
				}
				else
				{
					showblock('Qsblock',false,false);
				}
				refresh();
			}"	
		</ONLOSTFOCUS>
	
	</ITEM>
	<BLOCK NAME="Qsblock" LINE="11"  COL="29" VISABLE="FALSE">
	<ITEM LINE="0"  COL="0"  TYPE="%-11s"  FUNCTIONS="T(导出机构号:)" />
	<ITEM LINE="0"  COL="11"  NAME="#Brno" TYPE="%-10s" INPUT="TEXT" FUNCTIONS="T()V(NB)">
		<ONLOSTFOCUS>
			"{
			}"
		</ONLOSTFOCUS>
	</ITEM>
	</BLOCK>
	<ITEM  NAME="#OK" LINE="21"  COL="63"  TYPE="%-6s"   FUNCTIONS="T(确  定)" INPUT="BUTTON">
 	<ONCLICK>
 		"{
 				
				initfd();
				commsend_001();
				if (delspace(#Brno) != '')
				{
					$FD3 = #Brno;
				}
				$FD16 = '2044';
				$FD18 = 'pbp';
				$FD28 = 'sxps';
				
				dim @rcvbuffer as string;
				
				callagnpbp();
				@rcvbuffer = getfiletxt('../tmp/'+$KINBR+$TTYNAME);
				if($FD12!='0000')
				{
					showmsg(geterror());
					return(false);
				}
					
				dim @filename1 as string;
				dim @ret as number;
					
				@filename1 = '../tmp/'+$KINBR+$HDATE;
				@ret = savefiletxt(@filename1, @rcvbuffer);
				if(@ret &lt; 0){
					showmsg('账户文件导出失败！');
					return(false);
				}
				
				autolist('~'+@rcvbuffer);
				#DOLIST='1';
				goitem('#DOLIST');
				//call('fview '+'../tmp/'+$KINBR+$HDATE);
				//生成核心流水-start
				dim @bak_fd81 as string;
				@bak_fd81=$FD81;
				$FD81=#TXNAME;
				gethxtraceno();
				$FD81=@bak_fd81;
				//生成核心流水-end
				runoutput();
				return(true);
				rerun();
				refresh();
 		}"
 	</ONCLICK>  
 	</ITEM>
 	
 	<!--ITEM NAME="#DOLIST" TYPE="%1s" FUNCTIONS="">
	<ONLOSTFOCUS>
			"{
				dim @selid as number;
				dim @data as string;
				dim @file as file;
				dim @count as number;
				dim @line as string;
				dim @a0 as string;
				dim @a1 as string;
				dim @a2 as string;
				dim @a3 as string;
				dim @a4 as string;
				dim @a5 as string;
				dim @a6 as string;
				dim @a7 as string;
				dim @a8 as string;
				dim @a9 as string;
				dim @a10 as string;
				dim @a11 as string;
				dim @a12 as string;
				dim @a13 as string;
				dim @a14 as string;
				dim @a15 as string;
				dim @a16 as string;
				dim @a17 as string;
				dim @a18 as string;
				dim @a19 as string;
				dim @a20 as string;
				dim @a21 as string;
				dim @a22 as string;
				if(#DOLIST =='1')
				{
					@selid=list_work();
					if(@selid &lt; 0)
					{
						list_del();
						rerun();
						return(true);
					}
					@selid=list_getselid();
					if(@selid &lt; 0)
					{
						list_del();
						rerun();
						return(true);
					}
					@a0=ltrim(list_gettext(@selid,0));
					@a1=ltrim(list_gettext(@selid,1));
					@a2=ltrim(list_gettext(@selid,2));
					@a3=ltrim(list_gettext(@selid,3));
					@a4=ltrim(list_gettext(@selid,4));
					@a5=ltrim(list_gettext(@selid,5));
					@a6=ltrim(list_gettext(@selid,6));
					@a7=ltrim(list_gettext(@selid,7));
					@a8=ltrim(list_gettext(@selid,8));
					@a9=ltrim(list_gettext(@selid,9));
					@a10=ltrim(list_gettext(@selid,10));
					@a11=ltrim(list_gettext(@selid,11));
					@a12=ltrim(list_gettext(@selid,12));
					@a13=ltrim(list_gettext(@selid,13));
					@a14=ltrim(list_gettext(@selid,14));
					@a15=ltrim(list_gettext(@selid,15));
					@a16=ltrim(list_gettext(@selid,16));
					@a17=ltrim(list_gettext(@selid,17));
					@a18=ltrim(list_gettext(@selid,18));
					@a19=ltrim(list_gettext(@selid,19));
					@a20=$FD7;
					@a21=$FD5;
					@a22=$FD56;
					open('1841_1.XML','#Acct='+@a0+';#Acctnm='+@a1+';#Acctp='+@a2+';#Acctattr='+@a3+';#Openmmbid='+@a4+';#Openbnk='+@a5+';#Sysbnk='+@a6+';#CurNo='+@a7+';#Cashtp='+@a8+';#Licence='+@a9+';#ComCode='+@a10+';#Instdclr='+@a11+';#Dbtrid='+@a12+';#Cdtrid='+@a13+';#Cur='+@a14+';#Amt='+@a15+';#FeeWay='+@a16+';#FeeAmt='+@a17+';#MsgSts='+@a18+';#TxSts='+@a19+';#Teller='+@a20+';#Date='+@a21+';#Trace='+@a22+';');
				
					return(true);
				}
					list_del();
					#DOLIST='';
		}"
		</ONLOSTFOCUS>
	</ITEM--> 
</VARIABLE>
<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="按任意键退出">
NOTHING
</PACKAGE>
	<PRINT>
		"{			
				PrintTxHead();
				
				print(5,25,'账户文件导出完成，请下载');
				print(7,27,'账户文件:[30]',$KINBR+$HDATE);
				
				PrintTxTail();
    	}";
   	</PRINT>
</RESPONSE>
</TRANSACTION>
