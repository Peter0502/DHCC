<USERFUN NAME="commsend_001">"{
	$FD2=$OPNBR;
	$FD3=$KINBR;
	$FD5=$HDATE;
	$FD7=$TLRNO;
	$FD10=$TTYNAME;
	$FD16=$TXNO;
	$FD79=#PASSWD;
	$FD74=$KINBR+'|'+$TLRNO;
}"
</USERFUN>
<USERFUN NAME="commsend_002">"{
	$FD2=$OPNBR;
	$FD3=$KINBR;
	$FD5=$HDATE;
	$FD7=$TLRNO;
	$FD10=$TTYNAME;
	$FD16=$TXNO;
	$FD79=#PASSWD;
	$FD74=$KINBR+'|'+$TLRNO;
}"
</USERFUN>

<USERFUN NAME="commrecv_001">"{
	//showmsg('FD12=['+$FD12+']');
}"
</USERFUN>
<!--存款交易结构-->
<USERFUN NAME="commsend_101">"{
	$FD101=getitems('#ACTNO24#ACTSEQ#TXAMT#VOCTYPE#VOCNUM#DESC10#NBFLAG#CUSTNAME#AVBAL#CURCD#CASHFLAG#DSCPT#ACTTYPE#ACTSEQ_2#PRODNAME');
}"
</USERFUN>
	<!--取款交易结构-->
<USERFUN NAME="commsend_102">"{
	$FD102=getitems('#ACTNO24#ACTSEQ#VOCTYPE#VOCNUM#FETCHFLAG#PWDFLAG#QUE_PWD#DRAW_PWD#CERTFLAG#CERTNO#STAMPFLAG#PWDFLAG2#PWD16#PRINTDATE#TXAMT#CERTTYPE#CUSTNAME#AVBAL#CURCD#CASHFLAG#DSCPT#ACTTYPE#ACTSEQ_2#ACCOUNTFLAG#INTEREST1#INTEREST2#INTEREST3#PAYAMOUNT#NEWVOCNUM#SPEFLAG#PRODNAME#ACTNO_24#EDUCREDIT#DESC10');
}"
</USERFUN>
<USERFUN NAME="commrecv_101">"{
	setitems('#ACTNO24#ACTSEQ#RTXAMT#VOCTYPE#VOCNUM#DESC10#NBFLAG#CUSTNAME#AVBAL#CURCD#CASHFLAG#DSCPT#ACTTYPE#ACTSEQ_2#PRODNAME',$FD101);
}"
</USERFUN>
<!--开户交易结构-->
<USERFUN NAME="commsend_103">"{
	$FD103=getitems('#PRODNO#PRODNAME#CURCD#ACTLX#ACTZL#JXLX#TXAMT#CUSTNAME#SHOWACTNO20#TERM#LUNIT#SVTYPE#ACTSEQ#CASHCD#ZBCODE#AUTOSVCD#AUTOSVCNT');
}"
</USERFUN>
<USERFUN NAME="commrecv_103">"{
	setitems('#PRODNO#PRODNAME#CURCD#ACTLX#ACTZL#JXLX#RTXAMT#CUSTNAME#SHOWACTNO20#TERM#LUNIT#SVTYPE#ACTSEQ#CASHCD#ZBCODE#AUTOSVCD#AUTOSVCNT',$FD103);
}"
</USERFUN>
<!--开介质结构-->
<USERFUN NAME="commsend_116">"{
	$FD116=getitems('#JZZL#CARDNO#GBFJE#ZJLX#ZJHM#CUSTNAME#SHOWACTNO#VOCNUM#JZLX');
}"
</USERFUN>
<USERFUN NAME="commrecv_116">"{
	setitems('#JZZL#CARDNO#GBFJE#ZJLX#ZJHM#CUSTNAME#SHOWACTNO#RVOCNUM#JZLX',$FD116);
}"
</USERFUN>
<!--大额支付交易结构-->
<USERFUN NAME="commsend_123">"{
	#OTYPE='1';
	$FD123 = getitems('#CMTNO#O_CMTNO#PAY_QS_NO#OR_BR_NO#SENDCO#PAY_OPN_BR_NO#PAY_AC_NO#PAY_NAME#PAY_ADDR#CASH_QS_NO#AC_BR_NO#RECECO#CASH_OPN_BR_NO#CASH_AC_NO#CASH_NAME#CASH_ADDR#YW_TYPE#ORDERNO#CONTENT#RATE#RATEDATE#OORDERNO#PROCODE#CR_DATE#CR_BR_NO#CR_TX_NUM#QR_BR_NO#QR_TX_NUM#TX_TYPE#NOTPAY_CONTENT#NOTPAY_ORDERNO#O_NOTPAY_ORDERNO#RESP1#OPERLEVEL#PROC_STS#OPCD#LW_IND#HP_ADD_PWD#PACKID#O_PACKID#PACK_DATE#O_PACK_DATE#TXNUM#O_TXNUM#LV_YW_IND#RESP_DATE#RCP_STS#RESP2#RETCODE#YW_DTL_ID#ACC_IND#REQ_TYPE#DF_FREEAMT#PROTNO#PO_NO#PO_TYPE#OTYPE');
	//debug_stru('#CMTNO#O_CMTNO#PAY_QS_NO#OR_BR_NO#SENDCO#PAY_OPN_BR_NO#PAY_AC_NO#PAY_NAME#PAY_ADDR#CASH_QS_NO#AC_BR_NO#RECECO#CASH_OPN_BR_NO#CASH_AC_NO#CASH_NAME#CASH_ADDR#YW_TYPE#ORDERNO#CONTENT#RATE#RATEDATE#OORDERNO#PROCODE#CR_DATE#CR_BR_NO#CR_TX_NUM#QR_BR_NO#QR_TX_NUM#TX_TYPE#NOTPAY_CONTENT#NOTPAY_ORDERNO#O_NOTPAY_ORDERNO#RESP1#OPERLEVEL#PROC_STS#OPCD#LW_IND#HP_ADD_PWD#PACKID#O_PACKID#PACK_DATE#O_PACK_DATE#TXNUM#O_TXNUM#LV_YW_IND#RESP_DATE#RCP_STS#RESP2#RETCODE#YW_DTL_ID#ACC_IND#REQ_TYPE#DF_FREEAMT#PROTNO#PO_NO#PO_TYPE#OTYPE');
	//showmsg('CMTNO             ='+#CMTNO             +']');
	//showmsg('O_CMTNO           ='+#O_CMTNO           +']');
	//showmsg('PAY_QS_NO         ='+#PAY_QS_NO         +']');
	//showmsg('OR_BR_NO          ='+#OR_BR_NO          +']');
	//showmsg('SENDCO            ='+#SENDCO            +']');
	//showmsg('PAY_OPN_BR_NO     ='+#PAY_OPN_BR_NO     +']');
	//showmsg('PAY_AC_NO         ='+#PAY_AC_NO         +']');
	//showmsg('PAY_NAME          ='+#PAY_NAME          +']');
	//showmsg('PAY_ADDR          ='+#PAY_ADDR          +']');
	//showmsg('CASH_QS_NO        ='+#CASH_QS_NO        +']');
	//showmsg('AC_BR_NO          ='+#AC_BR_NO          +']');
	//showmsg('RECECO            ='+#RECECO            +']');
	//showmsg('CASH_OPN_BR_NO    ='+#CASH_OPN_BR_NO    +']');
	//showmsg('CASH_AC_NO        ='+#CASH_AC_NO        +']');
	//showmsg('CASH_NAME         ='+#CASH_NAME         +']');
	//showmsg('CASH_ADDR         ='+#CASH_ADDR         +']');
	//showmsg('YW_TYPE           ='+#YW_TYPE           +']');
	//showmsg('ORDERNO           ='+#ORDERNO           +']');
	//showmsg('CONTENT           ='+#CONTENT           +']');
	//showmsg('RATE              ='+itoa(#RATE,'%7.0f')+']');
	//showmsg('RATEDATE          ='+#RATEDATE          +']');
	//showmsg('OORDERNO          ='+#OORDERNO          +']');
	//showmsg('PROCODE           ='+#PROCODE           +']');
	//showmsg('CR_DATE           ='+#CR_DATE           +']');
	//showmsg('CR_BR_NO          ='+#CR_BR_NO          +']');
	//showmsg('CR_TX_NUM         ='+#CR_TX_NUM         +']');
	//showmsg('QR_BR_NO          ='+#QR_BR_NO          +']');
	//showmsg('QR_TX_NUM         ='+#QR_TX_NUM         +']');
	//showmsg('TX_TYPE           ='+#TX_TYPE           +']');
	//showmsg('NOTPAY_CONTENT    ='+#NOTPAY_CONTENT    +']');
	//showmsg('NOTPAY_ORDERNO    ='+#NOTPAY_ORDERNO    +']');
	//showmsg('O_NOTPAY_ORDERNO  ='+#O_NOTPAY_ORDERNO  +']');
	//showmsg('RESP1             ='+#RESP1             +']');
	//showmsg('OPERLEVEL         ='+#OPERLEVEL         +']');
	//showmsg('PROC_STS          ='+#PROC_STS          +']');
	//showmsg('OPCD              ='+#OPCD              +']');
	//showmsg('LW_IND            ='+#LW_IND            +']');
	//showmsg('HP_ADD_PWD        ='+#HP_ADD_PWD        +']');
	//showmsg('PACKID            ='+#PACKID            +']');
	//showmsg('O_PACKID          ='+#O_PACKID          +']');
	//showmsg('PACK_DATE         ='+#PACK_DATE         +']');
	//showmsg('O_PACK_DATE       ='+#O_PACK_DATE       +']');
	//showmsg('TXNUM             ='+#TXNUM             +']');
	//showmsg('O_TXNUM           ='+#O_TXNUM           +']');
	//showmsg('LV_YW_IND         ='+#LV_YW_IND         +']');
	//showmsg('RESP_DATE         ='+#RESP_DATE         +']');
	//showmsg('RCP_STS           ='+#RCP_STS           +']');
	//showmsg('RESP2             ='+#RESP2             +']');
	//showmsg('RETCODE           ='+#RETCODE           +']');
	//showmsg('YW_DTL_ID         ='+#YW_DTL_ID         +']');
	//showmsg('ACC_IND           ='+#ACC_IND           +']');
	//showmsg('REQ_TYPE          ='+#REQ_TYPE          +']');
	//showmsg('DF_FREEAMT        ='+#DF_FREEAMT        +']');
	//showmsg('PROTNO            ='+#PROTNO            +']');
	//showmsg('PO_NO             ='+#PO_NO             +']');
	//showmsg('PO_TYPE           ='+#PO_TYPE           +']');
	//showmsg('OTYPE             ='+#OTYPE             +']');
}"
</USERFUN>
<USERFUN NAME="commrecv_1234">"{
	$FD123 = getitems('#RECECO#QSBRNO#TXAMT#SDATE#EDATE#IDRATE#SERATE#MORATE#ZFTXAMT#ZFNUM#DBTXAMT#DBNUM#MESTXAMT#MESNUM');
  }"
</USERFUN>
<USERFUN NAME="commrecv_12">"{
	$FD123 = getitems('#RECECO#RATE_TIME#OVER_AMT#RATE#OVER_INTR');
  }"
</USERFUN>
<!--小额支付结构-->
<USERFUN NAME="lvsend_123">"{
	$FD123 = getitems('#CRDB#OPCD#PKGNO#ORDERNO#TXNUM#OR_BR_NO#AC_BR_NO#TX_AMT#PAY_OPN_BR_NO#PAY_QS_NO#PAY_AC_NO#PAY_NAME#PAY_ADDR#PWD#CASH_QS_NO#CASH_OPN_BR_NO#CASH_AC_NO#CASH_NAME#CASH_ADDR#YW_TYPE#BRF#WT_DATE#OPERLEVEL#AUTH_TEL#AUTH_PWD#NOTE_TYPE#NOTE_NO#PACK_DATE#PACK_ID#CHRG_IND#CHRG_AMT#RESP_DAY#PO_TYPE#PO_DATE#PO_NUM#PC_TX_AMT#JF_TX_AMT#O_WT_DATE#O_TXNUM#O_ORDERNO#RET_CODE#RCP_STS#RESP1#RESP2#PACK_END#LV_STS#LW_IND#DFXYNO#OORBRNO#OACBRNO');
	//showmsg('lw_ind'+#LW_IND);
	//showmsg('dfxyno'+#DFXYNO);
	//showmsg('resp1'+#RESP1);
	//showmsg('resp2'+#RESP2);
}"
</USERFUN>
<!--小额包结构,这里为了区别其他域的字段，就在每个字段前添加了一个B-->
<USERFUN NAME="lvsend_125">"{
	//showmsg('1111111111111111111111');
	$FD125 = getitems('#BPACK_DATE#BPACKID#BPKGNO#BPAY_QS_NO#BCASH_QS_NO#BIN_DATE#BPACKMY#BDTLCNT#BTOTAMT#BZCNODE#BZC_DATE#BZCID#BHZ_DATE#BO_PACK_DATE#BO_PACKID#BDTLSUCCNT#BDTLSUCAMT#BO_PKGNO#BORNODE#BACNODE#BFFFLAG#BTXNUM#BBFFLAG#BQS_DATE#BPACKSTAT#BSTS#BBR_NO#BFILLER');
	//showmsg('lw_ind'+#BPACK_DATE);
	//showmsg('dfxyno'+#BPACKID);
	//showmsg('resp1'+#BPKGNO);
	//showmsg('resp2'+#BPAY_QS_NO);
}"
</USERFUN>
<!--大额公共要素结构-->
<USERFUN NAME="commsend_hv">"{
	$FD44 = #WT_DAY;
	$FD45 = #O_WT_DAY;
	$FD46 = #NOTPAY_DATE;
	$FD39 = itoa( #TX_AMT*100,'%016.0f');
	$FD21 = #CUR_NO;
	$FD69 = #TX_TYPE;
	$FD89 = #NOTE_TYPE;
	$FD58 = #NOTE_NO;
	$FD20 = #LW_IND;
}"
</USERFUN>
<USERFUN NAME="call_9986">"{
	dim @fd122 as string;
	dim @fd122_tmp as string;
	commsend_001();
	$FD16='9986';
	$TXNO_AGENT=$TXNO;
	//showmsg('call_9986  $TXNO_AGENT='+$TXNO_AGENT+'$TXNO='+$TXNO);
	$FD12=$TXNO;
	if(len($FD9)==11){
		$FD9=substr($FD9,0,10)+' ';
	}
	@fd122=$FD122;
	if(substr(@fd122,231,1)=='1'){
	$FD122='                                                                                                                                                                                                                                       1';
	}else {
	$FD122='';
	}
	@fd122_tmp=$FD122;
	callserver();
	$FD122=@fd122_tmp;
	$FD16=$TXNO;
	if($FD12!='0000'){
		showmsg(geterror());
	}
	if($FD12=='Z201'){
	 if(opendlg('../xml/FEE.DLG')){
		return(true);
	 }else{
		return(false);
	 }
  }
	return(true);
}"
</USERFUN>
<USERFUN NAME="call_9986_1">"{
	dim @fd122 as string;
	commsend_001();
	$FD16='9986';
	$TXNO_AGENT=$TXNO;
	//showmsg('call_9986_1  $TXNO_AGENT='+$TXNO_AGENT+'$TXNO='+$TXNO);
	$FD12=$TXNO;
	if(len($FD9)==11){
		$FD9=substr($FD9,0,10)+' ';
	}
	@fd122=$FD122;
	if(substr(@fd122,231,1)=='1'){
	$FD122='                                                                                                                                                                                                                                       1';
	}else {
	$FD122='';
	}
	callserver();
	$FD16=$TXNO;
	if($FD12!='0000'){
		showmsg(geterror());
	}
	if($FD12=='Z201'){
		if(opendlg('../xml/FEE3101.DLG')){
			return(true);
		}else{
			return(false);
		}
	}
	return(true);
}"
</USERFUN>
<USERFUN NAME="call_9986_card">"{
	dim @fd122 as string;
	commsend_001();
	$FD16='9986';
	if ($TXNO =='2405')
	{
		$TXNO ='3405';
	}
	//showmsg('call_9986_card_$TXNO='+$TXNO);
	$TXNO_AGENT=$TXNO;
	//showmsg('call_9986_card  $TXNO_AGENT='+$TXNO_AGENT+'$TXNO='+$TXNO);
	$TXNO_AGENT=$TXNO;
	$FD12=$TXNO;
	if(len($FD9)==11){
		$FD9=substr($FD9,0,10)+' ';
	}
	@fd122=$FD122;
	if(substr(@fd122,231,1)=='1'){
	$FD122='                                                                                                                                                                                                                                       1';
	}else {
	$FD122='';
	}
	callserver();
	$FD16=$TXNO;
	if($FD12!='0000'){
		showmsg(geterror());
	}
	
	if($FD12=='Z201'){
		if(opendlg('../xml/FEE_CARD.DLG')){
			return(true);
		}else{
			return(false);
		}
	}
	return(true);
}"
</USERFUN>
<USERFUN NAME="commrecv_123">"{
    setitems('#CMTNO#O_CMTNO#PAY_QS_NO#OR_BR_NO#SENDCO#PAY_OPN_BR_NO#PAY_AC_NO#PAY_NAME#PAY_ADDR#CASH_QS_NO#AC_BR_NO#RECECO#CASH_OPN_BR_NO#CASH_AC_NO#CASH_NAME#CASH_ADDR#YW_TYPE#ORDERNO#CONTENT#RATE#RATEDATE#OORDERNO#PROCODE#CR_DATE#CR_BR_NO#CR_TX_NUM#QR_BR_NO#QR_TX_NUM#TX_TYPE#NOTPAY_CONTENT#NOTPAY_ORDERNO#O_NOTPAY_ORDERNO#RESP1#OPERLEVEL#PROC_STS#OPCD#LW_IND#HP_ADD_PWD#PACKID#O_PACKID#PACK_DATE#O_PACK_DATE#TXNUM#O_TXNUM#LV_YW_IND#RESP_DATE#RCP_STS#RESP2#RETCODE#YW_DTL_ID#ACC_IND#REQ_TYPE#DF_FREEAMT#PROTNO#PO_NO#PO_TYPE#OTYPE',$FD123);
		#CMTNO     =rtrim(#CMTNO  );enable(#CMTNO    ,true);
    #O_CMTNO   =rtrim(#O_CMTNO);enable(#O_CMTNO  ,true);
    #PAY_QS_NO =rtrim(#PAY_QS_NO);enable(#PAY_QS_NO,true);
    #OR_BR_NO  =rtrim(#OR_BR_NO);enable(#OR_BR_NO ,true);
    #SENDCO    =rtrim(#SENDCO  );enable(#SENDCO   ,true);
    #PAY_OPN_BR_NO=rtrim(#PAY_OPN_BR_NO);enable(#PAY_OPN_BR_NO,true);
    #PAY_AC_NO =rtrim(#PAY_AC_NO);enable(#PAY_AC_NO ,true);
    #PAY_NAME  =rtrim(#PAY_NAME );enable(#PAY_NAME  ,true);
    #PAY_ADDR  =rtrim(#PAY_ADDR );enable(#PAY_ADDR  ,true);
    #CASH_QS_NO=rtrim(#CASH_QS_NO);enable(#CASH_QS_NO,true);
    #AC_BR_NO  =rtrim(#AC_BR_NO );enable(#AC_BR_NO  ,true);
    #RECECO    =rtrim(#RECECO   );enable(#RECECO    ,true);
    #CASH_OPN_BR_NO=rtrim(#CASH_OPN_BR_NO);enable(#CASH_OPN_BR_NO,true);
    #CASH_AC_NO=rtrim(#CASH_AC_NO);enable(#CASH_AC_NO,true);
    #CASH_NAME =rtrim(#CASH_NAME);enable(#CASH_NAME,true);
    #CASH_ADDR =rtrim(#CASH_ADDR);enable(#CASH_ADDR,true);
    #YW_TYPE   =rtrim(#YW_TYPE  );enable(#YW_TYPE  ,true);
    #ORDERNO   =rtrim(#ORDERNO  );enable(#ORDERNO  ,true);
    #CONTENT   =rtrim(#CONTENT  );enable(#CONTENT  ,true);
    #RATEDATE  =rtrim(#RATEDATE );enable(#RATEDATE ,true);
    #OORDERNO  =rtrim(#OORDERNO );enable(#OORDERNO ,true);
    #PROCODE   =rtrim(#PROCODE  );enable(#PROCODE  ,true);
    #CR_DATE   =rtrim(#CR_DATE  );enable(#CR_DATE  ,true);
    #CR_BR_NO  =rtrim(#CR_BR_NO );enable(#CR_BR_NO ,true);
    #CR_TX_NUM =rtrim(#CR_TX_NUM);enable(#CR_TX_NUM,true);
    #QR_BR_NO  =rtrim(#QR_BR_NO );enable(#QR_BR_NO ,true);
    #QR_TX_NUM =rtrim(#QR_TX_NUM);enable(#QR_TX_NUM,true);
    #TX_TYPE   =rtrim(#TX_TYPE  );enable(#TX_TYPE  ,true);
    #NOTPAY_CONTENT=rtrim(#NOTPAY_CONTENT);enable(#NOTPAY_CONTENT,true);
    #NOTPAY_ORDERNO=rtrim(#NOTPAY_ORDERNO);enable(#NOTPAY_ORDERNO,true);
    #O_NOTPAY_ORDERNO =rtrim(#O_NOTPAY_ORDERNO );enable(#O_NOTPAY_ORDERNO ,true);
    #RESP1    =rtrim(#RESP1    );enable(#RESP1    ,true);
    #OPERLEVEL=rtrim(#OPERLEVEL);enable(#OPERLEVEL,true);
    #PROC_STS =rtrim(#PROC_STS );enable(#PROC_STS ,true);
    #OPCD  =rtrim(#OPCD);enable(#OPCD  ,true);
    #LW_IND=rtrim(#LW_IND);enable(#LW_IND,true);
    #HP_ADD_PWD =rtrim(#HP_ADD_PWD);enable(#HP_ADD_PWD,true);
    #PACKID   =rtrim(#PACKID);enable(#PACKID,true);
    #PACK_DATE=rtrim(#PACK_DATE);enable(#PACK_DATE,true);
    #O_PACK_DATE=rtrim(#O_PACK_DATE);enable(#O_PACK_DATE,true);
    #TXNUM  =rtrim(#TXNUM  );enable(#TXNUM  ,true);
    #O_TXNUM=rtrim(#O_TXNUM);enable(#O_TXNUM,true);
    #LV_YW_IND=rtrim(#LV_YW_IND);enable(#LV_YW_IND,true);
    #RESP_DATE=rtrim(#RESP_DATE);enable(#RESP_DATE,true);
    #RCP_STS=rtrim(#RCP_STS);enable(#RCP_STS,true);
    #RESP2  =rtrim(#RESP2  );enable(#RESP2  ,true);
    #RETCODE=rtrim(#RETCODE);enable(#RETCODE,true);
    #YW_DTL_ID=rtrim(#YW_DTL_ID);enable(#YW_DTL_ID,true);
    #ACC_IND  =rtrim(#ACC_IND );enable(#ACC_IND ,true);
    #REQ_TYPE =rtrim(#REQ_TYPE);enable(#REQ_TYPE,true);
    #DF_FREEAMT=rtrim(#DF_FREEAMT);enable(#DF_FREEAMT,true);
    #PROTNO =rtrim(#PROTNO);enable(#PROTNO,true);
    #PO_NO  =rtrim(#PO_NO );enable(#PO_NO ,true);
    #PO_TYPE=rtrim(#PO_TYPE);enable(#PO_TYPE,true);
    #OTYPE  =rtrim(#OTYPE );enable(#OTYPE,true);
}"
</USERFUN>
<USERFUN NAME="lvrecv_123">"{
    setitems('#CRDB#OPCD#PKGNO#ORDERNO#TXNUM#OR_BR_NO#AC_BR_NO#TX_AMT#PAY_OPN_BR_NO#PAY_QS_NO#PAY_AC_NO#PAY_NAME#PAY_ADDR#PWD#CASH_QS_NO#CASH_OPN_BR_NO#CASH_AC_NO#CASH_NAME#CASH_ADDR#YW_TYPE#BRF#WT_DATE#OPERLEVEL#AUTH_TEL#AUTH_PWD#NOTE_TYPE#NOTE_NO#PACK_DATE#PACK_ID#CHRG_IND#CHRG_AMT#RESP_DAY#PO_TYPE#PO_DATE#PO_NUM#PC_TX_AMT#JF_TX_AMT#O_WT_DATE#O_TXNUM#O_ORDERNO#RET_CODE#RCP_STS#RESP1#RESP2#PACK_END#LV_STS#LW_IND#DFXYNO#OORBRNO#OACBRNO',$FD123);
    #CRDB            =rtrim(#CRDB          );enable(#CRDB          ,true);
		#OPCD            =rtrim(#OPCD          );enable(#OPCD          ,true);
		#PKGNO           =rtrim(#PKGNO         );enable(#PKGNO         ,true);
		#ORDERNO         =rtrim(#ORDERNO       );enable(#ORDERNO       ,true);
		#TXNUM           =rtrim(#TXNUM         );enable(#TXNUM         ,true);
		#OR_BR_NO        =rtrim(#OR_BR_NO      );enable(#OR_BR_NO      ,true);
		#AC_BR_NO        =rtrim(#AC_BR_NO      );enable(#AC_BR_NO      ,true);
	//	#TX_AMT          =rtrim(#TX_AMT        );enable(#TX_AMT        ,true);
		#PAY_OPN_BR_NO   =rtrim(#PAY_OPN_BR_NO );enable(#PAY_OPN_BR_NO ,true);
		#PAY_QS_NO       =rtrim(#PAY_QS_NO     );enable(#PAY_QS_NO     ,true);
		#PAY_AC_NO       =rtrim(#PAY_AC_NO     );enable(#PAY_AC_NO     ,true);
		#PAY_NAME        =rtrim(#PAY_NAME      );enable(#PAY_NAME      ,true);
		#PAY_ADDR        =rtrim(#PAY_ADDR      );enable(#PAY_ADDR      ,true);
		#PWD             =rtrim(#PWD           );enable(#PWD           ,true);
		#CASH_QS_NO      =rtrim(#CASH_QS_NO    );enable(#CASH_QS_NO    ,true);
		#CASH_OPN_BR_NO  =rtrim(#CASH_OPN_BR_NO);enable(#CASH_OPN_BR_NO,true);
		#CASH_AC_NO      =rtrim(#CASH_AC_NO    );enable(#CASH_AC_NO    ,true);
		#CASH_NAME       =rtrim(#CASH_NAME     );enable(#CASH_NAME     ,true);
		#CASH_ADDR       =rtrim(#CASH_ADDR     );enable(#CASH_ADDR     ,true);
		#YW_TYPE"        =rtrim(#YW_TYPE"      );enable(#YW_TYPE"      ,true);
		//showmsg('!!!! ywtype=='+#YW_TYPE);
		#BRF             =rtrim(#BRF           );enable(#BRF           ,true);
		#WT_DATE         =rtrim(#WT_DATE       );enable(#WT_DATE       ,true);
		#OPERLEVEL       =rtrim(#OPERLEVEL     );enable(#OPERLEVEL     ,true);
		#AUTH_TEL        =rtrim(#AUTH_TEL      );enable(#AUTH_TEL      ,true);
		#AUTH_PWD        =rtrim(#AUTH_PWD      );enable(#AUTH_PWD      ,true);
		#NOTE_TYPE       =rtrim(#NOTE_TYPE     );enable(#NOTE_TYPE     ,true);
		#NOTE_NO         =rtrim(#NOTE_NO       );enable(#NOTE_NO       ,true);
		#PACK_DATE       =rtrim(#PACK_DATE     );enable(#PACK_DATE     ,true);
		#PACK_ID         =rtrim(#PACK_ID       );enable(#PACK_ID       ,true);
		#CHRG_IND        =rtrim(#CHRG_IND      );enable(#CHRG_IND      ,true);
		#CHRG_AMT        =rtrim(#CHRG_AMT      );enable(#CHRG_AMT      ,true);
		#RESP_DAY        =rtrim(#RESP_DAY      );enable(#RESP_DAY      ,true);
		#PO_TYPE"        =rtrim(#PO_TYPE       );enable(#PO_TYPE      ,true);
		#PO_DATE"        =rtrim(#PO_DATE       );enable(#PO_DATE      ,true);
		#PO_NUM"         =rtrim(#PO_NUM"       );enable(#PO_NUM"       ,true);
		#PC_TX_AMT       =rtrim(#PC_TX_AMT     );enable(#PC_TX_AMT     ,true);
		#JF_TX_AMT       =rtrim(#JF_TX_AMT     );enable(#JF_TX_AMT     ,true);
		#O_WT_DATE       =rtrim(#O_WT_DATE     );enable(#O_WT_DATE     ,true);
		#O_TXNUM         =rtrim(#O_TXNUM       );enable(#O_TXNUM       ,true);
		#O_ORDERNO       =rtrim(#O_ORDERNO     );enable(#O_ORDERNO     ,true);
		#RET_CODE        =rtrim(#RET_CODE      );enable(#RET_CODE      ,true);
		#RCP_STS         =rtrim(#RCP_STS       );enable(#RCP_STS       ,true);
		#RESP1	         =rtrim(#RESP1	       );enable(#RESP1	       ,true);
		#RESP2           =rtrim(#RESP2         );enable(#RESP2         ,true);
		#PACK_END        =rtrim(#PACK_END      );enable(#PACK_END      ,true);
		#LV_STS          =rtrim(#LV_STS        );enable(#LV_STS        ,true);
		#LW_IND          =rtrim(#LW_IND        );enable(#LW_IND        ,true);
		#DFXYNO          =rtrim(#DFXYNO        );enable(#DFXYNO      ,true);
		#OORBRNO          =rtrim(#OORBRNO        );enable(#OORBRNO        ,true);
		#OACBRNO          =rtrim(#OACBRNO        );enable(#OACBRNO      ,true);
   }"
</USERFUN>

<USERFUN NAME="lvrecv_125">"{
    setitems('#BPACK_DATE#BPACKID#BPKGNO#BPAY_QS_NO#BCASH_QS_NO#BIN_DATE#BPACKMY#BDTLCNT#BTOTAMT#BZCNODE#BZC_DATE#BZCID#BHZ_DATE#BO_PACK_DATE#BO_PACKID#BDTLSUCCNT#BDTLSUCAMT#BO_PKGNO#BORNODE#BACNODE#BFFFLAG#BTXNUM#BBFFLAG#BQS_DATE#BPACKSTAT#BSTS#BBR_NO#BFILLER',$FD125);
    #BPACK_DATE   = rtrim(#BPACK_DATE  ); enable(#BPACK_DATE   ,true);
    #BPACKID      = rtrim(#BPACKID     ); enable(#BPACKID      ,true);
    #BPKGNO       = rtrim(#BPKGNO      ); enable(#BPKGNO       ,true);
    #BPAY_QS_NO   = rtrim(#BPAY_QS_NO  ); enable(#BPAY_QS_NO   ,true);
    #BCASH_QS_NO  = rtrim(#BCASH_QS_NO ); enable(#BCASH_QS_NO  ,true);
    #BIN_DATE     = rtrim(#BIN_DATE    ); enable(#BIN_DATE     ,true);
    #BPACKMY      = rtrim(#BPACKMY     ); enable(#BPACKMY      ,true);
    #BDTLCNT      = rtrim(#BDTLCNT     ); enable(#BDTLCNT      ,true);
    #BTOTAMT      = rtrim(#BTOTAMT     ); enable(#BTOTAMT      ,true);
    #BZCNODE      = rtrim(#BZCNODE     ); enable(#BZCNODE      ,true);
    #BZC_DATE     = rtrim(#BZC_DATE    ); enable(#BZC_DATE     ,true);
    #BZCID        = rtrim(#BZCID       ); enable(#BZCID        ,true);
    #BHZ_DATE     = rtrim(#BHZ_DATE    ); enable(#BHZ_DATE     ,true);
    #BO_PACK_DATE = rtrim(#BO_PACK_DATE); enable(#BO_PACK_DATE ,true);
    #BO_PACKID    = rtrim(#BO_PACKID   ); enable(#BO_PACKID    ,true);
    #BDTLSUCCNT   = rtrim(#BDTLSUCCNT  ); enable(#BDTLSUCCNT   ,true);
    #BDTLSUCAMT   = rtrim(#BDTLSUCAMT  ); enable(#BDTLSUCAMT   ,true);
    #BO_PKGNO     = rtrim(#BO_PKGNO    ); enable(#BO_PKGNO     ,true);
    #BORNODE      = rtrim(#BORNODE     ); enable(#BORNODE      ,true);
    #BACNODE      = rtrim(#BACNODE     ); enable(#BACNODE      ,true);
    #BFFFLAG      = rtrim(#BFFFLAG     ); enable(#BFFFLAG      ,true);
    #BTXNUM       = rtrim(#BTXNUM      ); enable(#BTXNUM       ,true);
    #BBFFLAG      = rtrim(#BBFFLAG     ); enable(#BBFFLAG      ,true);
    #BQS_DATE     = rtrim(#BQS_DATE    ); enable(#BQS_DATE     ,true);
    #BPACKSTAT    = rtrim(#BPACKSTAT   ); enable(#BPACKSTAT    ,true);
    #BSTS         = rtrim(#BSTS        ); enable(#BSTS         ,true);
    #BBR_NO       = rtrim(#BBR_NO      ); enable(#BBR_NO       ,true);
    #BFILLER      = rtrim(#BFILLER     ); enable(#BFILLER      ,true);
   }"
</USERFUN>
<USERFUN NAME="commrecv_v123">"{
    setitems('#CMTNO#O_CMTNO#PAY_QS_NO#OR_BR_NO#SENDCO#PAY_OPN_BR_NO#PAY_AC_NO#PAY_NAME#PAY_ADDR#CASH_QS_NO#AC_BR_NO#RECECO#CASH_OPN_BR_NO#CASH_AC_NO#CASH_NAME#CASH_ADDR#YW_TYPE#ORDERNO#CONTENT#RATE#RATEDATE#OORDERNO#PROCODE#CR_DATE#CR_BR_NO#CR_TX_NUM#QR_BR_NO#QR_TX_NUM#TX_TYPE#NOTPAY_CONTENT#NOTPAY_ORDERNO#O_NOTPAY_ORDERNO#RESP1#OPERLEVEL#PROC_STS#OPCD#LW_IND#HP_ADD_PWD#PACKID#PACK_DATE#O_PACK_DATE#TXNUM#O_TXNUM#LV_YW_IND#RESP_DATE#RCP_STS#RESP2#RETCODE#YW_DTL_ID#ACC_IND#REQ_TYPE#DF_FREEAMT#PROTNO#PO_NO#PO_TYPE#OTYPE',$FD123);
}"
</USERFUN>

<USERFUN NAME="lv_reset_item">"{
	#OPCD  = '10';
	#OTYPE = '1';
	#WT_DAY = $HDATE;
	#LW_IND = '1';
	}"
</USERFUN>
<USERFUN NAME="printacdtl_1">"{ //为了使打印格式与凭证格式匹配
	dim @fd123 as string;
	dim @fd4 as string;
	dim @cnt as number;
	dim @id as number;
	dim @dracno as string;
	dim @cracno as string;
	dim @dramt as string;
	dim @cramt as string;
	dim @dramt_sign as string;
	dim @cramt_sign as string;
	dim @equa_ind as string;
	savefds('../tmp/'+$KINBR+$TTYNAME+'.fds');//保存fd变量
	@fd4=$FD4;
	initfd();
	commsend_001();
	$FD16='9550';
	$FD4=@fd4;
	setnomsg();
	callserver();
	setmsg();
	if($FD12!='0000'){
		print(lineno()+1,20,'取得分录信息失败!');
		loadfds('../tmp/'+$KINBR+$TTYNAME+'.fds');//恢复fd变量
		return(false);
	}
	@fd123=$FD123;
	loadfds('../tmp/'+$KINBR+$TTYNAME+'.fds');//恢复fd变量
	//print(lineno()+1,37,'\[会计分录\]');
	@cnt=val(substr(@fd123,0,2));
	@id=0;
 	print(lineno()+2,10,'[50]',space(50));
	while(@id &lt; @cnt){
		@equa_ind=substr(@fd123,2+@id*47,1);
		@dracno=substr(@fd123,2+@id*47+1,7);
		@dramt=substr(@fd123,2+@id*47+8,16);
		if(substr(@dramt,0,1)=='-'){
			@dramt_sign='-';
			@dramt=substr(@dramt,1,15);
		}else{
			@dramt_sign=' ';
		}
		@cracno=substr(@fd123,2+@id*47+24,7);
		@cramt=substr(@fd123,2+@id*47+31,16);
		if(substr(@cramt,0,1)=='-'){
			@cramt_sign='-';
			@cramt=substr(@cramt,1,15);
		}else{
			@cramt_sign=' ';
		}
		if(@equa_ind=='N'){
			/****收付****/
			if(substr(@dracno,0,1)==' '){
				/***只有收***/
				print(lineno()+1,48,'收:([7    ])[7]  [1][20                 ]',@cracno,space(7),@cramt_sign,delspace(comma(@cramt,21)));

			}else{
				/***只有付***/
				print(lineno()+1,20,'付:([7    ])[35]  [1][20                 ]',@dracno,space(35),@dramt_sign,delspace(comma(@dramt,21)));
			}
			@id=@id+1;
		}else{
			if(delspace(@dracno)!=''){
				print(lineno()+1,20,'借:([7    ])[35]  [1][20                 ]',@dracno,space(35),@dramt_sign,delspace(comma(@dramt,21)));
			}
			if(delspace(@cracno)!=''){
				print(lineno()+1,48,'贷:([7    ])[7]  [1][20                 ]',@cracno,space(7),@cramt_sign,delspace(comma(@cramt,21)));
			}
			@id=@id+1;
		}
	}
	return(true);
}"
</USERFUN>
<!--
<USERFUN NAME="print_sq">"{ //打印授权信息
	dim @auth_no as string;
	dim @auth as string;
	dim @auth_num as string;
	loadfds('../tmp/tmp'+$KINBR+$TTYNAME+'.fmp');//恢复fd变量
	@auth_no=substr($FD14,1,7);
	if((substr($FD9,0,3) == '@@@') and (substr($FD9,3,1) == '1')) //第3种授权方式
	{

		@auth_num=substr($FD9,3,7);
	loadfds('../tmp/tmp'+$KINBR+@auth_num+'.sq');
		print(lineno()+1,20,'授权流水号:[7]       授权码:[7]       授权柜员:[4]',@auth_no,@auth_num,$FD7);
		return(true);
	}
	if((substr($FD9,0,3) == '@@@') and (substr($FD9,3,1) == '3'))//第2种授权方式
	{
	loadfds('../tmp/tmp'+$KINBR+@auth_no+'.sq');

	print(lineno()+1,20,'授权流水号:[7]      授权码:[7]       授权柜员:[4]',@auth_no,@auth_no,$FD7);
		return(true);
	}
		@auth=substr($FD9,0,4);
	print(lineno()+1,20,'授权流水号:[7]      授权柜员:[4]',@auth_no,@auth);
		return(true);
}"
</USERFUN>
-->
<!--added by lyz-->
<USERFUN NAME="print_sq">"{ //打印授权信息
dim @auth_no as string;
	dim @auth as string;
	dim @auth_num as string;
	dim @f as file;
	dim @line as string;
	dim @fd27 as string;//com_tel_change.name
	dim @fd34 as string;
	dim @b as string;
	dim @fd68 as string;
	//解决授权打印问题，在文件名中加$TXNO以区别 20080927 martin
	savefds('../tmp/'+$KINBR+'-'+$TLRNO+'-'+$TTYNAME+'.tmp');//保存fd变量
	@f=openfile('../tmp/tmp'+$KINBR+'-'+$TLRNO+'-'+$TTYNAME+'-'+$TXNO+'.tmp','a');//授权修改 20080927 martin
	closefile(@f);
	@f=openfile('../tmp/tmp'+$KINBR+'-'+$TLRNO+'-'+$TTYNAME+'-'+$TXNO+'.tmp','r');//授权修改 20080927 martin
	@line=readline(@f);
	@b=substr(@line,0,1);

	if(@b=='b')
	{
	  if(substr(@line,1,1)=='1')
	  {
		@auth_num=substr(@line,8,7);
		@auth_no=substr(@line,1,7);
		initfd();
		commsend_001();
		$FD14=@auth_no;
		$FD28=@auth_num;
		$FD20='3';
		$FD16='9555';
		setnomsg();
		callserver();
		setmsg();
		if($FD12 != '0000'){
			//print(lineno()+1,20,'3取得授权信息失败!');
			loadfds('../tmp/'+$KINBR+'-'+$TLRNO+'-'+$TTYNAME+'.tmp');//保存fd变量
			closefile(@f);
			@f=openfile('../tmp/tmp'+$KINBR+'-'+$TLRNO+'-'+$TTYNAME+'-'+$TXNO+'.tmp','w');//授权修改 20081118 martin
			writeline(@f,' ');
			closefile(@f);
			return(false);
		}
		@fd27=$FD27;
		@fd34=$FD34;
		@fd68=$FD68;
		loadfds('../tmp/'+$KINBR+'-'+$TLRNO+'-'+$TTYNAME+'.tmp');//保存fd变量
		if(@fd68 != '0')
		{
			print(lineno()+1,20,'授权流水号:[7]      授权码:[7]       授权柜员:[8][10]',@auth_num,@auth_no,@fd34,@fd27);
		}
	  }
	if(substr(@line,1,1)=='3')//第2种授权方式
	{
		@auth_num=substr(@line,8,7);
		@auth_no=substr(@line,1,7);
		initfd();
		commsend_001();
		$FD14=@auth_no;
		$FD20='2';
		$FD16='9555';
		setnomsg();
		callserver();
		setmsg();
		if($FD12 !='0000'){
			//print(lineno()+1,20,'2取得授权信息失败!');
			closefile(@f);
			@f=openfile('../tmp/tmp'+$KINBR+'-'+$TLRNO+'-'+$TTYNAME+'-'+$TXNO+'.tmp','w');//授权修改 20081118 martin
			writeline(@f,' ');
			closefile(@f);
			loadfds('../tmp/'+$KINBR+'-'+$TLRNO+'-'+$TTYNAME+'.tmp');//保存fd变量
			return(false);
		}
		@fd27=$FD27;
		@fd34=$FD34;
		@fd68=$FD68;
		loadfds('../tmp/'+$KINBR+'-'+$TLRNO+'-'+$TTYNAME+'.tmp');//保存fd变量
		if(@fd68 != '0')
		{
			print(lineno()+1,20,'授权流水号:[7]      授权码:[7]       授权柜员:[4][10]',@auth_num,@auth_no,@fd34,@fd27);
	  	}
	  }
	}
	else if(@b=='a')
	{
		@auth=substr(@line,1,4);
		@auth_num=substr(@line,5,7);
		initfd();
		commsend_001();
		$FD14=@auth_num;
		$FD20='1';
		$FD16='9555';
		setnomsg();
		callserver();
		setmsg();
		if($FD12 !='0000'){
			//print(lineno()+1,20,'1取得授权信息失败!');
			loadfds('../tmp/'+$KINBR+'-'+$TLRNO+'-'+$TTYNAME+'.tmp');//保存fd变量
			closefile(@f);
			@f=openfile('../tmp/tmp'+$KINBR+'-'+$TLRNO+'-'+$TTYNAME+'-'+$TXNO+'.tmp','w');//授权修改 20081118 martin
			writeline(@f,' ');
			closefile(@f);
			return(false);
		}
		@fd27=$FD27;
		@fd68=$FD68;
		loadfds('../tmp/'+$KINBR+'-'+$TLRNO+'-'+$TTYNAME+'.tmp');//保存fd变量
		if(@fd68 != '0')
		{
			print(lineno()+1,20,'授权流水号:[7]      授权柜员:[4][10] ',@auth_num,@auth,@fd27);
		}
	}

	closefile(@f);
	@f=openfile('../tmp/tmp'+$KINBR+'-'+$TLRNO+'-'+$TTYNAME+'-'+$TXNO+'.tmp','w');//授权修改 20081118 martin
	writeline(@f,' ');
	closefile(@f);
	return(true);
}"
</USERFUN>
<USERFUN NAME="printacdtl_h">"{ //取消交易打印分录
	dim @fd123 as string;
	dim @cnt as number;
	dim @id as number;
	dim @dracno as string;
	dim @cracno as string;
	dim @dramt as string;
	dim @cramt as string;
	dim @dramt_sign as string;
	dim @cramt_sign as string;
	dim @equa_ind as string;
	dim @fd4 as string;
	savefds('../tmp/'+$KINBR+$TTYNAME+'.fds');//保存fd变量
	@fd4=itoa(val($FD44),'%06.0f');
	initfd();
	commsend_001();
	$FD16='9550';
	$FD4=@fd4;
	setnomsg();
	callserver();
	setmsg();
	if($FD12!='0000'){
		print(lineno()+1,20,'取得分录信息失败!');
		loadfds('../tmp/'+$KINBR+$TTYNAME+'.fds');//恢复fd变量
		return(false);
	}
	@fd123=$FD123;
	loadfds('../tmp/'+$KINBR+$TTYNAME+'.fds');//恢复fd变量
	//print(lineno()+1,37,'\[会计分录\]');
	@cnt=val(substr(@fd123,0,2));
	@id=0;
 	print(lineno()+2,10,'[50]',space(50));
	while(@id &lt; @cnt){
		@equa_ind=substr(@fd123,2+@id*47,1);
		@dracno=substr(@fd123,2+@id*47+1,7);
		@dramt=substr(@fd123,2+@id*47+8,16);
		//反交易的正负号要反过来
		if(substr(@dramt,0,1)=='-'){
			@dramt_sign=' ';
			@dramt=substr(@dramt,1,15);
		}else{
			@dramt_sign='-';
		}
		@cracno=substr(@fd123,2+@id*47+24,7);
		@cramt=substr(@fd123,2+@id*47+31,16);
		if(substr(@cramt,0,1)=='-'){
			@cramt_sign=' ';
			@cramt=substr(@cramt,1,15);
		}else{
			@cramt_sign='-';
		}
		if(@equa_ind=='N'){
			/****收付****/
			if(substr(@dracno,0,1)==' '){
				/***只有收***/
				print(lineno()+2,20,'收:([7    ])[35]  [1][20                 ]',@cracno,space(35),@cramt_sign,delspace(comma(@cramt,21)));

			}else{
				/***只有付***/
				print(lineno()+2,20,'付:([7    ])[35]  [1][20                 ]',@dracno,space(35),@dramt_sign,delspace(comma(@dramt,21)));
			}
			@id=@id+1;
		}else{
			if(delspace(@dracno)!=''){
				print(lineno()+1,20,'借:([7    ])[35]  [1][20                 ]',@dracno,space(35),@dramt_sign,delspace(comma(@dramt,21)));
			}
			if(delspace(@cracno)!=''){
				print(lineno()+1,48,'贷:([7    ])[7]  [1][21                 ]',@cracno,space(7),@cramt_sign,delspace(comma(@cramt,21)));
			}
			@id=@id+1;
		}
	}
	return(true);
}"
</USERFUN>

<USERFUN NAME="HV_SET_STAT">"{
	switch(#TMP_TXSTAT)
	{
		case '0':
			#TXSTAT	= '往账记账(复核)';
			break;
		case '1':
			#TXSTAT	= '往账发送';
			break;
		case '2':
			#TXSTAT	= '往账记账清算';
			break;
		case '3':
			#TXSTAT	= '往账退回记账';
			break;
		case '4':
			#TXSTAT	= '往账退回等待';
			break;
		case '5':
			#TXSTAT	= '往账拒绝';
			break;
		case '6':
			#TXSTAT	= '往账撤销记账';
			break;
		case '7':
			#TXSTAT	= '往账撤销等待';
			break;
		case '8':
			#TXSTAT	= '来账拒绝';
			break;
		case '9':
			#TXSTAT	= '来账记账清算';
			break;
		case 'A':
			#TXSTAT	= '往账登记取消';
			break;
		case 'B':
			#TXSTAT	= '来账退回';
			break;
		case 'C':
			#TXSTAT	= '往帐登记(不记账)';
			break;
		case 'D':
			#TXSTAT	= '往账复核取消';
			break;
		case 'E':
			#TXSTAT	= '来账记账登记';
			break;
		case 'F':
			#TXSTAT	= '来账核地方押错';
			break;
		case 'G':
			#TXSTAT	= '来账核全国押错';
			break;
		case 'H':
			#TXSTAT	= '清算中心挂帐';
			break;
		case 'I':
			#TXSTAT	= '支行挂帐';
			break;
		case 'J':
			#TXSTAT	= '往账排队';
			break;
		case 'K':
			#TXSTAT	= '核对清算记帐';
			break;
		default:
			#TXSTAT	= '未知状态';
	}

    }"
</USERFUN>



<USERFUN NAME="HV_SET_CMTNAME">"{
	switch(#CMTNO)
	{
		case '100':
			#CMTNO_DES = '大额汇兑【100】';
			break;
		case '103':
			#CMTNO_DES = '国库资金汇划【103】';
			break;
		case '101':
			#CMTNO_DES = '委托收款【101】';
			break;
		case '105':
			#CMTNO_DES = '同业拆借【105】';
			break;
		case '102':
			#CMTNO_DES = '托收承付【102】';
			break;
		case '109':
			#CMTNO_DES = '电子联行【109】';
			break;
		case '108':
			#CMTNO_DES = '支付退汇【108】';
			break;
		case '313':
			#CMTNO_DES = '申请退回【313】';
			break;
		case '314':
			#CMTNO_DES = '退回应答【314】';
			break;
		case '301':
			#CMTNO_DES = '大额查询【301】';
			break;
		case '302':
			#CMTNO_DES = '大额查复【302】';
			break;
		case '303':
			#CMTNO_DES = '自由格式【303】';
			break;
		case '311':
			#CMTNO_DES = '申请撤销【311】';
			break;
		case '407':
			#CMTNO_DES = '质押融资【407】';
			break;
		case '408':
			#CMTNO_DES = '质押融资扣款【408】';
			break;
		case '121':
			#CMTNO_DES = '资金移存【121】';
			break;
		case '721':
			#CMTNO_DES = '申请资金清算【721】';
			break;
		case '123':
			#CMTNO_DES = '多余资金退回【123】';
			break;
		case '725':
			#CMTNO_DES = '全额兑付通知【725】';
			break;
		case '724':
			#CMTNO_DES = '汇票申请退回【724】';
			break;
		case '124':
			#CMTNO_DES = '汇票未用退回【124】';
			break;
		default:
			#CMTNO_DES = '未知业务类型【000】';
	}
 }"
</USERFUN>

<USERFUN NAME="BIG5">
"{
	dim @hdate  as string; //日期
	dim @year   as string; //年
	dim @month  as string; //月
	dim @day    as string; //日
	dim @byear  as string; //大写年
	dim @bmonth as string; //大写月
	dim @bday   as string; //大写日
	dim @i      as number;


	@hdate = #COMMDAY;       //XML中传入的日期
	@year  = substr(@hdate,0,4);
	@month = substr(@hdate,4,2);
	@day   = substr(@hdate,6,2);
	while(@i &lt; 4)
	{
		switch(substr(@year,@i,1)) //判断年如何取大写
		{
			case '0':
				@byear = @byear+'零';
				break;
			case '1':
				@byear = @byear+'壹';
				break;
			case '2':
				@byear = @byear+'贰';
				break;
			case '3':
				@byear = @byear+'叁';
				break;
			case '4':
				@byear = @byear+'肆';
				break;
			case '5':
				@byear = @byear+'伍';
				break;
			case '6':
				@byear = @byear+'陆';
				break;
			case '7':
				@byear = @byear+'柒';
				break;
			case '8':
				@byear = @byear+'捌';
				break;
			case '9':
				@byear = @byear+'玖';
				break;
		}
		@i = @i + 1;
	}

	switch(@month)   //判断月如何取大写
	{
		case '01':
			@bmonth = '  零壹';
			break;
		case '02':
			@bmonth = '  零贰';
			break;
		case '03':
			@bmonth = '  零叁';
			break;
		case '04':
			@bmonth = '  零肆';
			break;
		case '05':
			@bmonth = '  零伍';
			break;
		case '06':
			@bmonth = '  零陆';
			break;
		case '07':
			@bmonth = '  零柒';
			break;
		case '08':
			@bmonth = '  零捌';
			break;
		case '09':
			@bmonth = '  零玖';
			break;
		case '10':
			@bmonth = '零壹拾';
			break;
		case '11':
			@bmonth = '壹拾壹';
			break;
		case '12':
			@bmonth = '壹拾贰';
			break;
	}

	switch(@day)    //判断日如何取大写
	{
		case '01':
			@bday = '  零壹';
			break;
		case '02':
			@bday = '  零贰';
			break;
		case '03':
			@bday = '  零叁';
			break;
		case '04':
			@bday = '  零肆';
			break;
		case '05':
			@bday = '  零伍';
			break;
		case '06':
			@bday = '  零陆';
			break;
		case '07':
			@bday = '  零柒';
			break;
		case '08':
			@bday = '  零捌';
			break;
		case '09':
			@bday = '  零玖';
			break;
		case '10':
			@bday = '零壹拾';
			break;
		case '11':
			@bday = '壹拾壹';
			break;
		case '12':
			@bday = '壹拾贰';
			break;
		case '13':
			@bday = '壹拾叁';
			break;
		case '14':
			@bday = '壹拾肆';
			break;
		case '15':
			@bday = '壹拾伍';
			break;
		case '16':
			@bday = '壹拾陆';
			break;
		case '17':
			@bday = '壹拾柒';
			break;
		case '18':
			@bday = '壹拾捌';
			break;
		case '19':
			@bday = '壹拾玖';
			break;
		case '20':
			@bday = '零贰拾';
			break;
		case '21':
			@bday = '贰拾壹';
			break;
		case '22':
			@bday = '贰拾贰';
			break;
		case '23':
			@bday = '贰拾叁';
			break;
		case '24':
			@bday = '贰拾肆';
			break;
		case '25':
			@bday = '贰拾伍';
			break;
		case '26':
			@bday = '贰拾陆';
			break;
		case '27':
			@bday = '贰拾柒';
			break;
		case '28':
			@bday = '贰拾捌';
			break;
		case '29':
			@bday = '贰拾玖';
			break;
		case '30':
			@bday = '零叁拾';
			break;
		case '31':
			@bday = '叁拾壹';
			break;
	}

	#BIGDAY = @byear+@bmonth+@bday;
}"
</USERFUN>

<USERFUN NAME="HV_SET_POSTS_NAME">
"{
	switch(#PO_STS)
	{
		case '0':
			#PO_STS_DESP = '登记';
			break;
		case '1':
			#PO_STS_DESP = '签发';
			break;
		case '2':
			#PO_STS_DESP = '汇票移存';
			break;
		case '3':
			#PO_STS_DESP = '申请兑付';
			break;
		case '4':
			#PO_STS_DESP = '汇票兑付';
			break;
		case '5':
			#PO_STS_DESP = '全额结清';
			break;
		case '6':
			#PO_STS_DESP = '部分退回';
			break;
		case '7':
			#PO_STS_DESP = '未用退回';
			break;
		case '8':
			#PO_STS_DESP = '汇票解付';
			break;
		case '9':
			#PO_STS_DESP = '签发取消';
			break;
		case 'A':
			#PO_STS_DESP = '解付取消';
			break;
		case 'B':
			#PO_STS_DESP = '发送';
			break;
		case 'C':
			#PO_STS_DESP = '申请兑付取消';
			break;
		case 'D':
			#PO_STS_DESP = '汇票登记取消';
			break;
		case 'E':
			#PO_STS_DESP = '挂失';
			break;
		case 'F':
			#PO_STS_DESP = '解挂失';
			break;
		case 'G':
			#PO_STS_DESP = '逾期未用退回';
			break;
		case 'H':
			#PO_STS_DESP = '未用解';
			break;
		case 'I':
			#PO_STS_DESP = '未用冲帐冲帐';
			break;
		default:
			#PO_STS_DESP = '未知状态';

	}
}"
</USERFUN>

<USERFUN NAME="LV_SET_STAT">"{
	switch(#TMP_TXSTAT)
	{
	case '0':
		#TXSTAT = '无效状态' ;
	        break;
	case '1':
		#TXSTAT = '往账录入' ;
	        break;
	case '3':
		#TXSTAT = '往账复核' ;
	        break;
	case '4':
		#TXSTAT = '往账发送' ;
	        break;
	case '5':
		#TXSTAT = '往账拒绝' ;
	        break;
	case '6':
		#TXSTAT = '往账扎差' ;
	        break;
	case '7':
		#TXSTAT = '往账排队' ;
	        break;
	case '8':
		#TXSTAT = '往账撤销等待' ;
	        break;
	case '9':
		#TXSTAT = '往账撤销' ;
	        break;
	case 'A':
		#TXSTAT = '退回冲正止付等待' ;
	        break;
	case 'B':
		#TXSTAT = '往账退回' ;
	        break;
	case 'C':
		#TXSTAT = '往账已冲正' ;
	        break;
	case 'D':
		#TXSTAT = '往账已止付' ;
	        break;
	case 'G':
		#TXSTAT = '往账异常挂帐' ;
	        break;
	case 'H':
		#TXSTAT = '临时接收,不记帐' ;
	        break;
	case 'I':
		#TXSTAT = '正式接收' ;
	        break;
	case 'J':
		#TXSTAT = '全国押错' ;
	        break;
	case 'K':
		#TXSTAT = '地方押错' ;
	        break;
	case 'L':
		#TXSTAT = '全国押和地方押都错' ;
	        break;
	case 'M':
		#TXSTAT = '清算中心挂帐' ;
	        break;
	case 'N':
		#TXSTAT = '支行挂帐' ;
	        break;
	case 'O':
		#TXSTAT = '来账退回等待' ;
	        break;
	case 'P':
		#TXSTAT = '来账退回' ;
	        break;
	case 'Q':
		#TXSTAT = '同意未发送' ;
	        break;
	case 'R':
		#TXSTAT = '同意已发送' ;
	        break;
	case 'S':
		#TXSTAT = '不同意未发送' ;
	        break;
	case 'T':
		#TXSTAT = '不同意已发送' ;
	        break;
	case 'U':
		#TXSTAT = '来账已冲正' ;
	        break;
	case 'V':
		#TXSTAT = '来账已止付' ;
	        break;
	case 'W':
		#TXSTAT = '来账已付款' ;
	        break;
	case 'Z':
		#TXSTAT = '来账异常挂帐' ;
	        break;
	default:
		#TXSTAT = '未知状态' ;
	}

    }"
</USERFUN>
<USERFUN NAME="LV_SET_RCPSTAT">"{
	switch(#TMP_RCPSTAT)
	{
		case '00':
			#RCPSTAT = '成功';
			break;
		case '01':
			#RCPSTAT = '帐号不符';
			break;
		case '02':
			#RCPSTAT = '帐号户名不符';
			break;
		case '03':
			#RCPSTAT = '账户余额不足支付';
			break;
		case '09':   //wangyongwei  20070621
			#RCPSTAT = '对方退票';
			break;
		case '10':
			#RCPSTAT = '账户密码错误';
			break;
		case '11':
			#RCPSTAT = '帐号状态错误';
			break;
		case '20':
			#RCPSTAT = '业务已撤销';
			break;
		case '90':
			#RCPSTAT = '其他错误';
			break;
		case '21':
			#RCPSTAT ='大小写金额不符  ';
			break;
		case '22':
			#RCPSTAT ='支票记载事项不全';
			break;
		case '23':
			#RCPSTAT ='出票人签章不符  ';
			break;
		case '24':
			#RCPSTAT ='支付密码错误    ';
			break;
		case '25':
			#RCPSTAT ='持票人未做背书  ';
			break;
		case '26':
			#RCPSTAT ='支票影像不相符  ';
			break;
		case '27':
			#RCPSTAT ='出票人帐号户名错';
			break;
		case '28':
			#RCPSTAT ='出票人余额不足  ';
			break;
		case '29':
			#RCPSTAT ='重复提示付款    ';
			break;
		case '30':
			#RCPSTAT ='非本行票据      ';
			break;
		case '31':
			#RCPSTAT ='出票人已销户    ';
			break;
		case '32':
			#RCPSTAT ='出票人帐户已冻结';
			break;
		case '33':
			#RCPSTAT ='出票人帐户已止付';
			break;
		case '34':
			#RCPSTAT ='业务已经申请止付';
			break;
		case '35':
			#RCPSTAT ='数字签名或证书错';
			break;
		case '40':  // add by NEWBP4
			#RCPSTAT ='本票号码不符';
			break;
		case '41':
			#RCPSTAT ='收款人户名不符';
			break;
		case '42':
			#RCPSTAT ='出票日期不符';
			break;
		case '43':
			#RCPSTAT ='密押不符';
			break;
		case '44':
			#RCPSTAT ='金额不符';
			break;
		case '45':
			#RCPSTAT ='超过提示付款日';
			break;
		case '48':
			#RCPSTAT ='本票已挂失止付或收到法院通知';
			break; //end by NEWBP4
		default:
			#RCPSTAT = '没有回执';
	}
}"
</USERFUN>
<USERFUN NAME="LV_SET_CMTNAME">"{

	switch(#CMTNO)
	{
	case '001':
		#CMT_DES = '普通贷记';
		break;
	case '002':
		#CMT_DES = '普通借记';
	        break;
	case '003':
		#CMT_DES = '实时贷记';
	        break;
	case '004':
		#CMT_DES = '实时借记';
	        break;
	case '005':
		#CMT_DES = '定期贷记';
	        break;
	case '006':
		#CMT_DES = '定期借记';
	        break;
	case '007':
		#CMT_DES = '贷记退汇';
	        break;
	case '008':
		#CMT_DES = '普通借记回执';
	        break;
	case '009':
		#CMT_DES = '实时贷记回执';
	        break;
	case '010':
		#CMT_DES = '实时借记回执';
	        break;
	case '011':
		#CMT_DES = '定期借记回执';
	        break;
	case '012':
		#CMT_DES = '通用信息';
	        break;
	case '013':
		#CMT_DES = '实时信息';
	        break;
	case '301':
		#CMT_DES = '小额查询';
	        break;
	case '302':
		#CMT_DES = '小额查复';
	        break;
	case '303':
		#CMT_DES = '自由格式';
	        break;
	case '319':
		#CMT_DES = '申请退回';
	        break;
	case '320':
		#CMT_DES = '退回应答';
	        break;
	case '321':
		#CMT_DES = '申请撤销';
	        break;
	case '322':
		#CMT_DES = '撤销应答';
	        break;
	case '323':
		#CMT_DES = '冲正申请';
	        break;
	case '324':
		#CMT_DES = '冲正应答';
	        break;
	case '325':
		#CMT_DES = '冲正通知';
	        break;
	case '327':
		#CMT_DES = '止付申请';
	        break;
	case '328':
		#CMT_DES = '止付应答';
	        break;
	default:
		#CMT_DES = '未知交易类型';
	}
}"
</USERFUN>

<USERFUN NAME="LV_SET_TXNUM">"{
	switch(#TMP_TXNUM)
	{
		case '00100':
			#TXNUM_DES = '汇兑';
			break;
		case '00101':
			#TXNUM_DES = '委托收款划回';
			break;
		case '00102':
			#TXNUM_DES = '托收承付划回';
			break;
		case '00103':
			#TXNUM_DES = '国库资金贷记划拨';
			break;
		case '00106':
			#TXNUM_DES = '其他贷记业务';
			break;
		case '20001':
			#TXNUM_DES = '缴税';
			break;
		case '20005':
			#TXNUM_DES = '国债贷记';
			break;
		case '20002':
			#TXNUM_DES = '非税收入';
			break;
		case '30002':
			#TXNUM_DES = '缴费';
			break;
		case '00113':
			#TXNUM_DES = '国库资金借记划拨';
			break;
		case '00119':
			#TXNUM_DES = '其他借记业务';
			break;
		case '20103':
			#TXNUM_DES = '财政直接支付';
			break;
		case '20104':
			#TXNUM_DES = '财政授权支付';
			break;
		case '20003':
			#TXNUM_DES = '财政直接支付退回';
			break;
		case '20004':
			#TXNUM_DES = '财政授权支付退回';
			break;
		case '30102':
			#TXNUM_DES = '支票截留业务';
			break;
		case '30104':
			#TXNUM_DES = '支票截留回执';
			break;
		case '20105':
			#TXNUM_DES = '国债借记';
			break;
		case '00108':
			#TXNUM_DES = '贷记退汇业务';
			break;
		case '00104':
			#TXNUM_DES = '定期贷记业务';
			break;
		case '00114':
			#TXNUM_DES = '定期借记业务';
			break;
		case '20102':
			#TXNUM_DES = '批量扣税';
			break;
		case '30001':
			#TXNUM_DES = '通存业务';
			break;
		case '20101':
			#TXNUM_DES = '实时扣税';
			break;
		case '30101':
			#TXNUM_DES = '通兑业务';
			break;
		case '30103':
			#TXNUM_DES = '对公通兑业务';
			break;
		case '30105':
			#TXNUM_DES = '通用截留回执';
			break;
		case '00500':
			#TXNUM_DES = '通用信息业务';
			break;
		case '40501':
			#TXNUM_DES = '代付业务';
			break;
		case '40502':
			#TXNUM_DES = '代收业务';
			break;
		case '30501':
			#TXNUM_DES = '支票圈存';
			break;
		case '30502':
			#TXNUM_DES = '客户账户查询';
			break;
		case '30503':
			#TXNUM_DES = '客户账户查询应答';
			break;
		case '30504':
			#TXNUM_DES = '支票圈存应答';
			break;
		case '30505':
			#TXNUM_DES = '证书查询';
			break;
		case '30506':
			#TXNUM_DES = '证书查询应答';
			break;
		default:
			#TXNUM_DES = '未知业务类型';
	}
}"
</USERFUN>
<USERFUN NAME="set_fd122">"{
setitems('#FD1221#FD1222#FD1223#FD1224#FD1225#FD1226#FD1227#FD1228#FD1229#FD122A#FD122B#FD122C#FD122D#FD122E#FD122F',$FD122);
}"
</USERFUN>

<USERFUN NAME="print_nxywpz1">"{
    dim @br_name1 as string;
    @br_name1=substr($BRNAME,0,4);

        print( 5,20,'机构名称:[30]',$BRNAME);
        print( 5, 2,'代码:[4]',#TXNUMBER);
        print( 5,13,'交易:[30]',#TXNAME);
    }"
</USERFUN>

<USERFUN NAME="print_nxywpz2">"{
    dim @txtime  as string;
    @txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
  print(24,15,'备注:');
  print(24,27,'交易日期:[8]  [8]',$HDATE,@txtime);
  print(24,5,'柜员:[4]',$FD7);
  print(24,5,'流水号:[6]',$FD4);
}"
</USERFUN>
<USERFUN NAME="setpicture">"{

}"
</USERFUN>
<USERFUN NAME="idcheck">"{

}"
</USERFUN>
<USERFUN NAME="call_96641">"{
      dim @txnobak as string;
      dim @tatl as string;
      dim @FD25 as string;
      dim @FD26 as string;
      dim @FD28 as string;
      dim @FD30 as string;
      dim @FD34 as string;
      dim @FD41 as string;
      dim @FD42 as string;
      dim @FD44 as string;
      dim @FD48 as string;
      dim @FD50 as string;
      dim @FD52 as string;
      dim @FD53 as string;
      dim @FD54 as string;
      dim @FD58 as string;
      dim @FD62 as string;
      dim @FD63 as string;
      dim @FD68 as string;
      dim @FD70 as string;
      dim @FD72 as string;
      dim @FD81 as string;
      dim @FD82 as string; 
      @txnobak = $TXNO;
      
      @FD25=$FD25;
      @FD26=$FD26;
      @FD28=$FD28;
      @FD30=$FD30;
      @FD34=$FD34;
      @FD41=$FD41;
      @FD42=$FD42;
      @FD44=$FD44;
      @FD48=$FD48;
      @FD50=$FD50;
      @FD52=$FD52;
      @FD53=$FD53;
      @FD54=$FD54;
      @FD58=$FD58;
      @FD62=$FD62;
      @FD63=$FD63;
      @FD68=$FD68;
      @FD70=$FD70;
      @FD72=$FD72;
      @FD81=$FD81;
      @FD82=$FD82;
      
      $TXNO = '9664';
      $FD30 = #LYACNO;
      $FD72 = '1';
      commsend_001();
      @tatl = callserver();
      if($FD12 !='0000')
      {
        
      }
      $TXNO = @txnobak;
      setpicture(#PIC,1,0);
      $FD25=@FD25;
      $FD26=@FD26;
      $FD28=@FD28;
      $FD30=@FD30;
      $FD34=@FD34;
      $FD41=@FD41;
      $FD42=@FD42;
      $FD44=@FD44;
      $FD48=@FD48;
      $FD50=@FD50;
      $FD52=@FD52;
      $FD53=@FD53;
      $FD54=@FD54;
      $FD58=@FD58;
      $FD62=@FD62;
      $FD63=@FD63;
      $FD68=@FD68;
      $FD70=@FD70;
      $FD72=@FD72;
      $FD81=@FD81;
      $FD82=@FD82;
}"
</USERFUN>
<USERFUN NAME="call_96642">"{
      dim @txnobak as string;
      dim @tatl as string;
      
      dim @FD25 as string;
      dim @FD26 as string;
      dim @FD28 as string;
      dim @FD30 as string;
      dim @FD34 as string;
      dim @FD41 as string;
      dim @FD42 as string;
      dim @FD44 as string;
      dim @FD48 as string;
      dim @FD50 as string;
      dim @FD52 as string;
      dim @FD53 as string;
      dim @FD54 as string;
      dim @FD58 as string;
      dim @FD62 as string;
      dim @FD63 as string;
      dim @FD68 as string;
      dim @FD70 as string;
      dim @FD72 as string;
      dim @FD81 as string;
      dim @FD82 as string; 
      
      @FD25=$FD25;
      @FD26=$FD26;
      @FD28=$FD28;
      @FD30=$FD30;
      @FD34=$FD34;
      @FD41=$FD41;
      @FD42=$FD42;
      @FD44=$FD44;
      @FD48=$FD48;
      @FD50=$FD50;
      @FD52=$FD52;
      @FD53=$FD53;
      @FD54=$FD54;
      @FD58=$FD58;
      @FD62=$FD62;
      @FD63=$FD63;
      @FD68=$FD68;
      @FD70=$FD70;
      @FD72=$FD72;
      @FD81=$FD81;
      @FD82=$FD82;
      @txnobak = $TXNO;
      $TXNO = '9664';
      $FD30 = #LYACNO;
      $FD72 = '2';
      commsend_001();
      @tatl = callserver();
      if($FD12 !='0000')
      {
        
      }
      $TXNO = @txnobak;
      setpicture(#PIC1,1,0);
      $FD25=@FD25;
      $FD26=@FD26;
      $FD28=@FD28;
      $FD30=@FD30;
      $FD34=@FD34;
      $FD41=@FD41;
      $FD42=@FD42;
      $FD44=@FD44;
      $FD48=@FD48;
      $FD50=@FD50;
      $FD52=@FD52;
      $FD53=@FD53;
      $FD54=@FD54;
      $FD58=@FD58;
      $FD62=@FD62;
      $FD63=@FD63;
      $FD68=@FD68;
      $FD70=@FD70;
      $FD72=@FD72;
      $FD81=@FD81;
      $FD82=@FD82;
}"
</USERFUN>
<USERFUN NAME="call_96681">"{
      dim @txnobak as string;
      dim @tatl as string;
      dim @FD25 as string;
      dim @FD26 as string;
      dim @FD28 as string;
      dim @FD30 as string;
      dim @FD34 as string;
      dim @FD41 as string;
      dim @FD42 as string;
      dim @FD44 as string;
      dim @FD48 as string;
      dim @FD50 as string;
      dim @FD52 as string;
      dim @FD53 as string;
      dim @FD54 as string;
      dim @FD58 as string;
      dim @FD62 as string;
      dim @FD63 as string;
      dim @FD68 as string;
      dim @FD70 as string;
      dim @FD72 as string;
      dim @FD81 as string;
      dim @FD82 as string; 
      
      @FD25=$FD25;
      @FD26=$FD26;
      @FD28=$FD28;
      @FD30=$FD30;
      @FD34=$FD34;
      @FD41=$FD41;
      @FD42=$FD42;
      @FD44=$FD44;
      @FD48=$FD48;
      @FD50=$FD50;
      @FD52=$FD52;
      @FD53=$FD53;
      @FD54=$FD54;
      @FD58=$FD58;
      @FD62=$FD62;
      @FD63=$FD63;
      @FD68=$FD68;
      @FD70=$FD70;
      @FD72=$FD72;
      @FD81=$FD81;
      @FD82=$FD82;
      @txnobak = $TXNO;
      $TXNO = '9668';
      $FD28 = '';
      $FD62 = #LYIDNO;
      $FD67 = #LYIDTYPE;
      $FD72 = '1';
      commsend_001();
      @tatl = callserver();
      if($FD12 !='0000')
      {
        
      }
      $TXNO = @txnobak;
      setpicture(#PIC,1,0);
      $FD25=@FD25;
      $FD26=@FD26;
      $FD28=@FD28;
      $FD30=@FD30;
      $FD34=@FD34;
      $FD41=@FD41;
      $FD42=@FD42;
      $FD44=@FD44;
      $FD48=@FD48;
      $FD50=@FD50;
      $FD52=@FD52;
      $FD53=@FD53;
      $FD54=@FD54;
      $FD58=@FD58;
      $FD62=@FD62;
      $FD63=@FD63;
      $FD68=@FD68;
      $FD70=@FD70;
      $FD72=@FD72;
      $FD81=@FD81;
      $FD82=@FD82;
}"
</USERFUN>
<USERFUN NAME="call_96682">"{
      dim @txnobak as string;
      dim @tatl as string;
      dim @FD25 as string;
      dim @FD26 as string;
      dim @FD28 as string;
      dim @FD30 as string;
      dim @FD34 as string;
      dim @FD41 as string;
      dim @FD42 as string;
      dim @FD44 as string;
      dim @FD48 as string;
      dim @FD50 as string;
      dim @FD52 as string;
      dim @FD53 as string;
      dim @FD54 as string;
      dim @FD58 as string;
      dim @FD62 as string;
      dim @FD63 as string;
      dim @FD68 as string;
      dim @FD70 as string;
      dim @FD72 as string;
      dim @FD81 as string;
      dim @FD82 as string; 
      
      @FD25=$FD25;
      @FD26=$FD26;
      @FD28=$FD28;
      @FD30=$FD30;
      @FD34=$FD34;
      @FD41=$FD41;
      @FD42=$FD42;
      @FD44=$FD44;
      @FD48=$FD48;
      @FD50=$FD50;
      @FD52=$FD52;
      @FD53=$FD53;
      @FD54=$FD54;
      @FD58=$FD58;
      @FD62=$FD62;
      @FD63=$FD63;
      @FD68=$FD68;
      @FD70=$FD70;
      @FD72=$FD72;
      @FD81=$FD81;
      @FD82=$FD82;
      @txnobak = $TXNO;
      $TXNO = '9668';
      $FD28 = '';
      $FD62 = #LYIDNO;
      $FD67 = #LYIDTYPE;
      $FD72 = '2';
      commsend_001();
      @tatl = callserver();
      if($FD12 !='0000')
      {
        
      }
      $TXNO = @txnobak;
      setpicture(#PIC1,1,0);
      $FD25=@FD25;
      $FD26=@FD26;
      $FD28=@FD28;
      $FD30=@FD30;
      $FD34=@FD34;
      $FD41=@FD41;
      $FD42=@FD42;
      $FD44=@FD44;
      $FD48=@FD48;
      $FD50=@FD50;
      $FD52=@FD52;
      $FD53=@FD53;
      $FD54=@FD54;
      $FD58=@FD58;
      $FD62=@FD62;
      $FD63=@FD63;
      $FD68=@FD68;
      $FD70=@FD70;
      $FD72=@FD72;
      $FD81=@FD81;
      $FD82=@FD82;
}"
</USERFUN>
<USERFUN NAME="count_cash">"{
	dim @total as number;
	@total=val(#MONEY100)*100+val(#MONEY50)*50+val(#MONEY20)*20+
			val(#MONEY10)*10+val(#MONEY5)*5+val(#MONEY2)*2+
			val(#MONEY1)*1+val(#MONEY05)*0.5+val(#MONEY02)*0.2+
			val(#MONEY01)*0.1+val(#MONEY005)*0.05+val(#MONEY002)*0.02+
			val(#MONEY001)*0.01;
	#TOTAL = comma(itoa(@total,'%.2f'),16);
	show(#TOTAL,true);
	enable(#TOTAL,false);
}"
</USERFUN>

<!--柜面通查询   20100712-->
<USERFUN NAME="ucgmup_pack">"{//修改为大写变量 20110517
//$FD123=getitems('#pkhead#spbkno#trancd#cardno#tranpw#tranam#tstime#inputp#idtftp#idtfno#acbkdt#acbkno#acbksq#isbkdt#isbkno#isbksq#centdt#centsq#track2#track3#acctna#onlnbl#avalbl#handfe#corrdt#corrsq#extdt1#extdt2#extdt3#extdt4#extdt5#rspscd#rtertx');
$FD123=getitems('#PKHEAD#SPBKNO#TRANCD#CARDNO#TRANPW#TRANAM#TSTIME#INPUTP#IDTFTP#IDTFNO#ACBKDT#ACBKNO#ACBKSQ#ISBKDT#ISBKNO#ISBKSQ#CENTDT#CENTSQ#TRACK2#TRACK3#ACCTNA#ONLNBL#AVALBL#HANDFE#CORRDT#CORRSQ#EXTDT1#EXTDT2#EXTDT3#EXTDT4#EXTDT5#RSPSCD#RTERTX');
}"
</USERFUN>
<!--柜面通查询   20100712-->
<USERFUN NAME="ucgmup_unpack">"{//修改为大写变量 20110517
//setitems('#pkhead#spbkno#trancd#cardno#tranpw#tranam#tstime#inputp#idtftp#idtfno#acbkdt#acbkno#acbksq#isbkdt#isbkno#isbksq#centdt#centsq#track2#track3#acctna#onlnbl#avalbl#handfe#corrdt#corrsq#extdt1#extdt2#extdt3#extdt4#extdt5#rspscd#rtertx',$FD123);
setitems('#PKHEAD#SPBKNO#TRANCD#CARDNO#TRANPW#TRANAM#TSTIME#INPUTP#IDTFTP#IDTFNO#ACBKDT#ACBKNO#ACBKSQ#ISBKDT#ISBKNO#ISBKSQ#CENTDT#CENTSQ#TRACK2#TRACK3#ACCTNA#ONLNBL#AVALBL#HANDFE#CORRDT#CORRSQ#EXTDT1#EXTDT2#EXTDT3#EXTDT4#EXTDT5#RSPSCD#RTERTX',$FD123);

}"
</USERFUN>
<!-- Added start 2010/10/26 by sunlicheng 检查win前台是否有更新,有则提示并下载-->
<USERFUN NAME="BankUpdateWin">"{
}"
</USERFUN>

<!--异常关闭时发往神码的卡业务撤销交易   20110310-->
<USERFUN NAME="AgentCancel">"{
	showmsg('调用AgentCancel!');
	showmsg('$TXNO_AGENT='+$TXNO_AGENT);
	showmsg('$TXNO='+$TXNO);
  //return(false)不关闭弹出窗体,return(true)关闭弹出窗体
  //return(true);
  commrecv_001();
	if(($TXNO=='2101') and (substr(#CARDNO,0,6)=='621223'))    //开卡
	{
	  CardCancel_kk();
	}
	else if(($TXNO_AGENT=='2201') and (substr(#CARDNO,0,6)=='621223'))     //存款
	{
	  CardCancel_ck();
	}
	else if(($TXNO=='2202') and (substr(#ACTNO,0,6)=='621223'))     //取款
	{
	  CardCancel_qk(); 
	}
	else if(($TXNO=='2204') and (substr(#ACTNO,0,6)=='621223'))      //销户
	{
	  CardCancel_xk();
	}
	if((delspace($TXNO)=='2204') and (substr(#ACTNO,0,6)=='621780'))    //IC销户
	{
	  CardCancel_icxk();
	}
	if((delspace($TXNO)=='2406') and (substr(#CARDNO,0,6)=='621780'))    //IC销户
	{
	  CardCancel_xksq();
	}
	else if((delspace($TXNO)=='2410') and (substr(#OACTNO,0,6)=='621780'))     //IC补换卡
	{
	  CardCancel_icbhk();
	}
	else if(($TXNO_AGENT=='2402') and (substr(#ACTNO,0,6)=='621223'))     //增加卡折开卡
	{
	  CardCancel_kjz();
	}
	else if((($TXNO_AGENT=='2405') or ($TXNO_AGENT=='3405') or ($TXNO=='3405') or ($TXNO_AGENT=='2602') or ($TXNO_AGENT=='2210')) and (substr(#ACTNO,0,6)=='621223' or substr(#ACTNO,0,6)=='621780'))   //卡挂失解挂、支取密码维护、销介质//(卡)
	{
	  CardCancel_kjy();
	}
	else if(($TXNO_AGENT=='2410') and (substr(#OACTNO,0,6)=='621223'))      //更换介质(卡)
	{
	  CardCancel_ghk();
	}
	else if((($TXNO_AGENT=='5802') or ($TXNO_AGENT=='5842') or ($TXNO_AGENT=='5844') or ($TXNO_AGENT=='5846')) and (substr(#ACTNO,0,6)=='621223'))      //大额支付类往帐、普通贷记业务、小额定期贷记业务、通存业务复核
	{
	  CardCancel_dexe();
	}
	else if(($TXNO_AGENT=='5869') and (substr(#ACTNO,0,6)=='621223'))       //大额错帐处理
	{
	  CardCancel_decz();
	}
	else if(($TXNO_AGENT=='5861') and (substr(#ACTNO,0,6)=='621223'))        //实时业务冲正处理
	{
	  CardCancel_sscz();
	}
	else if(($TXNO_AGENT=='5880') and (substr(#ACTNO,0,6)=='621223'))        //小额错帐处理
	{
	  CardCancel_xecz();
	}
	//showmsg('!!!到这儿了');
  return (true);
}"
</USERFUN>

<USERFUN NAME="CardCancel_kk">"{            //开卡 //修改20120317 将（$FD12!='Z201'）修改为（$FD12!='Z201'）chenggx
	//如果是转账开卡户,记录核心返回的12域返回错误代码,否则记为0000,确保是否需要进行转取款的撤销
	  showmsg('$FD12='+$FD12);
	  <!--
	  if(($FD12!='0000') and ($FD12!='Z003') and ($FD12!='Z201') and (#CASHCD == '2'))
	  -->
	  if(($FD12!='0000') and (#CASHCD == '2'))
	  	{
	  		#RESP_CODE_TRAN=$FD12;
	  	}
	  else
	  	{
	  		#RESP_CODE_TRAN='0000';
	  	}
	  //卡交易核心处理失败往数码发送取消交易
	  <!--
	  if(($FD12!='0000') and ($FD12!='Z003') and ($FD12!='Z201'))
	  -->
	  if($FD12!='0000')
	  {
	  	//showmsg('#RESP_CODE='+$FD12);
	  	#RESP_CODE=$FD12;
	  	//showmsg('#RESP_CODE='+$FD12);
	  	//showmsg(geterror());
	  	initfd();
	  	commsend_001();
	  	$FD16='7777';
	  	$FD12=#RESP_CODE;
	  	$FD30=#CARDNO;
	  	$FD39=itoa(#TXAMT*100);
	  	$FD43=#CARD_TRACENO;
	  	//showmsg('#CARD_TRACENO2='+#CARD_TRACENO);
	  	callagn();
	  	if($FD12!='0000')
	  	{
	  		showmsg('撤销卡系统开户失败:['+geterror()+']');
	  		//return (false);  //由于要执行2次撤销交易,故执行撤销错误的情况下只返回错误信息,不退出而继续执行下一次撤销
	  	}
	  }
	  //卡转账开户核心处理失败往数码发送转出卡取款撤销交易 add by hxc 091120
	  <!--
	  if((#RESP_CODE_TRAN != '0000') and (#RESP_CODE_TRAN != 'Z003') and (#RESP_CODE_TRAN != 'Z201') and (#CASHCD == '2'))
	  -->
	  if((#RESP_CODE_TRAN != '0000') and (#CASHCD == '2'))
	  {
	  	//#RESP_CODE=$FD12;
	  	//showmsg('#RESP_CODE='+$FD12);
	  	//showmsg(geterror());
	  	initfd();
	  	commsend_001();
	  	$FD16='7777';
	  	$FD12=#RESP_CODE_TRAN;
	  	$FD30=#TRAN_AC_NO;
	  	$FD39=itoa(#TXAMT*100);
	  	$FD43=#CARD_TRACENO_TRAN;
	  	callagn();
	  	if($FD12!='0000')
	  	{
	  		showmsg('撤销卡系统转取款失败:['+geterror()+']');
	  		//return (false);   //此处只提示错误信息而不返回,确保程序继续往下执行
	  	}
	  }
	  return (true);
}"
</USERFUN>

<USERFUN NAME="CardCancel_ck">"{                        //存款
	if(($FD12!='0000') and ($FD12!='Z003'))//卡交易核心处理失败往数码发送取消交易
	  {
	  	#RESP_CODE=$FD12;
	  	//showmsg(geterror());
	  	initfd();
	  	commsend_001();
	  	$FD16='7777';
	  	$FD12=#RESP_CODE;
	  	$FD30=#ACTNO;
	  	$FD39= itoa(atoi(#LTXAMT)*100,'%016f'); 
	  	$FD43=#CARD_TRACENO;
	  	callagn();
	  	if($FD12!='0000')
	  	{
	  		showmsg(geterror());
	  		//return(false);
	  	}
	  }
	return (true);
}"
</USERFUN>

<USERFUN NAME="CardCancel_qk">"{                     //取款
	if(($FD12!='0000') and ($FD12=='Z003') and (substr(#ACTNO,0,6)=='621223') and (len(#ACTNO)==19))//卡交易核心处理失败往数码发送取消交易
	  {
	  	#RESP_CODE=$FD12;
	  	//showmsg(geterror());
	  	initfd();
	  	commsend_001();
	  	$FD16='7777';
	  	$FD12=#RESP_CODE;
	  	$FD30=#ACTNO;
	  	$FD39=itoa(#TXAMT*100);
	  	$FD43=#CARD_TRACENO;
	  	callagn();
	  	if($FD12!='0000')
	  	{
	  		showmsg(geterror());
	  		//return (false);
	  	}
	  }
	return (true);
}"
</USERFUN>

<USERFUN NAME="CardCancel_xk">"{                            //销户
	showmsg('CardCancel_xk()==>$FD12='+$FD12+' #ACTNO='+substr(#ACTNO,0,6)+'#CASHFLAG='+#CASHFLAG);
	if(($FD12!='0000'))
	  	{
	  		#RESP_CODE_TRAN=$FD12;
	  		//showmsg('#RESP_CODE_TRAN='+#RESP_CODE_TRAN);
	  	}
	  else
	  	{
	  		#RESP_CODE_TRAN='0000';
	  	}
	  //卡转账销户核心处理失败往数码发送卡存款撤销交易 
	  if(($FD12 != '0000') and (substr(#ACTNO,0,6)=='621223')and (#CASHFLAG=='2'))
	  {
	  	//#RESP_CODE=$FD12;
	  	//showmsg('#RESP_CODE='+$FD12);
	  	//showmsg(geterror());
	  	initfd();
	  	commsend_001();
	  	$FD16='7777';
	  	$FD12=#RESP_CODE_TRAN;
	  	$FD30=#DFNO;
	  	$FD39=itoa(#TXAMT*100);
	  	$FD43=#CARD_TRACENO_TRAN;
	  	callagn();
	  	if($FD12!='0000')
	  	{
	  		showmsg('撤销卡系统转存款失败:['+geterror()+']');
	  		//return (false);   //由于要执行2次撤销交易,故执行撤销错误的情况下只返回错误信息,不退出而继续执行下一次撤销 
	  	}
	  }
	  //卡交易核心处理失败往数码发送取消交易
	  		showmsg('#RESP_CODE_TRAN='+#RESP_CODE_TRAN);
	  if((#RESP_CODE_TRAN!='0000') and (substr(#ACTNO,0,6)=='621223'))
	  {
	  	//showmsg('#RESP_CODE_TRAN='+$FD12);
	  	$FD12=#RESP_CODE_TRAN;
	  	//showmsg('#RESP_CODE='+$FD12);
	  	//showmsg(geterror());
	  	initfd();
	  	commsend_001();
	  	$FD16='7777';
	  	$FD12=#RESP_CODE_TRAN;
	  	$FD30=#ACTNO;
	  	$FD39=itoa(#TXAMT*100);
	  	$FD43=#CARD_TRACENO;
	  	//showmsg('#CARD_TRACENO2='+#CARD_TRACENO);
	  	callagn();
	  	if($FD12!='0000')
	  	{
	  		showmsg('撤销卡系统销户失败:['+geterror()+']');
	  		//return (false); //此处只提示错误信息而不返回,确保程序继续往下执行
	  	}
	  }
	return (true);
}"
</USERFUN>


<USERFUN NAME="CardCancel_icxk">"{                            //销户
	showmsg('CardCancel_icxk()==>$FD12='+$FD12+' #ACTNO='+substr(#ACTNO,0,6)+'#CASHFLAG='+#CASHFLAG);
	if(($FD12!='0000'))
	  	{
	  		#RESP_CODE_TRAN=$FD12;
	  		//showmsg('#RESP_CODE_TRAN='+#RESP_CODE_TRAN);
	  	}
	  else
	  	{
	  		#RESP_CODE_TRAN='0000';
	  	}
	  //卡转账销户核心处理失败往数码发送卡存款撤销交易 
	  if(($FD12 != '0000') and (substr(#ACTNO,0,6)=='621780')and (#CASHFLAG=='2'))
	  {
	  	//#RESP_CODE=$FD12;
	  	//showmsg('#RESP_CODE='+$FD12);
	  	//showmsg(geterror());
	  	initfd();
	  	commsend_001();
	  	$FD16='7777';
	  	$FD12=#RESP_CODE_TRAN;
	  	$FD30=#DFNO;
	  	$FD39=itoa(#TXAMT*100);
	  	$FD43=#CARD_TRACENO_TRAN;
	  	callagn();
	  	if($FD12!='0000')
	  	{
	  		showmsg('撤销卡系统转存款失败:['+geterror()+']');
	  		//return (false);   //由于要执行2次撤销交易,故执行撤销错误的情况下只返回错误信息,不退出而继续执行下一次撤销 
	  	}
	  }
	  //卡交易核心处理失败往数码发送取消交易
	  		showmsg('#RESP_CODE_TRAN='+#RESP_CODE_TRAN);
	  if((#RESP_CODE_TRAN!='0000') and (substr(#ACTNO,0,6)=='621780'))
	  {
	  	//showmsg('#RESP_CODE_TRAN='+$FD12);
	  	$FD12=#RESP_CODE_TRAN;
	  	//showmsg('#RESP_CODE='+$FD12);
	  	//showmsg(geterror());
	  	initfd();
	  	commsend_001();
	  	$FD16='7777';
	  	$FD12=#RESP_CODE_TRAN;
	  	$FD30=#ACTNO;
	  	$FD39=itoa(#TXAMT*100);
	  	$FD43=#CARD_TRACENO;
	  	//showmsg('#CARD_TRACENO2='+#CARD_TRACENO);
	  	callagn();
	  	if($FD12!='0000')
	  	{
	  		showmsg('撤销卡系统销户失败:['+geterror()+']');
	  		//return (false); //此处只提示错误信息而不返回,确保程序继续往下执行
	  	}
	  }
	return (true);
}"
</USERFUN>


<USERFUN NAME="CardCancel_xksq">"{                            //销户
	       //showmsg('CardCancel_xksq()==>$FD12='+$FD12+' #CARDNO='+substr(#CARDNO,0,6));
	       
	       if(($FD12!='0000') and ($FD12!='Z003'))
			   {
			   #RESP_CODE_TRAN=$FD12;
			  
			   }
			  else
			   {
			  #RESP_CODE_TRAN='0000';
			  
			   }
	      if(($FD12 != '0000') and (substr(#CARDNO,0,6)=='621223' or substr(#CARDNO,0,6)=='621780'))
	       {
	       
		       initfd();
				   commsend_001();
				   $FD16='7777';
				   $FD12=#RESP_CODE_TRAN;
				   $FD30=#CARDNO;
				   $FD39=itoa(val(#LAVBAL,100),'%016.2f');;
				   $FD43=#CARD_TRACENO;
				  callagn();
				  if($FD12!='0000')
				  {
					showmsg('撤销销卡申请失败:['+geterror()+']');
				  }
				  
	       }
	       return (true);
}"
</USERFUN>

<USERFUN NAME="CardCancel_icbhk">"{                            //ic补换卡
	      // showmsg('CardCancel_xksq()==>$FD12='+$FD12+' #OACTNO='+substr(#OACTNO,0,6));
	       
	       if(($FD12!='0000') and ($FD12!='Z003'))
			   {
			   #RESP_CODE=$FD12;
			   }
			  else
			   {
			  #RESP_CODE='0000';
			  
			   }
	      if(($FD12 != '0000') and substr(#OACTNO,0,6)=='621780')
	       {
		       initfd();
				   commsend_001();
				   $FD16='7777';
				   $FD12=#RESP_CODE;
				   $FD30=#OACTNO;
				   //$FD39=itoa(val(#LAVBAL,100),'%016.2f');;
				   $FD43=#CARD_TRACENO;
				   callagn();
				  if($FD12!='0000')
				  {
					showmsg('撤销补换卡申请失败:['+geterror()+']');
				  }
				 }
	       return (true);
}"
</USERFUN>

<USERFUN NAME="CardCancel_kjz">"{                            //增加卡折开卡
	if(($FD12!='0000') and ($FD12=='Z003') and ($FD12!='Z201') and (substr(#N_CARDNO,0,6)=='621223'))
	    {
	    	//showmsg('#RESP_CODE='+$FD12);
	    	#RESP_CODE=$FD12;
	    	//showmsg('#RESP_CODE='+$FD12);
	    	//showmsg(geterror());
	    	initfd();
	    	commsend_001();
	    	$FD16='7777';
	    	$FD12=#RESP_CODE;
	    	$FD30=#N_CARDNO;
	    	$FD39=itoa(#TXAMT*100);
	    	$FD43=#CARD_TRACENO;
	    	//showmsg('#CARD_TRACENO2='+#CARD_TRACENO);
	    	callagn();
	    	if($FD12!='0000')
	    	{
	    		showmsg('撤销卡系统开户失败:['+geterror()+']');
	    		//return (false);  
	    	}
	    }
	return (true);
}"
</USERFUN>

<USERFUN NAME="CardCancel_kjy">"{                     //卡挂失解挂、支取密码维护、销介质(卡)
	if(($FD12!='0000') and ($FD12 =='Z003') and ($FD12!='Z201') and (substr(#ACTNO,0,6)=='621223' or substr(#ACTNO,0,6)=='621780')) 
		{
				#RESP_CODE=$FD12;
				//showmsg(geterror());
				initfd();
				commsend_001();
				$FD16='7777';
				$FD12=#RESP_CODE;
				$FD30=#ACTNO;
				$FD43=#CARD_TRACENO;
				callagn();
				if($FD12!='0000')
				{
					showmsg(geterror());
					//return (false);
				}
		}
	return (true);
}"
</USERFUN>

<USERFUN NAME="CardCancel_ghk">"{                            //更换介质(卡)
	if(($FD12!='0000') and ($FD12=='Z003') and (substr(#OACTNO,0,6)=='621223'))
	    {
	      #RESP_CODE=$FD12;
	    	//showmsg(geterror());
	    	initfd();
	    	commsend_001();
	    	$FD16='7777';
	    	$FD12=#RESP_CODE;
	    	$FD30=#OACTNO;
	    	$FD43=#CARD_TRACENO;
	    	//showmsg('$FD43='+$FD43);
	    	callagn();
	    	if($FD12!='0000')
	    	{
	    		showmsg(geterror());
	    		//return (false);
	    	}
	    }
	return (true);
}"
</USERFUN>

<USERFUN NAME="CardCancel_dexe">"{                             //大额支付类往帐、普通贷记业务、小额定期贷记业务、通存业务复核
	if(($FD12!='0000') and ($FD12=='Z003') and ($FD12!='Z201') and (substr(#PAY_AC_NO,0,6) == '621223'))
	    {
	    	#RESP_CODE=$FD12;
	      //showmsg(geterror());
	    	initfd();
	    	commsend_001();
	    	$FD16='7777';
	    	$FD12=#RESP_CODE;
	    	$FD30=#PAY_AC_NO;
	    	$FD43=#CARD_TRACENO;
	    	callagn();
	    	if($FD12!='0000')
	    	{
	    		showmsg(geterror());
	    		//return (false);
	    	}
	    }
	return (true);
}"
</USERFUN>

<USERFUN NAME="CardCancel_decz">"{                            //大额错帐处理
	if(($FD12!='0000') and ($FD12=='Z003') and ($FD12!='Z201') and (substr(#PAY_AC_NO,0,6) == '621223') and #OPCD == '70')
	    {
	    	#RESP_CODE=$FD12;
	      //showmsg(geterror());
	    	initfd();
	    	commsend_001();
	    	$FD16='7777';
	    	$FD12=#RESP_CODE;
	    	$FD30=#PAY_AC_NO;
	    	$FD43=#CARD_TRACENO;
	    	callagn();
	    	if($FD12!='0000')
	    	{
	    		showmsg(geterror());
	    		//return (false);
	    	}
	    }
	return (true);
}"
</USERFUN>

<USERFUN NAME="CardCancel_sscz">"{                      //实时业务冲正处理
	if(($FD12!='0000') and ($FD12=='Z003') and ($FD12!='Z201') and (substr(#PAY_AC_NO,0,6) == '621223') and #O_CMTNO == '003')
	    {
	    	#RESP_CODE=$FD12;
	      //showmsg(geterror());
	    	initfd();
	    	commsend_001();
	    	$FD16='7777';
	    	$FD12=#RESP_CODE;
	    	$FD30=#PAY_AC_NO;
	    	$FD43=#CARD_TRACENO;
	    	callagn();
	    	if($FD12!='0000')
	    	{
	    		showmsg(geterror());
	    		//return (false);
	    	}
	    }
	return (true);
}"
</USERFUN>

<USERFUN NAME="CardCancel_xecz">"{                           //小额错帐处理
	if(($FD12!='0000') and ($FD12=='Z003') and ($FD12!='Z201') and (substr(#PAY_AC_NO,0,6) == '621223')  and #OPCD == '70')
	    {
	    	#RESP_CODE=$FD12;
	      //showmsg(geterror());
	    	initfd();
	    	commsend_001();
	    	$FD16='7777';
	    	$FD12=#RESP_CODE;
	    	$FD30=#PAY_AC_NO;
	    	$FD43=#CARD_TRACENO;
	    	callagn();
	    	if($FD12!='0000')
	    	{
	    		showmsg(geterror());
	    		//return (false);
	    	}
	    }
	return (true);
}"
</USERFUN>


<USERFUN NAME="isTxContinue">"{//检查IC卡交易是否中间拔过卡，如果拔过，则不能继续交易
	dim @chkcard as string ;
	@chkcard = chkiccard() ;
	if (@chkcard != '0000')
	{
		showmsg('交易过程中不能拔出IC卡，重新做交易!'+@chkcard);
		return(false) ; 
	}
return(true);
}"
</USERFUN>
<!--非税专用-->
<USERFUN NAME="callagnnew">"{
	dim @tota as string;
	dim @bakaddr as string;
	dim @newaddr as string;
	@bakaddr=getenv('AGNADDR');
	@newaddr=getenv('AGNADDR_NEW');	
	setenv('AGNADDR',@newaddr);
	@tota=callagn();
	setenv('AGNADDR',@bakaddr);
	if(@tota!=''){
		savefiletxt('../tmp/'+$KINBR+$TTYNAME,@tota);
	}		
}"
</USERFUN>
<!--银联柜面通重组脚本通知的55域IC卡卡片信息-->
<USERFUN NAME="restruc_fd55_jb">"{
	dim @fd_9f26 as string;
	dim @fd_9f27 as string;
	dim @fd_9f10 as string;
	dim @fd_9f37 as string;
	dim @fd_9f36 as string;
	dim @fd_95 as string;
	dim @fd_9a as string;
	dim @fd_9c as string;
	dim @fd_9f02 as string;
	dim @fd_5f2a as string;
	dim @fd_82 as string;
	dim @fd_9f1a as string;
	dim @fd_9f03 as string;
	dim @fd_9f33 as string;
	dim @temp as string;
	dim @l as number;
	dim @i as number;
	dim @num as number;
	@num = 14;
	@i = 0;
	while(@num != 0)
	{
	@temp=substr(#F55_ICC_DATA,@i,6);
	#CTEMP=substr(#F55_ICC_DATA,@i+4,2);
	if(@num == 9 or @num == 8 or @num == 7 or @num == 4)
	{
	@temp=substr(#F55_ICC_DATA,@i,4);
	#CTEMP=substr(#F55_ICC_DATA,@i+2,2);
	}
	hex_to_int();
	@l = atoi(#CTEMP);
	if(@num == 9 or @num == 8 or @num == 7 or @num == 4)
	{
	@temp=@temp+substr(#F55_ICC_DATA,@i+4,@l);
	}
	else
	{
	@temp=@temp+substr(#F55_ICC_DATA,@i+6,@l);
	}
	@i = @i+len(@temp);
	switch(@num)
	{
			case 14:
				@fd_9f26=@temp;
				break;
			case 13:
				@fd_9f27=@temp;
				break;
			case 12:
				@fd_9f10=@temp;
				break;
			case 11:
				@fd_9f37=@temp;
				break;
			case 10:
				@fd_9f36=@temp;
				break;
			case 9:
				@fd_95=@temp;
				break;
			case 8:
				@fd_9a=@temp;
				break;
			case 7:
				@fd_9c=@temp;
				break;
			case 6:
				@fd_9f02=@temp;
				break;
			case 5:
				@fd_5f2a=@temp;
				break;
			case 4:
				@fd_82=@temp;
				break;
			case 3:
				@fd_9f1a=@temp;
				break;
			case 2:
				@fd_9f03=@temp;
				break;
			case 1:
				@fd_9f33=@temp;
				break;
			default:
				showmsg('脚本重组异常！');
				return(false);
	}
	@num = @num-1;
	}
	#F55_ICC_DATA_JB=@fd_9f33+@fd_95+@fd_9f37+@fd_9f10+@fd_9f26+@fd_9f36+@fd_82+#RESP_CODE+@fd_9f1a+@fd_9a;
}"
</USERFUN>

<!--银联柜面通重组脚本通知的55域IC卡卡片信息-->
<USERFUN NAME="restruc_fd55_qkcz">"{
	dim @fd_9f26 as string;
	dim @fd_9f27 as string;
	dim @fd_9f10 as string;
	dim @fd_9f37 as string;
	dim @fd_9f36 as string;
	dim @fd_95 as string;
	dim @fd_9a as string;
	dim @fd_9c as string;
	dim @fd_9f02 as string;
	dim @fd_5f2a as string;
	dim @fd_82 as string;
	dim @fd_9f1a as string;
	dim @fd_9f03 as string;
	dim @fd_9f33 as string;
	dim @temp as string;
	dim @l as number;
	dim @i as number;
	dim @num as number;
	@num = 14;
	@i = 0;
	while(@num != 0)
	{
	@temp=substr(#F55_ICC_DATA,@i,6);
	#CTEMP=substr(#F55_ICC_DATA,@i+4,2);
	if(@num == 9 or @num == 8 or @num == 7 or @num == 4)
	{
	@temp=substr(#F55_ICC_DATA,@i,4);
	#CTEMP=substr(#F55_ICC_DATA,@i+2,2);
	}
	hex_to_int();
	@l = atoi(#CTEMP);
	if(@num == 9 or @num == 8 or @num == 7 or @num == 4)
	{
	@temp=@temp+substr(#F55_ICC_DATA,@i+4,@l);
	}
	else
	{
	@temp=@temp+substr(#F55_ICC_DATA,@i+6,@l);
	}
	@i = @i+len(@temp);
	switch(@num)
	{
			case 14:
				@fd_9f26=@temp;
				break;
			case 13:
				@fd_9f27=@temp;
				break;
			case 12:
				@fd_9f10=@temp;
				break;
			case 11:
				@fd_9f37=@temp;
				break;
			case 10:
				@fd_9f36=@temp;
				break;
			case 9:
				@fd_95=@temp;
				break;
			case 8:
				@fd_9a=@temp;
				break;
			case 7:
				@fd_9c=@temp;
				break;
			case 6:
				@fd_9f02=@temp;
				break;
			case 5:
				@fd_5f2a=@temp;
				break;
			case 4:
				@fd_82=@temp;
				break;
			case 3:
				@fd_9f1a=@temp;
				break;
			case 2:
				@fd_9f03=@temp;
				break;
			case 1:
				@fd_9f33=@temp;
				break;
			default:
				showmsg('脚本重组异常！');
				return(false);
	}
	@num = @num-1;
	}
	<!--#F55_ICC_DATA_QKCZ=@fd_95+#TEMP_9F1E+@fd_9f10+@fd_9f36+#RESP_CODE;-->
	#F55_ICC_DATA_QKCZ=@fd_95+@fd_9f10+@fd_9f36;
}"
</USERFUN>

<!--银联柜面通使用两位十六进制转十进制-->
<USERFUN NAME="hex_to_int">"{
	dim @tmp as string;
	dim @l1 as number;
	dim @l2 as number;
	dim @l as number;
	@tmp=substr(#CTEMP,0,1);
	switch(@tmp)
	{
		case '0':
			@l1=16*0;
			break;
		case '1':
			@l1=16*1;
			break;
		case '2':
			@l1=16*2;
			break;
		case '3':
			@l1=16*3;
			break;
		case '4':
			@l1=16*4;
			break;
		case '5':
			@l1=16*5;
			break;
		case '6':
			@l1=16*6;
			break;
		case '7':
			@l1=16*7;
			break;
		case '8':
			@l1=16*8;
			break;
		case '9':
			@l1=16*9;
			break;
		case 'A':
			@l1=16*10;
			break;
		case 'B':
			@l1=16*11;
			break;
		case 'C':
			@l1=16*12;
			break;
		case 'D':
			@l1=16*13;
			break;
		case 'E':
			@l1=16*14;
			break;
		case 'F':
			@l1=16*15;
			break;
		default:
			showmsg('非法字符！');
			return(false);
	}
	@tmp=substr(#CTEMP,1,1);
	switch(@tmp)
	{
		case '0':
			@l2=0;
			break;
		case '1':
			@l2=1;
			break;
		case '2':
			@l2=2;
			break;
		case '3':
			@l2=3;
			break;
		case '4':
			@l2=4;
			break;
		case '5':
			@l2=5;
			break;
		case '6':
			@l2=6;
			break;
		case '7':
			@l2=7;
			break;
		case '8':
			@l2=8;
			break;
		case '9':
			@l2=9;
			break;
		case 'A':
			@l2=10;
			break;
		case 'B':
			@l2=11;
			break;
		case 'C':
			@l2=12;
			break;
		case 'D':
			@l2=13;
			break;
		case 'E':
			@l2=14;
			break;
		case 'F':
			@l2=15;
			break;
		default:
			showmsg('非法字符！');
			return(false);
	}
	@l=(@l1 + @l2)*2;
	#CTEMP = itoa(@l);
}"
</USERFUN>
<!--调二代平台-->
<USERFUN NAME="callagnpt">"{
	dim @tota as string;
	dim @bakaddr as string;
	dim @newaddr as string;
	@bakaddr=getenv('AGNADDR');
	@newaddr=getenv('AGNADDR_PT');
	setenv('AGNADDR',@newaddr);
	@tota=callagn();
	setenv('AGNADDR',@bakaddr);
	if(@tota!=''){
		savefiletxt('../tmp/'+$KINBR+$TTYNAME,@tota);
	}		
}"
</USERFUN>

<!--二代支付系统添加 Added by YangMeng 20140704 begin-->

<USERFUN NAME="gethxtraceno">"{
	dim @bak_fd16 as string;
	dim @bak_fd38 as string;
	
	@bak_fd16=$FD16;
	@bak_fd38=$FD38;
	
	$FD16='8995';
	$FD38='';  //没有卡号传空值给核心
	callserver();
	if($FD12 !='0000')
	{
		$FD16=@bak_fd16;
		$FD38=@bak_fd38;
		showmsg(geterror());
		return(false);
	}
	$FD16=@bak_fd16;
	$FD38=@bak_fd38;
}"
</USERFUN>

<USERFUN NAME="call_9044">"{
        dim @fd122 as string;
        dim @fd43  as number;
        $FD16='9044';
        $FD18 = 'CBS';
        callagn_cnaps2();
        $FD16 = $TXNO;
        //showmsg($FD12);
        if ($FD12 == 'Z201')
        {
			if(opendlg('../xml/FEE_CNAPS.DLG'))
			{
				return(true);
			}else{
				return(false);
			}
        }
        else
        {
                showmsg('此业务暂不收取手续费');
        }
        return(true);
}"
</USERFUN>

<USERFUN NAME="authcheckagn">"{
	dim @bak_fd16 as string;
	dim @bak_fd18 as string;
	dim @bak_fd34 as string;
	dim @bak_fd79 as string;
	dim @bak_fd92 as string;
	
	@bak_fd16=$FD16;
	@bak_fd18=$FD18;
	@bak_fd34=$FD34;
	@bak_fd79=$FD79;
	@bak_fd92=$FD92;
	
	$FD16='9996';
	$FD18='CBS';
	$FD34=@bak_fd16;
	//showmsg('授权检查');
	callagn_cnaps2();
	if($FD12 != '0000')
	{
		showmsg(geterror());
		return(false);
	}
	if($FD34 == 'Z003'){
		//showmsg('需要授权,授权号'+$FD73);
		opendlg('../xml/9996.DLG');
		if($FD12 == '@@@@'){
			showmsg('授权已取消');
			return(false);
		}
		//showmsg('开始授权');
		$FD16='9996';
		$FD18='CBS';
		$FD34='1301';
		$FD92=#AUTHNAME_U;
		$FD79=#AUTHPWD_U;
		callagn_cnaps2();
		if($FD12 != '0000')
		{
			showmsg(geterror());
			return(false);
		}
		$FD16=@bak_fd16;
		$FD18=@bak_fd18;
		$FD34=@bak_fd34;
		$FD79=@bak_fd79;
		$FD92=@bak_fd92;
		return(true);
	}else{
		//showmsg('不需要授权');
		$FD16=@bak_fd16;
		$FD18=@bak_fd18;
		$FD34=@bak_fd34;
		$FD79=@bak_fd79;
		$FD92=@bak_fd92;
		return(true);
	}
}"
</USERFUN>

<USERFUN NAME="commrecv_v111">"{
    setitems('#MSGTYPE#RCV_BR_NO#WT_DATE#ORDERNO#NOTE_TYPE#NOTE_NO#PAY_QS_NO#OR_BR_NO#OR_BR_NM#PAY_OPN_BR_NO#PAY_AC_NO#PAY_NAME#CASH_QS_NO#AC_BR_NO#AC_BR_NM#CASH_OPN_BR_NO#CASH_AC_NO#CASH_NAME#YW_KIND#YW_TYPE#OPERLEVEL#HV_STS#RCV_SWNO#HV_BRF',$FD123);
		//showmsg('in functions notpay_content='+#NOTPAY_CONTENT);
	}"
</USERFUN>

<USERFUN NAME="commrecv_v303">"{
    setitems('#CCMSSYSCODE#CCMSMSGNO#REVBRABCODE#CCMSDATE#CCMSORDERNO#SNDCCPCNO#SNDCNAPSNO#SNDCNAPSNM#REVCCPCNO#REVCNAPSNO#REVCNAPSNM#PRIMWTDATE#PRIMORDERNO#PRIMORBRNO#PRIMMSGTYPE#PRIMTXTYPE#PRIMLWIND#CCMSSTAT#CCMSSWNO#CCMSREVTIME#QUECNT#REPCNT#CCMSREMARK',$FD123);
		//showmsg('in functions notpay_content='+#NOTPAY_CONTENT);
	}"
</USERFUN>

<!--二代支付系统添加 Added by YangMeng 20140704 end-->


<USERFUN NAME="PB_data_per">"{
	//前端限制语句300行，尽可能精简。
	 if($IsSelfFilled=='False') return(true);
  dim @st0 as string;
  @st0 = getkeydatavalue('1110','st0');
  dim @st1 as string;
  @st1 = getkeydatavalue('1110','st1');
  //dim @st2 as string;
  //@st2 = getkeydatavalue('1110','st2');
  dim @st3 as string;
  @st3 = getkeydatavalue('1110','st3');       	
  dim @xm as string;
  dim @xb as string;
  dim @zjlx as string;
  dim @zjhm as string;
  dim @lxdh as string;
  dim @sjhm as string;
  dim @lxdz as string;
  dim @khyw as string;
  dim @hqkh as string;
  dim @ickzl as string;
  dim @dqlx as string;
  dim @cq as string;
  dim @zcfs as string;
  dim @sfpm as string;
  dim @dxtzzt as string;
  dim @dxtzsjh as string;
  dim @zfbktzt as string;
  dim @zfbzh as string;
  dim @zfbdbxe as string;
  dim @zfbrljxe as string;
  dim @cftydtzt as string;
  dim @cftydtzh as string;
  dim @cftydtdbxe as string;
  dim @cftydtrljxe as string;
  dim @ylzxzt as string;
  dim @zzsbzzzt as string;
  dim @qttzckzt as string;
  dim @yktzt as string;
  if(@st0 == '0')
  {
    @xm = getkeydatavalue('1110','nm'); 
    @xb = getkeydatavalue('1110','sex');
    if(@xb == '0') @xb='男';
    else if(@xb == '1') @xb='女';
    else @xb='';    
    @zjlx = getkeydatavalue('1110','credty');
    switch(@zjlx)
    {
      case '1':
       @zjlx='身份证';
       break;
      case '2':
       @zjlx='户口薄';
       break;
      case '3':
       @zjlx='护照';
       break;
      case '4':
       @zjlx='军官证';
       break;
      case '5':
       @zjlx='回乡证';
       break;
      case '6':
       @zjlx='士兵证';
       break;
      case '7':
       @zjlx='港澳居民来往通行证';
       break;
      case 'E':
       @zjlx='临时身份证';
       break;
      case 'F':
       @zjlx='外国人居留证';
       break;
      case 'G':
       @zjlx='警官证';
       break;
      case 'H':
       @zjlx='其他证件';
       break;
      case 'I':
       @zjlx='台湾同胞来往通行证';
       break;   
      default:
       @zjlx='';
    }   
    @zjhm = getkeydatavalue('1110','credno');  
    @lxdh = getkeydatavalue('1110','tel');  
    @sjhm = getkeydatavalue('1110','cal');  
    @lxdz = getkeydatavalue('1110','add');  
    @khyw = getkeydatavalue('1110','accty');
    
    if(@khyw=='0')
    {
      @hqkh = getkeydatavalue('1110','curacc');
      //活期存折
      if(@hqkh=='0')
      {
         @hqkh='活期存折';
      }
      //九州方圆IC卡
      else
      {
        @hqkh='九州方圆IC卡';
        @ickzl = getkeydatavalue('1110','jzcard');
        switch(@ickzl)
        {
          case '0':
           @ickzl='普卡';
           break;
          case '1':
           @ickzl='淘宝联名男卡';
           break; 
          case '2':
           @ickzl='淘宝联名女卡';
           break;
          case '3':
           @ickzl='其他';
           break; 
          default:
           @ickzl='';
        } 
      }
    }
    else
    {
      @dqlx = getkeydatavalue('1110','regty');
      switch(@dqlx)
      {
        case '0':
         @dqlx='定活两便';
         break;
        case '1':
         @dqlx='定期整整';
         break; 
        case '2':
         @dqlx='零存整取';
         break;
        case '3':
         @dqlx='教育储蓄';
         break; 
        default:
         @dqlx='';
      } 
      @cq = getkeydatavalue('1110','regdue');
      @zcfs = getkeydatavalue('1110','regzc');
      if(@zcfs == 'Y') @zcfs='是';
      else if(@zcfs == 'N') @zcfs='否';
      else @zcfs='';      
      @sfpm = getkeydatavalue('1110','wrpas');
      if(@sfpm == 'Y') @sfpm='是';
      else if(@sfpm == 'N') @sfpm='否';
      else @sfpm='';       
    }
    dim @khje as string;
    @khje = getkeydatavalue('1110','amt'); 
  }
  if(@st1 == '1')
  {     
     @dxtzzt = getkeydatavalue('1110','sigsms');
     switch(@dxtzzt)
     {
       case '0':
        @dxtzzt='开通';
        break;
       case '1':
        @dxtzzt='变更';
        break;
       case '2':
        @dxtzzt='注销';
        break; 
       default:
        @dxtzzt='';
     }  
     @dxtzsjh = getkeydatavalue('1110','smscal');  
     @zfbktzt = getkeydatavalue('1110','sigpay');
     switch(@zfbktzt)
     {
       case '0':
        @zfbktzt='开通';
        break;
       case '1':
        @zfbktzt='修改限额';
        break;
       case '2':
        @zfbktzt='注销';
        break; 
       default:
        @zfbktzt='';
     }  
     @zfbzh = getkeydatavalue('1110','payno'); 
     @zfbdbxe = getkeydatavalue('1110','paylim');  
     @zfbrljxe = getkeydatavalue('1110','paydlim'); 
     @cftydtzt = getkeydatavalue('1110','sigcft');
     if(@cftydtzt == '0') @cftydtzt='开通';
     else if(@cftydtzt == '1') @cftydtzt='修改限额';
     else if(@cftydtzt == '2') @cftydtzt='注销';
     else @cftydtzt='';      
     @cftydtzh = getkeydatavalue('1110','sigcftno');  
     @cftydtdbxe = getkeydatavalue('1110','cftlim');  
     @cftydtrljxe = getkeydatavalue('1110','cftdlim'); 
     @ylzxzt = getkeydatavalue('1110','sigonl');
     if(@ylzxzt == '0') @ylzxzt='开通';
     else if(@ylzxzt == '1') @ylzxzt='注销';
     else @ylzxzt='';        
     @zzsbzzzt = getkeydatavalue('1110','sigsel');
     if(@zzsbzzzt == '0') @zzsbzzzt='开通';
     else if(@zzsbzzzt == '1') @zzsbzzzt='注销';
     else @zzsbzzzt='';
  }
  if(@st3 == '3')
  {     
     @qttzckzt = getkeydatavalue('1110','sigsev');
     if(@qttzckzt == '0') @qttzckzt='开通';
     else if(@qttzckzt == '1') @qttzckzt='注销';
     else @qttzckzt='';
     @yktzt = getkeydatavalue('1110','sigic');
     if(@yktzt == '0') @yktzt='开通';
     else if(@yktzt == '1') @yktzt='注销';
     else @yktzt='';
  }  
  dim @txtime as string;
  @txtime = substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
  dim @ch as string;
  dim @ch1 as string;
  @ch=showmsg('是否打印填单内容，1-打印;0-不打印 ：');
  if(@ch == '0')return(true);
  else 
  {
     dim @cnt as number;
     @cnt = 2;
     openprinter('printer');
     print( 1,10,'请确认以下信息是否正确：');   
     if(@st0 == '0')
     {
       print( @cnt,10,'姓    名:[30]      姓    别:[30]',@xm,@xb);
       @cnt=@cnt+1;
       print( @cnt,10,'证件类型:[30]      证件号码:[30]',@zjlx,@zjhm);
       @cnt=@cnt+1;
       print( @cnt,10,'联系电话:[30]      手机号码:[30]',@lxdh,@sjhm);
       @cnt=@cnt+1;
       print( @cnt,10,'联系地址:[60]',@lxdz);
       @cnt=@cnt+1;
       if(@khyw=='0')
       {
         print( @cnt,10,'开户业务:活期开户');
         @cnt=@cnt+1;
         if(@hqkh == '九州方圆IC卡')
         {
           print( @cnt,10,'活期类型:[30]      IC卡种类:[30]',@hqkh,@ickzl);
           @cnt=@cnt+1;
         }
         else
         {
           print( @cnt,10,'活期类型:[30]',@hqkh);
           @cnt=@cnt+1;
         }
       }
       else
       {
         print( @cnt,10,'开户业务:定期开户');
          @cnt=@cnt+1;
         print( @cnt,10,'定期类型:[30]      存    期:[30]',@dqlx,@cq);
          @cnt=@cnt+1;     
         print( @cnt,10,'是否转存:[30]      是否凭密:[30]',@zcfs,@sfpm);
          @cnt=@cnt+1;
       } 
     }
     if(@st1 == '1')
     {
        print( @cnt,10,'短信通知状态:[30]           短信通知手机号:[30]',@dxtzzt,@dxtzsjh);
        @cnt=@cnt+1;
        print( @cnt,10,'支付宝卡通状态:[30]         支付宝账号:[30]',@zfbktzt,@zfbzh);
        @cnt=@cnt+1;
        print( @cnt,10,'支付宝单笔限额:[30]         支付宝日累计限额:[30]',@zfbdbxe,@zfbrljxe);
        @cnt=@cnt+1;
        print( @cnt,10,'财付通一点通状态:[30]       财付通一点通账号:[30]',@cftydtzt,@cftydtzh);
        @cnt=@cnt+1;
        print( @cnt,10,'财付通一点通-单笔限额:[30]  财付通一点通-日累计限额:[30]',@cftydtdbxe,@cftydtrljxe);
        @cnt=@cnt+1;
        print( @cnt,10,'银联在线状态:[30]',@ylzxzt);
        @cnt=@cnt+1;
        print( @cnt,10,'自助设备转账状态:[30]',@zzsbzzzt);
        @cnt=@cnt+1;
     }    
     if(@st3 == '3')
     {
        print( @cnt,10,'七天通知存款状态:[30]',@qttzckzt);
        @cnt=@cnt+1;
        print( @cnt,10,'一卡通状态:[30]',@yktzt);
        @cnt=@cnt+1;
     }
     print( 22,85,'请签字确认：_____________');       
     print( 24,10,'柜员:[4]',$FD7);
     print( 24,67,'交易日期:[8] [8]',$HDATE,@txtime);
     closeprinter();
  }
  if(msgbox('打印完成是否提交交易,确认提交,取消不提交','交易提交提示','cancel|ok') == 1)
  {
    return(true);
  }
  else return(false);  
}"
</USERFUN>

<USERFUN NAME="PB_data_del">"{
	 if($IsSelfFilled=='False') return(true);	 
  dim @jyfs as string;
  @jyfs = getkeydatavalue('1020','tranty');
  switch(@jyfs)
  {
    case '0':
     @jyfs='现金';
     break;
    case '1':
     @jyfs='转账';
     break; 
    default:
     showmsg('非法字符！');
     return(false);
  } 
  dim @st0 as string;
  dim @st1 as string;
  dim @st2 as string;
  dim @st3 as string;
  dim @st4 as string;
  dim @st5 as string;
  @st0 = getkeydatavalue('1020','st0');
  @st1 = getkeydatavalue('1020','st1');
  @st2 = getkeydatavalue('1020','st2');
  @st3 = getkeydatavalue('1020','st3');
  @st4 = getkeydatavalue('1020','st4');
  @st5 = getkeydatavalue('1020','st5');
  dim @ywzl as string;
  if(@st0 == '0') @ywzl='行内';
  else if(@st1 == '1') @ywzl='同城';
  else if(@st2 == '2') @ywzl='大额';
  else if(@st3 == '3') @ywzl='小额';
  else if(@st4 == '4') @ywzl='本票';
  else if(@st5 == '5') @ywzl='汇票';
  else @ywzl=''; 
  dim @fkrzh as string;
  @fkrzh = getkeydatavalue('1020','payno');
  dim @fkrmc as string;
  @fkrmc = getkeydatavalue('1020','paynm');
  dim @fkhmc as string;
  @fkhmc = getkeydatavalue('1020','paybk');
  dim @skrzh as string;
  @skrzh = getkeydatavalue('1020','recno');
  dim @skrmc as string;
  @skrmc = getkeydatavalue('1020','recnm');
  dim @skhmc as string;
  @skhmc = getkeydatavalue('1020','recbk');
  dim @jyje as string;
  @jyje = getkeydatavalue('1020','amt');
  dim @khxm as string;
  @khxm = getkeydatavalue('1020','nm');  
  dim @zjlx as string;
  @zjlx = getkeydatavalue('1020','credty');
  switch(@zjlx)
  {
    case '1':
     @zjlx='身份证';
     break;
    case '2':
     @zjlx='户口薄';
     break;
    case '3':
     @zjlx='护照';
     break;
    case '4':
     @zjlx='军官证';
     break;
    case '5':
     @zjlx='回乡证';
     break;
    case '6':
     @zjlx='士兵证';
     break;
    case '7':
     @zjlx='港澳居民来往通行证';
     break;
    case 'E':
     @zjlx='临时身份证';
     break;
    case 'F':
     @zjlx='外国人居留证';
     break;
    case 'G':
     @zjlx='警官证';
     break;
    case 'H':
     @zjlx='其他证件';
     break;
    case 'I':
     @zjlx='台湾同胞来往通行证';
     break;   
    default:
     @zjlx='';
  } 
  dim @zjhm as string;
  @zjhm = getkeydatavalue('1020','id');
  dim @dlrxm as string;
  @dlrxm = getkeydatavalue('1020','attnm');  
  dim @dlrzjlx as string;
  @dlrzjlx = getkeydatavalue('1020','attcty');
  switch(@dlrzjlx)
  {
    case '1':
     @dlrzjlx='身份证';
     break;
    case '2':
     @dlrzjlx='户口薄';
     break;
    case '3':
     @dlrzjlx='护照';
     break;
    case '4':
     @dlrzjlx='军官证';
     break;
    case '5':
     @dlrzjlx='回乡证';
     break;
    case '6':
     @dlrzjlx='士兵证';
     break;
    case '7':
     @dlrzjlx='港澳居民来往通行证';
     break;
    case 'E':
     @dlrzjlx='临时身份证';
     break;
    case 'F':
     @dlrzjlx='外国人居留证';
     break;
    case 'G':
     @dlrzjlx='警官证';
     break;
    case 'H':
     @dlrzjlx='其他证件';
     break;
    case 'I':
     @dlrzjlx='台湾同胞来往通行证';
     break;   
    default:
     @dlrzjlx='';
  } 
  dim @dlrzjhm as string;
  @dlrzjhm = getkeydatavalue('1020','attcno');
  dim @txtime as string;
  @txtime = substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
  dim @ch as string;
  dim @ch1 as string;
  @ch=showmsg('是否打印填单内容，1-打印;0-不打印 ：');
  if(@ch == '0')return(true);
  else 
  {
     openprinter('printer');
     print( 4,10,'请确认以下信息时候正确：');       
     print( 6,20,'业务种类:[30]',@ywzl);
     print( 7,20,'交易方式:[30]',@jyfs); 
     print( 8,10,'付款人账号:[30]',@fkrzh);            
     print( 9,10,'付款人名称:[30]',@fkrmc);     
     print( 10,10,'付款行名称:[30]',@fkhmc);
     print( 11,10,'收款人账号:[30]',@skrzh);            
     print( 12,10,'收款人名称:[30]',@skrmc);     
     print( 13,10,'收款行名称:[30]',@skhmc);
     print( 14,10,'交易金额:[30]',@jyje);    
     print( 15,10,'客户姓名:[30]',@khxm); 
     print( 16,10,'证件类型:[30]',@zjlx); 
     print( 17,10,'证件号码:[30]',@zjhm); 
     if(@dlrxm != '')
     {
       print( 18,10,'代理人姓名:[30]',@dlrxm); 
       print( 19,10,'证件类型:[30]',@dlrzjlx); 
       print( 20,10,'证件号码:[30]',@dlrzjhm); 
     }
     print( 22,85,'请签字确认：_____________');       
     print( 24,10,'柜员:[4]',$FD7);
     print( 24,67,'交易日期:[8] [8]',$HDATE,@txtime);
     closeprinter();
  }
  if(msgbox('打印完成是否提交交易,确认提交,取消不提交','交易提交提示','cancel|ok') == 1)
  {
    return(true);
  }
  else return(false);  
}"
</USERFUN>

<USERFUN NAME="PB_data_revoked">"{
		 if($IsSelfFilled=='False') return(true);	 
		  dim @zhmc as string;
		  dim @khyhmc as string;
		  dim @khyhdm as string;
		  dim @zh as string;
		  dim @zhxz as string;
		  dim @khxkzhzh as string;
		  dim @xhyy as string;
		  
		  @zhmc = getkeydatavalue('1080','accnm');
		  @khyhmc = getkeydatavalue('1080','accbknm');
		  @khyhdm = getkeydatavalue('1080','accbk');
		  @zh = getkeydatavalue('1080','accno');
		  @zhxz = getkeydatavalue('1080','accty');
		 @khxkzhzh = getkeydatavalue('1080','appno');
		 @xhyy = getkeydatavalue('1080','reason');
	  dim @ch as string;
	  dim @ch1 as string;
	  @ch=showmsg('是否打印填单内容，1-打印;0-不打印 ：');
	  if(@ch == '0')return(true);
	  else 
	  {
	     openprinter('printer');    
	    print( 9,37,'[30]',@zhmc);
	    print( 14,37,'[30]',@khyhmc); 
	    print( 18,37,'[20]',@khyhdm);                 
	    print( 18,18,'[30]',@zh);
	     if(@zhxz=='0')
	     { 
	     		print(21,50,'[10]','√');
	     }
	     else  if(@zhxz=='1')
	     {
	   		  print(21,70,'[10]','√');   
	     }
	     else  if(@zhxz=='2')
	     {
	   		  print(21,90,'[10]','√');   
	     }
	     else  if(@zhxz=='3')
	     {
	   		  print(23,50,'[10]','√');   
	     }
	     else  if(@zhxz=='4')
	     {
	   		  print(23,70,'[10]','√');   
	     }
	     print( 26,37,'[100]',@khxkzhzh);     
	     print( 30,37,'[100]',@xhyy);
	     closeprinter();
	  }
	  if(msgbox('打印完成是否提交交易,确认提交,取消不提交','交易提交提示','cancel|ok') == 1)
	  {
	    return(true);
	  }
	  else return(false);  
	}"
</USERFUN>

<USERFUN NAME="PB_data_Cashpayment">"{
		 if($IsSelfFilled=='False') return(true);	 
		  dim @skrqc as string;
		  dim @zh as string;
		  dim @khyh as string;
		  dim @kxly as string;
		  dim @xxrmb as string;
		  dim @dxrmb as string;
		  dim @year as string;
		  dim @month as string;
		  dim @day as string;
		  
		  @skrqc = getkeydatavalue('1090','payee');
		  @zh = getkeydatavalue('1090','accno');
		  @khyh = getkeydatavalue('1090','accbk');
		  @kxly = getkeydatavalue('1090','source');
		  @xxrmb = getkeydatavalue('1090','amt');
		   if(len(@xxrmb)!=9)
		  {@xxrmb = space(9-len(@xxrmb),' ')+@xxrmb;}
		  dim @i as number;
	    @i=0;
	    dim @temp as string;
	    dim @valStr as string;
	    @valStr = '';
	    while(1)
	    	{
	    		if(@i>=9)break;
	    		 @temp = substr(@xxrmb,@i,1); 
	    		 if(@i==2 or @i==5 )
	    		 {
	    		 	@temp = @temp+' ,';
	    		 }else
	    		 {
	    		  	@temp = @temp+' ';
	    		 }
	    		 @valStr = @valStr+@temp;
	    		 @i = @i+1;
	    	}
	    	@xxrmb = @valStr;
		  @dxrmb = getkeydatavalue('1090','zwamt');
		  @year = substr($HDATE,0,4);
		  @month = substr($HDATE,4,2);
		  @day = substr($HDATE,6,2);
	  dim @ch as string;
	  dim @ch1 as string;
	  @ch=showmsg('是否打印填单内容，1-打印;0-不打印 ：');
	  if(@ch == '0')return(true);
	  else 
	  {
	      openprinter('printer');
		   print( 3,40,'[4]',@year);   
	     print( 3,5,'[2]',@month); 
	     print( 3,5,'[2]',@day);
	     print( 4,25,'[30]',@skrqc);   
	     print( 4,8,'[30]',@zh); 
	     print( 6,25,'[30]',@khyh);            
	     print( 6,8,'[30]',@kxly);     
	     print( 8,20,'[30]',@dxrmb);    
	     print( 8,25,'[30]',@xxrmb);
	     closeprinter();
	  }
	  if(msgbox('打印完成是否提交交易,确认提交,取消不提交','交易提交提示','cancel|ok') == 1)
	  {
	    return(true);
	  }
	  else return(false);  
	}"
</USERFUN>

<USERFUN NAME="PB_data_ChangeAcc">"{
		 if($IsSelfFilled=='False') return(true);	 
		  dim @zhmc as string;
		  dim @khyhdm as string;
		  dim @khxkzhzh as string;
		  dim @bgsx as string;
		  dim @zhmc2 as string;
		  dim @dz as string;
		  dim @yzbm as string;
		  dim @dh as string;
		  dim @zczjje as string;
		  dim @zmwjzl as string;
		  dim @zmwjbh as string;
		  dim @jyfw as string;
		  dim @fddbrxm as string;
		  dim @frzjzl as string;
		  dim @frzjhm as string;
		  
		  @zhmc = getkeydatavalue('1060','acc');
		  @khyhdm = getkeydatavalue('1060','accbk');
		  @khxkzhzh = getkeydatavalue('1060','appno');
		  @bgsx = getkeydatavalue('1060','chath');
		  	switch(@bgsx)
		  {
		    case '0':
		     @bgsx='账户名称';
		     break;
		    case '1':
		     @bgsx='地址';
		     break;
		    case '2':
		     @bgsx='邮政编码';
		     break;
		    case '3':
		     @bgsx='电话';
		     break;
		    case '4':
		     @bgsx='注册资金';
		     break;
		    case '5':
		     @bgsx='经营范围';
		     break;
		     case '6':
		     @bgsx='法定代表人或单位负责人';
		     break;
		    default:
		     @bgsx='';
		  } 
		  @zhmc2 = getkeydatavalue('1060','accnm');
		  @dz = getkeydatavalue('1060','add');
		  @yzbm = getkeydatavalue('1060','pc');
		  @dh = getkeydatavalue('1060','cal');
		  @zczjje = getkeydatavalue('1060','regamt');
		  @zmwjzl = getkeydatavalue('1060','nounty');
				switch(@zmwjzl)
		  {
		    case '8':
		     @zmwjzl='企业代码证';
		     break;
		    case '9':
		     @zmwjzl='经营许可证';
		     break;
		    case 'A':
		     @zmwjzl='营业执照';
		     break;
		    case 'B':
		     @zmwjzl='事业法人证书';
		     break;
		    case 'C':
		     @zmwjzl='工商核准号';
		     break;
		    case 'D':
		     @zmwjzl='其他证件';
		     break;
		    default:
		     @zmwjzl='';
		  } 
		  @zmwjbh = getkeydatavalue('1060','nounno');
		  @jyfw = getkeydatavalue('1060','eo');
		  @fddbrxm = getkeydatavalue('1060','aregnm');
		  @frzjzl = getkeydatavalue('1060','aregty');
			switch(@frzjzl)
		  {
		    case '1':
		     @frzjzl='身份证';
		     break;
		    case '2':
		     @frzjzl='户口薄';
		     break;
		    case '3':
		     @frzjzl='护照';
		     break;
		    case '4':
		     @frzjzl='军官证';
		     break;
		    case '5':
		     @frzjzl='回乡证';
		     break;
		    case '6':
		     @frzjzl='士兵证';
		     break;
		    case '7':
		     @frzjzl='港澳居民来往通行证';
		     break;
		    case 'E':
		     @frzjzl='临时身份证';
		     break;
		    case 'F':
		     @frzjzl='外国人居留证';
		     break;
		    case 'G':
		     @frzjzl='警官证';
		     break;
		    case 'H':
		     @frzjzl='其他证件';
		     break;
		    case 'I':
		     @frzjzl='台湾同胞来往通行证';
		     break;   
		    default:
		     @frzjzl='';
		  } 
		  @frzjhm = getkeydatavalue('1060','aregno');
	  dim @ch as string;
	  dim @ch1 as string;
	  @ch=showmsg('是否打印填单内容，1-打印;0-不打印 ：');
	  if(@ch == '0')return(true);
	  else 
	  {
	      openprinter('printer');
		 	 print( 7,37,'[30]',@zhmc);   
	     print( 9,37,'[30]',@khyhdm); 
	     print( 11,37,'[30]',@khxkzhzh);
	     print( 13,37,'[30]',@bgsx);
	     print( 14,37,'[30]',@zhmc2);   
	     print( 16,37,'[30]',@dz); 
	     print( 18,37,'[30]',@yzbm);     
	   	 print( 19,37,'[30]',@dh); 
	     print( 21,37,'[30]',@zczjje); 
	     print( 23,37,'[30]',@zmwjzl); 
	     print( 24,37,'[30]',@zmwjbh);     
	   	 print( 26,37,'[30]',@jyfw); 
	     print( 28,42,'[30]',@fddbrxm); 
	     print( 29,42,'[30]',@frzjzl); 
	     print( 31,42,'[30]',@frzjhm);
	   
	     closeprinter();
	  }
	  if(msgbox('打印完成是否提交交易,确认提交,取消不提交','交易提交提示','cancel|ok') == 1)
	  {
	    return(true);
	  }
	  else return(false);  
	}"
</USERFUN>


<USERFUN NAME="PB_data_cor_open">"{
	if($IsSelfFilled=='False') return(true);	  
  dim @ckrmc as string;
  @ckrmc = getkeydatavalue('1000','curnm');
  dim @dh as string;
  @dh = getkeydatavalue('1000','curcal');
  dim @dz as string;
  @dz = getkeydatavalue('1000','curadd');
  dim @yb as string;
  @yb = getkeydatavalue('1000','curpc');
  dim @ckrlb as string;
  @ckrlb = getkeydatavalue('1000','curty');
  if(@ckrlb=='0') @ckrlb='企业法人';
  else if(@ckrlb=='1') @ckrlb='非法人企业';
  else if(@ckrlb=='2') @ckrlb='机关';
  else if(@ckrlb=='3') @ckrlb='实行预算管理的事业单位';
  else if(@ckrlb=='4') @ckrlb='非预算管理的事业单位';
  else if(@ckrlb=='5') @ckrlb='团级（含）以上军队以及分散执勤的支（分）队';
  else if(@ckrlb=='6') @ckrlb='团级（含）以上武警以及分散执勤的支（分）队';
  else if(@ckrlb=='7') @ckrlb='社会团体';
  else if(@ckrlb=='8') @ckrlb='宗教组织';
  else if(@ckrlb=='9') @ckrlb='民办非企业组织';
  else if(@ckrlb=='a') @ckrlb='异地常设机构';
  else if(@ckrlb=='b') @ckrlb='外国驻华机构';
  else if(@ckrlb=='c') @ckrlb='有字号的个体工商户';
  else if(@ckrlb=='d') @ckrlb='无字号的个体工商户';
  else if(@ckrlb=='e') @ckrlb='居民（村民、社区）委员会';
  else if(@ckrlb=='f') @ckrlb='单位设立的独立核算的附属机构';
  else if(@ckrlb=='g') @ckrlb='其他组织';
  else { @ckrlb='';}
  dim @zzjgdm as string;
  @zzjgdm = getkeydatavalue('1000','org');
  dim @frdb_dwfzr as string;
  @frdb_dwfzr = getkeydatavalue('1000','repty'); 
  dim @xm as string;
  @xm = getkeydatavalue('1000','repnm');
  dim @zjzl as string;
  @zjzl = getkeydatavalue('1000','repcty');
//  if(@zjzl=='1') @zjzl='身份证';
//  else if(@zjzl=='2') @zjzl='户口薄';
//  else if(@zjzl=='3') @zjzl='护照';
//  else if(@zjzl=='4') @zjzl='军官证';
//  else if(@zjzl=='5') @zjzl='回乡证';
//  else if(@zjzl=='6') @zjzl='士兵证';
//  else if(@zjzl=='7') @zjzl='港澳居民来往通行证';
//  else if(@zjzl=='E') @zjzl='临时身份证';
//  else if(@zjzl=='F') @zjzl='外国人居留证';
//  else if(@zjzl=='G') @zjzl='警官证';
//  else if(@zjzl=='H') @zjzl='其他证件';
//  else if(@zjzl=='I') @zjzl='台湾同胞来往通行证';
//  else { @zjzl='';}
  dim @zjhm as string;
  @zjhm = getkeydatavalue('1000','repcno');
  dim @hyfl as string;
  @hyfl = getkeydatavalue('1000','busi'); 
  dim @zczj as string;
  @zczj = getkeydatavalue('1000','regamt');
  dim @dqdm as string;
  @dqdm = getkeydatavalue('1000','area');
  dim @jyfw as string;
  @jyfw = getkeydatavalue('1000','eo');
  dim @zmwjzl1 as string;
  @zmwjzl1 = getkeydatavalue('1000','nounty1');
	// if(@zmwjzl1 == '8') @zmwjzl1 = '企业代码证';
	// else if(@zmwjzl1 == '9') @zmwjzl1 = '经营许可证';
	// else if(@zmwjzl1 == 'A') @zmwjzl1 = '营业执照';
	// else if(@zmwjzl1 == 'B') @zmwjzl1 = '事业法人证书';
	// else if(@zmwjzl1 == 'C') @zmwjzl1 = '工商核准号';
	// else if(@zmwjzl1 == 'D') @zmwjzl1 = '其他证件';
	// else {@zmwjzl1 = '';}
  dim @zmwjbh1 as string;
  @zmwjbh1 = getkeydatavalue('1000','nounno1');
  dim @zmwjzl2 as string;
  @zmwjzl2 = getkeydatavalue('1000','nounty2');
  dim @j as number;
  @j=1;
  while(@j<3)
  {
	  @zmwjzl2 = @zmwjzl1;
		if(@j==2)	@zmwjzl2 = @zmwjzl2;
	  if(@zmwjzl2 == '8') @zmwjzl2 = '企业代码证';
	  else if(@zmwjzl2 == '9') @zmwjzl2 = '经营许可证';
	  else if(@zmwjzl2 == 'A') @zmwjzl2 = '营业执照';
	  else if(@zmwjzl2 == 'B') @zmwjzl2 = '事业法人证书';
	  else if(@zmwjzl2 == 'C') @zmwjzl2 = '工商核准号';
	  else if(@zmwjzl2 == 'D') @zmwjzl2 = '其他证件';
	  if(@j==1) @zmwjzl1 = @zmwjzl2;
		else{ @zmwjzl2 = @zmwjzl2;}
	 	@j = @j+1;
  }
  dim @zmwjbh2 as string;
  @zmwjbh2 = getkeydatavalue('1000','nounno2');
  dim @swdjzbh as string;
  @swdjzbh = getkeydatavalue('1000','taxno');
  dim @zhxz as string;
  @zhxz = getkeydatavalue('1000','accnat');  
  dim @zjxz as string;
  @zjxz = getkeydatavalue('1000','antnat');
  dim @yxrqz as string;
  @yxrqz = getkeydatavalue('1000','limday');
  dim @sjfr as string;
  @sjfr = getkeydatavalue('1000','dirrep');
  dim @khxkzh as string;
  @khxkzh = getkeydatavalue('1000','licence');
  dim @zzjgdm2 as string;
  @zzjgdm2 = getkeydatavalue('1000','org1');
  dim @fddbr as string;
  @fddbr = getkeydatavalue('1000','aregty');  
  dim @xm2 as string;
  @xm2 = getkeydatavalue('1000','aregnm');
  dim @zjzl2 as string;
  @zjzl2 = getkeydatavalue('1000','aregcty');
  @j=1;
   while(@j<3)
  {
		@zjzl2 = @zjzl;
		if(@j==2)	@zjzl2 = @zjzl2;
	  if(@zjzl2=='1') @zjzl2='身份证';
	  else if(@zjzl2=='2') @zjzl2='户口薄';
	  else if(@zjzl2=='3') @zjzl2='护照';
	  else if(@zjzl2=='4') @zjzl2='军官证';
	  else if(@zjzl2=='5') @zjzl2='回乡证';
	  else if(@zjzl2=='6') @zjzl2='士兵证';
	  else if(@zjzl2=='7') @zjzl2='港澳居民来往通行证';
	  else if(@zjzl2=='E') @zjzl2='临时身份证';
	  else if(@zjzl2=='F') @zjzl2='外国人居留证';
	  else if(@zjzl2=='G') @zjzl2='警官证';
	  else if(@zjzl2=='H') @zjzl2='其他证件';
	  else if(@zjzl2=='I') @zjzl2='台湾同胞来往通行证';
		if(@j==1) @zjzl = @zjzl2;
		else {@zjzl2 = @zjzl2;}
		@j = @j+1;
		
  }
  dim @zjhm2 as string;
  @zjhm2 = getkeydatavalue('1000','aregcno');
  dim @txtime as string;
  @txtime = substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
  dim @ch as string;
  dim @ch1 as string;
	  @ch=showmsg('是否打印填单内容，1-打印;0-不打印 ：');
	  if(@ch == '0')return(true);
	  else 
	  {
	     openprinter('printer');         
		print( 8,30,'[30]',@ckrmc);
		print( 8,20,'[30]',@dh);
		print( 9,30,'[30]',@dz);
		print( 9,20,'[30]',@yb);
		print( 10,30,'[30]',@ckrlb);
		print( 10,10,'[30]',@zzjgdm);
		if(@frdb_dwfzr=='0')	
		{
		  print(11,22,'[2]','√');
		  print(11,25,'[30]',@xm);
		  print(12,50,'[30]',@zjzl);
		  print(12,2,'[30]',@zjhm);	
		}
		else if(@frdb_dwfzr=='1')
		{ 
		  print(11,50,'[30]',@xm);
		  print(12,22,'[2]','√');
		  print(12,27,'[30]',@zjzl);
		  print(12,2,'[30]',@zjhm);	
		}  
	   
		
		if(@hyfl=='0')	    print(13,40,'[2]','√');
		else if(@hyfl=='1') print(13,46,'[2]','√');
		else if(@hyfl=='2') print(13,52,'[2]','√');
		else if(@hyfl=='3') print(13,57,'[2]','√');
		else if(@hyfl=='4') print(13,63,'[2]','√');
		else if(@hyfl=='5') print(13,67,'[2]','√');
		else if(@hyfl=='6') print(13,72,'[2]','√');
		else if(@hyfl=='7') print(13,78,'[2]','√');
		else if(@hyfl=='8') print(13,83,'[2]','√');
		else if(@hyfl=='9') print(13,89,'[2]','√');
		else if(@hyfl=='a') print(14,40,'[2]','√');
		else if(@hyfl=='b') print(14,46,'[2]','√');
		else if(@hyfl=='c') print(14,52,'[2]','√');
		else if(@hyfl=='d') print(14,57,'[2]','√');
		else if(@hyfl=='e') print(14,63,'[2]','√');
		else if(@hyfl=='f') print(14,67,'[2]','√');
		else if(@hyfl=='g') print(14,72,'[2]','√');
		else if(@hyfl=='h') print(14,78,'[2]','√');
		else if(@hyfl=='i') print(14,83,'[2]','√');
		else if(@hyfl=='j') print(14,89,'[2]','√');
	   print( 15,30,'[30]',@zczj);
		 print( 15,10,'[30]',@dqdm);
		 print( 17,30,'[30]',@jyfw);
		 print( 18,30,'[30]',@zmwjzl1);
		 print( 18,10,'[30]',@zmwjbh1);
		 print( 19,30,'[30]',@zmwjzl2);
		 print( 19,10,'[30]',@zmwjbh2);  	 
		 print( 20,30,'[30]',@swdjzbh);
	 if(@zhxz=='0')	print(23,35,'[2]','√');
	 else if(@zhxz=='1') print(23,45,'[2]','√');
	 else if(@zhxz=='2') print(23,58,'[2]','√');
	 else if(@zhxz=='3') print(23,70,'[2]','√');
		 print( 24,30,'[30]',@zjxz);
		 print( 24,13,'[4]',substr(@yxrqz,0,4));
		 print( 24,3,'[4]',substr(@yxrqz,4,2));
		 print( 24,3,'[4]',substr(@yxrqz,6,2));
		 print( 26,50,'[30]',@sjfr);
		 print( 28,50,'[15]',@khxkzh);
		 print( 28,18,'[20]',@zzjgdm2);
	 if(@fddbr=='0')
	 {	
	 	print(29,23,'[2]','√');
	 	print( 29,25,'[30]',@xm2);
	 	print( 30,50,'[30]',@zjzl2);
	 }
	 else if(@fddbr=='1') 
	 {
	 	print( 29,50,'[30]',@xm2);
	  print(30,23,'[2]','√');
	  print( 30,27,'[30]',@zjzl2);
	 
	 }
		 print( 31,50,'[30]',@zjhm2);	   
     closeprinter();
  }
  if(msgbox('打印完成是否提交交易,确认提交,取消不提交','交易提交提示','cancel|ok') == 1) return(true);
  else return(false);  
}"
</USERFUN>


<USERFUN NAME="PB_data_cor_open1">"{
	if($IsSelfFilled=='False') return(true);	  
  dim @ckrmc as string;
  @ckrmc = getkeydatavalue('1000','curnm');
  dim @dh as string;
  @dh = getkeydatavalue('1000','curcal');
  dim @dz as string;
  @dz = getkeydatavalue('1000','curadd');
  dim @yb as string;
  @yb = getkeydatavalue('1000','curpc');
  dim @ckrlb as string;
  @ckrlb = getkeydatavalue('1000','curty');
	  if(@ckrlb=='0') @ckrlb='企业法人';
	  else if(@ckrlb=='1') @ckrlb='非法人企业';
	  else if(@ckrlb=='2') @ckrlb='机关';
	  else if(@ckrlb=='3') @ckrlb='实行预算管理的事业单位';
	  else if(@ckrlb=='4') @ckrlb='非预算管理的事业单位';
	  else if(@ckrlb=='5') @ckrlb='团级（含）以上军队以及分散执勤的支（分）队';
	  else if(@ckrlb=='6') @ckrlb='团级（含）以上武警以及分散执勤的支（分）队';
	  else if(@ckrlb=='7') @ckrlb='社会团体';
	  else if(@ckrlb=='8') @ckrlb='宗教组织';
	  else if(@ckrlb=='9') @ckrlb='民办非企业组织';
	  else if(@ckrlb=='a') @ckrlb='异地常设机构';
	  else if(@ckrlb=='b') @ckrlb='外国驻华机构';
	  else if(@ckrlb=='c') @ckrlb='有字号的个体工商户';
	  else if(@ckrlb=='d') @ckrlb='无字号的个体工商户';
	  else if(@ckrlb=='e') @ckrlb='居民（村民、社区）委员会';
	  else if(@ckrlb=='f') @ckrlb='单位设立的独立核算的附属机构';
	  else if(@ckrlb=='g') @ckrlb='其他组织';
	  else { @ckrlb='企业法人';}
  dim @zzjgdm as string;
  @zzjgdm = getkeydatavalue('1000','org');
  dim @frdb_dwfzr as string;
  @frdb_dwfzr = getkeydatavalue('1000','repty'); 
  dim @xm as string;
  @xm = getkeydatavalue('1000','repnm');
  dim @zjzl as string;
  @zjzl = getkeydatavalue('1000','repcty');
	 if(@zjzl=='1') @zjzl='身份证';
	 else if(@zjzl=='2') @zjzl='户口薄';
	 else if(@zjzl=='3') @zjzl='护照';
	 else if(@zjzl=='4') @zjzl='军官证';
	 else if(@zjzl=='5') @zjzl='回乡证';
	 else if(@zjzl=='6') @zjzl='士兵证';
	 else if(@zjzl=='7') @zjzl='港澳居民来往通行证';
	 else if(@zjzl=='E') @zjzl='临时身份证';
	 else if(@zjzl=='F') @zjzl='外国人居留证';
	 else if(@zjzl=='G') @zjzl='警官证';
	 else if(@zjzl=='H') @zjzl='其他证件';
	 else if(@zjzl=='I') @zjzl='台湾同胞来往通行证';
	 else { @zjzl='';}
  dim @zjhm as string;
  @zjhm = getkeydatavalue('1000','repcno');
  dim @hyfl as string;
  @hyfl = getkeydatavalue('1000','busi'); 
  dim @zczj as string;
  @zczj = getkeydatavalue('1000','regamt');
  dim @dqdm as string;
  @dqdm = getkeydatavalue('1000','area');
  dim @jyfw as string;
  @jyfw = getkeydatavalue('1000','eo');
  dim @zmwjzl1 as string;
  @zmwjzl1 = getkeydatavalue('1000','nounty1');
  if(@zmwjzl1 == '8') @zmwjzl1 = '企业代码证';
  else if(@zmwjzl1 == '9') @zmwjzl1 = '经营许可证';
  else if(@zmwjzl1 == 'A') @zmwjzl1 = '营业执照';
  else if(@zmwjzl1 == 'B') @zmwjzl1 = '事业法人证书';
  else if(@zmwjzl1 == 'C') @zmwjzl1 = '工商核准号';
  else if(@zmwjzl1 == 'D') @zmwjzl1 = '其他证件';
  else {@zmwjzl1 = '';}
  dim @zmwjbh1 as string;
  @zmwjbh1 = getkeydatavalue('1000','nounno1');
  dim @zmwjzl2 as string;
  @zmwjzl2 = getkeydatavalue('1000','nounty2');
  if(@zmwjzl2 == '8') @zmwjzl2 = '企业代码证';
  else if(@zmwjzl2 == '9') @zmwjzl2 = '经营许可证';
  else if(@zmwjzl2 == 'A') @zmwjzl2 = '营业执照';
  else if(@zmwjzl2 == 'B') @zmwjzl2 = '事业法人证书';
  else if(@zmwjzl2 == 'C') @zmwjzl2 = '工商核准号';
  else if(@zmwjzl2 == 'D') @zmwjzl2 = '其他证件';
  else { @zmwjzl2 = '';}
  dim @zmwjbh2 as string;
  @zmwjbh2 = getkeydatavalue('1000','nounno2');
  dim @txtime as string;
  @txtime = substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
  dim @ch as string;
  dim @ch1 as string;
	  @ch=showmsg('是否打印填单内容，1-打印;0-不打印 ：');
	  if(@ch == '0')return(true);
	  else 
	  {
	    openprinter('printer');         
			print( 8,30,'[30]',@ckrmc);
			print( 8,20,'[30]',@dh);
			print( 9,30,'[30]',@dz);
			print( 9,20,'[30]',@yb);
			print( 10,30,'[30]',@ckrlb);
			print( 10,10,'[30]',@zzjgdm);
			if(@frdb_dwfzr=='0')	
			{
			  print(11,22,'[2]','√');
			  print(11,25,'[30]',@xm);
			  print(12,50,'[30]',@zjzl);
			  print(12,2,'[30]',@zjhm);	
			}
			else if(@frdb_dwfzr=='1')
			{ 
			  print(11,50,'[30]',@xm);
			  print(12,22,'[2]','√');
			  print(12,27,'[30]',@zjzl);
			  print(12,2,'[30]',@zjhm);	
			} 
			if(@hyfl=='0')	    print(13,40,'[2]','√');
			else if(@hyfl=='1') print(13,46,'[2]','√');
			else if(@hyfl=='2') print(13,52,'[2]','√');
			else if(@hyfl=='3') print(13,57,'[2]','√');
			else if(@hyfl=='4') print(13,63,'[2]','√');
			else if(@hyfl=='5') print(13,67,'[2]','√');
			else if(@hyfl=='6') print(13,72,'[2]','√');
			else if(@hyfl=='7') print(13,78,'[2]','√');
			else if(@hyfl=='8') print(13,83,'[2]','√');
			else if(@hyfl=='9') print(13,89,'[2]','√');
			else if(@hyfl=='a') print(14,40,'[2]','√');
			else if(@hyfl=='b') print(14,46,'[2]','√');
			else if(@hyfl=='c') print(14,52,'[2]','√');
			else if(@hyfl=='d') print(14,57,'[2]','√');
			else if(@hyfl=='e') print(14,63,'[2]','√');
			else if(@hyfl=='f') print(14,67,'[2]','√');
			else if(@hyfl=='g') print(14,72,'[2]','√');
			else if(@hyfl=='h') print(14,78,'[2]','√');
			else if(@hyfl=='i') print(14,83,'[2]','√');
			else if(@hyfl=='j') print(14,89,'[2]','√');
		   print( 15,30,'[30]',@zczj);
			 print( 15,10,'[30]',@dqdm);
			 print( 17,30,'[30]',@jyfw);
			 print( 18,30,'[30]',@zmwjzl1);
			 print( 18,10,'[30]',@zmwjbh1);
			 print( 19,30,'[30]',@zmwjzl2);
			 print( 19,10,'[30]',@zmwjbh2);  	  
    
  }
}"
</USERFUN>

<USERFUN NAME="PB_data_cor_open2">"{
	if($IsSelfFilled=='False') return(true);	 
  dim @swdjzbh as string;
  showmsg(@swdjzbh);
  @swdjzbh = getkeydatavalue('1000','taxno');
  showmsg(@swdjzbh);
  dim @zhxz as string;
  @zhxz = getkeydatavalue('1000','accnat');  
  dim @zjxz as string;
  @zjxz = getkeydatavalue('1000','antnat');
  dim @yxrqz as string;
  @yxrqz = getkeydatavalue('1000','limday');
  dim @sjfr as string;
  @sjfr = getkeydatavalue('1000','dirrep');
  dim @khxkzh as string;
  @khxkzh = getkeydatavalue('1000','licence');
  dim @zzjgdm2 as string;
  @zzjgdm2 = getkeydatavalue('1000','org1');
  dim @fddbr as string;
  @fddbr = getkeydatavalue('1000','aregty');  
  dim @xm2 as string;
  @xm2 = getkeydatavalue('1000','aregnm');
  dim @zjzl2 as string;
  @zjzl2 = getkeydatavalue('1000','aregcty');
  if(@zjzl2=='1') @zjzl2='身份证';
  else if(@zjzl2=='2') @zjzl2='户口薄';
  else if(@zjzl2=='3') @zjzl2='护照';
  else if(@zjzl2=='4') @zjzl2='军官证';
  else if(@zjzl2=='5') @zjzl2='回乡证';
  else if(@zjzl2=='6') @zjzl2='士兵证';
  else if(@zjzl2=='7') @zjzl2='港澳居民来往通行证';
  else if(@zjzl2=='E') @zjzl2='临时身份证';
  else if(@zjzl2=='F') @zjzl2='外国人居留证';
  else if(@zjzl2=='G') @zjzl2='警官证';
  else if(@zjzl2=='H') @zjzl2='其他证件';
  else if(@zjzl2=='I') @zjzl2='台湾同胞来往通行证';
  else { @zjzl2='';}
  dim @zjhm2 as string;
  @zjhm2 = getkeydatavalue('1000','aregcno');
  dim @txtime as string;
  @txtime = substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
  dim @ch as string;
  dim @ch1 as string;
	  @ch=showmsg('是否打印填单内容，1-打印;0-不打印 ：');
	  if(@ch == '0')return(true);
	  else 
	  {
	    openprinter('printer');   
		 print( 20,30,'[30]',@swdjzbh);
		 if(@zhxz=='0')	print(23,35,'[2]','√');
		 else if(@zhxz=='1') print(23,45,'[2]','√');
		 else if(@zhxz=='2') print(23,58,'[2]','√');
		 else if(@zhxz=='3') print(23,70,'[2]','√');
			 print( 24,30,'[30]',@zjxz);
			 print( 24,13,'[4]',substr(@yxrqz,0,4));
			 print( 24,3,'[4]',substr(@yxrqz,4,2));
			 print( 24,3,'[4]',substr(@yxrqz,6,2));
			 print( 26,50,'[30]',@sjfr);
			 print( 28,50,'[15]',@khxkzh);
			 print( 28,18,'[20]',@zzjgdm2);
		 if(@fddbr=='0')
		 {	
		 	print(29,23,'[2]','√');
		 	print( 29,25,'[30]',@xm2);
		 	print( 30,50,'[30]',@zjzl2);
		 }else if(@fddbr=='1') 
		 {
		 	print( 29,50,'[30]',@xm2);
		  print(30,23,'[2]','√');
		  print( 30,27,'[30]',@zjzl2);
		 }
	  	 print( 31,50,'[30]',@zjhm2);	   
      closeprinter();
  }
  if(msgbox('打印完成是否提交交易,确认提交,取消不提交','交易提交提示','cancel|ok') == 1)
  {
    return(true);
  }
  else return(false);  
}"
</USERFUN>

<!--统一支付专用-->
<USERFUN NAME="callagnpbp">"{
	dim @tota as string;
	dim @bakaddr as string;
	dim @newaddr as string;
	@bakaddr=getenv('AGNADDR');
	@newaddr=getenv('AGNADDR_ZFPT');
	setenv('AGNADDR',@newaddr);
	@tota=callagn();
	setenv('AGNADDR',@bakaddr);
	if(@tota!=''){
		savefiletxt('../tmp/'+$KINBR+$TTYNAME,@tota);
	}
}"
</USERFUN>

<!--统一支付打印头尾20140508-->
<USERFUN NAME="PrintTxHead">"{

	print( 1,3,'机构名称：[24]', $BRNAME);
	print( 1,27,'交易代码：[6]', #TXCODE);
	print( 1,45,'交易名称：[30]', #TXNAME);
	
	return(true);
	
	}"
</USERFUN>

<USERFUN NAME="PrintTxTail">"{
	
	$KINDNO='00';
	dim @txtime as string;
	@txtime = substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	
	print(21,3,'备注：');
	print(21,19,'交易日期：[8] [8]',$HDATE,@txtime);
	print(21,39,'柜员：[6]',$FD7);
	print(21,51,'核心流水：[8]',$FD4);
	
	return(true);

}"
</USERFUN>

<USERFUN NAME="authcheckagnpbp">"{
        dim @bak_fd16 as string;
        dim @bak_fd18 as string;
        dim @bak_fd34 as string;
        dim @bak_fd79 as string;
        dim @bak_fd92 as string;
        dim @bak_fd25 as string;

        @bak_fd16=$FD16;
        @bak_fd18=$FD18;
        @bak_fd34=$FD34;
        @bak_fd79=$FD79;
        @bak_fd92=$FD92;
        @bak_fd25=$FD25;
        $FD92='';

        $FD16='1107';
        $FD18='app';
        $FD34=@bak_fd16;
        $FD25=@bak_fd25;
        callagnpbp();
        if($FD12 != '0000')
	{
                showmsg(geterror());
                return(false);
        }
        if($FD34 == 'Z003'){
                showmsg('需要授权,授权号'+$FD73);
                opendlg('../xml/1896.DLG');
                if($FD12 == '@@@@'){
                        showmsg('授权已取消');
                        return(false);
                }
                $FD16='1108';
                $FD18='app';
                $FD34=@bak_fd16;             
                callagnpbp();
		if($FD12 != '0000')
                {
                        showmsg(geterror());
                        return(false);
                }

		$FD95=$FD92+'|'+$FD73+'|';
		savefiletxt('../tmp/auth'+$KINBR+$TTYNAME,$FD95);

                $FD16=@bak_fd16;
                $FD18=@bak_fd18;
                $FD34=@bak_fd34;
                $FD79=@bak_fd79;
                $FD92=@bak_fd92;
                return(true);
        }else{
		savefiletxt('../tmp/auth'+$KINBR+$TTYNAME,'||');
                $FD16=@bak_fd16;
                $FD18=@bak_fd18;
                $FD34=@bak_fd34;
                $FD79=@bak_fd79;
                $FD92=@bak_fd92;
                return(true);
        }
}"
</USERFUN>
<USERFUN NAME="PrintBilldata">"{
	dim @txtime as string;
		@txtime = substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
       dim @ch as string;
       	dim @ch1 as string;
       	//	showmsg($IsSelfFilled);
       	//if($IsSelfFilled=='False')
       	//return(true);
       	@ch=showmsg('是否打印填单内容，1-打印;0-不打印 ：');
				if(@ch == '0')return(true);
				else 
				{
				   openprinter('printer');
				   print( 5,10,'请确认以下信息时候正确：');
           print( 6,10,'姓    名:[30]','123123');
           print( 7,10,'证件类型:[30]',#SZJLX);
           print( 8,10,'证件号码:[30]',#ZJHM);
           print( 9,10,'联系电话:[30]','123');
           print( 10,10,'联系地址:[30]','123');
           print( 11,10,'定期类型:[30]','123');
           print( 12,10,'存    期:[30]','123');
           print( 13,10,'转存方式:[30]','123');
           print( 14,10,'是否凭密:[30]','123');
           print( 22,47,'请签字确认：_____________');       
	         print( 24,10,'柜员:[4]',$FD7);
	         print( 24,47,'交易日期:[8] [8]',$HDATE,@txtime);
           closeprinter();
        }
        	if(msgbox('打印完成是否提交交易,确认提交,取消不提交','交易提交提示','cancel|ok') == 1)
					{
						return(true);
					}
					else return(false);		
}"
</USERFUN>
