<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11111111011100000000000001100010" TITLE="1820         查询查复查询"
	xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>
	"{
		refresh();
		initfd();
		commsend_001();
	}"
</COMMSEND>
<COMMRECV>
	"{
		commrecv_001();
	}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3" COL="3"   TYPE="%-70s" FUNCTIONS=
  	"T(1820                           查询查复查询)"/>
	<ITEM LINE="4" COL="3"   TYPE="%-74s" FUNCTIONS=
	"T(--------------------------------------------------------------------------)"/>
	<ITEM NAME="#TXNAME"        TYPE="%-30s"  FUNCTIONS="T(查询查复查询)" />
	<ITEM NAME="#DOLIST" TYPE="%1s" FUNCTIONS="">
	<ONLOSTFOCUS>
	"{
		dim @selid as number;
		if(#DOLIST=='1')
		{
			@selid=list_work();     
			if(@selid &lt; 0)       
			{                     
				list_del();            
				rerun();               
				return(true);          
			}           
			@selid=list_getselid();
			if(@selid &lt; 0)
			{
				list_del();
				rerun();
				return(true);
			}
		}
		#DOLIST='';
		list_del();
	}"
	</ONLOSTFOCUS>
	</ITEM>
	<ITEM LINE="6" COL="3"   TYPE="%-10s" FUNCTIONS="T(查询类型：)"/>
	<ITEM LINE="6" COL="13"  NAME="#Qrytp" TYPE="%-1s" INPUT="SELECT" DEVICE="KEYBOARD" FUNCTIONS="T(0)V(NB)">
		<SELECT>
			<OPTION VALUE="0" TITLE="查询"/>
			<OPTION VALUE="1" TITLE="查复"/>
		</SELECT>
	</ITEM>
	<ITEM LINE="6" COL="35" TYPE="%-10s" FUNCTIONS="T(往来标志：)"/>
	<ITEM LINE="6" COL="45" NAME="#Contflg" TYPE="%-4s" INPUT="SELECT" DEVICE="KEYBOARD" FUNCTIONS="T(SR00)V(NB)">
		<SELECT>
			<OPTION VALUE="SR00" TITLE="往账"/>
			<OPTION VALUE="SR01" TITLE="来账"/>
		</SELECT>
	</ITEM>
	<ITEM LINE="7" COL="3"  TYPE="%-10s" FUNCTIONS="T(开始日期：)"/>
	<ITEM LINE="7" COL="13" NAME="#Startdate" TYPE="%-8s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()D()V(NB)"/>
	<ITEM LINE="7" COL="35"  TYPE="%-10s" FUNCTIONS="T(结束日期：)"/>
	<ITEM LINE="7" COL="45" NAME="#Enddate" TYPE="%-8s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()D()V(NB)">
		<ONLOSTFOCUS>
		"{
				if(#Enddate &lt; #Startdate)
				{	
					showmsg('结束日期比开始日期早,请重新输入!');
					return(false);
				}
		}"
		</ONLOSTFOCUS>		
	</ITEM>	
	
	<ITEM LINE="20"  COL="59" TYPE="%-6s" FUNCTIONS="T(确定)" INPUT="BUTTON" NAME="#OK" DEVICE="KEYBOARD" >
		<ONCLICK>
			"{			
				initfd();
				commsend_001();
				$FD3 = '01002';
				$FD10 = $TTYNAME;
				$FD16 = '1110';
				$FD18 = 'pbp';
				$FD26 = #Qrytp;
				$FD28 = #Contflg;
				
				$FD46 = #Startdate;
				$FD47 = #Enddate;
				
				dim @rcvbuffer as string;
				dim @filename1 as string;
				dim @ret as number;
				
				@rcvbuffer = callagn();
				
				
				if(@rcvbuffer == '')
				{
					showmsg(geterror());
					return(false);
				}
				
				if($FD12!='0000')
				{
					showmsg(geterror());
					return(false);
				}
					
				
					
				@filename1 = '../tmp/'+$KINBR+$HDATE;
				
				@ret = savefiletxt(@filename1, @rcvbuffer);
				if(@ret &lt; 0)
				{
					showmsg('账户文件导出失败！');
					return(false);
				}
				
				autolist('~'+@rcvbuffer);
				#DOLIST='1';
				goitem('#DOLIST');
				
				return(true);

			}"
		</ONCLICK>	
	</ITEM>	
	<ITEM NAME="#DOLIST" TYPE="%1s" FUNCTIONS="">
	<ONLOSTFOCUS>
		"{
			dim @selid as number;
			dim @data as string;
			dim @file as file;
			dim @count as number;
			dim @line as string;
			dim @a0 as string;
			dim @a1 as string;
			dim @a2 as string;
			dim @a3 as string;
			dim @a4 as string;
			dim @a5 as string;
			dim @a6 as string;
			dim @a7 as string;
			dim @a8 as string;
			dim @a9 as string;
			dim @a10 as string;
			dim @a11 as string;
			dim @a12 as string;
			dim @a13 as string;
			dim @a14 as string;
			dim @a15 as string;
			dim @a16 as string;
			dim @a17 as string;
			dim @a18 as string;
			dim @a19 as string;
			dim @a20 as string;
			dim @a21 as string;
			dim @a22 as string;
			if(#DOLIST == '1')
			{
				@selid=list_work();
				if(@selid &lt; 0)
				{
					list_del();
					rerun();
					return(true);
				}
				@selid=list_getselid();
				if(@selid &lt; 0)
				{
					list_del();
					rerun();
					return(true);
				}
				@a0=ltrim(list_gettext(@selid,0));
				@a1=ltrim(list_gettext(@selid,1));
				@a2=ltrim(list_gettext(@selid,2));
				@a3=ltrim(list_gettext(@selid,3));
				@a4=ltrim(list_gettext(@selid,4));
				@a5=ltrim(list_gettext(@selid,5));
				@a6=ltrim(list_gettext(@selid,6));
				@a7=ltrim(list_gettext(@selid,7));
				@a8=ltrim(list_gettext(@selid,8));
				@a9=ltrim(list_gettext(@selid,9));
				@a10=ltrim(list_gettext(@selid,10));
				@a11=ltrim(list_gettext(@selid,11));
				@a12=ltrim(list_gettext(@selid,12));
				@a13=ltrim(list_gettext(@selid,13));
				@a14=ltrim(list_gettext(@selid,14));
				@a15=ltrim(list_gettext(@selid,15));
				@a16=ltrim(list_gettext(@selid,16));
				@a17=ltrim(list_gettext(@selid,17));
				@a18=ltrim(list_gettext(@selid,18));
				@a19=ltrim(list_gettext(@selid,19));
				@a20=$FD7;
				@a21=$FD5;
				@a22=$FD56;
				open('1820_1.XML','#QryTp='+@a0+';#SrFlg='+@a1+';#QryBnkId='+@a2+';#RepBnkId='+@a3+';#TxNo='+@a4+';#TxDt='+@a5+';#TxSts='+@a6+';#QryId='+@a7+';#QryDt='+@a8+';#QryBrNo='+@a9+';#OSndBk='+@a10+';#ORcvBk='+@a11+';#OAmt='+@a12+';#OCur='+@a13+';#RepId='+@a14+';#RepDt='+@a15+';#RepBrNo='+@a16+';#PrtFlg='+@a17+';#QryMsg='+@a18+';#RepMsg='+@a19+';#Teller='+@a20+';#Date='+@a21+';#Trace='+@a22+';');
				
				return(true);
			}
				list_del();
				#DOLIST='';
	}"
	</ONLOSTFOCUS>
	</ITEM>
	</VARIABLE>	
</TRANSACTION>