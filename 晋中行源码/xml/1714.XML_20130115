<?xml version="1.0" encoding="GBK" ?><TRANSACTION RIGHT="11110100" TITLE="1714  二级账户查询修改"  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org"><COMMSEND>"{		if((#TMP_NAME==#S_NAME) and (#TMP_PAPERTYPE==#S_PAPERTYPE) and (#TMP_PAPERNO==#S_PAPERNO) and (#TMP_TELEPHONE==#S_TELEPHONE)			and (#TMP_XQ_NUM==#S_XQ_NUM) and (#TMP_LP_NUM==#S_LP_NUM) and (#TMP_DY_NUM==#S_DY_NUM) and (#TMP_FJ_NUM==#S_FJ_NUM))		{		showmsg('未做修改,关闭交易窗口!');		close('','');		return(false);		}	initfd();	commsend_001();	$FD30=delspace(#AC_NO);	$FD78=#AC_SEQ;	$FD25=#S_NAME;	$FD68=#S_PAPERTYPE;	$FD62=#S_PAPERNO;	$FD27=#S_TELEPHONE;	$FD53=#S_XQ_NUM;	$FD54=#S_LP_NUM;	$FD55=#S_DY_NUM;	$FD47=#S_FJ_NUM;}"</COMMSEND><COMMRECV>"{	commrecv_001();}"</COMMRECV><VARIABLE>	<ITEM LINE="3" COL="3" TYPE="%-52s" FUNCTIONS=	"T(1714                         二级账户查询修改)"/>	<ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=		"T(─────────────────────────────────────)"/>	<ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=1714)"/>	<ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>	<ITEM LINE="8" COL="16" TYPE="%-12s" FUNCTIONS="T(主  账  号:)"/>	<ITEM LINE="8" COL="28" TYPE="%-24s" NAME="#AC_NO" INPUT="TEXT" FUNCTIONS="V(NB)">	<ONLOSTFOCUS>"{		initfd();		commsend_001();		$FD16='9706';		$FD30=delspace(#AC_NO);		callserver();		if($FD12!='0000')		{			showmsg(geterror());			return (false);		}		if($OPNBR!=$FD2)		{			showmsg('请到开户行'+$FD2+'办理此业务;');			return(false);		}		#M_NAME=delspace($FD25);		show(#M_HM,true);		show(#M_NAME,true);	}"	</ONLOSTFOCUS>	</ITEM>	<ITEM LINE="9" COL="16" TYPE="%-12s" NAME="#M_HM"    INPUT="LABEL" VISABLE="FALSE" FUNCTIONS="T(主账号户名:)"/>	<ITEM LINE="9" COL="28" TYPE="%-50s" NAME="#M_NAME"  INPUT="LABEL" VISABLE="FALSE" FUNCTIONS=""/>	<ITEM LINE="10" COL="16" TYPE="%-12s" FUNCTIONS="T(子账户序号:)"/>	<ITEM LINE="10" COL="28" TYPE="%-8s"  NAME="#AC_SEQ" INPUT="TEXT" FUNCTIONS="">	<ONLOSTFOCUS>"{		dim @tota as string;		dim @filename as string;		dim @file as file;		dim @line as string;		initfd();		//先设置下拉菜单		commsend_001();		$FD16='9799';		$FD67='1';		@tota=callserver();		if($FD12 != '0000')		{			showmsg(geterror());			return(false);		}		setsel(#S_PAPERTYPE,@tota,'o5t20o1v1o2');		commsend_001();		$FD16='9598';		//$FD123='select name from sub_dd_mst where ac_no='+chr(39)+#AC_NO+chr(39)+' and sub_ac_seqn='+atoi(#AC_SEQ);		$FD123='select name,paper_type,paper_no,telephone,xq_num,lp_num,lp_num,fj_num from sub_dd_mst where ac_no='+chr(39)+#AC_NO+chr(39)+' and sub_ac_seqn='+itoa(atoi(#AC_SEQ));		// showmsg($FD123);		@tota=callserver();		if($FD12!='0000'){			showmsg(geterror());			return(false);		}		@filename='../tmp/'+$KINBR+$TTYNAME+'_1714.txt';		savefiletxt(@filename,@tota);		@file=openfile(@filename,'rb');		if(@file &lt; 0){		   showmsg(geterror());		   closefile(@file);		   return(false);		}		@line=readline(@file);		#S_NAME=strfld(@line,'|',0);		setitems('#S_PAPERTYPE',strfld(@line,'|',1));		#S_PAPERNO=strfld(@line,'|',2);		#S_TELEPHONE=strfld(@line,'|',3);		#S_XQ_NUM=strfld(@line,'|',4);		#S_LP_NUM=strfld(@line,'|',5);		#S_DY_NUM=strfld(@line,'|',6);		#S_FJ_NUM=strfld(@line,'|',7);		#TMP_NAME=strfld(@line,'|',0);		#TMP_PAPERTYPE=strfld(@line,'|',1);		#TMP_PAPERNO=strfld(@line,'|',2);		#TMP_TELEPHONE=strfld(@line,'|',3);		#TMP_XQ_NUM=strfld(@line,'|',4);		#TMP_LP_NUM=strfld(@line,'|',5);		#TMP_DY_NUM=strfld(@line,'|',6);		#TMP_FJ_NUM=strfld(@line,'|',7);		closefile(@file);		refresh();	}"	</ONLOSTFOCUS>	</ITEM>	<ITEM TYPE="%-50s" NAME="#TMP_NAME" FUNCTIONS=""/>	<ITEM TYPE="%-1s" NAME="#TMP_PAPERTYPE" FUNCTIONS=""/>	<ITEM TYPE="%-20s" NAME="#TMP_PAPERNO" FUNCTIONS=""/>	<ITEM TYPE="%-20s" NAME="#TMP_TELEPHONE" FUNCTIONS=""/>	<ITEM TYPE="%-1s" NAME="#TMP_CHG_FLAG" FUNCTIONS=""/>	<ITEM TYPE="%-6s" NAME="#TMP_XQ_NUM" FUNCTIONS=""/>	<ITEM TYPE="%-6s" NAME="#TMP_LP_NUM" FUNCTIONS=""/>	<ITEM TYPE="%-6s" NAME="#TMP_DY_NUM" FUNCTIONS=""/>	<ITEM TYPE="%-6s" NAME="#TMP_FJ_NUM" FUNCTIONS=""/>	<ITEM LINE="11" COL="16" TYPE="%-12s"  FUNCTIONS="T(子账号户名:)"/>	<ITEM LINE="11" COL="28" TYPE="%-50s" NAME="#S_NAME" INPUT="TEXT" FUNCTIONS=""/>	<ITEM LINE="12" COL="16" TYPE="%-10s"  FUNCTIONS="T(证件类型:)"/>	<ITEM LINE="12" COL="28" TYPE="%-1s" NAME="#S_PAPERTYPE" INPUT="SELECT" DEVICE="KEYBOARD" FUNCTIONS="V(NB)"/>	<ITEM TYPE="%-40s" NAME="#SS_PAPERTYPE" FUNCTIONS="S(#S_PAPERTYPE,#S_PAPERTYPE)"/>	<ITEM LINE="13" COL="16" TYPE="%-10s"  FUNCTIONS="T(证件号码:)"/>	<ITEM LINE="13" COL="28" TYPE="%-20s" NAME="#S_PAPERNO" INPUT="TEXT" FUNCTIONS="V(NB)">	<ONLOSTFOCUS>"{		dim @l as number;		dim @tota as string;		@l = len(#S_PAPERNO);		if('1' == #S_PAPERTYPE){		if(@l == 15 or  @l == 18){		}else{		showmsg('身份证号码位数错误');		return(false);		}	}	}"	</ONLOSTFOCUS>	</ITEM>	<ITEM LINE="14" COL="16" TYPE="%-10s"  FUNCTIONS="T(联系电话:)"/>	<ITEM LINE="14" COL="28" TYPE="%-20s" NAME="#S_TELEPHONE" INPUT="TEXT" FUNCTIONS=""/>	<ITEM LINE="15" COL="16" TYPE="%-10s"  FUNCTIONS="T(小区编号:)"/>	<ITEM LINE="15" COL="28" TYPE="%-6s" NAME="#S_XQ_NUM" INPUT="TEXT" FUNCTIONS="V(000000,999999)"/>	<ITEM LINE="16" COL="16" TYPE="%-10s"  FUNCTIONS="T(楼盘编号:)"/>	<ITEM LINE="16" COL="28" TYPE="%-6s" NAME="#S_LP_NUM" INPUT="TEXT" FUNCTIONS="V(000000,999999)"/>	<ITEM LINE="16" COL="40" TYPE="%-10s"  FUNCTIONS="T(单元编号:)"/>	<ITEM LINE="16" COL="50" TYPE="%-6s" NAME="#S_DY_NUM" INPUT="TEXT" FUNCTIONS="V(000000,999999)"/>	<ITEM LINE="17" COL="16" TYPE="%-10s"  FUNCTIONS="T(房间编号:)"/>	<ITEM LINE="17" COL="28" TYPE="%-6s" NAME="#S_FJ_NUM" INPUT="TEXT" FUNCTIONS="V(000000,999999)">	<ONLOSTFOCUS>	"{			if(#TMP_FJ_NUM!=#S_FJ_NUM)			{	      dim @tota as string;	      dim @num as number;	      commsend_001();	      $FD16='9598';	      $FD123='select count(*) from sub_dd_mst where ac_no='+chr(39)+delspace(#AC_NO)+chr(39)+' and xq_num='+#S_XQ_NUM+' and lp_num='+#S_LP_NUM+' and dy_num='+#S_DY_NUM+' and fj_num='+#S_FJ_NUM;	      @tota=callserver();	      if($FD12!='0000')	      {	        showmsg(geterror());	        return(false);	      }	      @num=val(strfld(@tota,'|',0),1);	      if(@num != 0)	      {	        showmsg('该房间编号已经存在,请检查');	        return(false);	      }			}	}"	</ONLOSTFOCUS>	</ITEM>	<ITEM LINE="20" COL="63" TYPE="%-6s" INPUT="SUBMIT" FUNCTIONS="T(确 定)"/></VARIABLE><REQUEST></REQUEST><RESPONSE><PACKAGE DEVICE="SCREEN" LINESPACE="38" DESC="修改成功!">NOTHING</PACKAGE><PRINT>"{	print( 2,16,'主  账  号: [24]',#AC_NO);	print( 3,16,'主账号户名: [50]',#M_NAME);	print( 4,16,'子  账  号：[24]  子账号序号: [ 8]',$FD33,$FD78);	print( 5,16,'子账号户名: [50]',$FD25);	print( 6,16,'子账户证件类型: [40]',#SS_PAPERTYPE);	print( 7,16,'子账户证件号码: [20]',#S_PAPERNO);	print( 8,16,'联系电话: [20]',#S_TELEPHONE);  print( 9,16,'小区编号: [6]',#S_XQ_NUM);  print(10,16,'楼盘编号: [6]',#S_LP_NUM);  print(11,16,'单元编号: [6]',#S_DY_NUM);  print(12,16,'房间编号: [6]',#S_FJ_NUM);}"</PRINT></RESPONSE><RESPONSE><PACKAGE DEVICE="PRINTER" DESC="请打印业务专用凭证">NOTHING</PACKAGE>	<PRINT>	"{		$KINDNO == '00';		dim @txtime  as string;		dim @skhlx as string;		@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);		print( 5,20,'机构名称:[30]',$BRNAME);		print( 5, 2,'代码:1714');		print( 5,13,'交易名称:二级账户查询修改');				print( 7,30,'\L0二级账户查询修改\L1');		print( 9,12,'主  账  号: [24]',#AC_NO); 		print(10,12,'子  账  号：[24]',$FD33); 		print(11,12,'子账号户名: [50]',$FD25); 		print(12,12,'子账号序号: [ 8]',$FD78); 		print(13,12,'子账户证件类型: [20]',#SS_PAPERTYPE); 		print(14,12,'子账户证件号码: [20]',#S_PAPERNO); 		print(15,12,'联系电话: [20]',#S_TELEPHONE); 		print(16,12,'小区编号: [6]  楼盘编号: [6]',#S_XQ_NUM,#S_LP_NUM); 		print(17,12,'单元编号: [6]  房间编号: [6]',#S_DY_NUM,#S_FJ_NUM); 		print(24,15,'备注:');		print(24,27,'交易日期:[8]  [8]',$HDATE,@txtime);		print(24, 5,'柜员:[6]',$FD7);		print(24, 5,'流水号:[6]',$FD4); 	}" 	</PRINT> </RESPONSE><LASTWORK>	"{		if((#TMP_NAME!=#S_NAME) or (#TMP_PAPERTYPE!=#S_PAPERTYPE) or (#TMP_PAPERNO!=#S_PAPERNO) or (#TMP_TELEPHONE!=#S_TELEPHONE))		{			commsend_001();			$FD24='fwx';			$FD16='J003';			$FD30=$FD33;               //帐号			$FD41=$KINBR;              //银行代码			$FD25=#S_NAME;             //户主名称			$FD18=#S_PAPERTYPE;        //证件类型			$FD63=#S_PAPERNO;          //证件号码			$FD62=#S_TELEPHONE;        //联系电话			callagn();			if($FD12 != '0000')			{				showmsg('交易成功,发送平台失败,请联系技术人员'+geterror());				return(false);			}			showmsg('二级账户查询修改成功!');		}	}"</LASTWORK></TRANSACTION>