<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110000" TITLE="5608 银行承兑汇票挂失/解挂"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
  	if(substr(#PAYACTNO,0,6) == '621223')
	{
		initfd();
		commsend_001();
		$FD16='6930';
		$FD30=#PAYACTNO;
		$FD79='111111';
		$FD75=$MSR2;
		$FD76=$MSR3;
		$FD39=itoa(val(#XTOAVBAL,100),'%016.2f');
		$FD31=#CASHACTNO;
		$FD73='10006933';	//小额交易代码
		$FD81='银行承兑汇票录入';
		callagn();  
		if($FD12!='0000')
		{
			showmsg(geterror());
			return (false);
		}
		#TRAN_FEE = val($FD39);
        }
		initfd();
		commsend_001();
        $FD25 = #PAYBRNAME;
        $FD26 = #PAYNAME;
        $FD27 = #CASHNAME;
        $FD30 = #PAYBRNO;
        $FD32 = #BZACTNO;
        $FD38 = #PAYACTNO;
//$FD39不知道是哪个金额
        $FD39 = space(16);
        $FD40 = itoa(val(#XBRATE,100),'%08d');  //保证金比例
        $FD44 = #EDATE;
        $FD58 = #CDHPNUM;
        $FD67 = #CZFLAG;
        $FD81 = #CASHBRNAME;
        $FD83 = #CASHACTNO;
        $FD100 = getitems('#TOAVBAL#ZYTOAVBAL#BZAVBAL#FD100_4#FD100_5#FD100_6#FD100_7#FD100_8#FD100_9#FD100_10');

}"
</COMMSEND>
<COMMRECV>"{
	commrecv_001();
	$PBLINE='05';
	$KINDNO='02';
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-60s" FUNCTIONS=
   "T(5608                     银行承兑汇票挂失/解挂)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>

  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=4346)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>

  <ITEM LINE="5"  COL="5"   TYPE="%-14s" FUNCTIONS="T(承兑汇票号码:)"/>
  <ITEM LINE="6"  COL="5"   TYPE="%-10s" FUNCTIONS="T(操作标志:!)"/>

  <ITEM LINE="8"  COL="13"  TYPE="%-60s" FUNCTIONS=
	   "T(-------------------- 以下为回显信息 ---------------------)"/>
  <ITEM LINE="10" COL="5"  TYPE="%-12s" FUNCTIONS="T(出票人账号:)"/>
  <ITEM LINE="11" COL="5"  TYPE="%-12s" FUNCTIONS="T(出票人全称:)"/>
  <ITEM LINE="12" COL="5"  TYPE="%-12s" FUNCTIONS="T(付款行行号:)"/>
  <ITEM LINE="13" COL="5"  TYPE="%-12s" FUNCTIONS="T(付款行全称:)"/>
  <ITEM LINE="14" COL="5"  TYPE="%-12s" FUNCTIONS="T(收款人帐号:)"/>
  <ITEM LINE="15" COL="5"  TYPE="%-11s" FUNCTIONS="T(收款人全称:)"/>
  <ITEM LINE="16" COL="5"  TYPE="%-12s" FUNCTIONS="T(收款行全称:)"/>

  <ITEM LINE="17" COL="5"  TYPE="%-12s" FUNCTIONS="T(票面总金额:)"/>
  <ITEM LINE="17" COL="37" TYPE="%-10s" FUNCTIONS="T(到期日期:)"/>
  <ITEM LINE="18" COL="5"  TYPE="%-12s" FUNCTIONS="T(保证金额:)"/>
  <ITEM LINE="18" COL="37" TYPE="%-12s" FUNCTIONS="T(质押总金额:)"/>

  <ITEM LINE="19" COL="5"  TYPE="%-12s" FUNCTIONS="T(保证金比例:)"/>
  <ITEM LINE="19" COL="26" TYPE="%-1s"  FUNCTIONS="T(%)"/>
  <ITEM LINE="20" COL="5"  TYPE="%-12s" FUNCTIONS="T(担保帐号:)"   NAME="#SDBACT" INPUT="LABEL" VISABLE="FALSE"/>
  <ITEM LINE="20" COL="5"  TYPE="%-12s" FUNCTIONS="T(保证金帐号:)" NAME="#SBZACT" INPUT="LABEL" VISABLE="TRUE"/>


<!-- 定义callserver返回但界面不用的变量 -->
  <ITEM TYPE="%17.2f" NAME="#FD100_1"  FUNCTIONS="V(NB)J(#XFD100_1)"/>
  <ITEM NAME="#XFD100_1" TYPE="%-16s"  FUNCTIONS="X(#FD100_1)"/>
  <ITEM TYPE="%17.2f" NAME="#FD100_2"  FUNCTIONS="V(NB)J(#XFD100_2)"/>
  <ITEM NAME="#XFD100_2" TYPE="%-16s"  FUNCTIONS="X(#FD100_2)"/>
  <ITEM TYPE="%17.2f" NAME="#FD100_3"  FUNCTIONS="V(NB)J(#XFD100_3)"/>
  <ITEM NAME="#XFD100_3" TYPE="%-16s"  FUNCTIONS="X(#FD100_3)"/>

  <ITEM TYPE="%17.2f" NAME="#FD100_4"  FUNCTIONS="V(NB)J(#XFD100_4)"/>
  <ITEM NAME="#XFD100_4" TYPE="%-16s"  FUNCTIONS="X(#FD100_4)"/>

  <ITEM TYPE="%9.6f"  NAME="#FD100_5"  FUNCTIONS="V(NB)J(#XFD100_5)"/>
  <ITEM NAME="#XFD100_5" TYPE="%-8s"   FUNCTIONS="X(#FD100_5)"/>

  <ITEM TYPE="%-2s"   NAME="#FD100_6"  FUNCTIONS="V(NB)"/>
  <ITEM TYPE="%-2s"   NAME="#FD100_7"  FUNCTIONS="V(NB)"/>
  <ITEM TYPE="%-10s"  NAME="#FD100_8"  FUNCTIONS="V(NB)"/>
  <ITEM TYPE="%-10s"  NAME="#FD100_9"  FUNCTIONS="V(NB)"/>
  <ITEM TYPE="%17.2f" NAME="#FD100_10" FUNCTIONS="V(NB)J(#XFD100_10)"/>
  <ITEM NAME="#XFD100_10" TYPE="%-16s" FUNCTIONS="X(#FD100_10)"/>
  <ITEM NAME="#TRAN_FEE"          TYPE="%16.2f"     FUNCTIONS=""/>

  <ITEM LINE="5"  COL="19" TYPE="%16d"  NAME="#CDHPNUM"    DEVICE="KEYBOARD" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
    "{
        dim @baktxno as string;
        @baktxno=$TXNO;
        $TXNO='9913';
        $FD58 = #CDHPNUM;
        commsend_001();
        callserver();
        $TXNO=@baktxno;
        if($FD12!='0000'){
            showmsg(geterror());
            return(false);
        }
        #PAYBRNAME = $FD25;
        #PAYNAME = $FD26;
        #CASHNAME = $FD27;
        #PAYBRNO = $FD30;
		#BZACTNO = $FD32;
        #PAYACTNO = $FD38;
        #XBRATE = itoa(val($FD40,0.01),'%.2f');
		#EDATE = $FD44;
		#CASHBRNAME = $FD81;
		#CASHACTNO = $FD83;
        setitems('#TOAVBAL#ZYTOAVBAL#BZAVBAL#FD100_4#FD100_5#FD100_6#FD100_7#FD100_8#FD100_9#FD100_10',$FD100);
	
	if($FD67=='4')
	{
		show(#SBZACT,false);
		show(#SDBACT,true);
	}else{
		show(#SDBACT,false);
		show(#SBZACT,true);
	}

  }"
  </ONLOSTFOCUS>
  </ITEM>

  <ITEM LINE="10" COL="17" TYPE="%-19s"  NAME="#PAYACTNO"   INPUT="LABEL" FUNCTIONS=""/>
  <ITEM LINE="11" COL="17" TYPE="%-50s"  NAME="#PAYNAME"    INPUT="LABEL" FUNCTIONS=""/>
  <ITEM LINE="12" COL="17" TYPE="%-12s"  NAME="#PAYBRNO"    INPUT="LABEL" FUNCTIONS=""/>
  <ITEM LINE="13" COL="17" TYPE="%-40s"  NAME="#PAYBRNAME"  INPUT="LABEL" FUNCTIONS=""/>
  <ITEM LINE="14" COL="17" TYPE="%-32s"  NAME="#CASHACTNO"  INPUT="LABEL" FUNCTIONS=""/>
  <ITEM LINE="15" COL="17" TYPE="%-50s"  NAME="#CASHNAME"   INPUT="LABEL" FUNCTIONS=""/>
  <ITEM LINE="16" COL="17" TYPE="%-40s"  NAME="#CASHBRNAME" INPUT="LABEL" FUNCTIONS=""/>

  <ITEM LINE="17" COL="17" NAME="#XTOAVBAL" TYPE="%-16s" FUNCTIONS="X(#TOAVBAL)"/>
  <ITEM TYPE="%17.2f" NAME="#TOAVBAL" FUNCTIONS="J(#XTOAVBAL)"/>
  <ITEM LINE="17" COL="47" TYPE="%-8s"   NAME="#EDATE"      INPUT="LABEL" FUNCTIONS=""/>
  <ITEM LINE="18" COL="17" NAME="#XBZAVBAL" TYPE="%-16s" FUNCTIONS="X(#BZAVBAL)"/>
  <ITEM TYPE="%17.2f" NAME="#BZAVBAL" FUNCTIONS="J(#XBZAVBAL)"/>
  <ITEM LINE="18" COL="49" NAME="#XZYTOAVBAL" TYPE="%-16s" FUNCTIONS="X(#ZYTOAVBAL)"/>
  <ITEM TYPE="%17.2f" NAME="#ZYTOAVBAL" FUNCTIONS="J(#XZYTOAVBAL)"/>
  <ITEM LINE="19" COL="17" NAME="#XBRATE" TYPE="%-8s" FUNCTIONS=""/>

  <ITEM LINE="20" COL="17" TYPE="%-24s" NAME="#BZACTNO"  INPUT="LABEL" FUNCTIONS="V(NB)"/>

  <ITEM LINE="6"  COL="15" TYPE="%-1s"   NAME="#CZFLAG"   DEVICE="KEYBOARD" FUNCTIONS="V(NB)">
    <SELECT LINE="0" COL="0">
        <OPTION VALUE="1" TITLE="挂失"/>
        <OPTION VALUE="2" TITLE="解挂"/>
    </SELECT>
  </ITEM>
  <ITEM TYPE="%-4s" NAME="#CZNAME"   FUNCTIONS="S(#CZFLAG,#CZFLAG)"/>
  
  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  <ITEM NAME="#YEAR"  TYPE="%-4s" FUNCTIONS="T($FD5,1,4)"/>
  <ITEM NAME="#MON"  TYPE="%-2s" FUNCTIONS="T($FD5,5,2)"/>
  <ITEM NAME="#DAY"  TYPE="%-2s" FUNCTIONS="T($FD5,7,2)"/>
  
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>

</VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
	<PACKAGE DEVICE="SCREEN" DESC="显示内容">
	NOTHING
	</PACKAGE>
	<PRINT>
	"{
		print(8, 8,'汇票 [16]  [4] 成功!',#CDHPNUM,#CZNAME);
	}"
	</PRINT>
</RESPONSE>

<RESPONSE>
    <PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="请打印业务专用凭证">
    NOTHING
    </PACKAGE>
    <PRINT>
    "{
 $KINDNO='00';
 dim @txtime  as string;
@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	print( 5,20,'机构名称:[30]',$BRNAME);  
	print( 5,2,'代码:5608');
	print( 5,13,'交易:承兑汇票挂失解挂');

	print( 7,20,'承兑汇票号码: [16]     [4] 成功!',#CDHPNUM,#CZNAME);
	print(24,20,'备注:');
	print(24,27,'交易日期:[8] [8]',$HDATE,@txtime);
	print(24,5,'柜员:[4]',$FD7);
	print(24,5,'流水号:[6]',$FD4);
    }"
    </PRINT>
</RESPONSE>

</TRANSACTION>
