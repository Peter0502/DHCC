<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110100000000000000000000000000" TITLE="1248 退款请求报文导入"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	 
}"
</COMMSEND>
<COMMRECV>"{
	commrecv_001();
}"
</COMMRECV>

<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-50s" FUNCTIONS=
	"T(1248                       退款请求报文导入)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=5616)"/>
  <ITEM NAME="#TXNAME" TYPE="%-12s" FUNCTIONS="T(退款请求报文导入)"/><!---交易名称--->
  <ITEM NAME="#TXNUMBER" TYPE="%-4s" FUNCTIONS="T(1248)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  
  <BLOCK LINE="4" COL="10" >
  	
  <ITEM LINE="5" COL="8" TYPE="%-14s"  FUNCTIONS="T(财政机构代码: )"/>
  <ITEM LINE="5" COL="22" TYPE="%-16s" NAME="#FIN_CODE" INPUT="TEXT" FUNCTIONS="V(NB)"/>
 
  <ITEM LINE="6" COL="8" TYPE="%-14s"  FUNCTIONS="T( 代理行 行号: )"/>
  <ITEM LINE="6" COL="22" TYPE="%-16s" NAME="#BR_NO" INPUT="TEXT"  FUNCTIONS="V(NB)T(313175000011)"/>
  
   <ITEM LINE="7" COL="8" TYPE="%-14s" FUNCTIONS="T( 报 文 日 期: )"/>
  <ITEM LINE="7" COL="22" TYPE="%-8d" NAME="#NoteDate" INPUT="TEXT" FUNCTIONS="V(19000101,99991231)"/>
  
  <ITEM LINE="8" COL="8" TYPE="%-14s"  FUNCTIONS="T( 报 文 序 号: )"/>
  <ITEM LINE="8" COL="22" TYPE="%-3s" NAME="#Seq" INPUT="TEXT" FUNCTIONS="V(NB)" >
  	<ONLOSTFOCUS>
  		"{
  		    if(len(#Seq)!=3)
  		    {
  		       showmsg('请输入3位序号!');
  		       return (false);
  		    }
  		}"
  		</ONLOSTFOCUS>
  </ITEM>
  
  <ITEM LINE="9" COL="8" TYPE="%-14s"  FUNCTIONS="T( 报 文 类 型: )"/>
  <ITEM LINE="9" COL="22" TYPE="%-4s" NAME="#MsgNo" INPUT="SELECT" ENABLE="FALSE" FUNCTIONS="V(NB)T(2202)" >
  	 <SELECT>
      <OPTION VALUE="2201"  TITLE="1.划款申请" />
      <OPTION VALUE="2202"  TITLE="2.退款请求" />
    </SELECT>
    <ONLOSTFOCUS>
    	"{
    	   if(#MsgNo=='2202')
    	   {
    	       //show(#LOri_NOTE_NO,true);
    	       //show(#Ori_NOTE_NO,true);
    	       //show(#LCMTNO,true);
    	       //show(#CMTNO,true);
    	       //show(#LORDER_NO,true);
    	       //show(#ORDER_NO,true);
    	   }
    	   else
    	   {
    	       //show(#LOri_NOTE_NO,false);
    	       //show(#Ori_NOTE_NO,false);
    	      // show(#LCMTNO,false);
    	      // show(#CMTNO,false);
    	      // show(#LORDER_NO,false);
    	      // show(#ORDER_NO,false);
    	   }
    	}"
    </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#cPackNo" TYPE="%-8s" FUNCTIONS="T()"/>
	<ITEM NAME="#cVouNo" TYPE="%-20s" FUNCTIONS="T()"/>

  <!--
  <ITEM LINE="10" COL="8"  TYPE="%-14s" NAME="#LOri_NOTE_NO" INPUT="LABEL" VISABLE="FALSE"  FUNCTIONS="T(原支付凭证号: )"/>
  <ITEM LINE="10" COL="22" TYPE="%-16s" NAME="#Ori_NOTE_NO" INPUT="TEXT" VISABLE="FALSE" FUNCTIONS="V(NB)"/>
  
  <ITEM LINE="11" COL="8"  TYPE="%-14s"  NAME="#LCMTNO"  INPUT="LABEL" VISABLE="FALSE"       FUNCTIONS="T(CMT     编号:)"/>
  <ITEM LINE="11" COL="22" TYPE="%3s"   NAME="#CMTNO"    INPUT="SELECT" VISABLE="FALSE"   DEVICE="KEYBOARD" FUNCTIONS="T(100)V(NB)">
    <SELECT>
        <OPTION VALUE="100" TITLE="汇兑"/>
        <OPTION VALUE="101" TITLE="委托收款"/>
        <OPTION VALUE="102" TITLE="托收承付"/>
        <OPTION VALUE="103" TITLE="国库资金汇划"/>
        <OPTION VALUE="105" TITLE="银行间拆借"/>
    </SELECT>
    </ITEM>
  <ITEM LINE="12" COL="8" TYPE="%-14s" INPUT="LABEL" NAME="#LORDER_NO" VISABLE="FALSE" FUNCTIONS="T(退款支付序号: )"/>
  <ITEM LINE="12" COL="22" TYPE="%-8s" INPUT="TEXT"  NAME="#ORDER_NO"   VISABLE="FALSE" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
	"{
		dim @l as number;
		@l = len(#ORDER_NO);
		if(@l != 8 )
		{
			showmsg('退款支付序号位数错误');
			return(false);
		}
  }"
	</ONLOSTFOCUS>
  </ITEM>
  -->
 <!--
  <ITEM LINE="9" COL="8" TYPE="%-10s" FUNCTIONS="T(凭 证 号:!)"/>
  <ITEM LINE="9" COL="18" TYPE="%-16s" NAME="#NOTE_NO" INPUT="TEXT" FUNCTIONS="V(NB)"/>
  <ITEM LINE="10" COL="8" TYPE="%-10s" FUNCTIONS="T(付款账号:)"/>
  <ITEM LINE="10" COL="18" TYPE="%-24s" NAME="#PAYACNO" INPUT="TEXT" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
   "{
        dim @br_no as string;
        
        initfd();
        commsend_001();
        $FD16 = '2492';
        $FD30 = #PAYACNO;
        callserver(); 
        if($FD12!='0000')
        {
           showmsg(geterror());
           return(false);
        }
        @br_no = $FD91;
        //showmsg('br_no='+@br_no);
        if( @br_no != $KINBR )
        {
             showmsg('非本机构账号不能做此业务!');
             return(false);
        }
   }"
   </ONLOSTFOCUS>
 </ITEM>
 -->
  </BLOCK>
   
   <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  <ITEM LINE="21"  COL="59" TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
  <ONCLICK>
    "{
        dim @tota as string; 
        dim @filename as string; 
        initfd();
	      commsend_001();
	      $FD16='5616';
	      $FD60=#Seq;
	      $FD47=#NoteDate;
	      $FD58=#BR_NO;
	      $FD59=#FIN_CODE;
	      $FD61=#MsgNo;  
	    //  $FD62=#Ori_NOTE_NO;
	      
	    //  $FD23=#CMTNO;
       // $FD64=#ORDER_NO;
        
	      @tota=calltips();
        if( $FD12!='0000')
        {
            showmsg(geterror());
  		      return(false);
        }
        #cPackNo=delspace($FD32);
        #cVouNo=delspace($FD33);
        @filename='../tmp/'+$KINBR+$TTYNAME+#TXNO;
        savefiletxt(@filename,@tota); 
        runoutput(); 
        call('fview '+@filename);

    }"
  </ONCLICK> 
   </ITEM> 
</VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
	<PACKAGE DEVICE="SCREEN"  DESC="交易完成">  
		NOTHING
	</PACKAGE>
		<PRINT>
		"{
		print( 5,20,'财政机构代码:[11]',#FIN_CODE);
		print( 7,20,'代理行 行号:[20]',#BR_NO);
		print( 9,20,'报 文 日 期:[8]',#NoteDate);
		print(11,20,'报 文 序 号:[3]',#Seq);	
		print(13,20,'报文 流水号:[8]',#cPackNo);	
		print(15,20,'原支付凭证号:[8]',#cVouNo);
	}"
		</PRINT>
</RESPONSE>

<RESPONSE>
<PACKAGE DEVICE="PRINTER" DESC="请打印凭证" LINESPACE="24" >
NOTHING
</PACKAGE>
<PRINT>
"{
		$KINDNO='00';
		dim @txtime as string;
		dim @feetype as string;
		@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);		
		print( 5,20,'机构名称:[30]',$BRNAME);
		print( 5, 2,'代码:[4]',#TXNUMBER);
		print( 5,13,'交易名称:[20]',#TXNAME);
		print( 7,30,'\L0退款请求报文导入凭条\L1');		
		print( 9,20,'财政机构代码:[11]',#FIN_CODE);
		print(10,20,'代理行 行号:[20]',#BR_NO);
		print(11,20,'报 文 日 期:[8]',#NoteDate);
		print(12,20,'报 文 序 号:[3]',#Seq);	
		print(13,20,'报文 流水号:[8]',#cPackNo);	
		print(14,20,'原支付凭证号:[8]',#cVouNo);
		print_sq();
		print(24,20,'备注:');
		print(24,27,'交易日期:[8] [8]',$HDATE,@txtime);
		print(24,5,'柜员:[4]',$FD7);
		print(24,5,'流水号:[6]',$FD4);	

}"
</PRINT>
</RESPONSE>
<OUTPUT>
</OUTPUT>
</TRANSACTION>

