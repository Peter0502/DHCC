<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110000" TITLE="4203 对公部提业务"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	commsend_001();
	commsend_102();
	//$FD101=getitems('#202ACTNO#202ACSEQ#202AMT#VOCTYPE1#202VOCNUM#202DSCPT#202NBFLAG#CUSTNAME1#AVBAL1#CURCD1#202CASHFLAG#VOCDSCPT1#202ACTYPE#202ACSEQ2#PRODNAME1');
	$FD101=getitems('#101ACTNO#101ACSEQ#101AMT#101VOCTYPE#101VOCNUM#101DSCPT#101CARDFLAG#101CNAME#101AVBAL#101CURCD#101CASHFLAG#101DSCTYPE#101ACTYPE#101ACSEQ2#101PNAME');
	$FD102=getitems('#ACTNO24#ACTSEQ#VOCTYPE#VOCNUM#FETCHFLAG#PWDFLAG#QUE_PWD#DRAW_PWD#CERTFLAG#CERTNO#STAMPFLAG#PWDFLAG2#PWD16#PRINTDATE#TXAMT#CERTTYPE#CUSTNAME#AVBAL#CURCD#CASHFLAG#DSCPT#ACTTYPE#ACTSEQ_2#ACCOUNTFLAG#INTEREST1#INTEREST2#INTEREST3#PAYAMOUNT#NEWVOCNUM#SPEFLAG#PRODNAME#ACTNO_24#EDUCREDIT#DESC10');
	$FD16='2207';
}"
</COMMSEND>
<COMMRECV>"{
	commrecv_001();
}"
</COMMRECV>
<FIRSTWORK>
"{
  #PIC='';
  #PIC1='';
  show(#PIC,false);
  show(#PIC1,false);
  show(#LBLPIC,false);
  show(#LBLPIC1,false);
  enable(#SETPIC,false);
  enable(#SETPIC1,false);
}"
</FIRSTWORK>
<VARIABLE UPLOOP="TRUE">
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(4203                          对公部提业务)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO"      TYPE="%-4s"  FUNCTIONS="T($TXNO=2207)"/>
  <ITEM NAME="#MSGTYPE"   TYPE="%-5s"  FUNCTIONS="T($MSGTYPE=03001)"/>
  <ITEM NAME="#ACT_LX"    TYPE="%-5s"  FUNCTIONS="T(2)"/>   
  <ITEM NAME="#ACT_LX_CK" TYPE="%-5s"  FUNCTIONS=""/>
  <ITEM NAME="#TXCD"      TYPE="%-4s"  FUNCTIONS="T(4203)"/>    <!---交易代码--->
  <ITEM NAME="#TXNAME"    TYPE="%-10s" FUNCTIONS="T(对公部提)"/><!---交易名称--->
  
  <PAGE NAME="DEFAULT">
	<ITEM NAME="#LACTNO" LINE="6" COL="5" TYPE="%-10s"  FUNCTIONS="T(帐    号: )"/>
	<ITEM LINE="6" COL="40" NAME="#LBLPIC" TYPE="%-10s" FUNCTIONS="T(照    片:)"/>
	<ITEM LINE="8" COL="40" NAME="#LBLPIC1" TYPE="%-10s" FUNCTIONS="T(印    件:)"/> 
	<ITEM LINE="6" COL="50" LINES="160" COLS="120" NAME="#PIC" TYPE="%-10s" VISABLE="FALSE" FUNCTIONS=""/>
	<ITEM LINE="8" COL="50" LINES="220" COLS="160" NAME="#PIC1" TYPE="%-10s" VISABLE="FALSE" FUNCTIONS=""/>
	<ITEM LINE="8"   COL="4" TYPE="%-16s" FUNCTIONS="T(【产品信息】)"/>
	<ITEM LINE="9"   COL="5" TYPE="%-70s" FUNCTIONS="T(-----------------------------------------------------------------------)"/>
	<ITEM NAME="#ACTNO"  LINE="6"  COL="15" TYPE="%-19s"  DEVICE="KEYBOARD" FUNCTIONS="">
	 <ONLOSTFOCUS>
	   "{
			// showmsg(#ACTNO);
			$TXNO='9956';
		}"
	 </ONLOSTFOCUS>
	 </ITEM>

	<BLOCK NAME="ACTINFO" LINE="7" COL="17" VISABLE="FALSE"><!----输入项IMP--->
		<IMPORT>42031.IMP</IMPORT>
	</BLOCK>
	
	<ITEM NAME="#ADDINFO" TYPE="%-1s" FUNCTIONS="">
	<ONLOSTFOCUS>
	"{
			// showmsg('$cashflag---'+#CASHFLAG);
			if(#CASHFLAG=='2')
			{
				show(#NT_PAGE,true);
			}else{
				show(#COMP,true);
			}
	}"
	</ONLOSTFOCUS>
	</ITEM>
	
	<ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(下一页)" INPUT="BUTTON" NAME="#NT_PAGE" VISABLE="FALSE">
  <ONCLICK>"{
    loadpage('PAGE2');
  }"
  </ONCLICK>
  </ITEM>
  
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT" NAME="#COMP"    VISABLE="TRUE"/>
	</PAGE>
	

  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD"   TYPE="%-6s"   FUNCTIONS="T()"/>
  <ITEM NAME="#TXAVBAL"  TYPE="%17.2f" FUNCTIONS="J(#UTXAVBAL)"/> <!---新存单金额--->
  <ITEM NAME="#UTXAVBAL" TYPE="%-40s"  FUNCTIONS="U(#TXAVBAL)"/>  <!---新存单大写金额--->
	<IMPORT>TRANSINFO.IMP</IMPORT>
  <ITEM NAME="#SELFYN"    TYPE="%-1s"  FUNCTIONS="T(1)"/><!----因打凭证需要设此变量,意为是否本人---->
  <ITEM NAME="#AGENTNAME" TYPE="%-20s" FUNCTIONS=""/>    <!----因打凭证需要设此变量---->
  <ITEM NAME="#SATCETYPE" TYPE="%-20s" FUNCTIONS=""/>    <!----因打凭证需要设此变量---->
  <ITEM NAME="#ATCENUM"   TYPE="%-1s"  FUNCTIONS=""/>    <!----因打凭证需要设此变量---->
</VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
    <PACKAGE DEVICE="SCREEN" DESC="显示内容">
	NOTHING
	</PACKAGE>
	<PRINT>"{
			print( 3, 32,'对公部提业务');
			print( 5, 22,'取款帐号: [19]',#ACTNO);
			print( 6, 22,'户    名: [50]',#CUSTNAME);
			print( 7, 22,'取款金额: [21]',#XTXAMT);
			print( 8, 22,'流 水 号: [ 6]',$FD4);
		}"
	 </PRINT>
 </RESPONSE>
<RESPONSE><!----用利息清单内容打印---->
<PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="请打印原证实书">
LXQD|@ac_no|@name|@tx_amt1|@title|@opn_date|@opn_br_no|@av_bal|@all_intst|@tax_intst|@tax_rate|@intst|@real_intst|@real_bal|@dinum|@intst_type|@memo|@ac_seqn|@term|@prt_line|@brf|@ac_no1|@book_line|@mtr_date|@tmp_seqn|@rate|@prdt_no|@int_acc_hrt|
</PACKAGE>
<INIT>
"{
$KINDNO='00';
}"
</INIT>
<PRINT>
"{
dim @txamt as string;
dim @interest as string;

//@txamt=ltrim(comma(substr(@tx_amt1,0,len(@tx_amt1)-4),16));
//if(len(@txamt)&lt;21)
//{
//	@txamt=space(21-len(@txamt))+@txamt;
//}
@interest=ltrim(comma(@all_intst,16));

print( 5,20,'\L0已部提\L1');
print( 7,20,'部提流水号: [6]  支取操作员:[4]',$FD4,$TLRNO);
print( 9,9,'交易日期: [8       ]    交易金额:[16              ]  利息:[10        ] 新帐号: [19]',$HDATE,ltrim(comma(@tx_amt1,16)),@interest,@ac_no1);

}"
</PRINT>
</RESPONSE>
<IMPORT>CX_QK_VOC.IMP</IMPORT>

<RESPONSE><!---对公利息清单--->
	<PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="请打印对公利息清单">
	LXQD|@ac_no|@name|@tx_amt1|@title|@opn_date|@opn_br_no|@av_bal|@all_intst|@tax_intst|@tax_rate|@intst|@real_intst|@real_bal|@dinum|@intst_type|@memo|@ac_seqn|@term|@prt_line|@brf|@ac_no1|@book_line|@mtr_date|@tmp_seqn|@rate|@prdt_no|@int_acc_hrt|
	</PACKAGE>

	<PRINT>
	"{
		$KINDNO='00';
		dim @txtime  as string;  //交易时间
		@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	
		print( 5, 20,'机构名称:[30]',$BRNAME);  
		print( 5, 2,'代码:4203');
		print( 5, 13,'交易:对公部提');
		
		print( 7,30,'\L0对公存款利息清单\L1');
		print( 8,20,'产品类型: [30                            ]  计息方式: [10        ]',@title,@intst_type);
		print( 9,20,'帐    号: [18                ]              户    名: [50]',@ac_no,@name);
		print(10,20,'余    额: [21                   ]           利    息: [16]',ltrim(comma(@tx_amt1,21)),ltrim(comma(@all_intst,16)));
		print(11,20,'本息合计: [21                   ]           利息积数: [21]',ltrim(comma(@av_bal,21)),ltrim(comma(@dinum,21)));
		print(12,20,'利    率: [4   ]%',@rate);
		print_sq();

		print( 24,20,'备注:');
		print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
		print( 24,5,'柜员:[4]',$FD7);
		print( 24,5,'流水号:[6]',$FD4);
	}"
	</PRINT>
</RESPONSE>

<IMPORT>CX_CK_PZ.IMP</IMPORT>
<!---涉及到储蓄活期，去补登折
<IMPORT>CXCZ.IMP</IMPORT>
--->
<!--对公定期存款证实书-->
<RESPONSE>
<PACKAGE DEVICE="PRINTER" LINESPACE="11"  DESC="请打印新定期存款证实书">
CZFY|@ac_no|@name|@tx_amt1|@title|@opn_date|@opn_br_no|@cif_no|@end_date|@term|@unit|@rate|@av_bal|@email|@zy|@deac_type|@cur_name|@tx_code|@memo|@ac_no1|@intr|@ct_name|@ac_seqn|@ic_date|@prt_line|@prdt_no||@brf|@tmp_ac_no|@tmp_tx_name|@tel|@id_name|@id_no|@br_name|@br_tele|@note_no|@zdzc|@acc_hrt|
</PACKAGE>
<INIT>
"{
$KINDNO='00';
}"
</INIT>
<PRINT>
"{
dim @txamt as string;
dim @interest as string;
dim @crate as string;    //打印用利率
dim @percent as string;    //百分号  
$KINDNO='00';

@txamt=ltrim(comma(substr(@tx_amt1,0,len(@tx_amt1)-4),16));
if(len(@txamt) &lt; 21)
{
	@txamt=space(21-len(@txamt))+@txamt;
}
@interest=ltrim(comma(@intr,16));
setitems('#TXAVBAL',itoa(val(substr(@tx_amt1,0,len(@tx_amt1)-4),100),'%016.0f'));

if(@prdt_no=='281' or @prdt_no=='282') //当为通知时,打印利率为空
{
	@crate   = '';
	@percent = '';
}
else
{
	@crate   = @rate;
	@percent = '%';
}
setitems('#TXAVBAL',itoa(val(@tx_amt1,100),'%016.0f'));
	
	print(13,33,'[4   ]      [2 ]     [2 ]  ',substr(@opn_date,0,4),substr(@opn_date,4,2),substr(@opn_date,6,2));
	print(16,1,'                    \L0[60                                                          ]       \L1',@name);
	print(19,1,'                    \L0[20                  ]  [30]\L1 ',@ac_no,@br_name);
	print(23,1,'                         [4   ]     [2 ]    [2 ]                 [2 ][2 ]                [7      ][1]',substr(@opn_date,0,4),substr(@opn_date,4,2),substr(@opn_date,6,2),@term,@unit,@crate,@percent);
	print(26,24,'\Z0[40]\Z1',#UTXAVBAL);
	print(30,24,'\L0[21]\L1',ltrim(@txamt));
	print(48,73,'[4]',$TLRNO);
}"
</PRINT>
</RESPONSE>
</TRANSACTION>
