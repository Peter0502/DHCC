<?xml version="1.0" encoding="GBK"?>
<TRANSACTION TITLE="8849 公务卡交易撤销" RIGHTS="01100000000000000000000000000000" xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<USERFUN NAME="saveprint"> 
"{   
	//用于补打流水
	dim @printflag as string;
	dim @otrno as string;
	dim @file as file;
	dim @line as string;
	dim @txtime as string;
	@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	@printflag='8849';
	@otrno='';

	dim @FD52 as string;
	dim @ntmp as number;
	@ntmp = atoi($FD52);
	@FD52 = itoa(@ntmp, '%012d');
	@file=openfile('../dat/CCARD_'+$HDATE+'_'+$TLRNO+'_'+@FD52+'.dat','w');
	
	if(#OPTION == '010000')
	{
		@line =@printflag + '|'+ #OPTION+ '|'+ #CARDNO + '|'  + #UERNAME + '|' + #XDEPAMT + '|' + comma(itoa(val($FD42,0.01),'%.2f')) + '|' + comma(itoa(val($FD43,0.01),'%.2f')) + '|' + ' ' + '|' + ' ' +'|'+ $FD52 +'|' + $FD58 + '|'+#TXTIME+'|' +$HDATE+'|' +$FD7+'|'+$FD4+'|' + '' +'|' + '' +'|'+ substr($FD126,2,6) +'|'+''+'|'+#AUTH_NO+'|' +#AUTH_TEL+'|';
	}
	else if(#OPTION == '210000') {
		@line =@printflag + '|'+ #OPTION+ '|'+ #CARDNO + '|'  + #UERNAME + '|' + #XDEPAMT + '|' + comma(itoa(val($FD42,0.01),'%.2f')) + '|' + comma(itoa(val($FD43,0.01),'%.2f')) + '|'+' '+'|'+' '+'|'+  $FD52 +'|' + $FD58 + '|'   +#TXTIME+'|' +$HDATE+'|' +$FD7+'|'+$FD4+'|' + ''+ '|' + '' +'|'+ substr($FD126,2,6) +'|'+''+'|'+#AUTH_NO+'|' +#AUTH_TEL+'|';
	}
	else if(#OPTION == '470000') { 
	@line =@printflag + '|'+ #OPTION+ '|'+ #CARDNO + '|'  + #UERNAME + '|' + #XDEPAMT + '|' + comma(itoa(val($FD42,0.01),'%.2f')) + '|' + comma(itoa(val($FD43,0.01),'%.2f')) + '|'+' '+'|'+' '+'|'+  $FD52 +'|' + $FD58 + '|'   +#TXTIME+'|' +$HDATE+'|' +$FD7+'|'+$FD4+'|' + #CASHNO+ '|' + #CASHNAME +'|'+ substr($FD126,2,6) +'|'+''+'|'+#AUTH_NO+'|' +#AUTH_TEL+'|';
	}
	else if(#OPTION == '460000') {
		@line =@printflag + '|'+ #OPTION+ '|'+ #P_CARDNO + '|'+ #P_UERNAME + '|'+#P_XDEPAMT + '|' +ltrim(comma(itoa(val($FD42,0.01),'%.2f'))) + '|' +ltrim(comma(itoa(val($FD43,0.01),'%.2f'))) + '|'+' '+'|'+' '+'|'+ $FD52 +'|' +#P_OLDTRNO+ '|' +#TXTIME+'|' +$HDATE+'|' +$FD7+'|'+$FD4+'|' + #TOCNO+ '|' + #TOCNAME +'|'+ substr($FD126,2,6) +'|'+''+'|'+#AUTH_NO+'|' +#AUTH_TEL+'|';
	}
	else if(#OPTION == '400000') {

		@line =@printflag + '|'+ #OPTION+ '|'+ #P_CARDNO + '|'  + #P_UERNAME + '|' + #P_XDEPAMT + '|'+ltrim(comma(itoa(val($FD42,0.01),'%.2f'))) + '|' +ltrim(comma(itoa(val($FD43,0.01),'%.2f'))) + '|'+' '+'|'+' '+'|'+  $FD52 +'|' + #P_OLDTRNO + '|'        +#TXTIME+'|'+$HDATE+'|' +$FD7+'|'+$FD4+'|' + #TOCNO+ '|' + #TOCNAME +'|'+ #TELNO +'|'+''+'|'+#AUTH_NO+'|' +#AUTH_TEL+'|';
	}
	writeline(@file, @line);
	closefile(@file);
	
}"
</USERFUN>

<!----验证柜员是否登录 -->
<FIRSTWORK>
"{
        initfd();
        commsend_001();
        $FD12='0000';
        $FD16='0910';
        callserver();
        if($FD12!='0000'){
                showmsg(geterror());
                msgbox('请注意：公务卡交易都需要柜员签到，才能正常交易','提示','ok|cancel');
                return(false);
        }
}"
</FIRSTWORK>
<!----验证柜员是否登录 -->

<VARIABLE>
<!-- 定义一些临时变量 -->

<ITEM NAME="#AUTH_NO"   TYPE="%-12s"  FUNCTIONS=""/><!--授权流水 add by xxt 20140308-->
<ITEM NAME="#AUTH_TEL"  TYPE="%-12s"  FUNCTIONS=""/><!-- 授权人 add by xxt 20140308-->

<ITEM NAME="#TELNO"     TYPE="%6s"     FUNCTIONS=""/>
<ITEM NAME="#HXNO"     TYPE="%6s"     FUNCTIONS=""/><!add by cyh 20140303>
<ITEM NAME="#TXTIME"    TYPE="%8s"     FUNCTIONS=""/>
<ITEM NAME="#P_MSR2"    TYPE="%37s"    FUNCTIONS=""/>
<ITEM NAME="#PRINTTYPE" TYPE="%-1s"    FUNCTIONS=""/>
<ITEM NAME="#CASHNO"    TYPE="%-25s"   FUNCTIONS=""/>
<ITEM NAME="#CASHNAME"  TYPE="%-51s"   FUNCTIONS=""/>
<ITEM NAME="#TOCNO"     TYPE="%-25s"   FUNCTIONS=""/>
<ITEM NAME="#TOCNAME"   TYPE="%-51s"   FUNCTIONS=""/>
<ITEM NAME="#CASTAMT"   TYPE="%-16s"   FUNCTIONS=""/>
<ITEM NAME="#LIMTAMT"   TYPE="%-20s"   FUNCTIONS=""/>
<ITEM NAME="#QTQRJB"    TYPE="%-600s"   FUNCTIONS=""/>
<ITEM LINE="3" COL="3"  NAME="#ITEM00" TYPE="%-52s" INPUT="LABEL"   FUNCTIONS="T(8849                          公务卡交易撤销)"/>
<ITEM LINE="4" COL="3"  NAME="#ITEM01" TYPE="%-74s" INPUT="LABEL"   FUNCTIONS="T(─────────────────────────────────────)"/>
 <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=8849)"/>
<ITEM LINE="6" COL="5"  NAME="#ITEM02" TYPE="%-12s" INPUT="LABEL"   FUNCTIONS="T(撤销类型:)"/>
<ITEM LINE="6" COL="15" NAME="#OPTION" TYPE="%-6s"  INPUT="SELECT"  FUNCTIONS="V(NB)T(010000)">
<SELECT>
	<OPTION VALUE="010000" TITLE="1.现金取款撤销"/>
	<OPTION VALUE="210000" TITLE="2.现金存款撤销"/>
	<OPTION VALUE="470000" TITLE="3.转入存款撤销"/>
	<OPTION VALUE="460000" TITLE="4.转出取款撤销"/>
	<OPTION VALUE="400000" TITLE="5.卡卡转帐撤销"/>
</SELECT>
<ONLOSTFOCUS>
"{
	if(#OPTION == '010000' or #OPTION == '210000' or #OPTION == '470000')
	{
		loadpage('DEFAULT');
	}
	else
	{
		loadpage('PAGE');
	}
}"
</ONLOSTFOCUS>
</ITEM>
<ITEM NAME="#OPTNAME"   TYPE="%-13s"   FUNCTIONS="S(#OPTION,#OPTION)"/>

<PAGE NAME="DEFAULT">
<ITEM LINE="8" COL="5"  NAME="#ITEM03" TYPE="%-10s" INPUT="LABEL" FUNCTIONS="T(公务卡号：)"/>
<ITEM LINE="8" COL="15" NAME="#CARDNO" TYPE="%-16s" INPUT="TEXT"  DEVICE="MSR"  FUNCTIONS="V(NB)m($MSR2,1,16)">
<ONLOSTFOCUS>
"{
	if(len(delspace($MSR2)) &lt; 34)
        {
               // showmsg('刷卡错误,请重试!');
               // return(false);
        }
	initfd();
	commsend_001();
	$FD16='3001';
	$FD60='CUPDATA';
	
	if(len(#CARDNO) != 16)
	{
		showmsg('卡号位数错误,请重试!');
		return(false);
	}
	$FD30=#CARDNO;
	$FD20='0';     //不检查密码
	$FD128='fix';
	$FD49='NOI';
	//callagn_credit();
	if($FD12!='0000')
	{
		showmsg(geterror());
		return(false);
	}
	$FD25 = substr($FD25, 0, len($FD25)-4); //去掉女士先生
	$FD25 = delspace($FD25);
	#UERNAME=$FD25;
	#REMAMT=$FD69+ltrim(comma(itoa(val($FD43,0.01),'%.2f')));
	#DOMAMT=comma(itoa(val($FD40,0.01),'%.2f'));
	#CASTAMT =delspace($FD43);
	#LIMTAMT =delspace($FD40);
	enable(#UERNAME,false);
	enable(#REMAMT,false);
	enable(#DOMAMT,false);
}"
</ONLOSTFOCUS>
</ITEM>
<ITEM LINE="10" COL="5"  NAME="#ITEM04" TYPE="%-10s" INPUT="LABEL" FUNCTIONS="T(交易金额：)"/>
<ITEM LINE="10" COL="15" NAME="#TXAMT" TYPE="%16.2f" INPUT="TEXT"  DEVICE="KEYBOARD" FUNCTIONS="V(0000000000000001,9999999999999999)">

</ITEM>
<ITEM  NAME="#XDEPAMT" TYPE="%-21s" FUNCTIONS="X(#TXAMT)"/>
<ITEM LINE="10" COL="45" NAME="#ITEM05"  TYPE="%-14s" INPUT="LABEL" FUNCTIONS="T(原平台流水号：)"/>
<ITEM LINE="10" COL="59" NAME="#OLDTRNO" TYPE="%12d"  INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="V(NB)">
<ONLOSTFOCUS>
"{
	//检查原始交易状态
	initfd();
	commsend_001();
	$FD60='CARD_EX';
	$FD61='credit_trace';
	$FD34='8849';//区分其它调用原平台流水查询的交易
	$FD30=#CARDNO;
	$FD58=itoa(val(#OLDTRNO),'%012.0f'); // 原平台流水
	$FD128='fix';
	//callagn_credit();
	if($FD12!='0000')
	{
		showmsg(geterror());
		return(false);
	}
	//保存转出帐号信息
	#CASHNO   = delspace($FD33);
	#CASHNAME = delspace($FD26); 
	//下面进行业务检查
	if(#OPTION != delspace($FD28))
	{
		//showmsg('所选撤销业务类型与原业务类型不相符,请注意! 原始：'+ delspace($FD28));
		showmsg('所选撤销业务类型与原业务类型不相符,请注意!');
		return(false);
	}
	if(#TXAMT != val(delspace($FD43)))
	{
		//showmsg('存款金额与原始交易金额不相符,请注意! 原始：'+ delspace($FD43));
		showmsg('存款金额与原始交易金额不相符,请注意!');
		return(false);
	}
	//add by uling 20140219  start
	if(delspace($FD66) == '2' )
	{
		showmsg('原始交易已经冲正或撤销! ');
		return(false);
	}
	//add by uling 20140219  end
	if(delspace($FD66) == '4' or delspace($FD66) == '3')
	{
		showmsg('原始交易已经确认或撤销! ');
		return(false);
	}
	if(delspace($FD66) != '0' or delspace($FD85) != '00' or delspace($FD84) != '0000')
	{
		showmsg('原始交易未成功,或为单边账,请注意! ');
		return(false);
	}
	
}"
</ONLOSTFOCUS>
</ITEM>
<ITEM LINE="12" COL="3"  NAME="#ITEM06"  TYPE="%-74s" INPUT="LABEL" FUNCTIONS="T(-------------------------------------------------------------------------------)"/>
<ITEM LINE="14" COL="5"  NAME="#ITEM07"  TYPE="%-10s" INPUT="LABEL" FUNCTIONS="T(客户姓名：)"/>
<ITEM LINE="14" COL="15" NAME="#UERNAME" TYPE="%-30s" DEVICE="KEYBOARD" FUNCTIONS="T()"/>
<ITEM LINE="16" COL="5"  NAME="#ITEM08"  TYPE="%-10s" INPUT="LABEL" FUNCTIONS="T(账面余额：)"/>
<ITEM LINE="16" COL="15" NAME="#REMAMT"  TYPE="%20s"  DEVICE="KEYBOARD" FUNCTIONS="T()"/>
<ITEM LINE="18" COL="5"  NAME="#ITEM09"  TYPE="%-14s" INPUT="LABEL" FUNCTIONS="T(当前可用额度：)"/>
<ITEM LINE="18" COL="19" NAME="#DOMAMT"  TYPE="%16s"  DEVICE="KEYBOARD"  FUNCTIONS="T()"/>
</PAGE>
<PAGE NAME="PAGE">
<ITEM LINE="8" COL="5"  TYPE="%-10s"     FUNCTIONS="T(转出卡号：)"/>
<ITEM LINE="8" COL="15" NAME="#P_CARDNO" TYPE="%-16s" DEVICE="MSR" INPUT="TEXT" FUNCTIONS="V(NB)m($MSR2,1,16)">
<ONLOSTFOCUS>
"{
	if(len(#P_CARDNO) != 16)
	{
		//showmsg('卡号位数错误,请重试!');
		//return(false);
	}

	//保存磁道信息
	#P_MSR2 = $MSR2;

	initfd();
	commsend_001();
	$FD16='3001';
	$FD60='CUPDATA';
	$FD30=#P_CARDNO;
	$FD20='0';  // 交易密码
	$FD128='fix';
	$FD49='NOI';
	//callagn_credit();
	if($FD12!='0000'){
		showmsg(geterror());
		return(false);
	}
	$FD25 = substr($FD25, 0, len($FD25)-4); //去掉女士先生
	$FD25 = delspace($FD25);
	#P_UERNAME=$FD25;
	#P_REMAMT=$FD69+ltrim(comma(itoa(val($FD43,0.01),'%.2f')));
	#P_DOMAMT=comma(itoa(val($FD40,0.01),'%.2f'));
	enable(#P_UERNAME,false);
	enable(#P_REMAMT,false);
	enable(#P_DOMAMT,false);
	
}"
</ONLOSTFOCUS>
</ITEM>

<ITEM LINE="10" COL="5"  TYPE="%-10s"      INPUT="LABEL" FUNCTIONS="T(交易金额：)"/>
<ITEM LINE="10" COL="15" NAME="#P_TXAMT"   TYPE="%16.2f" DEVICE="KEYBOARD" FUNCTIONS="V(0000000000000001,9999999999999999)"/>
<ITEM NAME="#P_XDEPAMT"  TYPE="%-21s"      FUNCTIONS="X(#P_TXAMT)"/>
<ITEM LINE="10" COL="45" TYPE="%-14s"      INPUT="LABEL" FUNCTIONS="T(原平台流水号：)"/>
<ITEM LINE="10" COL="59" NAME="#P_OLDTRNO" TYPE="%12d"   DEVICE="KEYBOARD" FUNCTIONS="T()V(NB)">
<ONLOSTFOCUS>
"{
	//检查原始交易状态
	initfd();
	commsend_001();
	$FD60='CARD_EX';
	$FD61='credit_trace';
	$FD30=#P_CARDNO;
	$FD58=itoa(val(#P_OLDTRNO),'%012.0f'); // 原平台流水
	$FD128='fix';
	//callagn_credit();
	if($FD12!='0000')
	{
		showmsg(geterror());
		return(false);
	}
	//保存转入方帐号信息
	#TOCNO   = delspace($FD38);
	#TOCNAME = delspace($FD26); 
	//下面进行业务检查
	if(#OPTION != delspace($FD28))
	{
		showmsg('所选撤销业务类型与原业务类型不相符,请注意! 原始：'+ delspace($FD28));
		return(false);
	}
	if(#P_TXAMT != val(delspace($FD43)))
	{
		showmsg('存款金额与原始交易金额不相符,请注意! 原始：'+ delspace($FD43));
		return(false);
	}
	//add by uling 20140219  start
	if(delspace($FD66) == '2' )
	{
		showmsg('原始交易已经冲正或撤销! ');
		return(false);
	}
	//add by uling 20140219  end
	if(delspace($FD66) == '4' or delspace($FD66) == '3')
	{
		showmsg('原始交易已经确认或撤销! ');
		return(false);
	}
	if(#OPTION == '400000')
	{
		if(delspace($FD66) != '0' or delspace($FD85) != '00' )
		{
			showmsg('原始交易未成功,或为单边账,请注意! ');
			return(false);
		}
	}else{
		if(delspace($FD66) != '0' or delspace($FD85) != '00' or delspace($FD84) != '0000')
		{
			showmsg('原始交易未成功,或为单边账,请注意! ');
			return(false);
		}
	}

}"
</ONLOSTFOCUS>
</ITEM>
<ITEM LINE="12" COL="3"  TYPE="%-74s"      INPUT="LABEL" FUNCTIONS="T(------------------------------------------------------------------------------)"/>	
<ITEM LINE="14" COL="5"  TYPE="%-14s"      INPUT="LABEL" FUNCTIONS="T(客 户  姓 名：)"/>
<ITEM LINE="14" COL="19" NAME="#P_UERNAME" TYPE="%-30s"  DEVICE="KEYBOARD" FUNCTIONS="T()"/>
<ITEM LINE="16" COL="5"  TYPE="%-14s"      INPUT="LABEL" FUNCTIONS="T(账 面  余 额：)"/>
<ITEM LINE="16" COL="19" NAME="#P_REMAMT"  TYPE="%20s"   DEVICE="KEYBOARD" FUNCTIONS="T()"/>
<ITEM LINE="18" COL="5"  TYPE="%-14s"      INPUT="LABEL" FUNCTIONS="T(当前可用额度：)"/>
<ITEM LINE="18" COL="19" NAME="#P_DOMAMT"  TYPE="%20s"   DEVICE="KEYBOARD"  FUNCTIONS="T()"/>
</PAGE>
<ITEM LINE="20" COL="62" NAME="#ITEM013" TYPE="%-5s" INPUT="BUTTON" FUNCTIONS="T(确 定)">
<ONCLICK>
"{
	//----验证柜员是否登录 -----------------------------
		initfd();
		commsend_001();
		$FD12='0000';
		$FD16='0910';
		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			msgbox('请注意：公务卡交易都需要柜员签到，才能正常交易','提示','ok|cancel');
			return(false);
		}
	//----验证柜员是否登录 -----------------------------

                //增加授权 add by uling 20140306
                if(creditauthcheck())
                {
                        showmsg('授权处理完成，请继续!');
			#AUTH_NO=$FD52;    // add by xxt 20140308
			#AUTH_TEL=$FD28;   // add by xxt 20140308
                }else
                {
                        return (false);
                }
                //增加授权 add by uling 20140306

	//卡卡转账撤消不过核心，调用核心7201交易获取柜员流水  START
	//if(#OPTION == '400000')
	//{
	//	initfd();
	//	commsend_001();
	//	$FD16='7201';
	//	$FD38=#P_CARDNO;
	//	$FD81='公务卡 卡转账撤消';  
	//	$FD40='0.00';
	//	callserver();
	//	if('0000' != $FD12)
	//	{
	//		showmsg('获取柜员流水失败');
	//		return(false);
	//	}
		//#TELNO = substr($FD126,2,6);  modfiy by cyh 20140303
	//	#HXNO = $FD4;
	//}
	//  END

	initfd();
	commsend_001();
	$FD30=#CARDNO;
	$FD60='CUPDATA';
	$FD58=itoa(val(#OLDTRNO),'%012.0f');  //原平台流水
	$FD40=itoa(#TXAMT*100,'%012.0f');
	$FD23='011';
	if(len(delspace($MSR2)) &gt; 1)
	{
		$FD75=$MSR2;
		$FD76=$MSR3;
		if(len(delspace($MSR2)) &lt; 35)
		{
			$FD23='021';
		}
		else
		{
			$FD23='051';
		}
	}
	if(#OPTION == '210000')       //现金存款撤销
	{
		$FD16='d002';
		#PRINTTYPE = '0';//打印格式1
	}	
	else if(#OPTION == '010000')  //现金取款撤销
	{
		$FD16='d013';
		#PRINTTYPE = '0';//打印格式1
	}
	else if(#OPTION == '470000')  //转入存款撤销
	{
		$FD16='d010';
		#PRINTTYPE = '1';//打印格式2
		$FD75=''; //银联数据要求不能上传二磁，否则报30报文格式错误
	}
	else if(#OPTION == '460000')  //转出取款撤销
	{
		initfd();
		commsend_001();
		$FD16='d009';
		$FD60='CUPDATA';
		$FD30=#P_CARDNO;
		$FD20='0';        // 密码类型
		//$FD79=#P_PWD;		
		$FD58=itoa(val(#P_OLDTRNO),'%012.0f'); // 原平台流水
		$FD40=itoa(#P_TXAMT*100,'%012.0f');
		$FD23='022';	
                if(len(delspace($MSR2)) &gt; 1)
                {
                        $FD75=$MSR2;
                        $FD76=$MSR3;
                        if(len(delspace($MSR2)) &lt; 35)
                        {
                                $FD23='022';
                        }
                        else
                        {
                                $FD23='052';
                        }
                }
		#PRINTTYPE = '2';//打印格式3
	}
	else if(#OPTION == '400000')  //卡卡转帐撤销
	{
		initfd();
		commsend_001();
		$FD16='d005';
		$FD60='CUPDATA';
		$FD30=#P_CARDNO;
		$FD20='0';        //密码类型
		//$FD79= #P_PWD;
		$FD58=itoa(val(#P_OLDTRNO),'%012.0f'); //原平台流水
		$FD40=itoa(#P_TXAMT*100,'%012.0f');
		$FD23='022';
                if(len(delspace($MSR2)) &gt; 1)
                {
                        $FD75=delspace($MSR2);
                        $FD76=delspace($MSR3);
                        if(len(delspace($MSR2)) &lt; 35)
                        {
                                $FD23='022';
                        }
                        else
                        {
                                $FD23='052';
                        }
                }
		#PRINTTYPE = '2';打印格式3
	}
	//callagn_credit();
	if($FD12!='0000')
	{
		showmsg(geterror());
		return(false);
	}
	//由于现金取款撤销交易银联不返回54域，需要自己处理金额
	if(#OPTION == '010000') 
	{
		//$FD42 = itoa((val(#CASTAMT)+ #TXAMT*100),'%016.0f');MODIFY BY ZHGF 20130528
		$FD42 = itoa((val(#CASTAMT)- #TXAMT*100),'%016.0f');
		$FD43 = itoa((val(#LIMTAMT)+ #TXAMT*100),'%016.0f');
	}

	runoutput();
	//ADD BY CYH 20140303
	if(#OPTION == '400000')
	{
		$FD4 = #HXNO;
	}
	
	saveprint();
	rerun();
}"
</ONCLICK>
</ITEM>
</VARIABLE>
<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="按任意键继续" CHECK="#PRINTTYPE=0">
NOTHING
</PACKAGE>
<PRINT>
"{
	print( 3,20,'公务卡[13]成功',delspace(#OPTNAME));
	print( 5,15,'卡    号:[20]',#CARDNO);
	print( 6,15,'户    名:[30]',#UERNAME);
	print( 7,15,'交易金额:[21]',#XDEPAMT);
	print( 8,15,'账面余额:[21]',ltrim(comma(itoa(val($FD42,0.01),'%.2f'))));
	print( 9,15,'可用额度:[21]',ltrim(comma(itoa(val($FD43,0.01),'%.2f'))));
	print(10,15,'平台流水号:[12]',$FD52);
	print(11,15,'原平台流水号:[12]',#OLDTRNO);
}"
</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="按任意键继续" CHECK="#PRINTTYPE=2">
NOTHING
</PACKAGE>
<PRINT>
"{
	print( 3,20,'公务卡[13]成功',delspace(#OPTNAME));
	print(5,15,'转出卡号:[20]',#P_CARDNO);
	print(6,15,'转出户名:[30]',#P_UERNAME);
	print(7,15,'转入卡号:[20]',#TOCNO);
	print(8,15,'转入户名:[30]',#TOCNAME);
	print(9,15,'交易金额:[21]',#P_XDEPAMT);
	print(10,15,'转出卡账面余额:[21]',ltrim(comma(itoa(val($FD42,0.01),'%.2f'))));
	print(11,15,'转出卡可用额度:[21]',ltrim(comma(itoa(val($FD43,0.01),'%.2f'))));
	print(12,15,'平台流水号: [12]',$FD52);
	print(13,15,'原平台流水号:[12]',#P_OLDTRNO);
}"
</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="按任意键继续" CHECK="#PRINTTYPE=1">
	NOTHING
</PACKAGE>
<PRINT>
"{
	print(3,20,'公务卡[13]成功',delspace(#OPTNAME));
	print(5,15,'转入卡号: [20]',#CARDNO);
	print(6,15,'转入户名: [30]',#UERNAME);
	print(7,15,'转出卡号: [20]',#CASHNO);
	print(8,15,'转出户名: [30]',#CASHNAME);
	print(9,15,'交易金额: [21]',#XDEPAMT);
	print(10,15,'转入卡账面余额: [21]',ltrim(comma(itoa(val($FD42,0.01),'%.2f'))));
	print(11,15,'转入卡可用额度: [21]',ltrim(comma(itoa(val($FD43,0.01),'%.2f'))));
	print(12,15,'平台流水号: [12]',$FD52);
	print(13,15,'原平台流水号: [12]',#OLDTRNO);
}"
</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER" DESC="请打印公务卡业务申请表" CHECK="#PRINTTYPE=0">
NOTHING
</PACKAGE>
<PRINT>
"{
	dim @txname as string;
	dim @tx_type as string;
	if(#OPTION == '210000')       //现金存款撤销
	{
		@tx_type='现金存款撤销';
	}	
	else if(#OPTION == '010000')  //现金取款撤销
	{
		@tx_type='现金取款撤销';
	}
	@txname='公务卡交易撤销';
    #TXTIME=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
   
	print( 34,14,'交易代码:[20]','8849');
	print( 34,2, '交易名称:[16]',@txname);
	print( 34,8,'交易类型:[20]',@tx_type);
	
	print( 35,14,'交易机构:[20]',$KINBR);
	print( 35,2, '机构名称:[20]',$BRNAME);

	print( 36,14,'卡    号:[20]',#CARDNO);
	print( 36,2, '户    名:[20]',#UERNAME);
	
	print(37,14,'交易金额:[20]',ltrim(#XDEPAMT));
	print(37,2, '账面余额:[16]',ltrim(comma(itoa(val($FD42,0.01),'%.2f'))));
	print(37,8, '可用额度:[20]',ltrim(comma(itoa(val($FD43,0.01),'%.2f'))));	
	print(38,14,'平台流水:[20]',$FD52);
	print(38,2, '原平台流水:[18]',$FD58);

	if(delspace(#AUTH_NO) != '')
	{
		print(lineno()+1,14,'授权流水号:[7] 授权人:[4]',#AUTH_NO,#AUTH_TEL);    //moidfy by xxt 20140308
	}
	print(42,36,' [8]  [8]      柜员号:[10]',$HDATE,#TXTIME,$TLRNO);
}"
</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER" DESC="请打印公务卡业务申请表" CHECK="#PRINTTYPE=1">
NOTHING
</PACKAGE>
<PRINT>
"{

	dim @txname as string;
	dim @tx_type as string;

	@tx_type='转入存款撤销';
	@txname='公务卡交易撤销';
    #TXTIME=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
   
	print( 34,14,'交易代码:[20]','8849');
	print( 34,2, '交易名称:[16]',@txname);
	print(34,8, '交易类型:[20]',@tx_type);
	
	print( 35,14,'交易机构:[20]',$KINBR);
	print( 35,2, '机构名称:[20]',$BRNAME);

	print( 36,14,'公务卡号:[20]',#CARDNO);
	print( 36,2, '户    名:[20]',#UERNAME);
	print( 37,14,'转出卡号:[20]',#CASHNO);
	print( 37,2, '转出户名:[20]',#CASHNAME);
	
	print(38,14,'交易金额:[20]',ltrim(#XDEPAMT));
	print(38,2 ,'账面余额:[16]',ltrim(comma(itoa(val($FD42,0.01),'%.2f'))));
	print(38,8,'可用额度:[20]',ltrim(comma(itoa(val($FD43,0.01),'%.2f'))));


	print(39,14,'平台流水:[20]',$FD52);

	print(39,2,'原平台流水:[18]',$FD58);

	if(delspace(#AUTH_NO) != '')
	{
		print(lineno()+1,14,'授权流水号:[7] 授权人:[4]',#AUTH_NO,#AUTH_TEL);    //moidfy by xxt 20140308
	}
	print(42,36,' [8]  [8]      柜员号:[10]',$HDATE,#TXTIME,$TLRNO);
}"
</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER" DESC="请打印公务卡业务申请表" CHECK="#PRINTTYPE=2">
	NOTHING
</PACKAGE>
<PRINT>
"{
	dim @txname as string;
	dim @tx_type as string;
	if(#OPTION == '460000')  //转出取款撤销
	{
		@tx_type='转出取款撤销';
	}
	else if(#OPTION == '400000')  //卡卡转帐撤销
	{
		@tx_type='卡卡转帐撤销';
	}
	@txname='公务卡交易撤销';
    #TXTIME=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
   
	print( 34,14,'交易代码:[20]','8849');
	print( 34,2, '交易名称:[20]',@txname);
	print(34,3, '交易类型:[16]',@tx_type);
	
	print( 35,14,'交易机构:[20]',$KINBR);
	print( 35,2, '机构名称:[20]',$BRNAME);

	print( 36,14,'转出卡号:[20]',#P_CARDNO);
	print( 36,2, '转出户名:[20]',#P_UERNAME);

	print( 37,14,'转入卡号:[20]',#TOCNO);
	print( 37,2, '转入户名:[20]',#TOCNAME);

	print(38,14,'交易金额:[20]',ltrim(#P_XDEPAMT));
	print(38,2 ,'转出卡账面余额:[16]',ltrim(comma(itoa(val($FD42,0.01),'%.2f'))));

	print(38,1,'转出卡可用额度:[24]',ltrim(comma(itoa(val($FD43,0.01),'%.2f'))));

	if(#OPTION == '400000'){
		print(39,14,'平台流水:[20]',$FD52);
	}	
	else if(#OPTION == '460000')
	{
		print(39,14,'平台流水:[20]',$FD52);
	}
	print(39,2, '原平台流水:[18]',$FD58);
	if(delspace(#AUTH_NO) != '')
	{
		print(lineno()+1,14,'授权流水号:[7] 授权人:[4]',#AUTH_NO,#AUTH_TEL);    //moidfy by xxt 20140308
	}
	print(42,36,' [8]  [8]      柜员号:[10]',$HDATE,#TXTIME,$TLRNO);	
}"
</PRINT>
</RESPONSE>
</TRANSACTION>
