<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="00110000" TITLE="6504 债券投资出售兑付记账 "
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
  <COMMSEND>"{
  		$TXNO='4604';
  		commsend_001();
//		$FD39=#
	}"
</COMMSEND>
<COMMRECV>"{
	
}"
</COMMRECV>
<FIRSTWORK>"{
	//dim @txno_bak as string;
	//dim @tota as string;
	//@txno_bak=$TXNO;
	//$TXNO='9885';
	//commsend_001();
	//@tota=callserver();
	//showmsg(@tota);	
	//setsel(#PZZL,@tota,'o5t20o1v3o2');
	//$FD11='';
}"
</FIRSTWORK>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-60s" FUNCTIONS=
    "T(6504                       债券投资出售兑付记账  )"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
   <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=4601)"/>
   <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
   <!--输入变量-->
  <ITEM LINE="7"   COL="5" TYPE="%-14s" FUNCTIONS="T(投资协议编号:)"/>
  <ITEM LINE="7"  COL="45" TYPE="%-14s" FUNCTIONS="T(出售债券类型:)"/>
  <ITEM LINE="8"  COL="5"  TYPE="%-14s" FUNCTIONS="T(买入债券品种: )"/>
 
<!--  <ITEM LINE="8"   COL="5" TYPE="%-10s" FUNCTIONS="T(投资账号:)"/>
  <ITEM LINE="9"   COL="5" TYPE="%-14s" FUNCTIONS="T(账号户名:)"/>
-->
  
  <ITEM LINE="10"   COL="5" TYPE="%-10s" FUNCTIONS="T(现转标志:)"/>
<!--  <ITEM LINE="10"   COL="36" TYPE="%-14s" FUNCTIONS="T(转账类型)"/> -->
 
   <ITEM LINE="11"   COL="5" TYPE="%-10s" FUNCTIONS="T(借方帐号:)"/>
  <ITEM LINE="12"   COL="5" TYPE="%-10s" FUNCTIONS="T(借方户名:)"/>

  <ITEM LINE="16"   COL="5" TYPE="%-10s" FUNCTIONS="T(卖 出 价:)"/>
  <ITEM LINE="16"   COL="40" TYPE="%-14s" FUNCTIONS="T(票 面 价:)"/>

  <ITEM LINE="17"   COL="5"  TYPE="%-12s" FUNCTIONS="T(未收回利息:)"/>
  <!--ITEM LINE="17"   COL="36" TYPE="%-14s" FUNCTIONS="T(买入成本价:)"/-->
  <ITEM LINE="18"   COL="5"  TYPE="%-14s" FUNCTIONS="T(未摊销溢价:)"/>
  <ITEM LINE="18"   COL="40" TYPE="%-12s" FUNCTIONS="T(未摊销折价:)"/>
  <ITEM LINE="19"   COL="5"  TYPE="%-10s" FUNCTIONS="T(轧差金额:)"/>

  <ITEM NAME="#XYBH" 	INPUT="TEXT" LINE="7" COL="19" TYPE="%-15s" 	FUNCTIONS="T()V(NB)">
   <ONLOSTFOCUS>
  "{
  	$FD58=#XYBH;
		commsend_001();
		$FD16='9825';
		callserver();
		if($FD12!='0000')
		{
			showmsg(geterror());
			return(false);
		}
		#PMJ = val($FD40, 0.01);
		#CPBH=$FD23; //产品编号 
		#ZQPZ=$FD86; //投资债券品种
		
		enable(#ZQPZ,false);
		enable(#PMJ, false);
  }"
	</ONLOSTFOCUS>
     </ITEM>
     <ITEM NAME="#CPBH" TYPE="%-3s" 	FUNCTIONS=""/>
     
     <ITEM NAME="#ZQLX" INPUT="SELECT" LINE="7"  COL="59" TYPE="%-1s" 	FUNCTIONS="T(1)V(1|2)">
  	<SELECT>
  		<OPTION VALUE="1" TITLE="0.短期债券 "/>
  		<OPTION VALUE="2" TITLE="0.中长期债券 "/>

  	</SELECT>
	<ONLOSTFOCUS>
	"{
			enable(#YJLX, true);
			enable(#ZJJE, true);
			enable(#YJJE, true);

		if('1' == #ZQLX){
			enable(#YJLX, false);
			enable(#ZJJE, false);
			enable(#YJJE, false);
		}
	}"
	</ONLOSTFOCUS>
	</ITEM>
	<ITEM NAME="#ZQPZ" 	INPUT="TEXT" LINE="8" COL="19" TYPE="%-10s" 	FUNCTIONS="V(NB)"/>
<!--
<ITEM NAME="#TZZH"	 LINE="8" COL="15" TYPE="%-24s" INPUT="TEXT"	FUNCTIONS="T()V(NB)">
<ONLOSTFOCUS>
"{
				dim @txno as string;

$FD31=#TZZH;

		@txno=$TXNO;
		$TXNO='9827';
		commsend_001();
		$TXNO=@txno;
		callserver();
		#ZHHM=$FD25;
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
			}
		enable(#ZHHM, false);

}"
</ONLOSTFOCUS>
</ITEM>
<ITEM NAME="#ZHHM"	 LINE="9" COL="15" TYPE="%-48s" INPUT="TEXT"    FUNCTIONS="T()V(NB)"/>
-->
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>


 
   <ITEM NAME="#XZBZ" INPUT="SELECT" LINE="10"  COL="15" TYPE="%-1s" 	FUNCTIONS="T(2)V(2)">
  	<SELECT>
  		<OPTION VALUE="2" TITLE="0.转账 "/>

  	</SELECT>
	</ITEM>

   <ITEM NAME="#ZZLX"  TYPE="%-1s" 	FUNCTIONS=""/>
   <ITEM NAME="#DFZH"	 LINE="11" COL="15" TYPE="%-24s" INPUT="TEXT"	FUNCTIONS="V(NB)">
	<ONLOSTFOCUS>
	"{
					dim @txno as string;

		$FD30=#DFZH;
		@txno=$TXNO;
		$TXNO='9812';
		commsend_001();
		$TXNO=@txno;
		callserver();
		#DFHM=$FD27;
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
	}"
	</ONLOSTFOCUS>
	</ITEM>
	<ITEM NAME="#DFHM"  LINE="12" COL="15" TYPE="%-50s" DEVICE="KEYBROD"  FUNCTIONS=""/>

  <ITEM NAME="#MCJ"	 LINE="16" COL="16" TYPE="%16.2f"  INPUT="TEXT"	FUNCTIONS="T()V(NB)"/>
  <ITEM NAME="#PMJ"	 LINE="16" COL="51" TYPE="%16.2f" INPUT="TEXT"	FUNCTIONS="T()V(NB)">

  </ITEM>
 
  <ITEM NAME="#YJLX"	 LINE="17" COL="16" TYPE="%16.2f" INPUT="TEXT"	FUNCTIONS="T()V(NB)">
  <ONLOSTFOCUS>
  "{
//	#ZJJE=#YJLX+#ZJJE;
//	enable(#ZJJE, false);
  }"
  </ONLOSTFOCUS>
  </ITEM>
<!--  <ITEM NAME="#CBJ" TYPE="%16.2f" FUNCTIONS=""/> -->

  <ITEM NAME="#YJJE"	 LINE="18" COL="16" TYPE="%16.2f" INPUT="TEXT"	FUNCTIONS="V(NB)"/>
   <ITEM NAME="#ZJJE"	 LINE="18" COL="51" TYPE="%16.2f" INPUT="TEXT"	FUNCTIONS="V(NB)"/>
   <ITEM NAME="#FDD" TYPE="%-1s">
  <ONLOSTFOCUS>
   "{
		if(#YJJE &gt; 0 and	 #ZJJE &gt; 0){
			showmsg('折价、溢价金额不能都大于零');
			return(false);
		}
		if('1' == #ZQLX){

			#ZCJE=#MCJ-#PMJ;
		}else{
			if('2' == #ZQLX){

				#ZCJE = #MCJ-#PMJ-#YJLX-#YJJE+#ZJJE;
			}
		}
		if(#ZCJE &lt; 0){
			showmsg('扎差金额小于零...');
			return(false);
		}
		enable(#ZCJE, false);
   }"
   </ONLOSTFOCUS>
   </ITEM>
     <ITEM NAME="#ZCJE"	 LINE="19" COL="16" TYPE="%16.2f" INPUT="TEXT"	FUNCTIONS="T()V(NB)"/>

  <ITEM NAME="#FD" TYPE="%-1s">
  <ONLOSTFOCUS>
  "{
//		$FD25=#ZHHM;

		$FD27=#DFHM;
		$FD30=#DFZH;

		$FD39=itoa(#MCJ*100, '%016.0f');
		$FD40=itoa(#PMJ*100, '%016.0f');
		$FD41=itoa(#YJLX*100, '%016.0f');
		$FD42=itoa(#YJJE*100, '%016.0f');
		$FD43=itoa(#ZJJE*100, '%016.0f');
		//$FD44=#LZRQ;
                //$FD45=#LZLS;

		$FD58=#XYBH;
		if(#CPBH=='931')
		{
       $FD64='51401';    //国债利息收入
		}
		else if(#CPBH!='931')
		{
       $FD64='51402';    //其他债券利息收入
		}
		$FD69=#XZBZ;
		$FD70=#ZZLX;

		$FD67=#ZQLX;
		$TXNO='4604';
	//	$FD100=itoa(#ZCJE*100, '%016.0f')+itoa(#YJLX*100, '%016.0f');   //+itoa(#YJLX*100, '%016.0f');
	$FD100=itoa(#ZCJE*100, '%016.0f');
  }"
  </ONLOSTFOCUS>
  </ITEM>


  <ITEM NAME="#SUBMIT" LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
    </VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="交易成功!">
NOTHING
</PACKAGE>
<PRINT>"{
	 print( 5, 30,'债券投资出售兑付记账');
	 print( 7, 20,'流水号:  [6]', $FD4);
	 print( 8, 20,'投资协议编号:[15]',#XYBH);
//	 print(11, 20,'利息金额:[16]',#LXJE);
 }"
</PRINT>
</RESPONSE>

<RESPONSE>
<PACKAGE DEVICE="PRINTER" DESC="打印业务专用凭证" LINESPACE="24">
NOTHING
</PACKAGE>
<PRINT>
"{
$KINDNO='00';
 dim @txtime  as string;
@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
print( 5, 20,'机构名称:[30]',$BRNAME);  
print( 5, 2,'代码:6504');
print( 5, 13,'交易:债券投资出售兑付记账');

print(07,15,'投资协议编号[15     ]',#XYBH);
printacdtl_1();

print( 24,20,'备注:');
print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
print( 24,5,'柜员:[4]',$FD7);
print( 24,5,'流水号:[6]',$FD4);
}"
</PRINT>
</RESPONSE>
<OUTPUT>

</OUTPUT>
</TRANSACTION>
   
   
   
   
    
   
  
