<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11000000" TITLE="3711 IC¿¨²¹»»¿¨"
	xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>
	"{
		//ÓëÉñÂëÍ¨Ñ¶ Begin by hxc
		dim @filename as string;
		dim @update as string;
		//dim @number as numner;
		@filename='../tmp/'+$FD7+$FD10+'.fds';
		if(substr(#OACTNO,0,6)=='621780' and len(#OACTNO)==19)
		{
			dim @icdata as string;
			savefds(@filename);
			initfd();
			commsend_001();
			$FD16='7110';//IC²¹»»¿¨
			$FD30=#OACTNO;
			$FD31=#NACTNO;
			$FD80=#NEW_PASSWORD;
			$FD67=#INSTEAD_REASON;
			if(#INSTEAD_REASON=='2')
			{
				$FD60=#LOST_NO;						//¹ÒÊ§±àºÅ
			}
			if(#INSTEAD_REASON=='0')
			{
				$FD39=itoa(val(#AVAIL_BAL,100),'%016.2f');  // Ô­¿¨µç×ÓÏÖ½ðÓà¶î
			}
			//showmsg('$FD39='+$FD39);
			//showmsg('#INSTEAD_REASON = ['+#INSTEAD_REASON+']');
			$FD75=#MSR2BAK;
			$FD76=#MSR3BAK;
			@icdata = initiccard();
			if(strfld(@icdata,'|',0)!='9000')
				{
					showmsg('º¯ÊýIniticcard·µ»ØÖµÓÐÎó!');
					return(false);
				}
			#IC_ATC = strfld(@icdata,'|',2);
			#IC_AC = strfld(@icdata,'|',3);
			#CARD_SEQ_ID=strfld(@icdata,'|',4);
			$FD65=#IC_ATC;//Ó¦ÓÃ½»Ò×¼ÆÊýÆ÷
			$FD61=#IC_AC;//Ó¦ÓÃÃÜÎÄ
			$FD23=#CARD_SEQ_ID;//IC¿¨ÐòÁÐºÅ
			//showmsg('Ó¦ÓÃ¼ÆÊýÆ÷#IC_ATC='+#IC_ATC);
			//showmsg('Ó¦ÓÃÃÜÎÄ#IC_AC='+#IC_AC);
			//showmsg('IC¿¨ÐòÁÐºÅ#CARD_SEQ_ID='+#CARD_SEQ_ID);
			if (isTxContinue() == false)
			{
				return(false);
			}
			callagn();
			if($FD12!='0000')
			{
				showmsg(geterror());
				return(false);
			}
			//showmsg('IC²¹»»¿¨·¢ÍùÉñÂëÕýÈ·´¦Àí½áÊø,½«ÒªÐ´½Å±¾');
			//@update=updateiccard('04DA9F790a0000000850006F94ABF1,04DC010C42703C9F61123635333132323139383630373135343431349F62010057136217800109002658D30122200004400284000F5F200848414E204348414F9F1F00260D27E7');
			#CARD_TRACENO=delspace(itoa(val($FD43),'%16d'));
			//showmsg('½Å±¾Îª'+$FD108);
			@update=updateiccard($FD108);
			//@update='9000'; 
			
			if(((@update !='9000') and(#INSTEAD_REASON=='2' or #INSTEAD_REASON=='1')) or (#INSTEAD_REASON=='0' and @update !='9000|9000' ))
			{
				showmsg('¿¨Êý¾Ý¸üÐÂÊ§°Ü@update='+@update);
				initfd();
				commsend_001();
				$FD16='7777';
				$FD12=#RESP_CODE;
				$FD30=#OACTNO;
				$FD43=#CARD_TRACENO;
				//showmsg('$FD43='+$FD43);
				callagn();
				if($FD12!='0000')
				{
					showmsg(geterror());
					return (false);
				}
				//#RESP_CODE=$FD12;
				return(false);
			}
			//$FD12='0000';
			//#RESP_CODE=$FD12;
			#COST_FEE = val($FD41);
			#TRAN_FEE = val($FD40);
			#COST_FEE1 = val($FD41,0.01);
			#TRAN_FEE1 = val($FD40,0.01);
			loadfds(@filename);
			initfd();
			//add by luolz 20091101 Ôö¼Ó¿ª¿¨ÊÕÊÖÐø·ÑÄ£¿é begin
			//ÔÝÊ±YEAR_FEE,COST_FEE,TRAN_FEE ¸³³õÖµ
			//#COST_FEE = 800;
			//#TRAN_FEE = 0;
			//#COST_FEE1 = 8.00;
			//#TRAN_FEE1 = 0.00;
			$FD31=#NACTNO;
			$FD40 = itoa(#COST_FEE,'%16.0f');
			$FD41 = itoa(#TRAN_FEE,'%16.0f');
			call_9986_card();
			setitems('#FEETLRNO#FEE_PWD#FEEFLAG',$FD9);  //µÃµ½ÊÕ·Ñ±êÖ¾
			//showmsg('#FEEFLAG = ['+#FEEFLAG+']');
			if(#FEEFLAG != '3' and #FEEFLAG != '' and substr(#OACTNO,0,6)=='621780' ) //·ÑÓÃÎª0Ê±,#FEEFLAGÎª¿Õ
			{
				#FEEFLAG1 = '0';
			}
			else
			{
				#FEEFLAG1 = '1';
			}
		}
		//add by luolz 20091101 Ôö¼Ó¿ª¿¨ÊÕÊÖÐø·ÑÄ£¿é end
		//ÓëÉñÂëÍ¨Ñ¶ End by hxc
		//return(false);//test test test test test
		//showmsg('¿ªÊ¼2410£¡');
		initfd();
		commsend_001();
		$TXNO='2410';
		$FD16='2410';
		$FD14='00000000';
		$FD30=#OACTNO;
		$FD31=#NACTNO;
		$FD59=#NVOCNUM;
		$FD67=#TXTP;
		//#PASSWD=#NEW_PASSWORD;
		$FD114=space(1)+#PASS+space(6)+#PASSWD+#CERT+getitems('#CERTNO')+space(1)+#ZJLX+space(2);
		//$FD114=space(1)+'N'+space(6)+getitems('#PASSWD')+getitems('#CERT')+getitems('#CERTNO')+space(1)+#ZJLX+space(2);
		}"
</COMMSEND>
<COMMRECV>
	"{
		commrecv_001();
		$PBLINE='05';
		$KINDNO='02';
		//showmsg('$FD12='+$FD12);
		//showmsg('#OACTNO='+#OACTNO);
		if(($FD12!='0000') and ($FD12!='Z003') and (substr(#OACTNO,0,6)=='621223' or substr(#OACTNO,0,6)=='621780'))//¿¨½»Ò×ºËÐÄ´¦ÀíÊ§°ÜÍùÊýÂë·¢ËÍÈ¡Ïû½»Ò×
		{
			#RESP_CODE=$FD12;
			showmsg(geterror());
			initfd();
			commsend_001();
			$FD16='7777';
			$FD12=#RESP_CODE;
			$FD30=#OACTNO;
			$FD43=#CARD_TRACENO;
			//showmsg('$FD43='+$FD43);
			callagn();
			if($FD12!='0000')
			{
				showmsg(geterror());
				return (false);
			}
			showmsg('IC¿¨²¹»»¿¨Ê§°Ü!!...');
			rerun();
		}
		//showmsg('haha³É¹¦!');
	}"
</COMMRECV>
<FIRSTWORK>
"{
	#PIC='';
	#PIC1='';
}"
</FIRSTWORK>
<VARIABLE>
	<ITEM LINE="3"  COL="3" TYPE="%-60s" FUNCTIONS=
		"T(3711                            IC¿¨²¹»»¿¨)"/>
	<ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
		"T(©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©¤©)"/>
	<ITEM LINE="7"  COL="09"   TYPE="%-12s"   FUNCTIONS="T(¸ü»»·½Ê½:!)"/>
	<ITEM LINE="9"  COL="09"   TYPE="%-12s"   FUNCTIONS="T(Ô­ÕË¿¨ºÅ:)"/>
	<ITEM LINE="9"  COL="45"   TYPE="%-12s"   FUNCTIONS="T(Ô­Æ¾Ö¤ºÅ:)"/>
	<ITEM LINE="10" COL="09"   TYPE="%-12s"   FUNCTIONS="T(»§    Ãû:)"/>
	<ITEM LINE="11" COL="09"   TYPE="%-12s"   FUNCTIONS="T(¸ü»»Ô­Òò:)"  NAME="#GHYY" VISABLE="FALSE"  INPUT="LABEL"/>
	<ITEM LINE="11" COL="45"   TYPE="%-12s"   FUNCTIONS="T(¹ÒÊ§±àºÅ:)"  NAME="#GSBH" VISABLE="FALSE"  INPUT="LABEL"/>
	<ITEM LINE="12" COL="09"   TYPE="%-12s"   FUNCTIONS="T(ÃÜÂëÖ§È¡:!)"/>
	<ITEM LINE="12" COL="45"   TYPE="%-12s"   FUNCTIONS="T(Ö§È¡ÃÜÂë:)"  NAME="#ZQMM" VISABLE="FALSE"  INPUT="LABEL"/>
	<ITEM LINE="13" COL="09"   TYPE="%-12s"   FUNCTIONS="T(Ö¤¼þÖ§È¡:!)"/>
	<ITEM LINE="14" COL="09"   TYPE="%-10s"   FUNCTIONS="T(ÕÕ    Æ¬:)"/>
	<ITEM LINE="14" COL="45"   TYPE="%-10s"   FUNCTIONS="T(Ó¡    ¼þ:)"/>
	<ITEM LINE="15" COL="09"   TYPE="%-12s"   FUNCTIONS="T(Ö¤¼þÀàÐÍ:!)" NAME="#LZJLX" VISABLE="FALSE" INPUT="LABEL"/>
	<ITEM LINE="15" COL="45"   TYPE="%-12s"   FUNCTIONS="T(Ö¤¼þºÅÂë:)"  NAME="#ZJHM"  VISABLE="FALSE" INPUT="LABEL"/>
	<ITEM LINE="16" COL="08"   TYPE="%-18s"   FUNCTIONS="T(¡¾ÐÂ½éÖÊÐÅÏ¢À¸¡¿)"/>
	<ITEM LINE="17" COL="09"   TYPE="%-60s"   FUNCTIONS="T(------------------------------------------------------------------)"/>
	<ITEM LINE="19" COL="09"   TYPE="%-12s"   FUNCTIONS="T(ÐÂÕË¿¨ºÅ:)"/>
	<ITEM LINE="19" COL="45"   TYPE="%-12s"   FUNCTIONS="T(ÐÂÆ¾Ö¤ºÅ:)"/>
	<ITEM LINE="20" COL="09"   TYPE="%-12s"   FUNCTIONS="T(ÐÂ ÃÜ Âë:)"  NAME="#NEW_MM" VISABLE="FALSE" INPUT="LABEL"/>
	<ITEM NAME="#MSR2BAK"      TYPE="%-37s"   FUNCTIONS=""/>
	<ITEM NAME="#MSR3BAK"      TYPE="%-104s"  FUNCTIONS=""/>
	<ITEM NAME="#ACTNO"        TYPE="%-104s"  FUNCTIONS=""/>
	<ITEM NAME="#TEMPCERTNO"   TYPE="%-20s"   FUNCTIONS=""/>
	<ITEM NAME="#CARD_TRACENO" TYPE="%-16s"   FUNCTIONS=""/>
	<ITEM NAME="#RESP_CODE"    TYPE="%-4s"    FUNCTIONS=""/>
	<ITEM NAME="#IC_ATC"       TYPE="%-4s"    FUNCTIONS=""/>   <!--Ó¦ÓÃ½»Ò×¼ÆÊýÆ÷ £¬ÓÐ¿¨±ØÐëÉÏËÍ-->
	<ITEM NAME="#IC_AC"        TYPE="%-16s"   FUNCTIONS=""/>   <!--Ó¦ÓÃÃÜÎÄ-->
	<ITEM NAME="#CARD_SEQ_ID"  TYPE="%-3s"    FUNCTIONS=""/>   <!--IC¿¨ÐòÁÐºÅ-->
	<ITEM NAME="#COST_FEE"     TYPE="%17.2f"  FUNCTIONS=""/>   <!----¹¤±¾·Ñ---->
	<ITEM NAME="#TRAN_FEE"     TYPE="%17.2f"  FUNCTIONS=""/>   <!----½»Ò×ÊÖÐø·Ñ---->
	<ITEM NAME="#COST_FEE1"    TYPE="%17.2f"  FUNCTIONS=""/>   <!----¹¤±¾·Ñ---->
	<ITEM NAME="#TRAN_FEE1"    TYPE="%17.2f"  FUNCTIONS=""/>   <!----½»Ò×ÊÖÐø·Ñ---->
	<ITEM NAME="#FEETLRNO"     TYPE="%4s"     FUNCTIONS=""/>   <!---ÊÚÈ¨¹ñÔ±ºÅ--->
	<ITEM NAME="#FEE_PWD"      TYPE="%6s"     FUNCTIONS=""/>   <!---ÊÚÈ¨¹ñÔ±¿ÚÁî--->
	<ITEM NAME="#FEEFLAG"      TYPE="%1s"     FUNCTIONS=""/>   <!---ÊÕ·Ñ±êÖ¾--->
	<ITEM NAME="#FEEFLAG1"     TYPE="%1s"     FUNCTIONS=""/>   <!---ÊÕ·Ñ±êÖ¾--->
	<ITEM NAME="#TXNAME"       TYPE="%-20s"   FUNCTIONS="T(¸ü»»¿¨)"/>  <!---½»Ò×Ãû³Æ--->
	<ITEM NAME="#TXNO"         TYPE="%-4s"    FUNCTIONS="T($TXNO=2410)"/>
	<ITEM NAME="#TXCD"              TYPE="%4s"    FUNCTIONS="T(3711)"/>  
	<ITEM NAME="#FLAG"         TYPE="%-1s"    FUNCTIONS=""/>
	<ITEM NAME="#TXTP" LINE="7"  COL="19	" TYPE="%-1s" INPUT="SELECT"	FUNCTIONS="T(1)">
	<SELECT>
		<OPTION VALUE="1" TITLE="Õý³£¸ü»»"/>
		<OPTION VALUE="2" TITLE="Êé¹Ò¸ü»»"/>
	</SELECT>
	<ONLOSTFOCUS>
		"{
		if(#TXTP=='1')
		{
		enable(#OACTNO1,true);
		enable(#OACTNO2,false);
		show(#OACTNO1,true);
		show(#OACTNO2,false);
		}
		if(#TXTP=='2')
		{
		enable(#OACTNO1,false);
		enable(#OACTNO2,true);
		show(#OACTNO1,false);
		show(#OACTNO2,true);
		}
		}"
	</ONLOSTFOCUS>
	</ITEM>
	<ITEM NAME="#STXTP"  TYPE="%-14s" FUNCTIONS="S(#TXTP,#TXTP)"/>
	<ITEM NAME="#OACTNO1" LINE="9" COL="19" TYPE="%-19s" INPUT="TEXT" DEVICE="ICC"  FUNCTIONS="V(NB)M($MSR2,1)"/>
	<ITEM NAME="#OACTNO2" LINE="9" COL="19" TYPE="%-19s" INPUT="TEXT" FUNCTIONS="V(NB)"/>
	<ITEM NAME="#OACTNO" TYPE="%-19s" FUNCTIONS="V(NB)">
		<ONLOSTFOCUS>
		"{
		if(#TXTP=='1')
		{
		#OACTNO=#OACTNO1;
		}
		if(#TXTP=='2')
		{
		#OACTNO=#OACTNO2;
		}
			initfd();
			commsend_001();
			$FD16='9710';
			#OACTNO=delspace(#OACTNO);
			$FD30=#OACTNO;
			$FD67=#TXTP;
			callserver();
			if($FD12!='0000')
			{
				showmsg(geterror());
				return(false);
			}
			//showmsg('µ½Õâ204ÐÐ');
			//showmsg('#OACTNO='+#OACTNO);
			if(substr(#OACTNO,0,6) == '621780')
			{
				show(#NACTNO,true);
				enable(#NACTNO,true);
				if(#TXTP=='1')
				{
					show(#ZQMM,true);
					show(#PASSWD,true);
					#INSTEAD_REASON='0';//Ëð»µ²¹»»¿¨
					show(#GHYY,true);
					enable(#INSTEAD_REASON,true);
					show(#INSTEAD_REASON,true);
				}
				else if(#TXTP=='2' or #TXTP=='3')
				{
					#INSTEAD_REASON='2';
					show(#GHYY,true);
					enable(#INSTEAD_REASON,false);
					#INSTEAD_REASON='2';
					show(#INSTEAD_REASON,true);
				}
				//showmsg('µ½Õâ219ÐÐ#TXTP='+#TXTP);
				//showmsg('#INSTEAD_REASON='+#INSTEAD_REASON);
			}
				#TEMPCERTNO=delspace($FD37);
				#PASS=substr($FD114,1,1);
				#CERT=substr($FD114,14,1);
				#MEDKIND=substr($FD116,0,4);    //½éÖÊÖÖÀà
				#OVOCNUM=substr($FD116,135,16);//Ô­Æ¾Ö¤
				//showmsg('OVOCNUM='+#OVOCNUM);
				//showmsg('#PASS='+#PASS);
				//showmsg('#CERT='+#CERT);
				//showmsg('#MEDKIND='+#MEDKIND);
				//showmsg('#OVOCNUM='+#OVOCNUM);
				//if(#PASS=='Y'){
				//IC¿¨²¹»»¿¨²»ÑéÖ¤ÃÜÂë-wangwk-20101217
				//show(#ZQMM,true);
				//show(#PASSWD,true);
				//}
				if(#CERT=='Y')
				{
					show(#LZJLX,true);
					show(#ZJHM,true);
					show(#CERTNO,true);
					show(#ZJLX,true);
					#ZJLX=substr($FD114,36,1);
				}
				else
				{
					show(#LZJLX,false);
					show(#ZJHM,false);
					show(#CERTNO,false);
					show(#ZJLX,false);
				}
				show(#OVOCNUM,true);
				//show(#PASS,true);
				show(#CERT,true);
				#NAME=$FD25;

				if(#TXTP=='3')
				{
					//#PASS='N';
					//modified by liuyong 20100512 start
					//show(#ZQMM,true);
					//¸ü»»½éÖÊ²»ÑéÖ¤ÃÜÂë-wangwk-20101217
					//show(#PASSWD,false);
					//enable(#PASSWD,false);
					//show(#SGPASSWD,true);
					//enable(#SGPASSWD,true);
					//modified by liuyong 20100512 end
				}
				//add by luolz Ôö¼ÓÊÇ¿¨Ê±£¬²»´òÓ¡¾ÉÆ¾Ö¤Ìõ¼þ  begin
				//showmsg('#TXTP='+#TXTP);
				//showmsg('substr(#OACTNO,0,6)='+substr(#OACTNO,0,6));
				if(#TXTP == '1' and substr(#OACTNO,0,6)!='621780')
				{
					#FLAG = '1';
				}
				else
				{
					#FLAG = '0';
				}
				//showmsg('µ½Õâ287ÐÐ#FLAG='+#FLAG);
				//add by luolz Ôö¼ÓÊÇ¿¨Ê±£¬²»´òÓ¡¾ÉÆ¾Ö¤Ìõ¼þ  end
				//#INSTEAD_REASON='0';
				//showmsg('#INSTEAD_REASON='+#INSTEAD_REASON);
			}"
		</ONLOSTFOCUS>
	</ITEM>
	<ITEM NAME="#MEDKIND" TYPE="%-4s"     FUNCTIONS=""/><!---½éÖÊÖÖÀà--->
	<!--added by liuyong 2009-9-15 ÏÔÊ¾Í¼Æ¬ÐÅÏ¢ start-->
	<ITEM NAME="#LYACNO" TYPE="%-19s" FUNCTIONS="" />
	<ITEM NAME="#PIC" LINE="14" COL="19" LINES="160" COLS="120"  TYPE="%-10s" VISABLE="FALSE" FUNCTIONS=""/>
	<ITEM NAME="#SETPIC" TYPE="%-10s" FUNCTIONS="">
	<ONLOSTFOCUS>
	"{
			#LYACNO=#OACTNO;
			call_96641();
	}"
	</ONLOSTFOCUS>
	</ITEM>
	<ITEM NAME="#PIC1" LINE="14" COL="55" LINES="220" COLS="160"  TYPE="%-10s" VISABLE="FALSE" FUNCTIONS=""/>
	<ITEM NAME="#SETPIC1" TYPE="%-10s" FUNCTIONS="">
	<ONLOSTFOCUS>
	"{
			#LYACNO=#OACTNO;
			call_96642();
	}"
	</ONLOSTFOCUS>
	</ITEM>
	<!--added by liuyong 2009-9-15 ÏÔÊ¾Í¼Æ¬ÐÅÏ¢ end-->
	<ITEM LINE="9"  COL="55" TYPE="%-16s" NAME="#OVOCNUM"	       INPUT="LABEL" 	 FUNCTIONS=""/>
	<ITEM LINE="10" COL="19" TYPE="%-50s" NAME="#NAME" 	         INPUT="LABEL" 	 FUNCTIONS="T($FD25)"/>
	<ITEM LINE="11" COL="19" TYPE="%-1s"  NAME="#INSTEAD_REASON" INPUT="SELECT"  FUNCTIONS="" ENABLE="FALSE" VISABLE="FALSE">
		<SELECT>
			<OPTION VALUE="0" TITLE="¸ü»»½éÖÊ"/>
			<OPTION VALUE="1" TITLE="Ëð»µ²¹»»½éÖÊ"/>
			<OPTION VALUE="2" TITLE="¹ÒÊ§²¹·¢ÐÂ½éÖÊ"/>
		</SELECT>
	</ITEM>
	<ITEM  TYPE="%-1s"  NAME="#TEMP"  FUNCTIONS="">
		<ONLOSTFOCUS>
		"{
				dim @tagvalue as string;
				dim @card_no as string;
			//Õý³£¸ü»»²»ÊäÈëÐÂÃÜÂë
			if(#INSTEAD_REASON =='0')
			{
					@tagvalue= ictagvalue('9f79');
				if(strfld(@tagvalue,'|',0)!='9000')
				{
					showmsg('º¯ÊýictagvalueµÄ·µ»ØÖµÓÐÎó!');
					return(false);
				}
				@tagvalue= strfld(@tagvalue,'|',1);
				#AVAIL_BAL=val(@tagvalue,0.01);
			}
			if(#TXTP == '1' and #INSTEAD_REASON == '2')
			{
				showmsg('¸ü»»·½Ê½ºÍ¸ü»»Ô­Òò²»Æ¥Åä£¬ÇëÖØÐÂÑ¡Ôñ£¡');
				return (false);
			}
			else if( (#TXTP != '1' and #INSTEAD_REASON != '2') )
			{
				showmsg('´ËÖÖ¸ü»»·½Ê½¸ü»»Ô­Òò±ØÐëÎª¹ÒÊ§²¹·¢ÐÂ¿¨£¬ÇëÖØÐÂÑ¡Ôñ£¡');
				return (false);
			}
			//Õý³£¸ü»»ÐèÒªÐÂÃÜÂë
			if(#TXTP == '1' and #INSTEAD_REASON != '0')
			{
				show(#NEW_MM,true);
				show(#NEW_PASSWORD,true);
				enable(#NEW_PASSWORD,true);
			}
			if(#INSTEAD_REASON=='2' and substr(#OACTNO,0,6) == '621780')
			{
				show(#GSBH,true);
				enable(#LOST_NO,true);
				show(#LOST_NO,true);
			}
			else if(#INSTEAD_REASON=='0' or #INSTEAD_REASON=='1')
			{
				show(#GSBH,false);
				show(#LOST_NO,false);
				enable(#LOST_NO,false);
			}
			//showmsg('µ½357ÐÐ!');
			//ÈÎºÎÇé¿ö»»Ö¤Ê±£¬±¾À´ÎªÃÜÂëÖ§È¡µÄ£¬ÊäÈëÃÜÂë¡£²»ÊÇÃÜÂëÖ§È¡µÄ£¬²»ÊäÈëÃÜÂë 20110907 begin by jk
			//del by zxw2011-11-21 17:01:38
			if(substr(#OACTNO,0,6) != '621780')
			{
				if( #PASS == 'Y')
				{
					show(#PASS,true);
					enable(#PASS,false);
					show(#ZQMM,true);
					show(#PASSWD,true);
					enable(#PASSWD,true);
				}
				else
				{
					show(#PASS,true);
					enable(#PASS,false);
					show(#ZQMM,false);
					show(#PASSWD,false);
					enable(#PASSWD,false);
				}
				show(#NEW_MM,false);
				show(#NEW_PASSWORD,false);
			}
			//end 20110907 by jk
			}"
		</ONLOSTFOCUS>
	</ITEM>
	<ITEM LINE="11"  COL="55" TYPE="%-16s" NAME="#LOST_NO"	INPUT="TEXT" 	  FUNCTIONS="V(NB)"  VISABLE="FALSE" ENABLE="FALSE"/>
	<ITEM LINE="12"  COL="19" TYPE="%-1s"  NAME="#PASS" 	  INPUT="SELECT"  FUNCTIONS="T(Y)" ENABLE="FALSE">
		<SELECT>
			<OPTION VALUE="Y" TITLE="ÊÇ"/>
			<OPTION VALUE="N" TITLE="·ñ"/>
		</SELECT>
		<ONLOSTFOCUS>
			"{
				if(#PASS == 'Y')
				{
					show(#PASSWD,true);
					show(#ZQMM,true);
				}
				else
				{
					show(#PASSWD,false);
					show(#ZQMM,false);
				}
			}"
		</ONLOSTFOCUS>
	</ITEM>
	<!--Êé¹Ò¼æÃÜ¹ÒÊ±ÖØÉèÃÜÂë added by liuyong 201005 start-->
	<!--ÊÇ¹ÒÊ§·½Ê½È¥µô-wangwk-20101217
	<ITEM NAME="#SGPASSWD" INPUT="TEXT" LINE="12" COL="55" TYPE="%6d" DEVICE="PINPAD" FUNCTIONS="I()i()V(NB)" VISABLE="FALSE">
	<ONLOSTFOCUS>
	"{
			#PASSWD=#SGPASSWD;
		}"
	</ONLOSTFOCUS>
	</ITEM>
	<!--added by liuyong 20100512 end-->
	<!--°´ÐÐÀïÒªÇóÈ¥µôÃÜÂëÃÜÂëÑéÖ¤ -->
	<ITEM LINE="12" COL="55" TYPE="%6s" NAME="#PASSWD" INPUT="TEXT" DEVICE="PINPAD" FUNCTIONS="i()T()V(NB)" VISABLE="FALSE">
		<ONLOSTFOCUS>
		 "{
		 if(len(delspace(#PASSWD)) &lt; 6)
				{
					showmsg('ÃÜÂë³¤¶È±ØÐëÎªÁùÎ»!');
					return(false);
				}
			initfd(); 
			commsend_001();
			$FD16='7007'; 
			$FD30=rtrim(#OACTNO);
			$FD79=#PASSWD;
			$FD68='4';
		<!--	
			if (isTxContinue() == false )
		{
			return(false);
		}-->
		callagn();
			if($FD12!='0000')
			{
				showmsg(geterror());
				return (false);
			}
			<!--
				initfd();
				commsend_001();
				$FD16='7007';
				$FD30=#OACTNO;
				$FD79=#PASSWD;
				$FD68='4';
				showmsg('1111111111111¹ýÕâ¶ùÁË£¡');
				callagn();
				showmsg('22222222222222222¹ýÕâ¶ùÁË£¡');
				if($FD12!='0000')
				{
					showmsg(geterror());
					return (false);
				}
			-->
			  //showmsg('333333333333333333¹ýÕâ¶ùÁË£¡');
			}"
		</ONLOSTFOCUS>
	</ITEM>
	<ITEM TYPE="%17.2f" NAME="#AVAIL_BAL"   FUNCTIONS=""/>
	<ITEM LINE="13" COL="19" TYPE="%-1s" NAME="#CERT" INPUT="SELECT" FUNCTIONS="T(0)" ENABLE="FALSE">
		<SELECT>
			<OPTION VALUE="Y" TITLE="ÊÇ"/>
			<OPTION VALUE="N" TITLE="·ñ"/>
		</SELECT>
	</ITEM>
	<ITEM LINE="15" COL="19" TYPE="%-1s" NAME="#ZJLX" INPUT="SELECT" FUNCTIONS="" ENABLE="FALSE" VISABLE="FALSE">
		<SELECT>
			<OPTION VALUE="1" TITLE="Éí·ÝÖ¤"/>
			<OPTION VALUE="2" TITLE="»§¿Ú±¡"/>
			<OPTION VALUE="3" TITLE="»¤ÕÕ  "/>
			<OPTION VALUE="4" TITLE="¾ü¹ÙÖ¤"/>
			<OPTION VALUE="5" TITLE="»ØÏçÖ¤"/>
			<OPTION VALUE="6" TITLE="Ê¿±øÖ¤"/>
			<OPTION VALUE="7" TITLE="¸Û°Ä¾ÓÃñÀ´ÍùÍ¨ÐÐÖ¤"/>
			<OPTION VALUE="E" TITLE="ÁÙÊ±Éí·ÝÖ¤"/>
			<OPTION VALUE="F" TITLE="Íâ¹úÈË¾ÓÁôÖ¤"/>
			<OPTION VALUE="G" TITLE="¾¯¹ÙÖ¤"/>
			<OPTION VALUE="H" TITLE="ÆäËûÖ¤¼þ"/>
			<OPTION VALUE="I" TITLE="Ì¨ÍåÍ¬°ûÀ´ÍùÍ¨ÐÐÖ¤"/>
		</SELECT>
	</ITEM>
	<ITEM LINE="15" COL="50" TYPE="%-20s" NAME="#CERTNO"  INPUT="TEXT"  FUNCTIONS="V(NB)" VISABLE="FALSE">
		<ONLOSTFOCUS>
		"{
			if(#TEMPCERTNO != #CERTNO)
				{
					showmsg('Ö¤¼þºÅ²»·ûÇëÖØÐÂÊäÈë!');
					return (false);
				}
			}"
		</ONLOSTFOCUS>
	</ITEM>
	<ITEM  TYPE="%-1s" NAME="#TEMP"    FUNCTIONS="">
		<ONLOSTFOCUS>
		"{
			showmsg('Çë²åÈëÐÂ¿¨£¬¿ªÊ¼¶ÔÐÂ¿¨Ïà¹ØÐ£Ñé´¦Àí£º');
			}"
		</ONLOSTFOCUS>
	</ITEM>
	<ITEM LINE="19" COL="19" TYPE="%-19s" NAME="#NACTNO" INPUT="TEXT"  DEVICE="ICC"  FUNCTIONS="V(NB)M($MSR2,1)">
		<ONLOSTFOCUS>
		"{
			//showmsg('#INSTEAD_REASON = ['+#INSTEAD_REASON+']');
			//showmsg('¿ªÊ¼¶ÔÐÂ¿¨Ïà¹ØÐ£Ñé´¦Àí£º')
			if(substr(#NACTNO,0,6)!='621780')
			{
				showmsg('½éÖÊ²»ÊÇIC¿¨');
				return(false);
			}
			//showmsg('µ½476ÐÐ!');
			if(substr(#OACTNO,0,6)=='621780' and substr(#NACTNO,0,6)=='621780')
			{
				//#IC_ATC = ictagvalue('9f36');
				//showmsg('Ó¦ÓÃ½»Ò×¼ÆÊýÆ÷#IC_ATC='+#IC_ATC);
				//showmsg('$ms2'+$MSR2);
				//showmsg('$ms3'+$MSR3);
				if(rtrim(#NACTNO) == rtrim(#OACTNO))
				{
					showmsg('ÐÂ¿¨ºÅÓëÔ­¿¨ºÅ²»ÄÜÏàÍ¬');
					return(false);
				}
				show(#NEW_MM,true);
				show(#NEW_PASSWORD,true);
				enable(#NEW_PASSWORD,true);
				#MSR2BAK=$MSR2;
				#MSR3BAK=$MSR3;
				//update by sunlicheng 20110613 start »ØÏÔÐÂÆ¾Ö¤ºÅ
				#NVOCNUM=substr(#NACTNO,6,12);
				//#NVOCNUM='0000'+substr(#NACTNO,6,17);
				//update by sunlicheng 20110613 end
				if(len(delspace($MSR2)) &lt; 37)
				{
					showmsg('Ë¢¿¨´íÎó,ÇëÖØÊÔ!');
					return(false);
				}
				if(len(rtrim(#NACTNO))!=19)
				{
					showmsg('¿¨ºÅ³¤¶È²»ÕýÈ·£¬ÇëÖØÐÂÊäÈë!');
					return(false);
				}
			}
			else if(substr(#OACTNO,0,6)=='621780' and substr(#NACTNO,0,6)!='621780')
			{
				showmsg('½éÖÊ²»ÊÇ´¢Ðî¿¨');
				return(false);
			}
			else
			{
				show(#NEW_MM,true);
				show(#NEW_PASSWORD,true);
				enable(#NEW_PASSWORD,true);
			}
		}"
		</ONLOSTFOCUS>
	</ITEM>
	<ITEM LINE="19" COL="55" TYPE="%16d"  NAME="#NVOCNUM" INPUT="TEXT"  FUNCTIONS="V(NB)">
		<ONLOSTFOCUS>
		"{
				initfd();
				commsend_001();
				$FD30=#OACTNO;
				//showmsg(#OACTNO);
				$FD31=#NACTNO;
				//showmsg('N'+#NACTNO);
				$FD59=#NVOCNUM;
				//showmsg('NV'+#NVOCNUM);
				$FD16='9972';
				callserver();
				if($FD12!='0000')
				{
					showmsg(geterror());
					return(false);
				}
				//showmsg('ÔÚ543ÐÐµÈµÈÎÒ!');
			}"
		</ONLOSTFOCUS>
	</ITEM>
	<ITEM LINE="20" COL="19" TYPE="%6s" NAME="#NEW_PASSWORD" INPUT="TEXT"    DEVICE="PINPAD" FUNCTIONS="I()i()V(NB)" VISABLE="FALSE">
		<ONLOSTFOCUS>
			"{
			if(len(delspace(#NEW_PASSWORD)) &lt; 6)
				{
					showmsg('ÃÜÂë³¤¶È±ØÐëÎªÁùÎ»!');
					return(false);
				}
				//ÐÂÃÜÂëÖ±½Ó¸ü¸Ä
				#PASS='Y';
				#PASSWD=#NEW_PASSWORD;
			}"
		</ONLOSTFOCUS>
	</ITEM>
	<ITEM NAME="#AVBAL"  TYPE="%17.2f" FUNCTIONS="J(#UAVBAL)"/><!---´æµ¥Óà¶î--->
	<ITEM NAME="#UAVBAL" TYPE="%-40s"  FUNCTIONS="U(#AVBAL)"/> <!---´æµ¥´óÐ´Óà¶î--->
	<ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(È·  ¶¨)" INPUT="SUBMIT"/>
</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
	<PACKAGE DEVICE="SCREEN" DESC="IC¿¨²¹»»¿¨³É¹¦">
		NOTHING
	</PACKAGE>
	<PRINT>
	"{
			$KINDNO='00';
			print( 5, 25,'¸ü »» ½é ÖÊ ³É ¹¦ !');
			print(10, 22,'ÐÂÕÊ¿¨ºÅ:[24]',$FD31);
			print(11, 22,'ÐÂÆ¾Ö¤ºÅ:[16]',#NVOCNUM);
			print(12, 22,'½éÖÊ´úºÅ:[4 ]',#MEDKIND);
		}"
	</PRINT>
</RESPONSE>

<RESPONSE>
	<PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="Çë´òÓ¡ÒµÎñ×¨ÓÃÆ¾Ö¤">
		NOTHING
	</PACKAGE>
	<PRINT>
		"{
			$KINDNO='00';
			dim @txtime  as string;
			@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
			print( 5,20,'»ú¹¹Ãû³Æ:[30]',$BRNAME);
			print( 5, 2,'´úÂë:3711');
			print( 5,13,'½»Ò×:¸ü»»Æ¾Ö¤');
			if(#INSTEAD_REASON=='0')
			{
			print( 7,20,'¸ü»»  ·½Ê½:[14]         »§     Ãû:[50]','µ½ÆÚ²¹»»¿¨',#NAME);
			}
			if(#INSTEAD_REASON=='1')
			{
			print( 7,20,'¸ü»»  ·½Ê½:[14]         »§     Ãû:[50]','Ëð»µ²¹»»¿¨',#NAME);
			}
			if(#INSTEAD_REASON=='2')
			{
			print( 7,20,'¸ü»»  ·½Ê½:[14]         »§     Ãû:[50]','¹ÒÊ§²¹»»¿¨',#NAME);
			}
			print( 8,20,'Ô­ÕÊ/¿¨ºÅ:[20      ]    ÐÂÕÊ/¿¨ºÅ:[20]',#OACTNO,$FD31);
			print( 9,20,'Ô­Æ¾Ö¤ ºÅ:[16  ]        ÐÂÆ¾Ö¤ ºÅ:[16]',#OVOCNUM,#NVOCNUM);
			print_sq();
			print(24,20,'±¸×¢:');
			print(24,27,'½»Ò×ÈÕÆÚ:[8] [8]',$HDATE,@txtime);
			print(24, 5,'¹ñÔ±:[4]',$FD7);
			print(24, 5,'Á÷Ë®ºÅ:[6]',$FD4);
		}"
	</PRINT>
</RESPONSE>
<!--add by luolz 20091101 ¸ü»»¿¨ÊÕÈ¡ÊÖÐø·Ñ´òÓ¡Æ¾Ö¤-->
<RESPONSE>
	<PACKAGE DEVICE="PRINTER" DESC="Çë´òÓ¡ÒµÎñ×¨ÓÃÆ¾Ö¤(ÊÖÐø·Ñ)" LINESPACE="24" CHECK="#FEEFLAG1=0">
		NOTHING
	</PACKAGE>
	<PRINT>
	"{
		dim @txtime as string;
		dim @feetype as string;
		@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
		$KINDNO='00';
		print( 5,20,'»ú¹¹Ãû³Æ:[30]',$BRNAME);
		print( 5, 2,'½»Ò×´úÂë: 3711');
		print( 5,13,'½»Ò×Ãû³Æ:[20]',#TXNAME);
		print( 7,30,'\L0¸ü»»¿¨½»Ò×\L1');
		print( 9,20,'Ô­¿¨ºÅ:[19]    ÐÂ¿¨ºÅ:[19]',#OACTNO,#NACTNO);
		//print(10,20,'ÕÊ»§Óà¶î:[21]',#TXAMT);
		//add by luolz 20091026 begin
		switch( #FEEFLAG ) {
			case '1' :
				print(11,20,'½É·Ñ·½Ê½:ÏÖ½ð');
				break;
			case '2' :
				print(11,20,'½É·Ñ·½Ê½:×ªÕË');
				break;
			default :
				print(11,20,'½É·Ñ·½Ê½:²»ÊÕ');
				break;
		}
		if( delspace(itoa(#COST_FEE1,'%16.2f')) != '0.00' )
		{
			print(12,20,'ÒøÐÐ¿¨¹¤±¾·Ñ:[21]',delspace(itoa(#COST_FEE1,'%16.2f')));
		}
		if( delspace(itoa(#TRAN_FEE1,'%16.2f')) != '0.00' )
		{
			print(13,20,'ÒøÐÐ¿¨ÊÖÐø·Ñ:[21]',delspace(itoa(#TRAN_FEE1,'%16.2f')));
		}
		if( delspace(itoa((#COST_FEE1+#TRAN_FEE1),'%16.2f')) != '0.00' )
		{
			print(14,20,'ÊÕ·Ñ×Ü¶î:[21]',delspace(itoa((#COST_FEE1+#TRAN_FEE1),'%16.2f')));
		}

		//add by luolz 20091026 end
		printacdtl_1();
		//print_sq();
		//print(19,80,'\H0±¾ÈËÒÑÈ·ÈÏÒøÐÐ´òÓ¡¼ÇÂ¼ÕýÈ·ÎÞÎó.\H1');
		//print(21,80,'¿Í»§Ç©Ãû:_____________________');
		print(24,20,'±¸×¢:');
		print(24,27,'½»Ò×ÈÕÆÚ:[8] [8]',$HDATE,@txtime);
		print(24, 5,'¹ñÔ±:[4]',$FD7);
		print(24, 5,'Á÷Ë®ºÅ:[6]',$FD4);
	}"
	</PRINT>
</RESPONSE>

<RESPONSE>
	<PACKAGE DEVICE="PRINTER" LINESPACE="27" DESC="Çë´òÓ¡¾ÉÆ¾Ö¤" CHECK="#FLAG=1" >
		NOTHING
	</PACKAGE>
	<PRINT>
		"{
			print(5, 20,'\Z0ÒÑ¸ü»»\Z1');
			print(10, 6,'Á÷ Ë® ºÅ:¡¾[6  ]¡¿    ÐÂÆ¾Ö¤ºÅ:¡¾[16]¡¿ ',$FD4 ,#NVOCNUM);
		}"
	</PRINT>
</RESPONSE>
<IMPORT>IC_XK_DJQD.IMP</IMPORT>
<IMPORT>CXHZ.IMP</IMPORT><!---»»ÕÛ--->
<IMPORT>CXHD.IMP</IMPORT><!---»»µ¥--->
<!--
<LASTWORK>
	"{
	dim @tota as string;
	dim @file as file;
	dim @line as string;
	dim @tctd_br_no as string;
	if(substr(#NACTNO,0,6)!='621223')
	{
		if(msgbox('ÐÂÆ¾Ö¤ÊÇ·ñÓÐÐèÒªË¢´Å?'+chr(10)+'------------------','Ìá  Ê¾','yes|no')==0)
		{
			if(writemsr(delspace(substr($FD31,0,19)),''))
			{
				showmsg('Ð´´Å³É¹¦!');
			}
			else
			{
			showmsg('Ð´´ÅÊ§°Ü!');
			}
		}
		//´òÓ¡Í¨´æÍ¨¶ÒÐÐºÅ
		$FD123='select tctd_br_no,br_no from tctd_ktzh where tctd_acno='+chr(39)+
		delspace($FD31)+chr(39)+' and (tc_kt_flag=1 or td_kt_flag=1 or cx_kt_flag=1)';
		commsend_001();
		$FD16='9598';
		@tota=callserver();
		if($FD12!='0000')
		{
			showmsg(geterror());
			showfooter();
			return(false);
		}
		if(@tota=='')
		{
			return(true);
		}
		savefiletxt('../tmp/'+$KINBR+$TTYNAME,@tota);
		@file=openfile('../tmp/'+$KINBR+$TTYNAME,'r');
		if(@file &lt; 0)
		{
			showmsg('È¡¸½¼þÊ§°Ü!');
			return(false);
		}
		@line=readline(@file);
		if(@line=='')
		{
			return(true);
		}
		@tctd_br_no=strfld(@line,'|',0);
		link('34101.XML',substr(getitems('$FD31'),0,19)+@tctd_br_no);
		}
	}"
</LASTWORK>
-->
</TRANSACTION>

