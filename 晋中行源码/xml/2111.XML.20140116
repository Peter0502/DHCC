<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11111001" TITLE="2111 机构客户信息录入"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	commsend_001();
	$FD25=#SJDW;
	$FD26=#ZGDW;
	$FD27=#DBDW;
	$FD28=#CUSTNO;
	$FD33=#SYFRZ;	
	$FD41=itoa(#TXAMT*100,'%016.0f');		
	$FD58=#ACTNO;
	$FD62=#JGZH;
	$FD64=#XYD;
	$FD67=#DWXZ;
	$FD71=#SYXS;
	$FD81=#FRMC;
	$FD82=#FRZH;
	$FD83=#KHH;

}"      
</COMMSEND>
<COMMRECV>"{
}"      
</COMMRECV>
<FIRSTWORK>
"{
  #PIC='';
  #PIC1='';
}"
</FIRSTWORK>        
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-52s" FUNCTIONS=
    "T(2111                        机构客户信息录入)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=1111)"/>
  <BLOCK NAME="COMMON" LINE="5" COL="5">
  <ITEM LINE="1" COL="0" TYPE="%-15s" FUNCTIONS="T(客   户   号:)" />
  <ITEM LINE="3" COL="0" TYPE="%-15s" FUNCTIONS="T(机构代码证号:)" />
  <ITEM LINE="4" COL="0" TYPE="%-15s" FUNCTIONS="T(事业法人证号:)" />
  <ITEM LINE="5" COL="0" TYPE="%-15s" FUNCTIONS="T(法人代表名称:)" />
  <ITEM LINE="6" COL="0" TYPE="%-15s" FUNCTIONS="T(法人身份证号:)" />
  <ITEM LINE="7" COL="0" TYPE="%-15s" FUNCTIONS="T(企业贷款卡号:)" />
  <ITEM LINE="8" COL="0" TYPE="%-15s" FUNCTIONS="T(所有制  形式:!)"/>
  <ITEM LINE="8" COL="40" TYPE="%-10s" FUNCTIONS="T(单位性质:!)" />
  <ITEM LINE="9" COL="0" TYPE="%-15s" FUNCTIONS="T(企业开办资金:)" />
  <ITEM LINE="9" COL="40" TYPE="%-10s" FUNCTIONS="T(信 誉 度:!)" />
  <ITEM LINE="10" COL="0" TYPE="%-15s" FUNCTIONS="T(基本户开户行:)" />	
  <ITEM LINE="11" COL="0" TYPE="%-15s" FUNCTIONS="T(所属上级单位:)" />
  <ITEM LINE="12" COL="0" TYPE="%-15s" FUNCTIONS="T(所属主管单位:)" />
  <ITEM LINE="13" COL="0" TYPE="%-15s" FUNCTIONS="T(资金调拨单位:)" />
  <ITEM LINE="3" COL="40" TYPE="%-10s" FUNCTIONS="T(照    片:)"/>  
  <ITEM LINE="6" COL="40" TYPE="%-10s" FUNCTIONS="T(印    件:)"/> 
  <ITEM LINE="1" COL="15" NAME="#CUSTNO" TYPE="%-8s" DEVICE="KEYBOARD" FUNCTIONS="T()V(NB)">

        <ONLOSTFOCUS>
	"{
		dim @txno_bak as string;
		@txno_bak=$TXNO;
		$TXNO='9757';
		$FD28=#CUSTNO;
		commsend_001();
		callserver();
		$TXNO=@txno_bak;
		#JGZH=$FD62;
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
	}"
    </ONLOSTFOCUS>
  </ITEM>
  
  <ITEM LINE="3" COL="15" NAME="#JGZH"  TYPE="%-20s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="" />
  <!--added by liuyong 2009-9-15 上传图片信息 start-->
  <ITEM LINE="3" COL="50" TYPE="%-10s" LINES="160" COLS="120" FUNCTIONS="A(1)" NAME="#PIC" VISABLE="FALSE"/>
  <ITEM NAME="#SETPICCONTENT" FUNCTIONS="" TYPE="%-10s">
  <ONLOSTFOCUS>
  "{
        setvfile(true,true);
        addvfile(#PIC);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#TRANPIC" TYPE="%-10s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
        if(#PIC=='')
        {
          $FD70='0';
        }
        else
        {
          $FD70='1';
        }
        dim @txnobak as string;
        @txnobak = $TXNO;
        $TXNO = '9667';
        $FD28 = #CUSTNO;
        $FD62 = '';
        $FD72 = '1';//1代表个人照片，2代表印件
        commsend_001();
        callserver();
        if($FD12 !='0000')
        {
            showmsg(geterror());
            return(false);
        }
        $TXNO = @txnobak;
        setvfile(false,false);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <!--added by liuyong 2009-9-15 上传图片信息 end-->
  <ITEM LINE="4" COL="15" NAME="#SYFRZ" TYPE="%-20s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="" /> 
  <ITEM LINE="5" COL="15" NAME="#FRMC"  TYPE="%-20s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="" />
  <!-- 为核查结果中文传值的变量 wudawei 20131101 -->
  <ITEM NAME="#HCJGBL"  TYPE="%-60s" />
  <ITEM LINE="6" COL="15" NAME="#FRZH"  TYPE="%-20s" DEVICE="KEYBOARD" FUNCTIONS="">
  	<ONLOSTFOCUS>
	"{
		dim @l as number;
		@l = len(#FRZH);
    		if(@l != 15 and  @l != 18){
	  		showmsg('身份证号码位数错误');
       			return(false);
			}
			
			//add 20131030 wudawei start 调用身份核查
  		  dim @res as string;
					@res = idcheck(#FRZH,#FRMC,'','N');
					#HCJGBL = strfld(@res,'|',1);
					@res = strfld(@res,'|',0);
					if(@res=='02' or @res=='03' or @res=='04' or @res=='05' or @res=='06')
					{
							showmsg('身份核查结果不通过，不能继续办理！');
							return(false);
					}
				//add 20131030 end

    }"
	</ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="7" COL="15" NAME="#ACTNO" TYPE="%-16s" DEVICE="KEYBOARD" FUNCTIONS="" />
  <!--added by liuyong 2009-9-15 上传图片信息 start-->
  <ITEM LINE="6" COL="50" TYPE="%-10s" LINES="220" COLS="160" FUNCTIONS="A(2)" NAME="#PIC1" VISABLE="FALSE"/>
  <ITEM NAME="#SETPICCONTENT1" FUNCTIONS="" TYPE="%-10s">
  <ONLOSTFOCUS>
  "{
        setvfile(true,true);
        addvfile(#PIC1);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#TRANPIC1" TYPE="%-10s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
        if(#PIC1=='')
        {
          $FD70='0';
        }
        else
        {
          $FD70='1';
        }
        dim @txnobak as string;
        @txnobak = $TXNO;
        $TXNO = '9667';
        $FD28 = #CUSTNO;
        $FD62 = '';
        $FD72 = '2';//1代表个人照片，2代表印件
        commsend_001();
        callserver();
        if($FD12 !='0000')
        {
            showmsg(geterror());
            return(false);
        }
        $TXNO = @txnobak;
        setvfile(false,false);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <!--added by liuyong 2009-9-15 上传图片信息 end-->
  <ITEM LINE="8" COL="15" NAME="#SYXS" TYPE="%-1s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T(1)"> 
   	<SELECT>
		<OPTION VALUE="1" TITLE="1.国有"/>
		<OPTION VALUE="2" TITLE="1.民办"/>
		<OPTION VALUE="3" TITLE="1.其他"/>
	</SELECT>
  </ITEM>
  <ITEM NAME="#S_SYXS" TYPE="%-10s" FUNCTIONS="S(#SYXS,#SYXS)"/>
    <ITEM LINE="8" COL="50" NAME="#DWXZ" TYPE="%-1s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T(1)">
  	<SELECT>
		<OPTION VALUE="1" TITLE="1.全额拨款"/>
		<OPTION VALUE="2" TITLE="1.差额补款"/>
		<OPTION VALUE="3" TITLE="1.自收自支"/>
	</SELECT>
  </ITEM>
  <ITEM NAME="#S_DWXZ" TYPE="%-10s" FUNCTIONS="S(#DWXZ,#DWXZ)"/> 
  <ITEM LINE="9" COL="15" NAME="#TXAMT" TYPE="%17.2f" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS=""/> 

  <ITEM LINE="9" COL="50" NAME="#XYD"   TYPE="%-7s" INPUT="SELECT" DEVICE="KEYBOARD" FUNCTIONS="T(1)" > 
	<SELECT>
		<OPTION VALUE="1" TITLE="A"/>
		<OPTION VALUE="2" TITLE="AA"/>
		<OPTION VALUE="3" TITLE="AAA"/>
		<OPTION VALUE="4" TITLE="B"/>
		<OPTION VALUE="5" TITLE="BB"/>
		<OPTION VALUE="6" TITLE="BBB"/>
		<OPTION VALUE="7" TITLE="XXX(未知)"/>
	</SELECT>
  </ITEM>
  <ITEM NAME="#S_XYD" TYPE="%-7s" FUNCTIONS="S(#XYD,#XYD)"/>
  <ITEM LINE="10"  COL="15" NAME="#KHH"  TYPE="%-50s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()" />
  <ITEM LINE="11" COL="15" NAME="#SJDW" TYPE="%-50s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()" />
  <ITEM LINE="12" COL="15" NAME="#ZGDW" TYPE="%-50s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()"/> 
  <ITEM LINE="13" COL="15" NAME="#DBDW" TYPE="%-50s" INPUT="TEXT" DEVICE="KEYBOARD" FUNCTIONS="T()"/> 
  </BLOCK>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  <ITEM LINE="21"  COL="59" TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT" />


  <ITEM LINE="21"  COL="59" TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON" >
  	<ONCLICK>
		"{
		dim @tota as string;
		dim @chose as string;
		commsend_001();
		$FD25=#SJDW;
		$FD26=#ZGDW;
		$FD27=#DBDW;
		$FD28=#CUSTNO;
		$FD33=#SYFRZ;	
		$FD41=itoa(#TXAMT*100,'%016.0f');		
		$FD58=#ACTNO;
		$FD62=#JGZH;
		$FD64=#XYD;
		$FD67=#DWXZ;
		$FD71=#SYXS;
		$FD81=#FRMC;
		$FD82=#FRZH;
		$FD83=#KHH;
		@tota=callserver();	
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
			}
		else{
			showall();
			runoutput();
			@chose=showmsg('请选择要转入的交易 0：退出 1：对公活期开户 2：对公定期开户');
			if(@chose == '0')
				return(true);
				else if(@chose == '1'){
					open('4101.XML','');
					return(true);
					}
				else if(@chose == '2'){
					open('4102.XML','');
					return(true);
					}
			}
		}"
	</ONCLICK>
  </ITEM>


</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
	<PACKAGE>
	NOTHING
	</PACKAGE>
	<PRINT>"{
		print(5,30,        '录入成功！')
		print(6,10,'客户号:[8]',#CUSTNO);
		print(7,10,'机构代码证号:[20]',#JGZH);
		print(8,10,'事业法人证号:[20]',#SYFRZ);
		print(9,10,'法人代表名称:[20]',#FRMC);
		print(10,10,'法人身份证号:[20]',#FRZH);
		print(11,10,'企业贷款卡号:[16]',#ACTNO);
		print(12,10,'所有制  形式:[10]',#S_SYXS);
		print(13,10,'单位性质   : [10]',#S_DWXZ);
		print(14,10,'企业开办资金:[17]',itoa(#TXAMT,'%17.2f'));
		print(15,10,'信 誉 度   : [7]',#S_XYD);
		print(16,10,'基本户开户行:[50]',#KHH);
		}"
	</PRINT>
</RESPONSE>
<RESPONSE>
 <PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="请打印机构信息录入结果" >
 NOTHING 
 </PACKAGE>
  <PRINT>
  "{
        print(5,20,'[5]',$KINBR);
	print(5,10,'[30]',$BRNAME);
	print(6,30,'机构信息录入结果');
	print(7,10,'客户号:[8]',#CUSTNO);
	print(7,10,'机构代码证号:[20]',#JGZH);
	print(8,10,'事业法人证号:[20]',#SYFRZ);
	print(8,10,'法人代表名称:[20]',#FRMC);
	print(9,10,'法人身份证号:[20]',#FRZH);
	print(9,10,'企业贷款卡号:[16]',#ACTNO);
	print(10,10,'所有制  形式:[10]',#S_SYXS);
	print(10,10,'单位性质   : [10]',#S_DWXZ);
	print(11,10,'企业开办资金:[17]',itoa(#TXAMT,'%17.2f'));
	print(11,10,'信 誉 度   : [7]',#S_XYD);
	print(12,10,'基本户开户行:[50]',#KHH);
	print( 13,10,'身份核查结果:[60] ',#HCJGBL);
  }"
  </PRINT>
</RESPONSE>
</TRANSACTION>
