<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110000" TITLE="6803 贴现记账"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	// 请注意本交易可以取消，但是取消后本票据号不能在使用，即取消后不可再次贴现
	initfd();
	$FD25=#NAME;
    $FD45=#MDATE;
    $FD48=#WDAYS;
    $FD60=#PNNO;
    $FD62=#PANO;
    $FD67=#ACTYPE;
    $FD68=#LIND;
    $FD83=#ACNO;
    $FD84=getitems('#PINT');
    $FD90=#NOTYPE;
	#FD100_1=itoa(val(#TINT,100),'%016d');
	#FD100_2=itoa(val(#AMT,100),'%016d');
    $FD100=getitems('#FD100_1#FD100_2');
	commsend_001();
	$FD16='4913';
	
}"
</COMMSEND>
<COMMRECV>"{
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(6803                            贴现记账)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=4913)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  <ITEM LINE="5"  COL="5" TYPE="%-15s" FUNCTIONS="T(贴现协议借据号:)"/>
  <ITEM LINE="7"  COL="3" TYPE="%-74s" FUNCTIONS=
  "T(-----------------------------【回显信息】----------------------------------)"/>
  <ITEM LINE="9"  COL="5"  TYPE="%-10s" FUNCTIONS="T(转账类型:!)"/>
  <ITEM LINE="9"  COL="29" TYPE="%-16s" FUNCTIONS="T(贴现申请人账号:)"/>
  <ITEM LINE="10" COL="5"  TYPE="%-16s" FUNCTIONS="T(贴现申请人户名:)"/>
  <ITEM LINE="11" COL="5"  TYPE="%-10s" FUNCTIONS="T(贴 现 率:)"/>
  <ITEM LINE="11" COL="29" TYPE="%-2s"  FUNCTIONS="T(‰)"/>
  <ITEM LINE="11" COL="41" TYPE="%-10s" FUNCTIONS="T(贴现利息:)"/>
  <ITEM LINE="12" COL="5"  TYPE="%-14s" FUNCTIONS="T(异地同城标志:!)"/>
  <ITEM LINE="12" COL="40" TYPE="%-10s" FUNCTIONS="T(在途天数:)"/>
  <ITEM LINE="13" COL="40" TYPE="%-10s" FUNCTIONS="T(汇票金额:)"/>
  <ITEM LINE="15" COL="40" TYPE="%-12s" FUNCTIONS="T(汇票到期日:)"/>
  <ITEM LINE="17" COL="5"  TYPE="%-10s" FUNCTIONS="T(票据类型:!)"/>
  <ITEM LINE="17" COL="40" TYPE="%-10s" FUNCTIONS="T(票 据 号:)"/>
 
  
  <ITEM NAME="#FD100_1" TYPE="%-16s" />
  <ITEM NAME="#FD100_2" TYPE="%-16s" />
  <!--输入变量-->
  <ITEM NAME="#PANO" LINE="5" COL="20" TYPE="%-20s" INPUT="TEXT" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
 "{
    initfd();
    commsend_001();
 		$FD16='9860';
		$FD62=#PANO;
		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		#NAME=$FD25;
		#MDATE=$FD45;
		#WDAYS=$FD48;
		#PNNO=$FD60;
		#ACTYPE=$FD67;
		#LIND=$FD68;
		#ACNO=$FD83;

		setitems('#PINT',$FD84);
		#NOTYPE=$FD90;
		setitems('#FD100_1#FD100_2',$FD100);
		#TINT=ltrim(comma(itoa(val(#FD100_1,0.01),'%.2f'),16));
		#AMT=ltrim(comma(itoa(val(#FD100_2,0.01),'%.2f'),16));

		show(#ACTYPE,true);
		show(#ACNO,true);
		show(#NAME,true);
		show(#PINT,true);
		show(#LIND,true);
		show(#WDAYS,true);
		show(#TINT,true);
		show(#NOTYPE,true);
		show(#PNNO,true);
		show(#AMT,true);
		show(#MDATE,true);
		#ACTYPE = '1';
		refresh();
 }"
 </ONLOSTFOCUS>
 </ITEM>
  <ITEM NAME="#ACTYPE" LINE="9" COL="15" TYPE="%-1s"  INPUT="SELECT" FUNCTIONS="T(1)">
  <SELECT>
		<OPTION VALUE="1" TITLE="本行"/>
		<!--
		<OPTION VALUE="2" TITLE="同城"/>
		<OPTION VALUE="3" TITLE="大额"/>
		-->
	</SELECT>
  </ITEM>
  <ITEM NAME="#ACNO" LINE="9" COL="44" TYPE="%-32s" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="T()"/>

  <ITEM NAME="#NAME" LINE="10" COL="21" TYPE="%-50s" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="T()"/>
  <ITEM NAME="#PINT" LINE="11" COL="15" TYPE="%9.6f" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS=""/>
  <ITEM NAME="#TINT" LINE="11" COL="51" TYPE="%-16s" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="T()"/>
  <ITEM NAME="#LIND" LINE="12" COL="20" TYPE="%-1s" ENABLE="FALSE" INPUT="SELECT" FUNCTIONS="T(0)">
  <SELECT>
		<OPTION VALUE="0" TITLE="本地"/>
		<OPTION VALUE="1" TITLE="异地"/>
	</SELECT>
	</ITEM>
  <!-- <ITEM NAME="#LIND"  TYPE="%-1s"  FUNCTIONS="T(0)"/> --><!--同名ITEM liangq注-->
  <ITEM NAME="#WDAYS" LINE="12" COL="50" TYPE="%4d" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="T()"/>
  <ITEM NAME="#AMT" LINE="13" COL="50" TYPE="%-16s" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="T()"/>
  <ITEM NAME="#MDATE" LINE="15" COL="52" TYPE="%-8s" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="D()"/>
  
  <ITEM NAME="#NOTYPE" LINE="17" COL="15" TYPE="%-3s" ENABLE="FALSE" INPUT="SELECT" FUNCTIONS="T(111)">
  <SELECT>
		<OPTION VALUE="111" TITLE="银行承兑汇票"/>
		<OPTION VALUE="112" TITLE="商业承兑汇票"/>
	</SELECT>
	</ITEM>
  <ITEM NAME="#PNNO" LINE="17" COL="50" TYPE="%-16s" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="T()"/>

  
   <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  
  <ITEM NAME="#YEAR"  TYPE="%-4s" FUNCTIONS="T($FD5,1,4)"/>
  <ITEM NAME="#MON"   TYPE="%-2s" FUNCTIONS="T($FD5,5,2)"/>
  <ITEM NAME="#DAY"   TYPE="%-2s" FUNCTIONS="T($FD5,7,2)"/>

  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>

  </VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
	<PACKAGE DEVICE="SCREEN" DESC="贴现记帐显示内容">
	NOTHING
	</PACKAGE>
	<PRINT>"{
		print( 7, 30,'记帐成功');
		print( 8, 20,'贴现协议编号: [16]',#PANO);
		print( 9, 20,'贴现账号: [24]',$FD33);
	}"
	</PRINT>
</RESPONSE>

<RESPONSE>
    <PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="打印业务专用凭证" >
        LNFFJF|@type|@actno|@num|@name|@prdt|@txamt|@day|||||@rate
    </PACKAGE>
    <PRINT>"{
 $KINDNO='00';
                dim @txtime  as string;
                @txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
 		print( 5,20,'机构名称:[30]',$BRNAME);
                print( 5,2,'代码:6803');
                print( 5,13,'交易:贴现记账');
		print( 7,20,'贴现账号: [24]',@actno);
		print( 7,10,'贴现协议编号: [20]',@num);
		print( 8,20,'贴现户名: [50]',@name);
		print( 9,20,'产品类型: [12]',@prdt);
		print( 9,16,'贴现金额: [16]',@txamt);
		print(10,20,'贴现日期: [8]',@day);
		print(10,10,'贴现利率: [9]',@rate);
                print(11,20,'贴现利息: [16]',#TINT);  
                printacdtl_1();
                print_sq();
	        print( 24,20,'备注:')
                print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
                print( 24,5,'柜员:[4]',$FD7);
                print( 24,5,'流水号:[6]',$FD4);
 }"
    </PRINT>
</RESPONSE>
</TRANSACTION>
