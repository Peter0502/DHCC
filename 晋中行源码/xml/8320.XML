<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11000000" TITLE="8320金太阳登存折"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	//验密码
	if(substr(#ACTNO,0,6) == '621223' or substr(#ACTNO,0,6) == '621780')
	{
		initfd();
		commsend_001();
		$FD16='7009';
		$FD30=#ACTNO;
		$FD79=#KKMM;
		<!--
// mod by chenggongxun 20091023 beg 
		$FD75	= $MSR2;
		$FD76	= $MSR3;
// mod by chenggongxun 20091023  end
   -->
		callagn();
		if( $FD12 != '0000')
		{
			showmsg(geterror());
			return(false);
		}
	}
	
	commsend_001();
	$FD31=#ACTNO;
	$FD67=#ACTFLAG;
	$FD44=#KSRQ;
	$FD45=#JSRQ;
	}"
</COMMSEND>
<COMMRECV>"{
	commrecv_001();
	
}"
</COMMRECV>

<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-60s" FUNCTIONS=
   "T(8320                            金太阳卡成长记录本打印)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=2321)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  <!--获取焦点-->
  <ITEM NAME="#FOCUS" INPUT="TEXT" LINE="8"  COL="1000" VISABLE="TRUE" />
  <!--输入变量-->
  <ITEM NAME="#LDQFS" LINE="7"  COL="25"  TYPE="%-14s" VISABLE="TRUE" FUNCTIONS="T(读 取  方 式:)"/>
  <ITEM LINE="7" COL="35" TYPE="%-1s"  NAME="#DQFS" INPUT="SELECT"   FUNCTIONS="V(NB)T(0)">
		<SELECT>
			<OPTION VALUE="0" TITLE="读取磁条方式"/>
			<OPTION VALUE="1" TITLE="读取芯片方式"/>
		</SELECT>
  <ONLOSTFOCUS>"{
     if(#DQFS=='1')
     {
     enable(#ACTNO1,false);
     enable(#ACTNO2,true);
     show(#ACTNO1,false);
     show(#ACTNO2,true);
     }
     if(#DQFS=='0')
     {
     enable(#ACTNO1,true);
     enable(#ACTNO2,false);
     show(#ACTNO1,true);
     show(#ACTNO2,false);
      
     }
     refresh();
   }"
  </ONLOSTFOCUS>
  </ITEM>
  
  <ITEM LINE="8"   COL="25" TYPE="%-14s" FUNCTIONS="T(金太阳 卡 号:)"/>
  <ITEM LINE="10"  COL="25" TYPE="%-14s" FUNCTIONS="T(户        名:)"/>
  <ITEM LINE="12"  COL="25" TYPE="%-14s" FUNCTIONS="T(儿童证件类型:)"/>
  <ITEM LINE="13"  COL="25" TYPE="%-14s" FUNCTIONS="T(儿童证件号码:)"/>
  <ITEM LINE="14"  COL="25" TYPE="%-14s" FUNCTIONS="T(金太阳卡密码:)"/>
  <ITEM LINE="15"  COL="25" TYPE="%-14s" FUNCTIONS="T(家长证件类型:)"/>
  <ITEM LINE="16"  COL="25" TYPE="%-14s" FUNCTIONS="T(家长证件号码:)"/>
  <ITEM LINE="17"  COL="25" TYPE="%-14s" FUNCTIONS="T(家  长 姓 名:)"/>

 <ITEM NAME="#ACTNO1"   DEVICE="MSR" INPUT="TEXT" LINE="8" COL="35" TYPE="%-19s"  VISABLE="FALSE" FUNCTIONS="V(NB)M($MSR2,1)">
	<ONLOSTFOCUS>
	"{#ACTNO=#ACTNO1;}"
	</ONLOSTFOCUS>
 </ITEM>
 
 <ITEM NAME="#ACTNO2"   INPUT="TEXT" DEVICE="ICC" LINE="8"  COL="35" TYPE="%-19s" VISABLE="FALSE" FUNCTIONS="V(NB)M($MSR2,1)">
	<ONLOSTFOCUS>
	"{#ACTNO=#ACTNO2;}"
	</ONLOSTFOCUS>
 </ITEM>
 
 <ITEM NAME="#ACTNO" 	INPUT="TEXT" 	LINE="8"   COL="35" TYPE="%-19s" 	FUNCTIONS="T()V(NB)">
  <ONLOSTFOCUS>
  "{
	dim @txno as string;
	
	commsend_001();
	@txno  = $TXNO;
	$FD101 = #ACTNO;
	$FD16  = '9951';
	
	callserver();
	if($FD12 != '0000')
	{
		showmsg(geterror());
		return(false);
	}
	#NAME = substr($FD101,74,50);
	//showmsg(#NAME);
	
	if( substr(#ACTNO,6,2) != '10' ) 
	  {
					showmsg('请刷金太阳卡!');
					return(false);
	  }
  }"
  </ONLOSTFOCUS>
 </ITEM>
 
  <ITEM NAME="#NAME" 	INPUT="LABEL" LINE="10"   COL="35" TYPE="%-30s" 	FUNCTIONS=""/>
  
  <ITEM LINE="9" COL="25" TYPE="%-14s" FUNCTIONS="T(查询日期区间:)" />
		<ITEM LINE="9" COL="35" TYPE="%-8s"  FUNCTIONS="D()" NAME="#KSRQ" INPUT="TEXT" FUNCTIONS="V(NB)" />
		<ITEM LINE="9" COL="43" TYPE="%-3s"  FUNCTIONS="T( → )" />
		<ITEM LINE="9" COL="47" TYPE="%-8s"  FUNCTIONS="D()" NAME="#JSRQ" INPUT="TEXT" FUNCTIONS="V(NB)T($HDATE)">
			<ONLOSTFOCUS>
			"{
		    if(#KSRQ &gt; #JSRQ and  #JSRQ != '')
		    {
		      showmsg('开始日期不能大于结束日期');
		      return(false);
		    }
			}"
			</ONLOSTFOCUS>
		</ITEM>
  
  <ITEM NAME="#ACTFLAG"	TYPE="%-1s" 	FUNCTIONS="T()"/>

   
   <ITEM LINE="12"  COL="35" TYPE="%-1s" NAME="#ZJLX1" INPUT="SELECT" FUNCTIONS="T(2)">
			<SELECT>
				<OPTION VALUE="1" TITLE="身份证"/>
				<OPTION VALUE="2" TITLE="户口薄"/>
				<OPTION VALUE="3" TITLE="护照  "/>
				<OPTION VALUE="4" TITLE="军官证"/>
				<OPTION VALUE="5" TITLE="回乡证"/>
			</SELECT>
		</ITEM>
   <ITEM LINE="13" COL="35" TYPE="%-24s" NAME="#ZJHM1"	DEVICE="KEYBOARD"   INPUT="TEXT"  FUNCTIONS="V(NB)" />
   <ITEM LINE="14" COL="35" TYPE="%-6s" NAME="#KKMM"	DEVICE="KEYBOARD"   INPUT="TEXT"  FUNCTIONS="V(NB)i()" >
   <ONLOSTFOCUS>
			"{
				//将密码改为-6s型,以便机器控制密码是否为六位
				if(len(#KKMM) &lt; 6)
				{
					showmsg('密码长度必须为六位!');
					return(false);
				}
			}"
			</ONLOSTFOCUS>
		</ITEM>
   <ITEM LINE="15"  COL="35" TYPE="%-1s" NAME="#ZJLX2"  INPUT="SELECT"  FUNCTIONS="T(1)">
			<SELECT>
				<OPTION VALUE="1" TITLE="身份证"/>
				<OPTION VALUE="2" TITLE="户口薄"/>
				<OPTION VALUE="3" TITLE="护照  "/>
				<OPTION VALUE="4" TITLE="军官证"/>
				<OPTION VALUE="5" TITLE="回乡证"/>
			</SELECT>
	 </ITEM>
	<ITEM LINE="16" COL="35" TYPE="%-24s" NAME="#ZJHM2"	DEVICE="KEYBOARD" INPUT="TEXT" FUNCTIONS="V(NB)">
		<ONLOSTFOCUS>
			"{			  
	  		  dim @res as string;
					if(#ZJLX2=='1' or #ZJLX2=='2')
					{					  
						@res = idcheck(#ZJHM2,#JZXM);					
						@res =  strfld(@res,'|',0);					
						if(@res=='02' or @res=='03' or @res=='04' or @res=='05' or @res=='06')
						{
								showmsg('身份核查结果不通过，不能继续办理！');
							 	return(false);
						}
					}							
			}"
		</ONLOSTFOCUS>
	</ITEM>
	<ITEM LINE="17" COL="35" TYPE="%-10s" NAME="#JZXM"	DEVICE="KEYBOARD"   INPUT="TEXT"  FUNCTIONS="V(NB)" />

  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
  
  </VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
	<PACKAGE DEVICE="SCREEN" DESC="准备打印,请插入儿童成长记录本">
      NOTHING
	</PACKAGE>

	<PRINT>"{
		$KINDNO='00';
		print( 5, 25,'打印儿童成长记录本成功 ！');
		print(12, 22,'户    名:[50]',#NAME);
	}"
	</PRINT>
</RESPONSE>
<IMPORT>CXCZ_8321.IMP</IMPORT>
<RESPONSE>
	 <PACKAGE DEVICE="SCREEN" DESC="换折提示" CHECK="$FD20=1">
	NOTHING
	</PACKAGE>
	<PRINT>"{
		print(10,22,'还有未打印的明细,请进行换折打印');
	}"
	</PRINT>
</RESPONSE>
		
</TRANSACTION>

