<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110000" TITLE="3301 协定存款登记"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	commsend_001();
	$FD16='2301';
    $FD30=#ACCOUNTNO;
		$FD34=#ACCTSEQ;
		$FD39=itoa(#SAVEMONEY*100,'%016.0f');
		$FD84=itoa(#RATE*1000000,'%08.0f');
}"
</COMMSEND>
<COMMRECV>"{
		commrecv_001();
		#XYNO=$FD31;
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(3301                          协定存款登记)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=2301)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  
  <!--输入变量-->	
  <ITEM LINE="8" COL="12" TYPE="%-9s" FUNCTIONS="T(结算帐号:)"/>
  <ITEM LINE="10" COL="12" TYPE="%-10s" INPUT="LABEL" FUNCTIONS="T(户    名:)"/>
  <!---根据协议编号联动出出两个变量----->
  <!--ITEM LINE="10" COL="12" TYPE="%-9s" FUNCTIONS="T(帐户序号:)"/-->
  <ITEM LINE="12" COL="12" TYPE="%-9s" FUNCTIONS="T(留存额度:)"/>
  
  <ITEM LINE="14" COL="12" TYPE="%-9s" FUNCTIONS="T(协定利率:)"/>
  <ITEM LINE="14" COL="35" TYPE="%-2s" FUNCTIONS="T(％)"/>
  
  <ITEM NAME="#ACCOUNTNO"    INPUT="TEXT"  LINE="8" COL="21" TYPE="%-19s" FUNCTIONS="T()">
  <ONLOSTFOCUS>
	"{
		dim @txno_bak as string;
		@txno_bak=$TXNO;
		$TXNO='9958';
		$FD30=#ACCOUNTNO;
		commsend_001();
		callserver();
		$TXNO=@txno_bak;
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
			}
		//通过帐号回显户名 add by wudawei 20130711
		 $FD16='9921';
     $FD83=#ACCOUNTNO;
     callserver();
     if($FD12!='0000')
     {
         showmsg(geterror());
         return(false);
     }
     #ACTNAME = $FD25;

	}"
	 </ONLOSTFOCUS>
  </ITEM>
  <!--ITEM NAME="#ACCTSEQ"      INPUT="TEXT" LINE="10" COL="21" TYPE="%4d" FUNCTIONS="T()"/-->
  <ITEM NAME="#ACCTSEQ"   TYPE="%4d" FUNCTIONS="T(0001)"/>
  <ITEM NAME="#SAVEMONEY"    INPUT="TEXT"  LINE="12" COL="21" TYPE="%17.2f" FUNCTIONS=""/>
  <ITEM NAME="#RATE"         INPUT="TEXT"  LINE="14" COL="21" TYPE="%9.6f" FUNCTIONS="V(00000001,09999999)"/>
  <ITEM NAME="#ACTNAME" LINE="10" COL="21" TYPE="%-60s"   INPUT="TEXT" ENABLE="FALSE" FUNCTIONS=""/>
   <ITEM NAME="#XYNO"  TYPE="%-19s" FUNCTIONS=""/>
  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>

  
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
 </VARIABLE>
 
 
<REQUEST>
</REQUEST>
<RESPONSE>
	<PACKAGE DEVICE="SCREEN" DESC="按任意键继续">
	NOTHING
	</PACKAGE>
	<PRINT>"{
		print( 5,25,'协定存款登记成功');
		print( 7,20,'户    名:[60]',#ACTNAME);
		print( 8,20,'帐    号:[19]',#ACCOUNTNO);
		print( 9,20,'协议帐号:[19]',#XYNO);
		print(10,20,'留存金额:[20]',itoa(#SAVEMONEY,'%-17.2f'));
		print(11,20,'利    率:[10]',itoa(#RATE,'%-9.6f'));
		print(12,20,'流    水:[6 ]',$FD4);
		
		}"
	</PRINT>
</RESPONSE>
<RESPONSE>
	<PACKAGE DEVICE="PRINTER" DESC="请打印业务专用凭证" LINESPACE="24">
	NOTHING
	</PACKAGE>
	<PRINT>"{
		dim @txtime as string;
		@txtime = substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);

                print( 5,20,'机构名称:[30]',$BRNAME);
                print( 5, 2,'代码: 3301');
                print( 5,13,'交易名称: 协定存款登记');
		print( 7,30,'\L0协定存款登记\L1');
		print( 9,20,'帐    号:[19]',#ACCOUNTNO);
		print( 9,10,'序    号:[4 ]',#ACCTSEQ);
		print(10,20,'协议帐号:[19]',#XYNO);
		print(11,20,'户    名:[60]',#ACTNAME);
		print(12,20,'留存金额:[20]',itoa(#SAVEMONEY,'%-17.2f'));
		print(13,20,'利    率:[10]',itoa(#RATE,'%-9.6f'));
		print_sq();
		print(24,20,'备注:');
                print(24,27,'交易日期:[8] [8]',$HDATE,@txtime);
                print(24,5,'柜员:[4]',$FD7);
                print(24,5,'流水号:[6]',$FD4);

		}"
	</PRINT>
</RESPONSE>

</TRANSACTION>
