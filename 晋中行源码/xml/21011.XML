<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11111001" TITLE="2101 建立客户识别ID"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	commsend_001();
	$FD25=#KHXM;
	$FD26=#TEL;
	$FD27=#ADDR;
	$FD62=#ZJHM;
	$FD67=#KHLX;
	$FD68=#ZJLX;
}"
</COMMSEND>
<COMMRECV>"{
	#CUSID=$FD28;
	#SERIAL=$FD4;
}"
</COMMRECV>

<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-52s" FUNCTIONS=
    "T(2101                            建立客户识别ID)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=1101)"/>

  <ITEM LINE="5"  COL="15"  TYPE="%-10s" FUNCTIONS="T(客户类型:!)" />
  <ITEM LINE="7"  COL="15"  TYPE="%-10s" FUNCTIONS="T(证件类型:!)" />
  <ITEM LINE="9"  COL="15"  TYPE="%-10s" FUNCTIONS="T(证件号码:)" />


  <ITEM LINE="11"  COL="15"  TYPE="%-10s" FUNCTIONS="T(客户名称:)" />
  <ITEM LINE="13"  COL="15"  TYPE="%-10s" FUNCTIONS="T(联系电话:)" />
  <ITEM LINE="15"  COL="15"  TYPE="%-10s" FUNCTIONS="T(联系地址:)" />

  <ITEM LINE="5" COL="26" NAME="#KHLX" TYPE="%-1s" INPUT="SELECT" ENABLE="FALSE" FUNCTIONS="" >
		<SELECT>
			<OPTION VALUE ="2" TITLE="0.公司" />
			<OPTION VALUE ="3" TITLE="0.机构" />
		</SELECT>
    <ONLOSTFOCUS>
	"{
	dim @txno_bak as string;
	dim @tota as string;
	@txno_bak=$TXNO;
	$TXNO='9799';
	$FD67=#KHLX;
	commsend_001();
	$TXNO=@txno_bak;
	@tota=callserver();	
	setsel(#ZJLX,@tota,'o5t20o1v1o2');
	}"
    </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="7" COL="26" NAME="#ZJLX" TYPE="%-1s" INPUT="SELECT" 
		FUNCTIONS="">
		<SELECT>
			<OPTION VALUE ="1" TITLE="1.身份证" />
		</SELECT>
  </ITEM>
  <ITEM LINE="9" COL="26" NAME="#ZJHM" TYPE="%-20s" FUNCTIONS="">
	<ONLOSTFOCUS>
	"{
		dim @l as number;
		@l = len(#ZJHM);
		if('1' == #ZJLX){
    		if(@l == 15 or  @l == 18){
		}else{
	  		showmsg('身份证号码位数错误');
        	return(false);
			}
    	}
	//检查是否该证件已经登记
		dim @txno_bak as string;
		dim @tota as string;
		@txno_bak=$TXNO;
		$TXNO='9797';
		$FD62=#ZJHM;
		$FD68=#ZJLX;
		commsend_001();
		$TXNO=@txno_bak;
		@tota=callserver();	
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
	}"
	</ONLOSTFOCUS>
  </ITEM>

  <ITEM LINE="11" COL="26" NAME="#KHXM" TYPE="%-50s" DEVICE="KEYBOARD" FUNCTIONS="T()V(NB)"/> 
  <ITEM LINE="13" COL="26" NAME="#TEL" TYPE="%-30s" DEVICE="KEYBOARD" FUNCTIONS="T()"/> 
  <ITEM LINE="15" COL="26" NAME="#ADDR" TYPE="%-50s" DEVICE="KEYBOARD" FUNCTIONS="T()"/> 

  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>

  <ITEM NAME="#CUSID" TYPE="%-8s" FUNCTIONS=""/>
  <ITEM NAME="#SERIAL" TYPE="%6d" FUNCTIONS=""/>
<!--
  <ITEM LINE="21"  COL="59" TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT" >
-->
<!--测试callserver方式提交 -->

  <ITEM LINE="21"  COL="59" TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON" >
  	<ONCLICK>
		"{
		dim @tota as string;
		dim @ch as string;
		commsend_001();
		$FD25=#KHXM;
		$FD26=#TEL;
		$FD27=#ADDR;
		$FD62=#ZJHM;
		$FD67=#KHLX;
		$FD68=#ZJLX;
		@tota=callserver();	
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
			}
		else{
			#CUSID=$FD28;
			#SERIAL=$FD4;
			runoutput();
			showall();
			if(#KHLX=='1'){ //个人客户
			  while(true){
				@ch=showmsg('选择要转入的交易，1-活期开户;2-定期开户;3-继续;0-退出 ：');
				if(@ch == '0')return(true);
				else if(@ch == '3'){	
					open('2102.XML', '#CUSID='+#CUSID+';');
					return(true);
					}
				else if(@ch == '1'){
					open('3101.XML', '#ID_TYPE='+#ZJLX+';#ID_NO='+#ZJHM+';');
					return(true);
					}
				else if(@ch == '2'){
					open('3103.XML','#CUSID='+#CUSID+';');
					return(true);
					}
				}
			  }
			  else if(#KHLX=='2' or #KHLX=='4'){ //公司、同业客户
				open('2103.XML','#CUSID='+#CUSID+';');
				return(true);
			  }
			  else{ //机构客户
				open('2111.XML','#CUSID='+#CUSID+';');
				return(true);
			  }
			}
		}"
	</ONCLICK>
  </ITEM>

</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE>
NOTHING
</PACKAGE>
</RESPONSE>

<OUTPUT>
<PACKAGE>
001$9999=9P110100A显示内容N505$FD2#CUSID#KHXM#SERIAL
</PACKAGE>
<FORMAT NAME="P110100A">
"03                                建立客户识别ID 
05                      开户行号 : #####
06                      客 户 号 : ########
07                      户    名 : ##################################################
08                      流 水 号 : ########
"
</FORMAT>
</OUTPUT>
</TRANSACTION>
