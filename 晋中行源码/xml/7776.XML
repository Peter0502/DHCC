<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11111111" TITLE="7776 电子现金单边撤销交易"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<FIRSTWORK>
	"{
			show(#ONE,true);
			show(#TWO,false);
			show(#TRACENO_TRAN,true);
	}"
</FIRSTWORK>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(7776                        电子现金单边撤销交易)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
    <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=7776)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  <!--输入变量-->
  <BLOCK NAME="COMMON" LINE="7" COL="12">
  <ITEM LINE="0" COL="0" TYPE="%-15s" FUNCTIONS="T(卡       号:)"/>
  <ITEM LINE="2" COL="0" TYPE="%-15s" FUNCTIONS="T(交 易 金 额:)"/>
  <ITEM LINE="4" COL="0" TYPE="%-15s" FUNCTIONS="T( 交易发起方:)"/> 
  <ITEM LINE="0" COL="14" TYPE="%-19s"  NAME="#TRAN_AC_NO" INPUT="TEXT"  DEVICE="ICC"  FUNCTIONS="V(NB)M($MSR2,1)">
  <ONLOSTFOCUS>
    "{
    	if(substr(#TRAN_AC_NO,0,6)!='621780')
    	{
    	 showmsg('此交易只支持本行IC卡!');
    	 return (false)
		  }
     }"
     </ONLOSTFOCUS>
     </ITEM>
  <ITEM NAME="#TXAMT" INPUT="TEXT" LINE="2" COL="14" TYPE="%17.2f" FUNCTIONS="V(NB)"/>
  <ITEM NAME="#ONETWO" INPUT="SELECT" LINE="4" COL="14" TYPE="%-3s" FUNCTIONS="T(001)">
  	<SELECT>
  		<OPTION VALUE="001" TITLE="1.行内柜面"/>
  		<!--OPTION VALUE="002" TITLE="2.西安卡系统"/-->
  	</SELECT>
    <ONLOSTFOCUS>
    "{
    	if(#ONETWO=='001')
    	{
    	 show(#ONE,true);
    	 show(#TWO,false);
    	 show(#TRACENO_TRAN,true);
     }
     if(#ONETWO=='002')
     {
      show(#TWO,true);
      show(#ONE,false);
      show(#TRACENO_TRAN,true);
      }
     }"
     </ONLOSTFOCUS>
     </ITEM>
     <ITEM LINE="6" COL="0" NAME="#ONE" TYPE="%-15s" FUNCTIONS="T(卡系统流水号:)" />
     <ITEM LINE="6" COL="0" NAME="#TWO" TYPE="%-15s"  FUNCTIONS="T(核心流水号:)"/>
     <ITEM NAME="#TRACENO_TRAN" INPUT="TEXT" LINE="6" COL="14" TYPE="%-19s" FUNCTIONS="V(NB)"/>
 </BLOCK>
  <!--输出变量--->
  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
	<ONCLICK>"{
		//发往核心调用授权交易
		initfd();
    commsend_001();
	  $FD16='3369';
	  callserver();
	  if($FD12 !='0000')
	  {
	   showmsg(geterror());
	   return(false);
	  }
	   showmsg('撤销授权!!...');
		initfd();
		commsend_001();
		$FD16='7776';
		$FD12='9999';
		$FD82=#ONETWO;
		$FD30=#TRAN_AC_NO;
		$FD39=itoa(#TXAMT*100);
		$FD43=#TRACENO_TRAN;
		callagn();
		if($FD12!='0000')
		{
			showmsg('撤销卡系统败:['+geterror()+']');
			return (false);  
		}
		showmsg('撤销成功!!...');
		runoutput();
		rerun();
	}"
 	</ONCLICK>
  </ITEM>
</VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
<PACKAGE DEVICE="SCRREN" DESC="单边撤销成功，按任意键打印">
NOTHING
</PACKAGE>
<PRINT>"{
	print(5,5,'单边撤销成功！');
}"
</PRINT>
</RESPONSE>
<OUTPUT>
</OUTPUT>
<RESPONSE>
	<PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="请打印业务专用凭证(单边撤销交易)">
		NOTHING
	</PACKAGE>
	<PRINT>
	"{
		dim @txday  as string;
		dim @txtime as string;
		dim @amt    as string;
		dim @ltxamt1    as string;
		@amt       ='￥'+ltrim(comma(#AMT));
		@ltxamt1   ='￥'+ltrim(comma(#LTXAMT1));
		@txday  = substr($HDATE,0,4)+'-'+substr($HDATE,4,2)+'-'+substr($HDATE,6,2);
		@txtime = substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
		print( 5, 20,'机构名称:[30]',$BRNAME);
		print( 5,  2,'代码:7776');
		print(5,13,'交易:卡单边撤销交易');	
		
		print( 7,30,'\L0卡单边撤销交易凭条\L1');  
    print(10, 20,'原帐/ 卡号:[20                    ]',#TRAN_AC_NO);
    print(11, 20,'原交易金额:[21  ]',#TXAMT);
    print(12, 20,'原卡系统流水:[20                    ]',#TRACENO_TRAN);
    print_sq(); 
    <!--
    print(19,80,'\H0相关人员已确认银行打印记录正确无误.\H1');
    -->
    print(20		,80,'柜员签名:_____________________');
    print(21,80,'授权柜员签名:_____________________'); 
	
    print(23,20,'备注:');
    print(23,27,'交易日期:[8] [8]',$HDATE,@txtime);
    print(23,5,'柜员:[4]',$FD7);
    print(23,5,'流水号:[6]',$FD4);
	}"
	</PRINT>
</RESPONSE>
</TRANSACTION>

