<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110100000000000000000000000000" TITLE="5515 支付凭证汇总查询"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	 
}"
</COMMSEND>
<COMMRECV>"{
	commrecv_001();
}"
</COMMRECV>

<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-50s" FUNCTIONS=
	"T(5515                       支付凭证汇总查询)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  
  <ITEM NAME="#DOLIST" TYPE="%-1s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
    if(#DOLIST!='')
    {
       
        dim  @selid as number;
        dim  @filename as string;
        
       dim @BANK_NO        as string;
       dim @FIN_NO         as string;
       dim @BILL_TYPE      as string;
       dim @BILL_NO        as string;
       dim @NO_DATE        as string;
       dim @TOT_AMT        as string;
       dim @QS_BK_CODE     as string;
       dim @QS_BK_NAME     as string;
       dim @QS_BK_ACCODE   as string;
       dim @QS_BK_ACNAME   as string;
       dim @PAY_AC_NO      as string;
       dim @PAY_NAME       as string;
       dim @PAY_OPN_BK     as string;
       dim @PAY_OPN_BKNAME as string;
       dim @PAYEE_AC_NO    as string;
       dim @PAYEE_NAME     as string;
       dim @PAYEE_BKNAME   as string;
       dim @FUND_TYPE      as string;  
      
        @selid=list_work();
        if(@selid &lt; 0)
        {
            list_del();
            rerun();
            return(true);
        }
        @selid=list_getselid();
        
        @BANK_NO       =rtrim(list_gettext(@selid,1));
        @FIN_NO        =rtrim(list_gettext(@selid,2)); 
        @BILL_TYPE     =rtrim(list_gettext(@selid,3)); 
        @BILL_NO       =rtrim(list_gettext(@selid,4)); 
        @NO_DATE       =rtrim(list_gettext(@selid,5)); 
        @TOT_AMT       =rtrim(list_gettext(@selid,6)); 
        @QS_BK_CODE    =rtrim(list_gettext(@selid,8)); 
        @QS_BK_NAME    =rtrim(list_gettext(@selid,9)); 
        @QS_BK_ACCODE  =rtrim(list_gettext(@selid,10)); 
        @QS_BK_ACNAME  =rtrim(list_gettext(@selid,11)); 
        @PAY_AC_NO     =rtrim(list_gettext(@selid,12));
        @PAY_NAME      =rtrim(list_gettext(@selid,13));
        @PAY_OPN_BK    =rtrim(list_gettext(@selid,14));
        @PAY_OPN_BKNAME=rtrim(list_gettext(@selid,15));
        @PAYEE_AC_NO   =rtrim(list_gettext(@selid,16));
        @FUND_TYPE     =rtrim(list_gettext(@selid,20));
        @PAYEE_NAME    =rtrim(list_gettext(@selid,17));
        @PAYEE_BKNAME  =rtrim(list_gettext(@selid,18));
        @FUND_TYPE     =rtrim(list_gettext(@selid,20));
        
         @filename='CFX_5515.XML';
        //showmsg(@filename);
       //showmsg('#BANK_NO='+@BANK_NO+';#FIN_NO='+@FIN_NO+';#BILL_TYPE='+@BILL_TYPE+';#BILL_NO='+@BILL_NO);
       //showmsg(';#NO_DATE='+@NO_DATE+';#TOT_AMT='+@TOT_AMT+';#QS_BK_CODE='+@QS_BK_CODE);
       //showmsg(';#QS_BK_NAME='+@QS_BK_NAME+';#QS_BK_ACCODE='+@QS_BK_ACCODE);
       //showmsg(';#QS_BK_ACNAME='+@QS_BK_ACNAME+';#PAY_AC_NO='+@PAY_AC_NO);
       //showmsg(';#PAY_NAME='+@PAY_NAME+';#PAY_OPN_BK='+@PAY_OPN_BK);
       //showmsg(';#PAY_OPN_BKNAME='+@PAY_OPN_BKNAME);
       //showmsg(';#PAYEE_AC_NO='+@PAYEE_AC_NO+';#PAYEE_NAME='+@PAYEE_NAME);
       //showmsg(';#PAYEE_BKNAME='+@PAYEE_BKNAME+';');
       open(@filename,'#BANK_NO='+@BANK_NO+';#FIN_NO='+@FIN_NO+';#BILL_TYPE='+@BILL_TYPE+';#BILL_NO='+@BILL_NO+';#NO_DATE='+@NO_DATE+';#TOT_AMT='+@TOT_AMT+';#QS_BK_CODE='+@QS_BK_CODE+';#QS_BK_NAME='+@QS_BK_NAME+';#QS_BK_ACCODE='+@QS_BK_ACCODE+';#QS_BK_ACNAME='+@QS_BK_ACNAME+';#PAY_AC_NO='+@PAY_AC_NO+';#PAY_NAME='+@PAY_NAME+';#PAY_OPN_BK='+@PAY_OPN_BK+';#PAY_OPN_BKNAME='+@PAY_OPN_BKNAME+';#PAYEE_AC_NO='+@PAYEE_AC_NO+';#FUND_TYPE='+@FUND_TYPE+';#PAYEE_NAME='+@PAYEE_NAME+';#PAYEE_BKNAME='+@PAYEE_BKNAME+';');
                                     
        return(true);
     } 
      list_del();
      #DOLIST='';
      return(true);

    }"</ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=1251)"/>
  <ITEM NAME="#TXNAME" TYPE="%-12s" FUNCTIONS="T(支付凭证单查询)"/><!---交易名称--->
  <ITEM NAME="#TXNUMBER" TYPE="%-4s" FUNCTIONS="T(1251)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  
  <BLOCK NAME="BLK" LINE="4" COL="10" >
  <ITEM LINE="5" COL="8" TYPE="%-10s" FUNCTIONS="T(机 构 号:!)"/>
  <ITEM LINE="5" COL="18" TYPE="%-5s" NAME="#TX_BR_NO" INPUT="TEXT" FUNCTIONS=""/>
  
  <ITEM LINE="6" COL="8" TYPE="%-10s" FUNCTIONS="T(银行编码: )"/>
  <ITEM LINE="6" COL="18" TYPE="%-16s" NAME="#BR_NO" INPUT="TEXT" FUNCTIONS=""/>
  
  <ITEM LINE="7" COL="8" TYPE="%-10s"  FUNCTIONS="T(财政编码: )"/>
  <ITEM LINE="7" COL="18" TYPE="%-16s" NAME="#FIN_CODE" INPUT="TEXT" FUNCTIONS=""/>
  
  <ITEM LINE="8" COL="8" TYPE="%-10s" FUNCTIONS="T(单据类型: )"/>
  <ITEM LINE="8" COL="18" TYPE="%-1s" NAME="#PAY_NOTE_TYPE" INPUT="SELECT" FUNCTIONS="">
    <SELECT>
  	  <OPTION VALUE="1"  TITLE="1.直接支付" />
  	  <OPTION VALUE="2"  TITLE="2.授权支付" />
  	  <OPTION VALUE="3"  TITLE="3.公 务 卡" />
  	</SELECT>
  </ITEM>
  <ITEM LINE="9" COL="8" TYPE="%-10s" FUNCTIONS="T(交易日期:!)"/>
  <ITEM LINE="9" COL="18" TYPE="%-8s" NAME="#TX_DATE" INPUT="TEXT" FUNCTIONS=""/>
   <ITEM LINE="9" COL="27" TYPE="%-1s" FUNCTIONS="T(-)"/>
  <ITEM LINE="9" COL="29" TYPE="%-8s" NAME="#TX_DATE_END" INPUT="TEXT" FUNCTIONS=""/>
  
  </BLOCK>
   <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  <ITEM LINE="21"  COL="59" TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
  <ONCLICK>
    "{
        dim @tota as string; 
        dim @filename as string; 
        initfd();
	      commsend_001();
	      if(#BR_NO=='' and #FIN_CODE=='' and #PAY_NOTE_TYPE=='' and #TX_BR_NO=='' and #TX_DATE=='' and #TX_DATE_END=='')
	      {
	         showmsg('至少要有一个查询条件!');
	         return(false);
	      }
	      $FD16=#TXNO;
	      $FD44=#TX_DATE;
	      $FD45=#TX_DATE_END;
	      
	      $FD59=#FIN_CODE;
	      $FD60=#BR_NO;
	      $FD67=#PAY_NOTE_TYPE;
	      $FD91=#TX_BR_NO;
	      
	      @tota=calltips();
        if( $FD12!='0000')
        {
            showmsg(geterror());
            rerun();
  		      return(false);
        }
        if(autolist(@tota))
        {
            //list_work();
        }
         
        #DOLIST='1';
    }"
  </ONCLICK> 
   </ITEM> 
</VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
	<PACKAGE DEVICE="SCREEN"  DESC="交易完成">  
		NOTHING
	</PACKAGE>
		<PRINT>
		"{
			
		}"
		</PRINT>
</RESPONSE>

<RESPONSE>
<PACKAGE DEVICE="PRINTER" DESC="请打印凭证" LINESPACE="24" >
NOTHING
</PACKAGE>
<INIT>
"{
}"
</INIT>
<PRINT>
"{
	

}"
</PRINT>
</RESPONSE>

<OUTPUT>
</OUTPUT>
</TRANSACTION>

