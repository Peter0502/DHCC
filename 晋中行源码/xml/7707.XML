<TRANSACTION RIGHTS="00111000" TITLE="7707 高级预授权" 
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	commsend_001();
//	$FD40=itoa(#AUTHAMT,'%12.2f');
        $FD40=getitems('#AUTHAMT');
	$FD45=#EFFDATE;
	$FD79=#AUTHPASSWD;
	$FD88=$TLRNO;
}"
</COMMSEND>
<COMMRECV>"{
		commrecv_001();
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(7707                          高级预授权)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=5707)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  <ITEM LINE="5"   COL="15" TYPE="%-10s" FUNCTIONS="T(机构编码:)"/>
  <ITEM LINE="6"   COL="15" TYPE="%-10s" FUNCTIONS="T(柜 员 号:)"/>
  <ITEM LINE="8"   COL="15" TYPE="%-10s" FUNCTIONS="T(有效日期:)"/>
  <ITEM LINE="10"  COL="15" TYPE="%-10s" FUNCTIONS="T(交易代码:)"/>
  <ITEM LINE="12"  COL="15" TYPE="%-10s" FUNCTIONS="T(授权金额:)"/>
  <ITEM LINE="14"  COL="15" TYPE="%-10s" FUNCTIONS="T(授权帐号:)"/>
  <!--ITEM LINE="17"  COL="15" TYPE="%-10s" FUNCTIONS="T(主管密码:)"/--> 
  <ITEM LINE="5"  COL="25" NAME="#AUTHBRNO" INPUT="TEXT"  TYPE="%-5s" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>"{
	dim @tota as string;
	commsend_001();
	$FD16='9670';
	$FD91=#AUTHBRNO;
	@tota=callserver();
	if($FD12!='0000'){
		showmsg(geterror());
		return(false);
	}
	#AUTHBRNAME=delspace($FD26);
	show(#AUTHBRNAME,true);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="5"  COL="35" NAME="#AUTHBRNAME" INPUT="LABEL"  TYPE="%-30s" FUNCTIONS="V(NB)"/> 
  <ITEM LINE="6"  COL="25" NAME="#AUTHTLRNO" INPUT="TEXT"  TYPE="%-4s" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>"{
	dim @tota as string;
	commsend_001();
	$FD16='9671';
	$FD91=#AUTHBRNO;
	$FD92=#AUTHTLRNO;
	@tota=callserver();
	if($FD12!='0000'){
		showmsg(geterror());
		return(false);
	}
	#AUTHTLRNAME=delspace($FD58);
	show(#AUTHTLRNAME,true);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="6"  COL="35" NAME="#AUTHTLRNAME" INPUT="LABEL"  TYPE="%-30s" FUNCTIONS="V(NB)"/> 
  <ITEM LINE="8"  COL="25" NAME="#EFFDATE" INPUT="TEXT"  TYPE="%-8s" FUNCTIONS="D()"/> 
  <ITEM LINE="10"  COL="25" NAME="#TXCODE" INPUT="TEXT"  TYPE="%-4s" FUNCTIONS="T(2611)">
  <ONLOSTFOCUS>"{
	dim @tota as string;
	commsend_001();
	$FD16='9672';
	$FD64=#TXCODE;
	@tota=callserver();
	if($FD12!='0000'){
		showmsg(geterror());
		return(false);
	}
	#TXNAME=delspace($FD63);
	show(#TXNAME,true);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="10"  COL="35" NAME="#TXNAME"  INPUT="LABEL" TYPE="%-30s"  FUNCTIONS="V(NB)"/> 
  <ITEM LINE="12"  COL="25" NAME="#AUTHAMT" INPUT="TEXT"  TYPE="%17.2f" FUNCTIONS=""/> 
  <ITEM NAME="#XAUTHAMT"    TYPE="%-21s"    FUNCTIONS="X(#AUTHAMT)"/> 

  <ITEM LINE="14"  COL="25" NAME="#AUTHACTNO" INPUT="TEXT"  TYPE="%-19s" FUNCTIONS="">
  <ONLOSTFOCUS>"{
	dim @tota as string;
	if(delspace(#AUTHACTNO)==''){
		return(true);
	}
	commsend_001();
	$FD16='9673';
	$FD30=#AUTHACTNO;
	@tota=callserver();
	if($FD12!='0000'){
		showmsg(geterror());
		return(false);
	}
	#AUTHNAME=delspace($FD25);
	show(#AUTHNAME,true);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="15"  COL="25" NAME="#AUTHNAME" INPUT="LABEL"  TYPE="%-60s" FUNCTIONS="V(NB)"/> 
  <!--ITEM LINE="17"  COL="25" NAME="#AUTHPASSWD" INPUT="TEXT"  TYPE="%6d" FUNCTIONS="i()"/--> 
  <ITEM NAME="#AUTHPASSWD" TYPE="%6d" FUNCTIONS=""/> 
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  <ITEM NAME="#SUBMIT" LINE="21"  COL="65" TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
  <ONCLICK>"{
	submit();
  }"
  </ONCLICK>
  </ITEM>

</VARIABLE>
<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="显示结果">
	NOTHING
</PACKAGE>
	<PRINT>"{
		print( 5,20,'授权成功,授权码:[7    ]',substr($FD44,1,7));
	}"
	</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="请打印业务专用凭证(高级预授权信息)">
	NOTHING
</PACKAGE>
	<PRINT>"{
		$KINDNO='00';
		dim @txtime  as string;
		@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
                print( 5, 20,'机构名称:[30]',$BRNAME);
                print( 5, 2,'代码:7707');
                print( 5, 13,'交易:高级预授权');
		print( 7, 20,'申请机构:[5]  [30]',#AUTHBRNO,#AUTHBRNAME);
		print( 8, 20,'申请柜员:[4]   [30]',#AUTHTLRNO,#AUTHTLRNAME);
		print( 9, 20,'有效日期:[8]',#EFFDATE);
		print( 10, 20,'交    易:[4]   [30]',#TXCODE,#TXNAME);
		print( 11, 20,'授权金额:[20]',#XAUTHAMT);
		print( 12, 20,'授权帐号:[19]   户    名:[60]',#AUTHACTNO,#AUTHNAME);
		print( 13, 20,'主管柜员:[4]',$TLRNO);
		print( 14, 20,'授 权 码:[7]',substr($FD44,1,7));
	        print( 24,20,'备注:')
                print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
                print( 24,5,'柜员:[4]',$FD7);
                print( 24,5,'流水号:[6]',$FD4);

             }"
	</PRINT>
</RESPONSE>
</TRANSACTION>
