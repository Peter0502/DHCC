<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11000000" TITLE="3404 捡拾交易"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	commsend_001();

    	$FD67=#OPRTYPE;	
    	$FD102=#ACTNO24+space(354); 	
    	$FD114=getitems('#SPACE1#PWDFLAG#SPACE6#DRAW_PWD#CERTFLAG#CERTNO#SPACE1#CERTTYPE#SPACE1#SPACE1'); 	
}"
</COMMSEND>

<COMMRECV>"{
	commrecv_001();
}"
</COMMRECV>

<VARIABLE UPLOOP="TRUE">
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(3404                          捡 拾 交 易)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>

  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=2404)"/>    
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>

  <ITEM NAME="#ACTNO24"   TYPE="%-24s" FUNCTIONS=""/>  
  <ITEM NAME="#SPACE354" TYPE="%-354s" FUNCTIONS=""/>  
  <ITEM NAME="#SPACE1" TYPE="%-1s" FUNCTIONS=""/> 
  <ITEM NAME="#SPACE6" TYPE="%-6s" FUNCTIONS=""/>   
  <ITEM NAME="#SPACE20" TYPE="%-20s" FUNCTIONS=""/>      
  <BLOCK NAME="COMM" LINE="0" COL="10">
  <ITEM LINE="7"  COL="5" TYPE="%-10s" FUNCTIONS="T(处理标志:!)"/>  
  <ITEM NAME="#OPRTYPE" LINE="7"  COL="15" TYPE="%-1s" INPUT="SELECT" FUNCTIONS="T(1)" >
	<SELECT>
		<OPTION VALUE="1" TITLE="0.捡拾"/>
		<OPTION VALUE="2" TITLE="1.归还"/>		
	</SELECT>
  </ITEM> 
  
  <ITEM LINE="9"  COL="5"  TYPE="%-10s"  FUNCTIONS="T(账/卡 号:)"/>
  <ITEM LINE="9"  COL="15" NAME="#ACTNO" INPUT="TEXT" TYPE="%-19s" VISABLE="TRUE" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>"{
    	dim @baktxno as string;
    	@baktxno=$TXNO;

     	$FD2=$OPNBR;
     	$FD3=$KINBR;
     	$FD5=$HDATE;
     	$FD7=$TLRNO;
     	$FD10=$TTYNAME;
     	$FD16='9790';
     	$FD79=#PASSWD; 
	

    	$FD67=#OPRTYPE;
    	$FD102=#ACTNO+space(359); 
    	   	
    	callserver();
    	$TXNO=@baktxno;
    	
    	if($FD12!='0000'){
    		showmsg(geterror());
    		return(false);
    	}

    	setitems('#ACTNO24#SPACE354',$FD102);   
    	setitems('#CUSTNAME',$FD25);  
    	setitems('#SPACE1#PWDFLAG#SPACE6#SPACE6#CERTFLAG#SPACE20#SPACE1#CERTTYPE#SPACE1#SPACE1',$FD114);    	 
    	
    	// showmsg(#CUSTNAME);

      if (#OPRTYPE == '2')
      {
        	  showblock('PWDINFO',true,true);
        	    	
            if (#PWDFLAG=='Y')
            {
            	  show(#LDRAW_PWD,true);
            	  show(#DRAW_PWD,true);         	         
            }
            else
            {
            	  show(#LDRAW_PWD,false);
            	  show(#DRAW_PWD,false); 
            } 
               		 
            if (#CERTFLAG=='Y')
            {   
                showblock('CERTINFO',true,true);
            }
            else
            {
                showblock('CERTINFO',false,true);
            } 
      } 
      else
      {
        	  showblock('PWDINFO',false,true);      
            showblock('CERTINFO',false,true);      
      } 	
    	 
  }"
  </ONLOSTFOCUS>
  </ITEM>  
  
  <ITEM LINE="11"  COL="5"  TYPE="%-10s" FUNCTIONS="T(户    名:)"/>
  <ITEM LINE="11"  COL="15" NAME="#CUSTNAME"  INPUT="LABEL" TYPE="%-50s" VISABLE="TRUE" FUNCTIONS="J(#CUSTNAME30)"/>
  <ITEM NAME="#CUSTNAME30" TYPE="%-30s" FUNCTIONS="T(#CUSTNAME)"/> 
  </BLOCK>  
  
  <BLOCK NAME="PWDINFO" LINE="11" COL="8" VISABLE="FALSE" >  

  <ITEM LINE="0"  COL="40"  TYPE="%-50s" FUNCTIONS="T(【归还校验栏】)"/>
  <ITEM LINE="1"  COL="0"  TYPE="%-60s" FUNCTIONS="T(--------------------------------------------------------------------------)"/>
  <ITEM LINE="3"  COL="7" NAME="#LPWDFLAG" TYPE="%-10s"  FUNCTIONS="T(密码支取:!)"/> 
      
  <ITEM  NAME="#PWDFLAG" LINE="3"  COL="17"  TYPE="%-1s" INPUT="SELECT" FUNCTIONS="" ENABLE="FALSE">
  <SELECT>
    		<OPTION VALUE="Y" TITLE="0.是"/>	
    		<OPTION VALUE="N" TITLE="1.否"/>		
 	</SELECT>
  </ITEM>  	   

  <ITEM  LINE="3"  COL="35" NAME="#LDRAW_PWD" TYPE="%-10s"  FUNCTIONS="T(支取密码: )"  />	   
  <ITEM  LINE="3"  COL="45" NAME="#DRAW_PWD"  TYPE="%6d"  DEVICE="PINPAD" INPUT="TEXT"   FUNCTIONS="V(NB)i()" /> 

   <ITEM LINE="4"  COL="7" TYPE="%-10s" FUNCTIONS="T(证件支取:!)"/>
  <ITEM LINE="4"  COL="17" NAME="#CERTFLAG" TYPE="%-1s"  INPUT="SELECT" FUNCTIONS="" ENABLE="FALSE" >
	<SELECT>
    		<OPTION VALUE="Y" TITLE="0.是"/>	
    		<OPTION VALUE="N" TITLE="1.否"/>					
	</SELECT>
  </ITEM> 

  </BLOCK>
  
  <BLOCK NAME="CERTINFO" LINE="16" COL="10" VISABLE="FALSE">     
  <ITEM NAME="#LCERTTYPE" LINE="0"  COL="5"  TYPE="%-10s" INPUT="LABEL"  FUNCTIONS="T(证件类型:!)" /> 
  <ITEM NAME="#CERTTYPE" LINE="0"  COL="15" TYPE="%-1s" INPUT="SELECT"  FUNCTIONS=""  >
    	<SELECT>
    		<OPTION VALUE="1" TITLE="0.身份证"/>
    		<OPTION VALUE="2" TITLE="1.户口簿"/>		
    		<OPTION VALUE="3" TITLE="2.护照"/>		
    		<OPTION VALUE="4" TITLE="3.军官证"/>		
    		<OPTION VALUE="5" TITLE="4.回乡证"/>	
    		<OPTION VALUE="6" TITLE="5.居住证"/>
    		<OPTION VALUE="7" TITLE="6.驾照"/>		
    		<OPTION VALUE="8" TITLE="7.企业代码证"/>		
    		<OPTION VALUE="9" TITLE="8.组织机构号"/>		
    		<OPTION VALUE="A" TITLE="9.营业执照"/>			
    		<OPTION VALUE="B" TITLE="a.经营许可证"/>
    		<OPTION VALUE="C" TITLE="b.事业法人证书"/>				
    	</SELECT>
      </ITEM> 
    <ITEM NAME="#LCERTNO" LINE="0"  COL="33"   TYPE="%-10s" INPUT="LABEL"  FUNCTIONS="T(证件号码:)" /> 
    <ITEM NAME="#CERTNO" LINE="0"  COL="43"  TYPE="%-20s" DEVICE="KEYBOARD" INPUT="TEXT" FUNCTIONS="V(NB)"/> 
  </BLOCK>  

  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  
     
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT" />
    
</VARIABLE>


<REQUEST>
</REQUEST>
<RESPONSE>
	<PACKAGE DEVICE="SCREEN" DESC="捡拾交易成功">
      NOTHING
	</PACKAGE>
	  
	<PRINT>"{
		if (#OPRTYPE == '1')
		{
			print(5,28,'捡拾交易捡拾成功！');
			print(8,22,'交易类别:捡拾');
			print(9,22,'捡拾帐号:[24 ]',#ACTNO);
			print(10,22,'流水号  :[6  ]',$FD4);

		}
		else
		{
			print(5,28,'捡拾交易归还成功！');
			print(8,22,'交易类别:归还');
			print(9,22,'归还帐号:[24 ]',#ACTNO);
			print(10,22,'流水号  :[6  ]',$FD4);
		}
		}"
	</PRINT>
</RESPONSE>
<RESPONSE>
	<PACKAGE DEVICE="PRINTER" DESC="请打印业务专用凭证">
      NOTHING
	</PACKAGE>
	  
	<PRINT>"{
		$KINDNO='00';
		dim @txtime  as string;
		@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
		print( 5,20,'机构名称:[30]',$BRNAME);
		print( 5,2,'代码:2101');
		print( 5,13,'交易:建立客户ID');
		if (#OPRTYPE == '1')
		{
			print(7,20,'交易日期:[8  ]',$FD5);
			print(8,20,'交易类别:捡拾');
			print(9,20,'捡拾帐号:[24 ]',#ACTNO);
		}
		else
		{
			print(7,20,'交易日期:[8  ]',$FD5);
			print(8,20,'交易类别:归还');
			print(9,20,'归还帐号:[24 ]',#ACTNO);
		}
		print_sq();
		print(24,20,'备注:');
		print(24,27,'交易日期:[8] [8]',$HDATE,@txtime);
		print(24,5,'柜员:[4]',$FD7);
		print(24,5,'流水号:[6]',$FD4);
	}"
	</PRINT>
</RESPONSE>


</TRANSACTION>



