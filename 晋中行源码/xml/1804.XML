<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11111111011100000000000001100010" TITLE="1804 借记业务复核"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>
  "{
	refresh();
	initfd();
	commsend_001();
  }"
</COMMSEND>
<COMMRECV>
  "{
	commrecv_001();
  }"
</COMMRECV>
<VARIABLE>
	<ITEM LINE="3"  COL="3" TYPE="%-52s" FUNCTIONS="T(1804               借记业务复核)"/>
	<ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS="T(─────────────────────────────────────)"/>
	<ITEM NAME="#Busitype" TYPE="%-60s" FUNCTIONS="T()"/>
  	<ITEM NAME="#Busikind" TYPE="%-60s" FUNCTIONS="T()"/>
   	<ITEM NAME="#Payeract" TYPE="%-60s" FUNCTIONS="T()"/>
  	<ITEM NAME="#Payeeact" TYPE="%-60s" FUNCTIONS="T()"/>
  	<ITEM NAME="#payername" TYPE="%-60s" FUNCTIONS="T()"/>
  	<ITEM NAME="#payeename" TYPE="%-60s" FUNCTIONS="T()"/>
  	<ITEM NAME="#txamt" TYPE="%17.2f" FUNCTIONS="T()"/>
  	<ITEM NAME="#TXCODE" TYPE="%-30s" FUNCTIONS="T(1804)"/>
  	<ITEM NAME="#TXNAME" TYPE="%-30" FUNCTIONS="T(统一支付借记复核)"/>
	<ITEM LINE="5"  COL="3"  TYPE="%-12s"  FUNCTIONS="T(交易  序号:)" />
	<ITEM LINE="5"  COL="15" NAME="#TxNo" TYPE="%-15s" INPUT="TEXT" FUNCTIONS="T()V(NB)" />
	<ITEM LINE="5"  COL="35"  TYPE="%-12s"  FUNCTIONS="T(交易  日期:)" />
	<ITEM LINE="5"  COL="47"  NAME="#TxDate" TYPE="%-8s" INPUT="TEXT" FUNCTIONS="T()V(NB)">
		<ONLOSTFOCUS>
		"{
			dim @fNumb as number;
			initfd();
			commsend_001();
			$FD44=#TxNo;
			$FD16='1108';
			$FD18='pbp';
			$FD61=#TxDate;
			$FD29='1204';
			callagnpbp();

			if ($FD12 != '0000')
			{
				showmsg(geterror());
				return(false);
			}
			@fNumb = val($FD39, 1);
			#Busitype=$FD81;
			#Busikind=$FD82;
			#PayrName=$FD25;
			#PayeName=$FD26;
			#payername=$FD25;
			#payeename=$FD26;
			#PayerAddr=$FD27;
			#PayeeAddr=$FD116;
			#Ps=$FD113;
			
			#Payeract = $FD31;
			#Payeeact = $FD30;
			#txamt =@fNumb;
	
			setsel(#BusyType,#Busitype,'v4o1t32o1');
			#BusyType=substr(#Busitype,0,4);
			setsel(#BusyKind,#Busikind,'v5o1t32o1');
			#BusyKind=substr(#Busikind,0,5);
			enable(#BusyType,false);
			enable(#BusyKind,false);
			enable(#PayrName,false);
			enable(#PayerAddr,false);
			enable(#PayeName,false);
			enable(#PayeeAddr,false);
			enable(#Ps,false);
			showblock('block_info',true,true);
			showall();
			refresh();
		}"
		</ONLOSTFOCUS>
	</ITEM>
	<BLOCK NAME="block_info" LINE="6"  COL="0" VISABLE="FALSE">
	<ITEM LINE="0"  COL="3"  TYPE="%-12s"  FUNCTIONS="T(付款行行号:)" />
	<ITEM LINE="0"  COL="15" NAME="#InBankNo" TYPE="%-20s" INPUT="TEXT" FUNCTIONS="T()V(NB)" >
	<ONLOSTFOCUS>
	"{
		if (delspace($FD59) != #InBankNo)
		{
			showmsg('付款行行号复核失败');
			return(false);
		}
	}"
	</ONLOSTFOCUS>
	</ITEM>
	<ITEM LINE="1"  COL="3"  TYPE="%-12s"  FUNCTIONS="T(付款人账号:)" />
	<ITEM LINE="1"  COL="15" NAME="#PayerAcct" TYPE="%-32s" INPUT="TEXT" FUNCTIONS="T()V(NB)" >
	<ONLOSTFOCUS>
	"{
		if (delspace($FD30) != #PayerAcct)
		{
			showmsg($FD35);
			showmsg('付款人账号复核失败');
			return(false);
		}
	}"
	</ONLOSTFOCUS>
	</ITEM>
	<ITEM LINE="2"  COL="3"  TYPE="%-12s"  FUNCTIONS="T(付款人户名:)" />
	<ITEM LINE="2"  COL="15" NAME="#PayrName" TYPE="%-60s"  INPUT="TEXT" FUNCTIONS="T()V(NB)" />
	<ITEM LINE="3"  COL="3"  TYPE="%-12s"  FUNCTIONS="T(付款人地址:)" />
	<ITEM LINE="3"  COL="15" NAME="#PayerAddr" TYPE="%-60s"  INPUT="TEXT" FUNCTIONS="T()" />
	<ITEM LINE="5"  COL="3"  TYPE="%-12s"  FUNCTIONS="T(收款人账号:)" />
	<ITEM LINE="5"  COL="15" NAME="#PayeeAcct" TYPE="%-32s" INPUT="TEXT" FUNCTIONS="T()V(NB)" >
	<ONLOSTFOCUS>
	"{
		if (delspace($FD31) != #PayeeAcct)
		{
			showmsg('收款人账号复核失败');
			return(false);
		}
	}"
	</ONLOSTFOCUS>
	</ITEM>
	<ITEM LINE="6"  COL="3"  TYPE="%-12s"  FUNCTIONS="T(收款人户名:)" />
	<ITEM LINE="6"  COL="15" NAME="#PayeName" TYPE="%-60s"  INPUT="TEXT" FUNCTIONS="T()V(NB)" />
	<ITEM LINE="7"  COL="3"  TYPE="%-12s"  FUNCTIONS="T(收款人地址:)" />
	<ITEM LINE="7"  COL="15" NAME="#PayeeAddr" TYPE="%-60s"  INPUT="TEXT" FUNCTIONS="T()" />
	<ITEM LINE="9"  COL="3"  TYPE="%-12s"  FUNCTIONS="T(交易  金额:)" />
	<ITEM LINE="9"  COL="15" NAME="#TradeAmt" TYPE="%16.2f" INPUT="TEXT" FUNCTIONS="T()V(NB)">
	<ONLOSTFOCUS>
	"{
		dim @fNumb as number;
		@fNumb = val($FD39, 1);
			
		if (@fNumb != #TradeAmt)
		{
			showmsg('交易金额复核失败');
			return(false);
		}
	}"
	</ONLOSTFOCUS>
	</ITEM>
	<ITEM LINE="11" COL="3" TYPE="%-12s" FUNCTIONS="T(业务  类型:)"/>
	<ITEM NAME="#BusyType" LINE="11" COL="15" INPUT="SELECT"  TYPE="%-4s"  FUNCTIONS="T()V(NB)" >
		<SELECT>
		</SELECT>
	</ITEM>
	<ITEM LINE="12" COL="3" TYPE="%-12s" FUNCTIONS="T(业务  种类:)"/>
	<ITEM NAME="#BusyKind" LINE="12" COL="15" INPUT="SELECT"  TYPE="%-5s"  FUNCTIONS="T()V(NB)" >
		<SELECT>
		</SELECT>
	</ITEM>
	

	<ITEM LINE="13"  COL="3"  TYPE="%-12s"  FUNCTIONS="T(附      言:)" />
	<ITEM LINE="13"  COL="15" NAME="#Ps" TYPE="%-60s"  INPUT="TEXT" FUNCTIONS="T()" />
	</BLOCK>
	<ITEM LINE="21"  COL="59" TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON" >
	<ONCLICK>
	"{
		initfd();
		commsend_001();
		
		$FD16='1204';
		$FD18='pbp';
		$FD28='sxps';
		$FD38=#TxNo;
		$FD61=#TxDate;
		callagnpbp();
		
		if($FD12!='0000')
		{
			showmsg(geterror());
			return(false);
		}
		runoutput();
		showall();
		rerun();
		refresh();
	}"
	</ONCLICK>
	</ITEM>
</VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="按任意键退出">
NOTHING
</PACKAGE>
	<PRINT>
	"{
		
		PrintTxHead();
	//	print(1,25, '1204 借记业务复核');
		
		print( 3, 10,'付款人账号:[20]',#Payeract);
   		print(3, 40,'付款人姓名:[60]',#payername);
   		print(5,10,'收款人账号:[20]',#Payeeact);
   		print(5,40,'收款人姓名:[60]',#payeename);
   		print(7,10,'交易金额:[20]',ltrim(itoa(#txamt,'%.2f')));
		print( 9, 10,'交易序号:[10]',#TxNo);
		print(9,40,'交易日期:[8]',#TxDate);
	
		PrintTxTail();		
	//	print(20,10,'柜员:[6]   日期:[10]   流水号:[20]',$FD7,$FD5,$FD56);
		}"
	</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="请打印业务专用凭证" >
NOTHING
</PACKAGE>
<PRINT>"{
		$KINDNO='00';
		dim @txtime as string;
		@txtime = substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
		
		print( 3, 10,'机构名称:[30]',$BRNAME);
		print( 3, 0,'代码:1204');
		print( 3, 5,'交易:借记业务复核');
		

		print(11, 20,'付款人账号:[20]',#PayerAcct);
		print(12, 20,'付款人姓名:[60]',#PayerName);  		
   		print(13, 20,'交易  金额:[20]',ltrim(itoa(#txamt,'%.2f')));
   		print(14, 20,'收款人账号:[20]',#PayeeAcct);
   		print(15, 20,'收款人姓名:[60]',#PayeeName);
   		print(16, 20,'附      言:[60]',#PS);
		print(17, 20,'交易  序号:[10]',#TxNo);		
		print(11, 20,'交易  日期:[8]',#TxDate);
		
		printacdtl_1();
		print(23,10,'交易日期:[8] [8]',$HDATE,@txtime);
		print(23,5,'柜员:[4]',$FD7);
		print(23,5,'流水号:[6]',$FD56);	
	}"
	</PRINT>
</RESPONSE>
</TRANSACTION>
