<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110000" TITLE="5360 小额来账查询与打印"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{    
}"
</COMMSEND>
<COMMRECV>"{
commrecv_001();
if($FD12 == '0000')
{
   showmsg('交易成功!');
}
}"
</COMMRECV>
<VARIABLE>

  <ITEM NAME="#DOLIST" TYPE="%-1s" FUNCTIONS="">
  <ONLOSTFOCUS>"{
    dim @selid as number;
    dim @prtflg as string;
    dim @cnt as number;
    @prtflg='';
    if(#DOLIST!=''){
      while(true){
        @selid=list_getselid();
        if(@selid &lt; 0){
          break;
        }
        if(#ZFTYPE=='0')
        {
 
          show(#BOX1,true);
          show(#BOX2,true);
          show(#BOX3,true);
          show(#BOX4,true);
          show(#BOX5,true);
          show(#BOX6,true);
          show(#BOX7,true);
          show(#BOX8,true);
          show(#BVTYPE,true);
          show(#BVOCNUM,true);
          goitem(#BVOCNUM,false);
          return(true);
        }
        else
        {
          #TXDAY=delspace(list_gettext(@selid,1));
          #NEXTORDERNO=list_gettext(@selid,2);
          #PAY_QS_NO=list_gettext(@selid,10);
          #XSTAT=delspace(list_gettext(@selid,6));
          #NEXTORBRNO=list_gettext(@selid,12);
          #NEXTVOCNUM=#VOCNUM;
          #CPKGNO=delspace(list_gettext(@selid,7));
          if(#CPKGNO=='普通贷记'){#PKGNO='001';};    
          if(#CPKGNO=='普通借记'){#PKGNO='002';};    
          if(#CPKGNO=='实时贷记'){#PKGNO='003';};    
          if(#CPKGNO=='实时借记'){#PKGNO='004';};    
          if(#CPKGNO=='定期贷记'){#PKGNO='005';};    
          if(#CPKGNO=='定期借记'){#PKGNO='006';};    
          if(#CPKGNO=='贷记退汇'){#PKGNO='007';};    
          if(#CPKGNO=='普借回执'){#PKGNO='008';};    
          if(#CPKGNO=='实时贷记回执'){#PKGNO='009';};
          if(#CPKGNO=='实时借记回执'){#PKGNO='010';};
          if(#CPKGNO=='定期借记回执'){#PKGNO='011';};
          if(#CPKGNO=='通用信息'){#PKGNO='012';};    
          if(#CPKGNO=='实时信息'){#PKGNO='013';};    
          if(#CPKGNO=='小额查询'){#PKGNO='301';};    
          if(#CPKGNO=='小额查复'){#PKGNO='302';};    
          if(#CPKGNO=='自由格式'){#PKGNO='303';};    
          if(#CPKGNO=='申请退回'){#PKGNO='319';};    
          if(#CPKGNO=='退回应答'){#PKGNO='320';};    
          if(#CPKGNO=='申请撤销'){#PKGNO='321';};    
          if(#CPKGNO=='撤销应答'){#PKGNO='322';};    
          if(#CPKGNO=='冲正申请'){#PKGNO='323';};    
          if(#CPKGNO=='冲正应答'){#PKGNO='324';};    
          if(#CPKGNO=='冲正通知'){#PKGNO='325';};    
          if(#CPKGNO=='止付申请'){#PKGNO='327';};    
          if(#CPKGNO=='止付应答'){#PKGNO='328';};    
          
          list_show();
          while(true)
          {
            @prtflg=delspace(list_gettext(@selid,8));
            if(@prtflg=='已打印')
            {
              if(msgbox('此笔交易已打印!确定重新打印吗!'+chr(10)+
              '    交易序号:'+#NEXTORDERNO+chr(10)+
              '─────────────'
              ,'提示','yes|no')!=0){break;}
              #CPRTFLAG='重复打印';
            }else{
              #CPRTFLAG='首次打印';
              if(msgbox('打印此笔交易吗?'+chr(10)+
                '    交易序号:'+#NEXTORDERNO+chr(10)+
                '─────────────'
                ,'提示','yes|no')!=0){break;}
            }
            #TXAMT=0;
            initfd();
            commsend_001();
            $FD44=#TXDAY;
            //$FD29=#NEXTORDERNO;
            $FD58=#NEXTORDERNO;
            $FD23=#PKGNO;
            $FD69=#TXSTAT;
            $FD90=#VTYPE;
            $FD60=#NEXTVOCNUM;
            $FD72=#ZFTYPE;
            $FD16='9091';
            $FD30=#PAY_QS_NO;
            $FD31=#NEXTORBRNO;
            callserver();
            if($FD12!='0000')
            {
                showmsg(geterror());
                goitem('#DOLIST',false);
                return(true);      
            }
            commrecv_v123();
            //showmsg('1='+#WT_DATE);
            #NEXTVOCNUM=delspace(substr($FD96,0,60));
            setitems('#AMT',$FD39);
            runoutput();
            list_rmitem(@selid);                              
            list_show();
            @selid=list_getselid();
            @cnt=list_getrowcnt();
            if(@cnt==0)
            {
              msgbox('    小额来账打印完毕    '+chr(10)+'─────────────');
              break;
            }
            #TXDAY=delspace(list_gettext(@selid,1));
            #NEXTORDERNO=list_gettext(@selid,2);
            #NEXTORBRNO=list_gettext(@selid,12);
            #XSTAT=delspace(list_gettext(@selid,6));
          } 
          list_del();
          #DOLIST='0';
          return(true);
        }        
      }
      list_del();
      #DOLIST='';
    }
  }"
  </ONLOSTFOCUS>
  </ITEM>
 
  <ITEM LINE="8"  COL="17" NAME="#BOX1" INPUT="LABEL" VISABLE="FALSE" TYPE="%-50s" FUNCTIONS="T(┌─────────────────────┐)"/>
  <ITEM LINE="9"  COL="17" NAME="#BOX2" INPUT="LABEL" VISABLE="FALSE" TYPE="%-50s" FUNCTIONS="T(│                                          │)"/>
  <ITEM LINE="10" COL="17" NAME="#BOX3" INPUT="LABEL" VISABLE="FALSE" TYPE="%-50s" FUNCTIONS="T(│  凭 证 类 型!:                           │)"/>
  <ITEM LINE="11" COL="17" NAME="#BOX4" INPUT="LABEL" VISABLE="FALSE" TYPE="%-50s" FUNCTIONS="T(│                                          │)"/>
  <ITEM LINE="12" COL="17" NAME="#BOX5" INPUT="LABEL" VISABLE="FALSE" TYPE="%-50s" FUNCTIONS="T(│                                          │)"/>
  <ITEM LINE="13" COL="17" NAME="#BOX6" INPUT="LABEL" VISABLE="FALSE" TYPE="%-50s" FUNCTIONS="T(│  凭 证 号 码 :                           │)"/>
  <ITEM LINE="14" COL="17" NAME="#BOX7" INPUT="LABEL" VISABLE="FALSE" TYPE="%-50s" FUNCTIONS="T(│                                          │)"/>
  <ITEM LINE="15" COL="17" NAME="#BOX8" INPUT="LABEL" VISABLE="FALSE" TYPE="%-50s" FUNCTIONS="T(└─────────────────────┘)"/>
  
  <ITEM LINE="10" COL="35" NAME="#BVTYPE" TYPE="%3d" INPUT="SELECT" VISABLE="FALSE"  ENABLE="FALSE" FUNCTIONS="T(110)" >
     <SELECT LINE="10" COL="36">
      <OPTION VALUE="110"   TITLE="小额来账凭证" />
     </SELECT> 
  </ITEM>
  <ITEM NAME="#VTYPE" TYPE="%3d" FUNCTIONS=""/>
  <ITEM NAME="#VOCNUM" TYPE="%16d" FUNCTIONS=""/>
  <ITEM NAME="#TXDAY" TYPE="%8s" FUNCTIONS=""/>
  <ITEM LINE="13"   COL="35" NAME="#BVOCNUM"  TYPE="%16d"   INPUT="TEXT" VISABLE="FALSE"  FUNCTIONS="V(NB)" >
  <ONLOSTFOCUS>"{
      dim @selid as number;
      dim @tota as string;
      dim @prtflg as string;
      dim @cnt as number;
      @prtflg='';
     
      show(#BOX1,false);
      show(#BOX2,false);
      show(#BOX3,false);
      show(#BOX4,false);
      show(#BOX5,false);
      show(#BOX6,false);
      show(#BOX7,false);
      show(#BOX8,false);
      #VTYPE=#BVTYPE;
      #VOCNUM=#BVOCNUM;
      initfd();
      commsend_001();
      $FD89=#VTYPE;
      //showmsg($FD89);
      $FD59=#VOCNUM;
      $FD16='0110';
      callserver();
      if($FD12!='0000')
              {
      showmsg(geterror());
        return(false);      
              }
              if(len(delspace($FD13))!=0){
                       //showmsg($FD13);

                      show(#BOX1,true);
        show(#BOX2,true);
        show(#BOX3,true);
        show(#BOX4,true);
        show(#BOX5,true);
        show(#BOX6,true);
        show(#BOX7,true);
        show(#BOX8,true);
                      show(#BVTYPE,true);
              show(#BVOCNUM,true);
        return(false);  
              }
      @selid=list_getselid();
      #TXDAY=delspace(list_gettext(@selid,1));
      #NEXTORDERNO=list_gettext(@selid,2);
      #XSTAT=delspace(list_gettext(@selid,6));
      #NEXTORBRNO=list_gettext(@selid,12);
      #NEXTVOCNUM=#VOCNUM;
       list_show();
      while(true)
      {
        @prtflg=delspace(list_gettext(@selid,8));
        if(@prtflg=='已打印')
        {
              if(msgbox('此笔交易已打印!确定重新打印吗!'+chr(10)+
          '    交易序号:'+#NEXTORDERNO+chr(10)+
          '    凭证号码:'+#NEXTVOCNUM+chr(10)+
          '─────────────'
          ,'提示','yes|no')!=0)
          {
                 break;
               }
               #CPRTFLAG='重复打印';
        }else{
        #CPRTFLAG='首次打印';
        if(msgbox('打印此笔交易吗?'+chr(10)+
          '    交易序号:'+#NEXTORDERNO+chr(10)+
          '    凭证号码:'+#NEXTVOCNUM+chr(10)+
          '─────────────'
          ,'提示','yes|no')!=0)
          {
                break;
               }
        }
        #TXAMT=0;
        if(#NEXTVOCNUM=='0000000000000000')
        {
             msgbox('    小额来账凭证已用完    '+chr(10)+'─────────────');
             break;
        }
         
             initfd();
             commsend_001();
              $FD44=#TXDAY;
            //$FD29=#NEXTORDERNO;
            $FD58=#NEXTORDERNO;
            $FD23=#PKGNO;
             $FD69=#TXSTAT;
             $FD90=#VTYPE;
            $FD60=#NEXTVOCNUM;
            $FD72=#ZFTYPE;
            $FD16='9091';
            $FD31=#NEXTORBRNO;
            callserver();
            if($FD12!='0000')
                {
        showmsg(geterror());
        goitem('#DOLIST',false);
          return(true);      
                  }
           //setitems('#CRDB#OPCD#PKGNO#ORDERNO#TXNUM#OR_BR_NO#AC_BR_NO#TX_AMT#PAY_OPN_BR_NO#PAY_QS_NO#PAY_AC_NO#PAY_NAME#PAY_ADDR#PWD#CASH_QS_NO#CASH_OPN_BR_NO#CASH_AC_NO#CASH_NAME#CASH_ADDR#YW_TYPE#BRF#WT_DATE#OPERLEVEL#AUTH_TEL#AUTH_PWD#NOTE_TYPE#NOTE_NO#PACK_DATE#PACK_ID#CHRG_IND#CHRG_AMT#RESP_DAY#PO_TYPE#PO_DATE#PO_NUM#PC_TX_AMT#JF_TX_AMT#O_WT_DATE#O_TXNUM#OORDERNO#RET_CODE#RCP_STS#RESP1#RESP2#PACK_END#LV_STS',$FD123);
            lvrecv_123();
      //showmsg('2='+#YW_TYPE);
      //showmsg('2='+#WT_DATE);
            #NEXTVOCNUM=delspace(substr($FD96,0,60));
            #TMP_TXNUM=#TXNUM;
            setitems('#AMT',$FD39);
            runoutput();
            list_rmitem(@selid);                              
            list_show();
            @selid=list_getselid();
            @cnt=list_getrowcnt();
            if(@cnt==0)
            {
              msgbox('    小额来账凭证打印完毕    '+chr(10)+'─────────────');
              break;
            }
          #TXDAY=delspace(list_gettext(@selid,1));
          #NEXTORDERNO=list_gettext(@selid,2);
          #NEXTORBRNO=list_gettext(@selid,12);
          #XSTAT=delspace(list_gettext(@selid,6));
        } 
        list_del();
        #DOLIST='0';
      return(true);
  }"
  </ONLOSTFOCUS>
  </ITEM> 
  <ITEM NAME="#START"  TYPE="%-1s" FUNCTIONS="">
  <ONLOSTFOCUS>"{
   showall();
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="3"  COL="3" TYPE="%-46s" FUNCTIONS=
    "T(5360                    小额来帐查询与打印)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
    "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=5900)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
 
  <ITEM LINE="8"  COL="15" TYPE="%-14s" FUNCTIONS="T(交 易  行 号:)"/>
  <ITEM LINE="10" COL="15" TYPE="%-14s" FUNCTIONS="T(交 易  日 期:)"/>
  <ITEM LINE="12" COL="15" TYPE="%-14s" FUNCTIONS="T(打 印  标 志:!)"/>
  <ITEM LINE="14" COL="15" TYPE="%-14s" FUNCTIONS="T(支 付  标 志:!)"/>
  <ITEM LINE="16" COL="15" TYPE="%-14s" FUNCTIONS="T(交 易  类 型:!)"/>
  <ITEM LINE="18" COL="15" TYPE="%-14s" FUNCTIONS="T(交 易  状 态:!)"/>
  <ITEM LINE="8"  COL="29" NAME="#BRNO"    TYPE="%-5s"     DEVICE="KEYBOARD" FUNCTIONS="T($KINBR)"/>
  <ITEM LINE="10" COL="29" NAME="#WTDAY"  TYPE="%-8s"     DEVICE="KEYBOARD" FUNCTIONS="T($HDATE)"/>
  <ITEM LINE="12" COL="29" NAME="#PRTFLAG" TYPE="%-1s"     DEVICE="KEYBOARD" FUNCTIONS="T(0)V(0,2)">
       <SELECT LINE="12" COL="29" >
            <OPTION VALUE="0 未打印"  TITLE="0.未打印"/>
            <OPTION VALUE="1 已打印"  TITLE="1.已打印"/>
            <OPTION VALUE="2 全  部 " TITLE="2.全  部"/>
       </SELECT>
  </ITEM>     

  <ITEM NAME="#CPRTFLAG" TYPE="%-8s"  FUNCTIONS=""/>
  <ITEM NAME="#ZFTYPE"  LINE="14" COL="29" TYPE="%-1s"  INPUT="SELECT"  FUNCTIONS="T(0)V(NB)">
  <SELECT LINE="11" COL="31">
    <OPTION VALUE="0"    TITLE="0.支付类"/>
    <OPTION VALUE="1"    TITLE="1.非支付类"/>
  </SELECT>
  <ONLOSTFOCUS>
  "{
    dim @tota_txtype as string;
    dim @tota_txstat as string;
    if(#ZFTYPE=='0')
    {
      @tota_txtype = '0000|全部类型        |000|*0000|普通贷记        |001|*0000|普通借记        |002|*0000|实时贷记        |003|*0000|实时借记        |004|*0000|定期贷记        |005|*0000|定期借记        |006|*0000|贷记退汇        |007|*0000|普通借记回执    |008|*0000|实时贷记回执    |009|*0000|实时借记回执    |010|*0000|定期借记回执    |011|*'; 
      @tota_txstat = '0000|全部状态        |a|*0000|临时接受        |H|*0000|正式接受        |I|*0000|地方押错        |K|*0000|全国押错        |J|*0000|中心挂帐        |M|*0000|支行挂帐        |I|*0000|来帐清算            |N|*0000|来帐退回等待      |O|*0000|来帐退回        |P|*0000|同意未发送      |Q|*0000|同意已发送      |R|*0000|不同意未发送    |S|*0000|不同意已发送    |T|*0000|来帐已冲正      |U|*0000|来帐已止付      |V|*0000|来帐已付款      |W|*0000|来帐异常挂帐    |C|*';    
    }
    else if(#ZFTYPE=='1')
    {
      @tota_txtype = '0000|全部类型        |000|*0000|小额查询        |301|*0000|小额查复        |302|*0000|小额自由格式    |303|*0000|退回申请        |319|*0000|退回应答        |320|*0000|申请撤销        |321|*0000|撤销应答        |322|*0000|冲正申请        |323|*0000|冲正应答        |324|*0000|冲正通知        |325|*0000|止付申请        |327|*0000|止付应答        |328|*';
      @tota_txstat = '0000|全部状态        |a|*0000|来帐接收        |B|*0000|地方押错        |K|*0000|全国押错        |J|*';
    }
  
    setsel(#PKGNO,@tota_txtype,'o5t16o1v3o2');
    setsel(#TXSTAT,@tota_txstat,'o5t16o1v1o2');
  }"
  </ONLOSTFOCUS>
</ITEM>
  <ITEM LINE="16" COL="29" NAME="#PKGNO" TYPE="%-3s"     DEVICE="KEYBOARD" FUNCTIONS="T(000)V(NB)">
     <SELECT LINE="14" COL="30">
        <OPTION VALUE="000 全部类型"          TITLE="000.全部类型"/>
     </SELECT>
   </ITEM>
  <ITEM LINE="18" COL="29" NAME="#TXSTAT" TYPE="%-1s" DEVICE="KEYBOARD" FUNCTIONS="T(a)V(NB)J(#UTXSTAT)">
     <SELECT LINE="16" COL="30">
       <OPTION VALUE="a 全部状态" TITLE="a.全部状态"/>
     </SELECT>
   </ITEM>
<ITEM NAME="#AMT"               TYPE="%17.2f" FUNCTIONS="J(#XDTXAMT)J(#UDTXAMT)"/>
<ITEM NAME="#XDTXAMT"       TYPE="%-21s"  FUNCTIONS="X(#AMT)"/>
<ITEM NAME="#UDTXAMT"       TYPE="%-40s"  FUNCTIONS="U(#AMT)"/>
<ITEM NAME="#WT_DAY"            TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#ORDERNO"     TYPE="%8d"      FUNCTIONS=""/>
<ITEM NAME="#IORDERNO"    TYPE="%-6s"    FUNCTIONS=""/>
<ITEM NAME="#OTYPE"       TYPE="%-1s"      FUNCTIONS="T(1)"/>
<ITEM NAME="#CMTNO"             TYPE="%-3s"       FUNCTIONS=""/>
<ITEM NAME="#O_CMTNO"           TYPE="%-3s"       FUNCTIONS=""/>
<ITEM NAME="#PAY_QS_NO"         TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#OR_BR_NO"          TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#SENDCO"            TYPE="%-4s"       FUNCTIONS=""/>
<ITEM NAME="#PAY_OPN_BR_NO"     TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#PAY_AC_NO"         TYPE="%-32s"      FUNCTIONS=""/>
<ITEM NAME="#PAY_NAME"          TYPE="%-60s"      FUNCTIONS=""/>
<ITEM NAME="#PAY_ADDR"          TYPE="%-60s"      FUNCTIONS=""/>
<ITEM NAME="#CASH_QS_NO"        TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#AC_BR_NO"          TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#RECECO"            TYPE="%-4s"       FUNCTIONS=""/>
<ITEM NAME="#CASH_OPN_BR_NO"    TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#CASH_AC_NO"        TYPE="%-32s"      FUNCTIONS=""/>
<ITEM NAME="#CASH_NAME"         TYPE="%-60s"      FUNCTIONS=""/>
<ITEM NAME="#CASH_ADDR"         TYPE="%-60s"      FUNCTIONS=""/>
<ITEM NAME="#YW_TYPE"           TYPE="%-12s"      FUNCTIONS=""/>
<!---定义为两位是什么意思?  fd123中就定义为２位　by LiuHuafeng 2007-2-3 0:12解答
<ITEM NAME="#YW_TYPE"           TYPE="%-2s"       FUNCTIONS=""/>
--->
<ITEM NAME="#YW_TYPE1"          TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#CONTENT"           TYPE="%-60s"      FUNCTIONS=""/>
<ITEM NAME="#RATE"              TYPE="%-7s"       FUNCTIONS=""/><!--拆借利率-->
<ITEM NAME="#RATEDATE"          TYPE="%-5s"       FUNCTIONS=""/><!--拆借期限-->
<ITEM NAME="#OORDERNO"          TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#PROCODE"           TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#CR_DATE"           TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#CR_BR_NO"          TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#CR_TX_NUM"         TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#QR_BR_NO"          TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#QR_TX_NUM"         TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#TX_TYPE"           TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#NOTPAY_CONTENT"    TYPE="%-255s"     FUNCTIONS=""/>
<ITEM NAME="#NOTPAY_ORDERNO"    TYPE="%-3s"       FUNCTIONS=""/>
<ITEM NAME="#O_NOTPAY_ORDERNO"  TYPE="%-3s"       FUNCTIONS=""/>
<ITEM NAME="#RESP1"             TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#OPERLEVEL"         TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#PROC_STS"          TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#OPCD"              TYPE="%-2s"       FUNCTIONS="T()"/>
<ITEM NAME="#HP_ADD_PWD"        TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#PACKID"            TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#O_PACKID"          TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#PACK_DATE"         TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#PACK_ID"           TYPE="%-8s"       FUNCTIONS=""/><!--来包编号-->
<ITEM NAME="#O_PACK_DATE"       TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#TXNUM"             TYPE="%-5s"       FUNCTIONS=""/>
<ITEM NAME="#O_TXNUM"           TYPE="%-5s"       FUNCTIONS=""/>
<ITEM NAME="#LV_YW_IND"         TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#RESP_DATE"         TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#RCP_STS"           TYPE="%-2s"       FUNCTIONS=""/>
<ITEM NAME="#RESP2"             TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#RETCODE"           TYPE="%-2s"       FUNCTIONS=""/>
<ITEM NAME="#YW_DTL_ID"         TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#ACC_IND"           TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#REQ_TYPE"          TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#DF_FREEAMT"        TYPE="%-16s"      FUNCTIONS=""/>
<ITEM NAME="#PROTNO"            TYPE="%-60s"      FUNCTIONS=""/>
<ITEM NAME="#PO_NO"             TYPE="%-8s"       FUNCTIONS=""/>
<ITEM NAME="#PO_TYPE"           TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#OTYPE"             TYPE="%-1s"       FUNCTIONS=""/>
<ITEM NAME="#VTYPE"             TYPE="%3d"        FUNCTIONS="" />
<ITEM NAME="#VOCNUM"            TYPE="%16d"       FUNCTIONS="" />
<ITEM NAME="#TXDAY"             TYPE="%-8s"       FUNCTIONS="T($HDATE)"/>
<ITEM NAME="#NEXTORDERNO"       TYPE="%8s"        FUNCTIONS=""/>
<ITEM NAME="#NEXTVOCNUM"        TYPE="%16d"       FUNCTIONS=""/>
<ITEM NAME="#NEXTORBRNO"        TYPE="%-12s"      FUNCTIONS=""/>
<ITEM NAME="#TXAMT"             TYPE="%17.2f"     FUNCTIONS="J(#UTXAMT)J(#XTXAMT)"/>
<ITEM NAME="#XTXAMT"            TYPE="%-21s"      FUNCTIONS="X(#TXAMT)"/>
<ITEM NAME="#UTXAMT"            TYPE="%-40s"      FUNCTIONS="U(#TXAMT)"/>
<ITEM NAME="#TMP_TXNUM"             TYPE="%-5s"       FUNCTIONS=""/>

<ITEM NAME="#CPKGNO"           TYPE="%-12s"/>

<!--下面是小额的123域对应的一些内容,其中与大额123域重复的地方省了-->
  <ITEM NAME="#CRDB"      TYPE="%1d"  FUNCTIONS="T(1)"/>
  <ITEM NAME="#PKGNO"      TYPE="%3s"  FUNCTIONS=""/>
  <ITEM NAME="#TX_AMT"      TYPE="%15s"   FUNCTIONS="T()"/>   <!--交易金额--->
  <ITEM NAME="#PWD"      TYPE="%-8s"     FUNCTIONS="T()"/>    <!--支取密码-->
  <ITEM NAME="#BRF"      TYPE="%-60s"    FUNCTIONS="T(123456789012345678901234567890123456789012345678901234567890)"/>  <!--附言--->
  <ITEM NAME="#WT_DATE"                 TYPE="%-8s"     FUNCTIONS=""/> <!--委托日期-->
  <ITEM NAME="#AUTH_TEL"                TYPE="%-6s"     FUNCTIONS="T()"/>    <!--授权操作员号   ---->
  <ITEM NAME="#AUTH_PWD"                TYPE="%-8s"     FUNCTIONS="T()"/>    <!--授权操作员密码 ---->
  <ITEM NAME="#NOTE_TYPE"               TYPE="%-2s"     FUNCTIONS="T()"/>    <!--凭证种类---->
  <ITEM NAME="#NOTE_NO"                 TYPE="%-12s"    FUNCTIONS="T()"/>    <!--凭证号码---->
  <ITEM NAME="#CHRG_IND"          TYPE="%-1s"     FUNCTIONS="T()"/>    <!--手续费标志     ---->
  <ITEM NAME="#CHRG_AMT"          TYPE="%-15s"    FUNCTIONS="T()"/>    <!--手续费金额     ---->
  <ITEM NAME="#RESP_DAY"        TYPE="%-8s"     FUNCTIONS="T()"/>    <!--期待应答日期  ---->
  <ITEM NAME="#PO_DATE"         TYPE="%-8s"     FUNCTIONS="T()"/>    <!--票据日期     ---->
  <ITEM NAME="#PO_NUM"          TYPE="%-8s"     FUNCTIONS="T()"/>    <!--票据号码     ---->
  <ITEM NAME="#PC_TX_AMT"       TYPE="%-16.2f"  FUNCTIONS="T()"/>   <!--赔偿金额---->
  <ITEM NAME="#JF_TX_AMT"       TYPE="%-16.2f"  FUNCTIONS="T()"/>   <!--拒付金额---->
  <ITEM NAME="#O_WT_DATE"       TYPE="%-8s"     FUNCTIONS="T()"/>    <!--原委托日期    ---->
  <ITEM NAME="#O_TXNUM"         TYPE="%-5s"     FUNCTIONS="T()"/>    <!--原业务编号    ---->
  <ITEM NAME="#O_ORDERNO"       TYPE="%-8s"     FUNCTIONS="T()"/>    <!--原支付交易序号---->
  <ITEM NAME="#RET_CODE"        TYPE="%-2s"     FUNCTIONS="T()"/>    <!--退汇原因代码  ---->
  <ITEM NAME="#PACK_END"        TYPE="%-1s"     FUNCTIONS="T()"/>    <!--包结束标志    ---->
  <ITEM NAME="#LV_STS"          TYPE="%-1s"     FUNCTIONS="T()"/>    <!--交易状态      ---->
  <ITEM NAME="#DFXYNO"          TYPE="%-60s"    FUNCTIONS="T()"/>               <!--多方协议号-->
  <ITEM NAME="#OORBRNO"         TYPE="%-12s"    FUNCTIONS="T()"/>       <!--原发起行行号 -->
  <ITEM NAME="#OACBRNO"         TYPE="%-12s"    FUNCTIONS=""/>          <!--原接收行行号-->
<ITEM NAME="#XSTAT"       TYPE="%-20s"/>
<ITEM NAME="#LW_IND"       TYPE="%-1s" FUNCTIONS="T(2)"/>
<ITEM NAME="#TXNAME" TYPE="%-20s" FUNCTIONS="S(#PKGNO,#PKGNO)"/>
   <ITEM NAME="#MAC"       TYPE="%-10s"   FUNCTIONS=""/>
   <ITEM NAME="#TXNUM_DES"     TYPE="%-20s"   FUNCTIONS=""/>
   <ITEM NAME="#TRACE_NO"  TYPE="%-8s"    FUNCTIONS=""/>
   <ITEM NAME="#OPERLEVELNAME" TYPE="%-10s" FUNCTIONS=""/>
   <ITEM NAME="#PROC_NAME" TYPE="%-20s" FUNCTIONS=""/>
     <ITEM NAME="#CMTNAME"  TYPE="%-16s" FUNCTIONS=""/>

  <ITEM LINE="21"  COL="65" TYPE="%-6s" NAME="#SUREDO" FUNCTIONS="T(确  定)" INPUT="BUTTON" >
  <ONCLICK>
  "{
        dim @pkgcnt  as number;
        dim @recdcnt as number;
        dim @step   as number;
        dim @tota   as string;
        dim @relapos as number;
        dim @pkgcntpos as number; 
        dim @tmptxamt as string;
        dim @txamt as string;
        
        list_init(18,78,4,1);
        list_setcolcnt(12);
        list_setcol(0, '交易行',9 );
        list_setcol(1, '交易日期',10);
        list_setcol(2, '顺序号',10 );
        list_setcol(3, '交 易 金 额',20);
        list_setcol(4, '开户行( 付 )',14);
        list_setcol(5, '开户行( 收 )',14);
        list_setcol(6, '状    态',22);
        list_setcol(7, '报文编号',12);
        list_setcol(8, '打印标志', 10);
        list_setcol(9, '包序号', 10);
        list_setcol(10, '发起清算行', 14);
        list_setcol(11, '发起行行号', 14);
        initfd();
        commsend_001();
       $FD23=#PKGNO;
       $FD44=#WTDAY;
       $FD67=#PRTFLAG;
       $FD72=#ZFTYPE;
       $FD69=#TXSTAT;
       @tota=callserver();
       if($FD12!='0000')
       {
    showmsg(geterror());
    return(false);
       }
       
       if(autolist(@tota))
       {
      list_work();
   }
         #DOLIST='1';
  }"
  </ONCLICK>
  </ITEM>
  </VARIABLE>  
 <REQUEST>
 </REQUEST>
 <RESPONSE>
 <PACKAGE DEVICE="SCREEN" DESC="凭证打印">
 NOTHING
 </PACKAGE>
  <PRINT>"{
          if(#ZFTYPE=='0')
         {
          print( 2,  24,'交易名称:凭证打印'); 
          print( 3,  5,'[8]',#CPRTFLAG); 
          print( 4,  5,' 打印机构:[5    ]交易日期:[8       ]交易序号:[8       ]来账状态:[20]',$FD2,$HDATE,#ORDERNO,#XSTAT);
          print( 5,  5,'┃付┃发起行行号: [12]',#OR_BR_NO);  
          print( 6,  5,'┃款┃付款人帐号: [32]',#PAY_AC_NO);
          print( 7,  5,'┃人┃付款人名称: [60]',#PAY_NAME);  
          print( 9,  5,'┃收┃接收行行号: [12]',#AC_BR_NO);                             
          print(10,  5,'┃款┃收款人帐号: [32]',#CASH_AC_NO);
          print(11,  5,'┃人┃收款人名称: [60]',#CASH_NAME);
          print(13,  5,' 附言:[60]',#BRF);
          print(15,  5,' 入帐金额:[21](大写):[40]',#XDTXAMT,#UDTXAMT);
          print(16,  5,' 操 作 员:[4] 流 水 号:[6]',$FD7,$FD4); 
        }
        else
        {
              print( 2,  24,'交易名称:凭证打印');                         
              print( 4,   5,'交易     序号:[8]',#NEXTORDERNO);                
              print( 4,  40,'[8]',#CPRTFLAG);                             
              print( 5,   5,'发起      行号: [12]',#OR_BR_NO);            
              print( 6,   5,'付款清算行行号: [12]',#PAY_QS_NO);           
              print( 7,   5,'发报 中心 代码: [4]',#SENDCO);               
              print( 8,   5,'接受 清算 行号: [12]',#CASH_QS_NO);          
              print( 9,   5,'接受      行号: [12]',#AC_BR_NO);            
              print( 10,  5,'原支付交易序号: [12]',#OORDERNO);            
              if(#PKGNO=='314' or #PKGNO=='302' or #PKGNO=='312')         
              {                                                           
                  print( 11,   5,'应答      内容: [80]',substr(#NOTPAY_CONTENT,0,80));
                  print( 12,  21,'[80]',substr(#NOTPAY_CONTENT,80,80));
                  print( 13,  21,'[100]',substr(#NOTPAY_CONTENT,160,95));  
               }                                                           
              else                                                        
              {                                                           
                  print( 11,   5,'申请      内容: [80]',substr(#NOTPAY_CONTENT,0,80));
                  print( 12,  21,'[80]',substr(#NOTPAY_CONTENT,80,80));
                  print( 13,  21,'[100]',substr(#NOTPAY_CONTENT,160,95));
              }                                                           
              print( 14,  5,'应答      行号: [12]',#CR_BR_NO);            
              print( 15,  5,'应答      日期: [8 ]',#CR_DATE);             
              print( 16,  5,'原  交易  金额: [21 ]',#XDTXAMT);             
        
        }
  }"    
</PRINT>
</RESPONSE>
<RESPONSE>
 <PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="请插入打印凭条">
 NOTHING
 </PACKAGE>
 <!---
  <PRINT>"{
          if(#ZFTYPE=='0')
         {
          print( 2,  24,'交易名称:凭证打印'); 
          print( 3,  5,'[8]',#CPRTFLAG); 
          print( 4,  5,' 打印机构:[5    ]交易日期:[8       ]交易序号:[8       ]来账状态:[20]',$FD2,$HDATE,#ORDERNO,#XSTAT);
          print( 5,  5,'┃付┃发起行行号: [12]',#OR_BR_NO);  
          print( 6,  5,'┃款┃付款人帐号: [32]',#PAY_AC_NO);
          print( 7,  5,'┃人┃付款人名称: [60]',#PAY_NAME);  
          print( 9,  5,'┃收┃接收行行号: [12]',#AC_BR_NO);                             
          print(10,  5,'┃款┃收款人帐号: [32]',#CASH_AC_NO);
          print(11,  5,'┃人┃收款人名称: [60]',#CASH_NAME);
          print(13,  5,' 附言:[60]',#BRF);
          print(15,  5,' 入帐金额:[21]手续费:[21]',#XDTXAMT,#XFEEAMT);
          print(16,  5,' 汇款金额:人民币(大写):[40]',#UTXAMT);    
          print(17,  5,' 操 作 员:[4]   流 水 号:[6]',$FD7,$FD4);
        }
          else
        {
              print( 2,  24,'交易名称:凭证打印');                         
              print( 4,   5,'交易     序号:[8]',#ORDERNO);                
              print( 4,  40,'[8]',#CPRTFLAG);                             
              print( 5,   5,'发起      行号: [12]',#OR_BR_NO);            
              print( 6,   5,'付款清算行行号: [12]',#PAY_QS_NO);           
              print( 7,   5,'发报 中心 代码: [4]',#SENDCO);               
              print( 8,   5,'接受 清算 行号: [12]',#CASH_QS_NO);          
              print( 9,   5,'接受      行号: [12]',#AC_BR_NO);            
              print( 10,  5,'原支付交易序号: [12]',#OORDERNO);            
              print( 11,  5,'应答      状态: [1 ]',#PROC_STS);            
              if(#CMTNO=='314' or #CMTNO=='302' or #CMTNO=='312')         
              {                                                           
                  print( 12,  5,'应答      内容: [255]',#NOTPAY_CONTENT); 
              }                                                           
              else                                                        
              {                                                           
                  print(12,   5,'申请      内容: [255]',#NOTPAY_CONTENT); 
              }                                                           
              print( 13,  5,'应答      行号: [12]',#CR_BR_NO);            
              print( 14,  5,'应答      日期: [8 ]',#CR_DATE);             
              print( 15,  5,'原  交易  金额: [21 ]',#XDTXAMT);             

        }
  }"
</PRINT>
--->
 <PRINT>"{
           dim @pkgno as number;
          @pkgno='';
          if(#OPERLEVEL=='0')
          {
          #OPERLEVELNAME='一般业务';
          }
          else if(#OPERLEVEL=='1')
          {
          #OPERLEVELNAME='紧急业务';
          }
          else
          {
          #OPERLEVELNAME='特急业务';
          }
          switch(#PROC_STS)
          {
             case '8':
                       #PROC_NAME='来账拒绝';
                      break;
             case '9':
                       #PROC_NAME='来账记账清算';
                      break;
             case 'B':
                       #PROC_NAME='来账退回';
                      break;                 
              case  'F':
                       #PROC_NAME='来账核地方押错';
                        break;
              case  'G':
                       #PROC_NAME='来账核全国押错';
                        break;
              case  'H':
                       #PROC_NAME='来账内容不符';
                        break;
              case  'I':
                       #PROC_NAME='来账户名不符';
                      break;              
              case  'K':
                       #PROC_NAME='核对清算记帐';
                      break;
             default :
                       break;
          }
           @pkgno=atoi(#PKGNO);

          switch(@pkgno)
          {
              case 1:
                    #CMTNAME='普通贷记';
                    break;
              case 2:    
                    #CMTNAME='普通借记';
                    break;
              case 3:  
                    #CMTNAME='实时贷记';
                    break;
              case 4:   
                    #CMTNAME='实时借记';
                    break;
              case 5:   
                    #CMTNAME='定期贷记';
                    break;
              case 6:
                    #CMTNAME='定期借记';
                    break;
              case 7:
                    #CMTNAME='贷记退汇';
                    break;
              case 8:   
                    #CMTNAME='普通借记回执';
                    break;
              case 9:    
                    #CMTNAME='实时贷记回执';
                    break;
              case 10:
                    #CMTNAME='实时借记回执';
                    break;
              case 11:
                    #CMTNAME='定期借记回执';
                    break;
              case 12:
                    #CMTNAME='通用信息';
                    break;
              case 301:
                    #CMTNAME='小额查询';
                    break;
              case 302:
                    #CMTNAME='小额查复';   
                    break;
              case 303:
                    #CMTNAME='小额自由格式';
                    break;
              case 319:
                    #CMTNAME='退回申请';
                    break;
              case 320:
                    #CMTNAME='退回应答';
                    break;
              case 321:
                    #CMTNAME='申请撤销';
                    break;
              case 322:
                    #CMTNAME='撤销应答';
                    break;
              case 323:
                    #CMTNAME='冲正申请';
                    break;
              case 324:
                    #CMTNAME='冲正应答';
                    break;
              case 325:
                    #CMTNAME='冲正通知';
                    break;
              case 327:
                    #CMTNAME='止付申请';
                    break;
              case 328:
                    #CMTNAME='止付应答';
                    break;
              default :
                    #CMTNAME='未知状态';
                     break;    
          }
          if(#ZFTYPE=='0')
          {
              
              LV_SET_TXNUM();
              print(0,5,'@3v1');
              print(2, 5,'    支付交易序号[8       ]    委托日期:[8       ]  交易种类: 小额来账  发报日期:[8       ]  流水号: [6      ] PKG号:[16  ]',#ORDERNO,#WT_DATE,#TXDAY,$FD4,#CMTNAME);  
              print(3, 5,'┏━┯━━━━┯━━━━━━━━━━━━━━━━━━━━━┯━┯━━━━┯━━━━━━━━━━━━━━━━━━━━━┓');
              print(4, 5,'┃  │账    号│[32                       ]          │  │账    号│[32                          ]          ┃',#PAY_AC_NO,#CASH_AC_NO);
              print(5, 5,'┃  ├────┼─────────────────────┤  ├────┼─────────────────────┨');
              print(6, 5,'┃发│名    称│[40                                      ]  │接│名    称│[40                                      ]  ┃',#PAY_NAME,#CASH_NAME);
              print(7, 5,'┃  ├────┼───────┬────┬────────┤  ├────┼───────┬────┬────────┨');
              print(8, 5,'┃起│发起行号│[12          ]  │发报中心│[4   ]            │收│接受行号│[12          ]  │接收中心│[4   ]            ┃',#OR_BR_NO,#SENDCO,#AC_BR_NO,#RECECO);
              print(9, 5,'┃  ├────┼───────┼────┼────────┤  ├────┼───────┼────┼────────┨');
              print(10,5,'┃人│开户行号│[12          ]  │清算行号│[12          ]    │人│开户行号│[12          ]  │清算行号│[12          ]    ┃',#PAY_OPN_BR_NO,#PAY_QS_NO,#CASH_OPN_BR_NO,#CASH_QS_NO);
              print(11,5,'┠─┴────┴───────┴────┴────────┴─┴────┴───────┴────┴────────┨');
              print(12,5,'┃      金    额: RMB [21                   ]                       原凭证日期:[8       ]   来包编号:[8       ]           ┃',#XDTXAMT,#TXDAY,#PACK_ID);
              print(13,5,'┠─────────────────────────────────────────────────────────┨');
              print(14,5,'┃      金    额:人民币(大写)[40]                                               ┃',#UDTXAMT);
              print(15,5,'┠─────────────────────────────────────────────────────────┨');
              print(16,5,'┃      附    言:[80                                                                              ]                   ┃',substr(#BRF,0,60));
              print(17,5,'┃               [80                                                                              ]                   ┃',substr(#CONTENT,80,80));
              print(18,5,'┠─────────────────────────────────────────────────────────┨');
              print(19,5,'┃      业务类型:[20                  ]              处理状态:[20                  ]         优先级别:[10          ]        ┃',#TXNUM_DES,#XSTAT,#OPERLEVELNAME);
              print(20,5,'┠─────────────────────────────────────────────────────────┨');
              print(21,5,'┃      接收时间:[20                  ]              转发时间:[20                  ]         状态时间:[12          ]      ┃',#TXDAY,#TXDAY,#TXDAY);
              print(22,5,'┠─────────────────────────────────────────────────────────┨');
              print(23,5,'┃      密    押:[10          ]                              交易机构:[5    ]-[4   ]             打印状态:[10        ]        ┃',#MAC,$FD3,$FD7,#CPRTFLAG);
              print(24,5,'┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛');
         }
        else
       {
            print( 2,  24,'交易名称:凭证打印');                         
            print( 4,   5,'交易     序号:[8]',#NEXTORDERNO);                
            print( 4,  40,'[8]',#CPRTFLAG);                             
            print( 5,   5,'发起      行号: [12]',#OR_BR_NO);            
            print( 6,   5,'付款清算行行号: [12]',#PAY_QS_NO);           
            print( 7,   5,'发报 中心 代码: [4]',#SENDCO);               
            print( 8,   5,'接受 清算 行号: [12]',#CASH_QS_NO);          
            print( 9,   5,'接受      行号: [12]',#AC_BR_NO);            
            print( 10,  5,'原支付交易序号: [12]',#OORDERNO);            
            if(#PKGNO=='314' or #PKGNO=='302' or #PKGNO=='312')         
            {                                                           
                  print( 11,   5,'应答      内容: [80]',substr(#NOTPAY_CONTENT,0,80));
                  print( 12,  21,'[80]',substr(#NOTPAY_CONTENT,80,80));
                  print( 13,  21,'[100]',substr(#NOTPAY_CONTENT,160,95));  
             }                                                           
            else                                                        
            {                                                           
                  print( 11,   5,'申请      内容: [80]',substr(#NOTPAY_CONTENT,0,80));
                  print( 12,  21,'[80]',substr(#NOTPAY_CONTENT,80,80));
                  print( 13,  21,'[100]',substr(#NOTPAY_CONTENT,160,95));
            }                                                           
            print( 14,  5,'应答      行号: [12]',#CR_BR_NO);            
            print( 15,  5,'应答      日期: [8 ]',#CR_DATE);             
            print( 16,  5,'原  交易  金额: [21 ]',#XDTXAMT);             
      
      }
  }"  
</PRINT>
<LASTWORK>
"{
  //showmsg(#NOTPAY_CONTENT);
}"
</LASTWORK>
</RESPONSE>
</TRANSACTION>
