<?xml version="1.0"  encoding="GBK" ?>
<TRANSACTION RIGHTS="11111111011100000000000001100010" TITLE="供热补打凭条"
xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<VARIABLE>
	<ITEM LINE="3" COL="3"   TYPE="%-70s"    FUNCTIONS="T(9933                      补打瑞阳供热缴费凭条)"/>
	<ITEM LINE="4" COL="3"   TYPE="%-70s"    FUNCTIONS="T(────────────────────────────────────────)"/>
  <!--ITEM NAME="#TXNO"       TYPE="%-4s"     FUNCTIONS="T($TXNO=4100)"/-->
  <ITEM NAME="#MSGTYPE"    TYPE="%-5s"     FUNCTIONS="T($MSGTYPE=03001)"/>
  <ITEM LINE="10"   COL="3" TYPE="%-14s"  FUNCTIONS="T(用  户  号:)"/>
  <ITEM LINE="10"   COL="17" NAME="#USER_NO" INPUT="TEXT" TYPE="%-24s"  FUNCTIONS="T()">
   <ONLOSTFOCUS>
	"{
		if (len(delspace(#USER_NO)) != 0 )
		{
			dim @tota as string;
			dim @selid as number;
			dim @amta as string;
			$FD30=#USER_NO;
			$FD60='RYGR';
			commsend_001();
			$FD16='1010';
			//showmsg($FD16);
			callagnpt();	
			if($FD12!='0000'){
				showmsg($FD13);
				return(false);
			}
			@tota=getfiletxt('../tmp/'+$KINBR+$TTYNAME);
			if(@tota==''){
				showmsg('未找到记录!');
				return(false);
			}
			autolist(@tota);
			@selid=list_work();
			@amta=list_gettext(1,4);
			//showmsg('@amta='+@amta);
			#AMT=val(@amta);
		}
  }"
  </ONLOSTFOCUS>
 </ITEM>
  
  <ITEM LINE="12"   COL="3" TYPE="%-14s"  FUNCTIONS="T(缴费流水号:)"/>
  <ITEM LINE="12"   COL="17" NAME="#JFTRACENO" INPUT="TEXT" TYPE="%-24s"  FUNCTIONS="V(NB)T()"/>
  
	<ITEM NAME="#YHNO_2"      TYPE="%-30s"    FUNCTIONS=""/>
	<ITEM NAME="#YHNAME_2"    TYPE="%-50s"    FUNCTIONS=""/>              		
	<ITEM NAME="#ADDRESS_2"   TYPE="%-50s"    FUNCTIONS=""/>           					
 	<ITEM NAME="#YEAR_2"      TYPE="%-4s"  		FUNCTIONS=""/>                    
 	<ITEM NAME="#FWMJ_2"      TYPE="%-12.2f"  FUNCTIONS=""/> 										
 	<ITEM NAME="#MONTH_2"     TYPE="%-2s"  	  FUNCTIONS=""/> 									
 	<ITEM NAME="#MJDJ_2"      TYPE="%-12.2f"  FUNCTIONS=""/> 										
 	<ITEM NAME="#MJYS_2"      TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#JLYL_2"      TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#JLDJ_2"      TYPE="%-12.3f"  FUNCTIONS=""/> 										
	<ITEM NAME="#JLYS_2"      TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#YSBJ_2"      TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#JMJE_2"      TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#YHJE_2"      TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#AMT_2"       TYPE="%-12.2f"  FUNCTIONS=""/> 										
	<ITEM NAME="#BZ_2"        TYPE="%-60s"    FUNCTIONS=""/>    										
	<ITEM NAME="#TRACE_NO"    TYPE="%-24s"    FUNCTIONS=""/>
	<ITEM NAME="#STAT"        TYPE="%-1s"     FUNCTIONS=""/>
	<ITEM NAME="#JFDATE"      TYPE="%-8s"     FUNCTIONS=""/>
	
	<ITEM NAME="#AMT"       TYPE="%-12.2f"  FUNCTIONS=""/> 
	<ITEM NAME="#UAMT" TYPE="%-40s"  FUNCTIONS="U(#AMT)"/>

 <ITEM  NAME="#BTN" LINE="21"  COL="63" TYPE="%-6s"    FUNCTIONS="T(确  定)" INPUT="BUTTON">
	<ONCLICK>"{
	dim @tota as string;
	dim @filename as string;
	//$FD30=#USER_NO;
	$FD27=#JFTRACENO;
	$FD60='RYGR';
	commsend_001();
	$FD16='4100';

		callagnpt();
		if($FD12!='0000')
		{
			showmsg($FD13);
			return(false);
		}
		
		#YHNO_2=$FD30;
		#YHNAME_2=$FD25;
		#ADDRESS_2=$FD26;
		#YEAR_2=$FD34;
		#MONTH_2=$FD35;
		#FWMJ_2=val($FD84);
		#MJDJ_2=val($FD85);
		#MJYS_2=val($FD97);
		#JLDJ_2=val($FD94);
		#JLYL_2=val($FD39);
		#JLYS_2=val($FD40);
		#YSBJ_2=val($FD41);
		#JMJE_2=val($FD42);
		#YHJE_2=val($FD43);
		#AMT_2=val($FD44);
		#BZ_2=$FD81;
		#STAT=$FD20;
		#TRACE_NO=$FD27;
		#JFDATE=$FD45;		
		//showmsg('#AMT_2='+$FD44);
		//showmsg('#UAMT='+#UAMT);
		runoutput();
		rerun();
  }"
  </ONCLICK>
 </ITEM>
</VARIABLE>
 <!--RESPONSE>
  <PACKAGE DEVICE="SCREEN"  DESC="交易完成">
    NOTHING
  </PACKAGE>
	<PRINT>
	 "{       
			print(3,42,'[4]   [2]    [2]',substr($HDATE,0,4),substr($HDATE,4,5),substr($HDATE,6,7));
		  	print(4,20,'     [40] [16] [20]',#ADDRESS_2,#YHNAME_2,#TRACE_NO); 
		  	print(5,14,'     [24]',#YHNO_2);
			print(7,12,' [4]供热费            [15]  [4]        [10]    [16]',#YEAR_2,delspace(comma(itoa(#FWMJ_2,'%.2f'))),#MONTH_2,delspace(comma(itoa(#MJDJ_2,'%.2f'))),delspace(comma(itoa(#MJYS_2,'%.2f')))); 
			
			print(8,12,' 优惠金额                                                         [16]',delspace(comma(itoa(#YHJE_2,'%.2f'))));
			
			print(9,12,' 实收金额                                                         [16]',delspace(comma(itoa(#AMT_2,'%.2f'))));
			print(10,30,'   [40]',#UAMT);
			if(#STAT=='0')
			{
				print(12,20,'基础热费');
			}
			else
			{
				print(12,20,'退款');
			}
			print(15,20,'[12]                                [12]',$FD3,$FD7);
	 }"
	</PRINT>
 </RESPONSE>
 <RESPONSE>
   <PACKAGE DEVICE="PRINTER"  LINESPACE="22" DESC="打印专用凭证">
     NOTHING
   </PACKAGE>
   <PRINT>
   	"{
   			print(3,42,'[4]   [2]    [2]',substr($HDATE,0,4),substr($HDATE,4,5),substr($HDATE,6,7));
		  	print(4,20,'     [40] [16] [20]',#ADDRESS_2,#YHNAME_2,#TRACE_NO); 
		  	print(5,14,'     [24]',#YHNO_2);
			print(7,12,' [4]供热费            [15]  [4]        [10]    [16]',#YEAR_2,delspace(comma(itoa(#FWMJ_2,'%.2f'))),#MONTH_2,delspace(comma(itoa(#MJDJ_2,'%.2f'))),delspace(comma(itoa(#MJYS_2,'%.2f')))); 
			
			print(8,12,' 优惠金额                                                         [16]',delspace(comma(itoa(#YHJE_2,'%.2f'))));
			
			print(9,12,' 实收金额                                                         [16]',delspace(comma(itoa(#AMT_2,'%.2f'))));
			print(10,30,'   [40]',#UAMT);
			
			if(#STAT=='0')
			{
				print(12,20,'基础热费');
			}
			else
			{
				print(12,20,'退款');
			}
			print(15,20,'[12]                                [12]',$FD3,$FD7);
     }"
   </PRINT>
 </RESPONSE-->
 
 <RESPONSE>
  <PACKAGE DEVICE="SCREEN"  DESC="交易完成">
    NOTHING
  </PACKAGE>
	<PRINT>
	 "{       
		print(3,20,'\L0晋中市瑞阳热电联产供热有限责任公司收费收据\L1');
		print(5,50,' [4] 年 [2] 月 [2] 日',substr($HDATE,0,4),substr($HDATE,4,5),substr($HDATE,6,7));
		
		print(6,20,'缴费单位或个人：[40] [16] 票据编号：[20]',#ADDRESS_2,#YHNAME_2,#TRACE_NO); 
		
		print(7,20,'房间编号：[24]',#YHNO_2);
		
		print(9,23,'   项  目          面积(平方米)       月数(个)      单价(元/平方米)  金额(元)');
		
		print(10,23,' [4]供热费            [15]  [4]             [10]  [16]',#YEAR_2,delspace(comma(itoa(#FWMJ_2,'%.2f'))),#MONTH_2,delspace(comma(itoa(#MJDJ_2,'%.2f'))),delspace(comma(itoa(#MJYS_2,'%.2f')))); 
		
		print(11,23,' 优惠金额(元)                                                        [16]',delspace(comma(itoa(#YHJE_2,'%.2f'))));
		
		print(12,23,' 实收金额(元)                                                        [16]',delspace(comma(itoa(#AMT_2,'%.2f'))));
		print(13,23,' 合 计（大写）      [40]',#UAMT);
		
		if(#STAT=='0')
		{
			print(15,20,'说明：基础热费');
		}
		else
		{
			print(15,20,'说明：退款');
		}
		
		print(16,20,'备注：尊敬的用户您好，建议您在每个供热期结束前（3 月 31 日）结清取暖费，逾期不交将从每');
		print(17,20,'      年4 月 1 日起开始收取滞纳金，每日按欠收金额的 3‰计算，最高不超过取暖费本金。');
		print(18,20,'收费单位：[12]                                收款人：[12]',$FD3,$FD7);
	 }"
	</PRINT>
 </RESPONSE>
 
 
 <RESPONSE>
  <PACKAGE DEVICE="PRINTER" LINESPACE="22" DESC="请打印业务专用凭证"> 
    NOTHING
  </PACKAGE> 
  <PRINT>
   "{
   	print(5,20,'\L0晋中市瑞阳热电联产供热有限责任公司收费收据\L1');
	print(7,50,' [4] 年 [2] 月 [2] 日',substr($HDATE,0,4),substr($HDATE,4,5),substr($HDATE,6,7));
	
	print(8,20,'缴费单位或个人：[40] [16] 票据编号：[20]',#ADDRESS_2,#YHNAME_2,#TRACE_NO); 
	
	print(9,20,'房间编号：[24]',#YHNO_2);
	
	print(11,23,'   项  目          面积(平方米)       月数(个)      单价(元/平方米)  金额(元)');
	
	print(12,23,' [4]供热费            [15]  [4]             [10]  [16]',#YEAR_2,delspace(comma(itoa(#FWMJ_2,'%.2f'))),#MONTH_2,delspace(comma(itoa(#MJDJ_2,'%.2f'))),delspace(comma(itoa(#MJYS_2,'%.2f')))); 
	
	print(13,23,' 优惠金额(元)                                                        [16]',delspace(comma(itoa(#YHJE_2,'%.2f'))));
	
	print(14,23,' 实收金额(元)                                                        [16]',delspace(comma(itoa(#AMT_2,'%.2f'))));
	print(15,23,' 合 计（大写）      [40]',#UAMT);
	
	if(#STAT=='0')
	{
		print(17,20,'说明：基础热费');
	}
	else
	{
		print(17,20,'说明：退款');
	}
	
	print(18,20,'备注：尊敬的用户您好，建议您在每个供热期结束前（3 月 31 日）结清取暖费，逾期不交将从每');
	print(19,20,'      年4 月 1 日起开始收取滞纳金，每日按欠收金额的 3‰计算，最高不超过取暖费本金。');
	print(20,20,'收费单位：[12]                                收款人：[12]',$FD3,$FD7);
    }"
  </PRINT>
</RESPONSE>
 
 <RESPONSE>
<PACKAGE DEVICE="PRINTER" LINESPACE="22" DESC="请打印业务专用凭证">
NOTHING
</PACKAGE>
<PRINT>
"{
dim @txtime  as string;
@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
print(5,20,'机构名称:[30]',$BRNAME);
print(5,2,'代码:9933');
print(5,13,'交易:供热补打凭条');

print(7,40,'\L0供热补打凭条\L1');
			print(9,20, '缴费单位或个人：[40]',#ADDRESS_2);
			print(10,20,'用户姓名：[30]      房间编号：[24]',#YHNAME_2,#YHNO_2);
			print(11,20,'项    目：[4]供热费                          面   积(平方米)：[15]',#YEAR_2,delspace(comma(itoa(#FWMJ_2,'%.2f')))); 
			print(12,20,'月    数(个)：[4]                            单价(元/平方米)：[10]',#MONTH_2,delspace(comma(itoa(#MJDJ_2,'%.2f')))); 
			print(13,20,'面积应收(元)：[16]',delspace(comma(itoa(#MJYS_2,'%.2f'))));
			print(14,20,'优惠金额(元)：[16]',delspace(comma(itoa(#YHJE_2,'%.2f'))));
			print(15,20,'实收金额(元)：[16]',delspace(comma(itoa(#AMT_2,'%.2f'))));
			print(16,20,'票    号：[20]', #TRACE_NO);
			if(#STAT=='0')
			{
				print(17,20,'说    明：基础热费');
			}
			else
			{
				print(17,20,'说    明：退款');
			}
			
		  print(18,80,'\H0本人已确认银行打印记录正确无误.\H1');
		  print(20,80,'客户签名:_____________________');

print( 24,20,'备注:');
print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
print( 24,5,'柜员:[4]',$FD7);
print( 24,5,'流水号:[6]',itoa(#TRACE_NO,'%06d'));
}"
</PRINT>
</RESPONSE>
 
</TRANSACTION>