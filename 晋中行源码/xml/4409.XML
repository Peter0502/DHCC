 <?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11000000" TITLE="4409 按揭提前还本"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
	  initfd();
	  $FD23 = space(3);
	  $FD25 = #USERNAME;
	  $FD34 = #CD34;
	  $FD37 = #ACCOUNTNO;
	  $FD39 = space(16);
	  $FD40=itoa(#RETURNMONEY*100, '%016.0f');
	  $FD42=itoa(#BALANCE*100, '%016.0f');
	  $FD50 = #CD50;
	  $FD58 = space(16);
	  $FD65 = '3204   ';
	  $FD66 = #FLAG;
	  $FD81 = getseltitle(#FLAG,#FLAG);
	#FD102_34='还本';//摘要 add by ligl 2006-12-19 16:56

	  if(#FLAG=='1')
	  {
	//	  $FD102 = getitems ('#FD102_41#FD102_42#FD102_43#FD102_48#PASSWD2#FD102_14#FD102_15#KKKK#FD102_56#FD102_57#FD102_58#FD102_59#FD102_60#FD102_61#FD102_62#FD102_63#FD102_64');
	//??不知道27是从哪来得
  	  	#FD102_21='27';
  	  	#FD102_24='1';
	  	$FD102 = getitems ('#FD102_1#FD102_2#FD102_3#FD102_4#FD102_5#FD102_6#FD102_7#FD102_8#FD102_9#FD102_10#FD102_11#FD102_12#FD102_13#FD102_14#RETURNMONEY#FD102_16#FD102_17#FD102_18#FD102_19#FD102_20#FD102_21#FD102_22#FD102_23#FD102_24#FD102_25#FD102_26#FD102_27#FD102_28#FD102_29#FD102_30#FD102_31#FD102_32#FD102_33#FD102_34');
	  }
	  else{
  	  	#FD102_22='2';
  	  	#FD102_24='1';
	  	$FD102 = getitems ('#FD102_1#FD102_2#FD102_3#FD102_4#FD102_5#FD102_6#FD102_7#FD102_8#FD102_9#FD102_10#FD102_11#FD102_12#FD102_13#CPDATE#RETURNMONEY#FD102_16#FD102_17#FD102_18#FD102_19#FD102_20#DSCPT#FD102_22#FD102_23#FD102_24#FD102_25#FD102_26#FD102_27#FD102_28#FD102_29#FD102_30#FD102_31#FD102_32#FD102_33#FD102_34');
	  }
	  $FD109 = getitems ('#FD109_1#FD109_2#FD102_34');
	  $FD118 = getitems ('#FD118_1#FD118_2#FD118_3#FD118_4#FD118_5');
      commsend_001();
      $MSGTYPE='03001';
	  $FD16 = '3204';

}"
</COMMSEND>
<COMMRECV>"{
	 if($FD12 == '0000')
		 {
			 showmsg('交易成功!');
		 }
	 }"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(4409                       按揭提前还本 )"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <PAGE NAME="DEFAULT">
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=3204)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  
  <!--输入变量-->	
  <ITEM LINE="8" COL="12" TYPE="%-9s" FUNCTIONS="T(贷款帐号:)"/>
  <ITEM LINE="9" COL="12" TYPE="%-9s" FUNCTIONS="T(帐户姓名:)"/>

  <ITEM LINE="12" COL="12" TYPE="%-9s" FUNCTIONS="T(本金金额:)"/>
  
  <ITEM LINE="14" COL="12" TYPE="%-9s" FUNCTIONS="T(归还金额:)"/>
  <ITEM LINE="15" COL="12" TYPE="%-9s" FUNCTIONS="T(现转标志:)"/>
  <ITEM NAME="#FD102_41"  TYPE="%-32s" FUNCTIONS=""/>
  <ITEM NAME="#CD34"     TYPE="%-4s"  FUNCTIONS=""/>
  <ITEM NAME="#CD50"     TYPE="%-4s"  FUNCTIONS=""/>
  <ITEM NAME="#PASSWD2"   TYPE="%-6s"  FUNCTIONS="T(000000)"/>

  <ITEM NAME="#FD102_1"   TYPE="%-24s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_2"   TYPE="%-4s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_3"   TYPE="%-3s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_4"   TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_5"   TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_6"   TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_7"   TYPE="%-6s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_8"   TYPE="%-6s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_9"   TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_10"  TYPE="%-20s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_11"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_12"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_13"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_14"  TYPE="%-8s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_15"  TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#FD102_16"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_17"  TYPE="%-60s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_18"  TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#FD102_19"  TYPE="%-2s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_20"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_21"  TYPE="%-3s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_22"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_23"  TYPE="%-4s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_24"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_25"  TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#FD102_26"  TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#FD102_27"  TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#FD102_28"  TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#FD102_29"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_30"  TYPE="%-20s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_31"  TYPE="%-30s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_32"  TYPE="%-24s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_33"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_34"  TYPE="%-20s"  FUNCTIONS=""/>


  <ITEM NAME="#FD109_1"  TYPE="%-259s" FUNCTIONS=""/>
  <ITEM NAME="#FD109_2"  TYPE="%-1s"  FUNCTIONS="T(0)"/>
  <ITEM NAME="#FD118_1" TYPE="%-2s" FUNCTIONS="T(01)"/>
  <ITEM NAME="#FD118_2" TYPE="%-3s" FUNCTIONS=""/>
  <ITEM NAME="#FD118_3" TYPE="%-16s" FUNCTIONS=""/>
  <ITEM NAME="#FD118_4" TYPE="%-16s" FUNCTIONS="T(0000000000000000)"/>
  <ITEM NAME="#FD118_5"  TYPE="%-53s" FUNCTIONS=""/>
  
  <ITEM NAME="#ACCOUNTNO"    INPUT="TEXT"  LINE="8" COL="21" TYPE="%-19s" FUNCTIONS="T()">

  <ONLOSTFOCUS>
 "{
		initfd();
		commsend_001();
		$FD16 = '9807';
		$FD37 = #ACCOUNTNO;
		$FD65 = '3204';
		callserver();
		if($FD12!='0000')
		{
			showmsg(geterror());
			return (false);
		}
		#USERNAME = $FD25;
		show(#USERNAME,true);
		#BALANCE  = val($FD42,0.01);
	    #CD34=$FD34;
	    #CD50='001';

		enable(#USERNAME,false);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#USERNAME" INPUT="TEXT" LINE="9" COL="21" TYPE="%-60s" FUNCTIONS=""/>
  <!---
  <ITEM NAME="#AVL"     TYPE = "%16s"  FUNCTIONS=""/>
  <ITEM NAME="#BALANCE" INPUT="TEXT"  LINE="12" COL="21" TYPE="%16s" FUNCTIONS="X(#AVL)"/>
  <ITEM NAME="#AVL"     TYPE = "%17.2f"  FUNCTIONS="J(#BALANCE)"/>
  -->
  <ITEM NAME="#BALANCE"       INPUT="TEXT"  LINE="12" COL="21" TYPE="%17.2f" FUNCTIONS="T()"/>
  <ITEM NAME="#RETURNMONEY"   INPUT="TEXT"  LINE="14" COL="21" TYPE="%17.2f" FUNCTIONS="J(#XRETURNMONEY)J(#KHJE)">
  <ONLOSTFOCUS>
  "{
		if(#RETURNMONEY==0)
		{	
			showmsg('请输入贷款金额');
			return (false);
		}
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#KHJE" TYPE="%17.2f" FUNCTIONS="T(#RETURNMONEY)"/>
  <ITEM NAME="#XRETURNMONEY"   TYPE="%-16s" FUNCTIONS="X(#RETURNMONEY)"/>

  <ITEM NAME="#FLAG"   INPUT="SELECT"  LINE="15" COL="21" TYPE="%1s" FUNCTIONS="V(NB)">
	<SELECT>
		<OPTION VALUE="1" TITLE="1.现金"/>
		<OPTION VALUE="2" TITLE="2.转帐"/>
	</SELECT>

 </ITEM>

   <ITEM LINE="21" COL="49" NAME="#SECONDPAGE" TYPE="%-6s" FUNCTIONS="T(下一页)" INPUT="BUTTON">
    <ONCLICK>	
	"{
		if(#FLAG=='2')
		{
			loadpage('PAGE1');
		}
	}"	
    </ONCLICK>
  </ITEM>
  </PAGE>
  <PAGE NAME="PAGE1">
  <BLOCK NAME="ZZH_PGE2" LINE="6" COL="5" VISABLE="FALSE">
     <IMPORT>44061_2.IMP</IMPORT>
  </BLOCK>
    <ITEM LINE="21" COL="49"  TYPE="%-6s" FUNCTIONS="T(上一页)" INPUT="BUTTON">
    <ONCLICK>"{
        loadpage('DEFAULT');
    }"
    </ONCLICK>
  </ITEM>
  </PAGE>



   
  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
	<ITEM NAME="#YEAR"  TYPE="%-4s" FUNCTIONS="T($FD5,1,4)"/>
    <ITEM NAME="#MON"   TYPE="%-2s" FUNCTIONS="T($FD5,5,2)"/>
	<ITEM NAME="#DAY"   TYPE="%-2s" FUNCTIONS="T($FD5,7,2)"/>
	<ITEM NAME="#CD102"   TYPE="%-378s" FUNCTIONS=""/>
</VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
	<PACKAGE DEVICE="PRINTER" DESC="打印按揭提前还本普通凭证">
		NOTHING
	</PACKAGE>
		<PRINT>"{
        dim @txtime  as string;
        @txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
        print( 5, 20,'机构名称:[30]',$BRNAME);
        print( 5, 2,'代码:4409');
        print( 5, 13,'交易:按揭提前还本');
	print( 7, 20,'贷款帐号:[24]',#ACCOUNTNO);
	print( 8, 20,'帐户姓名:[60]',#USERNAME);
	print( 9, 20,'本金金额:[22]',ltrim(comma(itoa(#BALANCE, '%17.2f'), 22)));
        print( 10, 20,'归还本金:[22]',ltrim(comma(itoa(#RETURNMONEY, '%17.2f'), 22)));
        print_sq();
        printacdtl_1();
	print( 24,20,'备注:')
        print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
        print( 24,5,'柜员:[4]',$FD7);
        print( 24,5,'流水号:[6]',$FD4);
	}"
     </PRINT>
</RESPONSE>
<!--
<RESPONSE>
<PACKAGE DEVICE="PRINTER" DESC="打印按揭还本交易凭条">
NOTHING
</PACKAGE>
          <PRINT>
          "{
	dim @txtime  as string;
@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
print( 5,20,'[25]按揭提前还本交易凭条',space(40));
print( 6,20,'[10]交易日期:[8] [8]  [20]流水号:[6]',space(10),$HDATE,@txtime,space(20),$FD4);
print( 7,20,'┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓');
print( 8,20,'┃ 机构名称:[40] [42] ┃',$BRNAME,space(42));
print( 9,20,'┃ 贷款帐号:[24] [58] ┃',#ACCOUNTNO,space(58));
print(10,20,'┃ 户    名:[60] [22] ┃',#USERNAME,space(22));
print(11,20,'┃----------------------------------------------------------------------------------------------┃');
print(12,20,'┃ 本金金额:[22] [60] ┃',ltrim(comma(itoa(#BALANCE,'%17.2f'),22)),space(60));
print(13,20,'┃ 归还本金:[22] [60] ┃',ltrim(comma(itoa(#RETURNMONEY,'%17.2f'),22)),space(60));
print(14,20,'┃----------------------------------------------------------------------------------------------┃');
print(15,20,'┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛');           
          }"
          </PRINT>
</RESPONSE>
-->
<!---------<RESPONSE>
 <PACKAGE DEVICE="PRINTER" DESC="打印按揭提前还本专用凭证">
 NOTHING
 </PACKAGE>
  <PRINT>
  "{
	dim @txtime  as string;
@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	print( 4, 25,'[5]',$KINBR);
	print( 4, 10,'[30]',$BRNAME);
	print( 4, 5,'操作员号:[4]',$FD7);
	print( 5, 15,'[6]',$FD4);
	print( 5, 28,'按揭提前还本');
	print( 5, 22,'[8]  [8]',$HDATE,@txtime);
	printacdtl_1();
  }"
  </PRINT>
</RESPONSE>
---------->
</TRANSACTION>




