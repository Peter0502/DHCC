<TRANSACTION RIGHTS="11111111111000000000000000000000"  TITLE="5562     与银行税票明细对账通知查询"
xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>
"{
   // initfd();
    commsend_001();
    $FD44=#CHKDATE;     //对账日期
    $FD26=#ORITAXORGCODE; //原征收机关代码
}"
</COMMSEND>

<COMMRECV>
"{
commrecv_001();
}"
</COMMRECV>

<VARIABLE UPLOOP="TRUE">
<ITEM LINE="3"  COL="3" TYPE="%-70s" FUNCTIONS=
"T(5562                   与银行税票明细对账通知查询)"/>
<ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
"T(─────────────────────────────────────)"/>
<ITEM NAME="#TXNO"    TYPE="%-4s" FUNCTIONS="T($TXNO=5568)"/>
<ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>

<ITEM NAME="#DOLIST" TYPE="%1s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
        dim @selid          as number;
	dim @paybkcode      as string;
	dim @payeebankno    as string;
	dim @chkdate        as string;
	dim @chkacctord     as string;
	dim @curpackno      as string;
	dim @br_no          as string;
	dim @payacct        as string;
	dim @handorgname    as string;
	dim @oritaxorgcode  as string;
	dim @orientrustdate as string;
	dim @oritrano       as string;
	dim @oripackno      as string;
	dim @traamt         as string;
	dim @taxvouno       as string;
	dim @taxpayname     as string;
	dim @protocolno     as string;
	dim @taxtypenum     as string;
	dim @checkflag      as string;
	
	
	
	if(#DOLIST == '1')
	{
	    @selid=list_work();
	    if(@selid &lt; 0)
	    {
		     list_del();
		     rerun();
		     return(true);
	    }
      @selid=list_getselid();
      if(@selid &lt; 0)
      {
         list_del();
         rerun();
         return(true);
      }

	    @paybkcode=rtrim(list_gettext(@selid,0));
	    @payeebankno=rtrim(list_gettext(@selid,1));
	    @chkdate=rtrim(list_gettext(@selid,2));
	    @chkacctord=rtrim(list_gettext(@selid,3));
	    @curpackno=rtrim(list_gettext(@selid,4));
	    @br_no=rtrim(list_gettext(@selid,5));
	    @payacct=rtrim(list_gettext(@selid,6));
	    @handorgname=rtrim(list_gettext(@selid,7));
	    @oritaxorgcode=rtrim(list_gettext(@selid,8));	    
	    @orientrustdate =rtrim(list_gettext(@selid,9));
            @oritrano=rtrim(list_gettext(@selid,10));
            @oripackno=rtrim(list_gettext(@selid,11));
            @traamt=rtrim(list_gettext(@selid,12));
	    @taxvouno=rtrim(list_gettext(@selid,13));
	    @taxpayname=rtrim(list_gettext(@selid,14));
	    @protocolno=rtrim(list_gettext(@selid,15));
	    @taxtypenum=rtrim(list_gettext(@selid,16));
	    @checkflag=rtrim(list_gettext(@selid,17));
	    
   
	     //与银行税票明细对账通知信息
	    open('5562_1.XML','#PAYBKCODE='+@paybkcode+';#PAYEEBANKNO='+@payeebankno+';#CHKDATE='+@chkdate+';#CHKACCTORD='+@chkacctord+';#CURPACKNO='+@curpackno+';#BR_NO='+@br_no+';#PAYACCT='+@payacct+';#HANDORGNAME='+@handorgname+';#ORITAXORGCODE='+@oritaxorgcode+';#ORIENTRUSTDATE='+@orientrustdate+';#ORITRANO='+@oritrano+';#ORIPACKNO='+@oripackno+';#TRAAMT='+@traamt+';#TAXVOUNO='+@taxvouno+';#TAXPAYNAME='+@taxpayname+';#PROTOCOLNO='+@protocolno+';#TAXTYPENUM='+@taxtypenum+';#CHECKFLAG='+@checkflag+';'); 

		showfooter();
		return(true);
	}
	list_del();
	#DOLIST='';
  }"
  </ONLOSTFOCUS>
  </ITEM>

<ITEM NAME="#DOLIST" TYPE="%-1s" FUNCTIONS="">
<ONLOSTFOCUS>
"{
	showall();
}"
</ONLOSTFOCUS>
</ITEM>

<ITEM LINE="7"  COL="21" TYPE="%-15s" FUNCTIONS="T(对  账  日  期:)"/>
<ITEM LINE="9"  COL="21" TYPE="%-15s" FUNCTIONS="T(原征收机关代码:)"/>
<ITEM NAME="#ORITAXORGTYPE" TYPE="%1s" FUNCTIONS=""/><!--征收机关类型 -->

<ITEM LINE="7"  COL="37" NAME="#CHKDATE" TYPE="%-8s" DEVICE="KEYBOARD" FUNCTIONS="T()V(NB)D()"/>
<ITEM LINE="9"  COL="37" NAME="#ORITAXORGCODE" TYPE="%-12s" DEVICE="KEYBOARD" FUNCTIONS="T()">
<ONLOSTFOCUS>
  "{
    dim @c as string;
    dim @d as string;
    dim @a as string;
    dim @b as string;
    // TODO在这里callserver判断征收机关代码是否存在
    if(#ORITAXORGCODE =='')
  	return (true);
    dim @FullMsg as string;
    @FullMsg='';
    initfd();
    dim @baktxno as string;
    @baktxno=$TXNO;
    $TXNO='9410';
    $FD61=#ORITAXORGCODE;
    commsend_001();
    //callserver(); chengbo 20090619 HS
    calltips();
    $TXNO=@baktxno;
    if($FD12!='0000'){
      showmsg(geterror());
      return (false);
    }
    @d = substr($FD95,12,60);
    @c =substr($FD95,72,1);
    @a = substr($FD95,73,1);
    @b = substr($FD95,74,1);
    @FullMsg='户名:'+@d+chr(10)+'类型:'+@c+chr(10)+'征收机关类型:'+@a+chr(10)+'机构级次:'+@b;
    showhelp(6,70,8,3,'征收机关基本信息',@FullMsg);
    #ORITAXORGTYPE=substr(@a,0,1);
    $FD20=@b;
  }"
  </ONLOSTFOCUS>
  </ITEM> 
<ITEM LINE="20" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
<ONCLICK>
"{
	dim @tota as string;
	initfd();
	commsend_001();
        $FD44=#CHKDATE;     //对账日期
        $FD26=#ORITAXORGCODE; //原征收机关代码
        //@tota=callserver();   chengbo  20090619  HS
        @tota=calltips();

	if($FD12!='0000'){
		showmsg(geterror());
		return(false);
	}

	autolist(@tota);	
	#DOLIST='1';
}"
</ONCLICK>
</ITEM>   
</VARIABLE>

<REQUEST>        
</REQUEST>      
<RESPONSE>       
<PACKAGE>        
</PACKAGE>          
</RESPONSE>      
</TRANSACTION>   
