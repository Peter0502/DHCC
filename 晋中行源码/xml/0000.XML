<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11111111011100000000000001100010" TITLE="1423   签到签退"
	xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
	<FIRSTWORK RERUN="TRUE">
		"{
		dim @tota as string;
		initfd();
		commsend_001();
		$FD16='1001';
		$FD18='pbp';
		@tota=callagnpbp();
		if(@tota == '' or @tota == '1')
		{
		    @tota=getfiletxt('../tmp/'+$KINBR+$TTYNAME);
		}
		setsel(#SYSCODE,@tota,'v4o1t8o1');
		}"
	</FIRSTWORK>
	<COMMSEND>
		"{
		refresh();
		initfd();
		commsend_001();
		}"
	</COMMSEND>
	<COMMRECV>
		"{
		commrecv_001();
		}"
	</COMMRECV>
	<VARIABLE>
		<ITEM LINE="3" COL="3" TYPE="%-60s" FUNCTIONS="T(1423                             签到签退)"/>
		<ITEM LINE="4" COL="4" TYPE="%-72s" FUNCTIONS="T(-----------------------------------------------------------------------)"/>
		<ITEM NAME="#QDZT" TYPE="%-1s" FUNCTIONS="" />
		<ITEM LINE="6" COL="6" TYPE="%-10s" FUNCTIONS="T(操作类型：)"/>
		<ITEM LINE="6" COL="16" NAME="#SIGN" TYPE="%-2s" INPUT="SELECT" DEVICE="KEYBOARD" FUNCTIONS="T(00)">
			<SELECT>
				 <OPTION VALUE="00" TITLE="0.签到" />
				 <!--OPTION VALUE="01" TITLE="1.签退" /-->
			</SELECT>
		</ITEM>
		<ITEM LINE="7" COL="6" TYPE="%-10s" FUNCTIONS="T(系统代码：)"/>
		<ITEM LINE="7" COL="16" NAME="#SYSCODE" TYPE="%-4s" INPUT="SELECT" DEVICE="KEYBOARD" FUNCTIONS="T()V(NB)">
			<SELECT>
			</SELECT>
			<ONLOSTFOCUS>
				"{
				
				showblock('SXYW', true, true);
				
				}"
			</ONLOSTFOCUS>
		</ITEM>
		<BLOCK LINE="9" COL="0" NAME="SXYW" VISABLE="FALSE">
			<ITEM LINE="0" COL="6"  TYPE="%-10s"  FUNCTIONS="T(业务种类:)"/>
			<ITEM LINE="0" COL="16" TYPE="%-4s" NAME="#SvcClass" INPUT="TEXT" FUNCTIONS="T(0000)V(NB)">
				<ONGOTFOCUS>
					"{
					       dim @liststr as string;
					       dim @selid   as number;
					       dim @idx     as number;
					       dim @flag    as string;    
					       dim @tmp    as string;
					       
					       @flag = '';
                 list_init(10, 32, 10, 17);
                 list_setcolcnt(2);
					       list_setcol(0, '  启  用', 9);
					       list_setcol(1, '     名    称', 20);
					       list_additem('#CNY0', '', '人民币单位结算');
				         list_additem('#CNY1', '', '人民币个人结算');
					       list_additem('#CNY2', '', '外币结算业务');		
					       list_additem('#CNY3', '', '人民币批量借贷记');	
					       list_additem('#OK', '', '确  定');		    	
				        	while (true)
				        	{
				        	   @selid = list_work();
				        	   @tmp = list_getaction(@selid);
				        	   showmsg(@tmp + itoa(@selid,'%.2f')+' ' +#SvcClass);
				        	   if ((@selid &lt; 0) or (@selid == 1))
				        	   {
				        	         @idx = 2;
				        	         #SvcClass = '';
				            	      while (@idx &lt; 6)
				            	      {
				        	            if (list_gettext(@idx, 0) == '')
				            	        {
				                     	    #SvcClass = #SvcClass+'0';
				        	            }
				        	            else
				        	            {
				        	               #SvcClass = #SvcClass+'1';
				        	            }
				        	            @idx = @idx + 1;
				        	          }
				        	    list_del();
				        	    refresh();
				        	    return(true);
					          }
					       }
					}"
				</ONGOTFOCUS>
			</ITEM>
			<!--
			<ITEM LINE="0" COL="16" TYPE="%-14s"  FUNCTIONS="T(人民币单位结算)"/>
			<ITEM LINE="0" COL="32" NAME="#RMBD"  TYPE="%-1s" INPUT="SELECT" FUNCTIONS="T(0)V(NB)" >
			<SELECT>
			<OPTION VALUE="0" TITLE="启用"/>
			<OPTION VALUE="1" TITLE="不启用"/>
			</SELECT>
			</ITEM>
			<ITEM LINE="0" COL="46" TYPE="%-14s"  FUNCTIONS="T(人民币个人结算)"/>
			<ITEM LINE="0" COL="64" NAME="#RMBG"  TYPE="%-1s" INPUT="SELECT" FUNCTIONS="T(0)V(NB)" >
			<SELECT>
			<OPTION VALUE="0" TITLE="启用"/>
			<OPTION VALUE="1" TITLE="不启用"/>
			</SELECT>
			</ITEM>
			<ITEM LINE="1" COL="16" TYPE="%-14s"  FUNCTIONS="T(外币结算业务)"/>
			<ITEM LINE="1" COL="32" NAME="#WB"    TYPE="%-1s" INPUT="SELECT" FUNCTIONS="T(1)V(NB)" >
			<SELECT>
			<OPTION VALUE="0" TITLE="启用"/>
			<OPTION VALUE="1" TITLE="不启用"/>
			</SELECT>
			</ITEM>
			<ITEM LINE="1" COL="46" TYPE="%-16s"  FUNCTIONS="T(人民币批量借贷记)"/>
			<ITEM LINE="1" COL="64" NAME="#RMBP"  TYPE="%-1s" INPUT="SELECT" FUNCTIONS="T(0)V(NB)" >
			<SELECT>
			<OPTION VALUE="0" TITLE="启用"/>
			<OPTION VALUE="1" TITLE="不启用"/>
			</SELECT>
			</ITEM>
			-->
		</BLOCK>
		<ITEM LINE="11" COL="4" TYPE="%-72s" FUNCTIONS="T(----------------------------------------------------------------------)" />
		<ITEM LINE="13" COL="6" TYPE="%-10s" FUNCTIONS="T(系统状态：)"/>
		<ITEM LINE="13" COL="16" TYPE="%-20s" NAME="#SysSts" FUNCTIONS=""/>
		<ITEM LINE="14" COL="6" TYPE="%-10s" NAME="#Login_L" FUNCTIONS="T(签到状态：)"/>
		<ITEM LINE="14" COL="16" TYPE="%-50s" NAME="#LoginSts" FUNCTIONS=""/>
		<ITEM LINE="15" COL="6" TYPE="%-10s" FUNCTIONS="T(工作日期：)"/>
		<ITEM LINE="15" COL="16" TYPE="%-8s"  NAME="#WorkDate" FUNCTIONS=""/>
		<ITEM NAME="#MAKESURE" TYPE="%-1s" FUNCTIONS="">
			<ONLOSTFOCUS>
				"{
				if (#QDZT == '1') {
				if (#SIGN == '00') {
				showmsg('可能已经签到!');
				#MAKESURE=confirm('是否继续?', 2);
				if (#MAKESURE == 'N') {
				closeall();
				}
				}
				}
				}"
			</ONLOSTFOCUS>
		</ITEM>
		<BLOCK LINE="16" COL="25" NAME="B_PASSWD" VISABLE="FALSE">
			<ITEM LINE="0" COL="0" TYPE="%-10s" FUNCTIONS="T(签到密码：)"/>
			<ITEM LINE="0" COL="10" TYPE="%-6s" NAME="#PASSWD" INPUT="TEXT" FUNCTIONS="V(NB)i()">
				<ONGOTFOCUS>
					"{
					#PASSWD = '';
					show(#PASSWD, true);
					}"
				</ONGOTFOCUS>
			</ITEM>
			<ITEM LINE="1" COL="0" TYPE="%-10s" FUNCTIONS="T(新 密 码：)"/>
			<ITEM LINE="1" COL="10" TYPE="%-6s" NAME="#PASSWD_NEW" INPUT="TEXT" FUNCTIONS="i()">
				<ONLOSTFOCUS>
					"{
					dim @pattern as string;
					dim @get as string;
					dim @lenth as number;
					dim @cnt as number;
					@cnt = 0;
					@pattern = delspace(#PASSWD_NEW);
					while (@cnt &lt; len(@pattern)) {
					@get = substr(@pattern, @cnt, 1);
					if (@get &gt; '9' or @get &lt; '0') {
					showmsg('密码只能输入数字!');
					#PASSWD_NEW = '';
					show(#PASSWD_NEW, true);
					return(false);
					}
					@cnt = @cnt + 1;
					}
					@lenth = len(delspace(#PASSWD_NEW));
					if (@lenth &lt; 6) {
					showmsg('密码长度必须是六位');
					#PASSWD_NEW = '';
					show(#PASSWD_NEW, true);
					return(false);
					}
					}"
				</ONLOSTFOCUS>
			</ITEM>
			<ITEM LINE="2" COL="0" TYPE="%-10s" FUNCTIONS="T(确认密码：)"/>
			<ITEM LINE="2" COL="10" TYPE="%-6s" NAME="#PASSWD_CHK" INPUT="TEXT" FUNCTIONS="i()">
				<ONLOSTFOCUS>
					"{
					if (#PASSWD_CHK != #PASSWD_NEW) {
					showmsg('两次输入的密码不一致，请重新输入');
					#PASSWD_NEW = '';
					show(#PASSWD_NEW, true);
					#PASSWD_CHK = '';
					show(#PASSWD_CHK, true);
					goitem(#PASSWD_NEW);
					}
					}"
				</ONLOSTFOCUS>
			</ITEM>
		</BLOCK>
		<ITEM LINE="21" COL="65" TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
			<ONCLICK>
				"{
				dim @cnt as number;
				if (#SYSCODE == 'sxps')
				{
				if (#SvcClass == '1111')
				{
				initfd();
				commsend_001();
				$FD16='1501';
				$FD18='pbp';
				$FD28='sxps';
				$FD23='0';
				$FD35=#SIGN;
				callagnpbp();
				if ($FD12 != '0000') {
				showmsg(geterror());
				return(false);
				}
				#SysSts=$FD36;
				if(#SysSts == '10')
				{
				#SysSts = '运行';
				}
				#WorkDate=$FD44;
				if (#SIGN == '00')
				{
				#LoginSts='已签到';
				}
				else if (#SIGN == '01')
				{
				#LoginSts='已签退';
				}
				show(#SysSts, true);
				show(#WorkDate, true);
				show(#LoginSts, true);
				showmsg('交易成功！');
				//closeall();
				//return(true);
				runoutput();
				rerun();
				refresh();
				}
				#Login_L = '成功列表：';
				@cnt = 0;
				while (@cnt &lt; 4)
				{
				if (substr(#SvcClass, @cnt, 1) == '1')
				{
				initfd();
				commsend_001();
				$FD16='1501';
				$FD18='sxps';
				$FD28='sxps';
				$FD35=#SIGN;
				$FD23=itoa(@cnt+1, '%1d');
				callagnpbp();
				if ($FD12 == '0000')
				{
				if (@cnt == 0)
				{
				#LoginSts = '1,人民币单位结算;';
				}
				else if (@cnt == 1)
				{
				#LoginSts = #LoginSts+'2,人民币个人结算;';
				}
				else if (@cnt == 2)
				{
				#LoginSts = #LoginSts+'3,外币结算业务;';
				}
				else if (@cnt == 3)
				{
				#LoginSts = #LoginSts+'4,人民币批量借贷记;';
				}
				}
				#SysSts=$FD36;
				if(#SysSts == '10')
				{
				#SysSts = '运行';
				}
				#WorkDate=$FD44;
				}
				@cnt = @cnt + 1;
				}
				show(#SysSts, true);
				show(#WorkDate, true);
				show(#Login_L, true);
				show(#LoginSts, true);
				showmsg('交易完成！');
				//closeall();
				//return(true);
				runoutput();
				rerun();
				refresh();
				}
				runoutput();
				rerun();
				refresh();
				}"
			</ONCLICK>
		</ITEM>

	</VARIABLE>

	<REQUEST>
	</REQUEST>
	<RESPONSE>
		<PACKAGE>
			HOTHING
		</PACKAGE>
	</RESPONSE>
	<OUTPUT>
	</OUTPUT>

</TRANSACTION>

