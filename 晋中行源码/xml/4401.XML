<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11000000" TITLE="4401 贷款开户"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{ 
		$FD16 = '3101';
  	$MSGTYPE='03001';
}"
</COMMSEND>
<COMMRECV>"{
	commrecv_001();

	if( $FD66 == 'A')
	{
		setitems('#CD66','A自动计算');
	}
	else if($FD66 == 'N')
	{
		setitems('#CD66','N无');
	}
	else if($FD66 == 'M')
	{
		setitems('#CD66','M手工输入');
	}
	if( $FD72 == 'M')
	{
		setitems('#CD72','M手工');
	}
	else if($FD66 == 'N')
	{
		setitems('#CD72','N无');
	}

}"
</COMMRECV>
<FIRSTWORK>
"{
  #PIC='';
  #PIC1='';
}"
</FIRSTWORK>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(4401                            贷款开户)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>

  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=3101)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  
 <PAGE NAME="DEFAULT">
  <ITEM LINE="5"   COL="5"  TYPE="%-10s" FUNCTIONS="T(证件类型:!)"/>
  <ITEM LINE="5"   COL="40" TYPE="%-10s" FUNCTIONS="T(证件号码:)"/>
  <ITEM LINE="6"   COL="5"  TYPE="%-10s" FUNCTIONS="T(客户名称:)"/>
  <ITEM LINE="6"   COL="59" NAME="#LBLPIC" TYPE="%-10s" FUNCTIONS="T(照    片:)"/>
  <ITEM LINE="7"   COL="59" NAME="#LBLPIC1" TYPE="%-10s" FUNCTIONS="T(印    件:)"/>
  <ITEM LINE="7"   COL="5"  TYPE="%-10s" FUNCTIONS="T(审批借据号:)"/>

  <ITEM LINE="8"   COL="5"  TYPE="%-5s"  FUNCTIONS="T(期限:)"/>
  <ITEM LINE="8"   COL="15" TYPE="%-2s"  FUNCTIONS="T(月)"/>
  <ITEM LINE="8"   COL="40" TYPE="%-10s" FUNCTIONS="T(贷款方式:!)"/>
  <ITEM LINE="10"  COL="5"  TYPE="%-70s" FUNCTIONS="T(------------------------------------------------------------------)"/>
   
  <ITEM LINE="12"  COL="5"  TYPE="%-10s" FUNCTIONS="T(产品编号:!)"/>
 
  <ITEM LINE="14"  COL="5"  TYPE="%-10s" FUNCTIONS="T(币    种:!)"/>
  <ITEM LINE="15"  COL="5"  TYPE="%-10s" FUNCTIONS="T(还款方式:!)"/>
  <ITEM LINE="15"  COL="40" TYPE="%-10s" FUNCTIONS="T(记息类型:!)"/>
  <ITEM LINE="16"  COL="5"  TYPE="%-10s" FUNCTIONS="T(利率获取:!)"/>
  <ITEM LINE="16"  COL="40" TYPE="%-10s" FUNCTIONS="T(基础利率:)"/>
  <ITEM LINE="16"  COL="59" TYPE="%-2s"  FUNCTIONS="T(‰)"/>
  
  <ITEM LINE="18"  COL="5"  TYPE="%-10s" FUNCTIONS="T(合同利率:)"/>
  <ITEM LINE="18"  COL="25" TYPE="%-2s"  FUNCTIONS="T(‰)"/>
  <ITEM LINE="18"  COL="35" TYPE="%-2s"  FUNCTIONS="T(％)"/>
  <ITEM LINE="18"  COL="40" TYPE="%-10s" FUNCTIONS="T(逾期利率:)"/>
  <ITEM LINE="18"  COL="59" TYPE="%-2s"  FUNCTIONS="T(‰)"/>
  <ITEM LINE="18"  COL="70" TYPE="%-2s"  FUNCTIONS="T(％)"/>
  <ITEM LINE="19"  COL="5"  TYPE="%-10s" FUNCTIONS="T(罚息利率:)"/>
  <ITEM LINE="19"  COL="25" TYPE="%-2s"  FUNCTIONS="T(‰)"/>
  <ITEM LINE="19"  COL="35" TYPE="%-2s"  FUNCTIONS="T(％)"/>
  
  <!--输入变量-->
  <ITEM NAME="#CITYPE" LINE="5"  COL="15" TYPE="%-1s" INPUT="SELECT" FUNCTIONS="V(NB)J(#CITYPENAME)">
	<SELECT>
		<OPTION VALUE="1" TITLE="1身份证"/>
		<OPTION VALUE="2" TITLE="2户口簿"/>
		<OPTION VALUE="3" TITLE="3护照"/>
		<OPTION VALUE="4" TITLE="4军官证"/>
		<OPTION VALUE="5" TITLE="5回乡证"/>
		<OPTION VALUE="8" TITLE="8企业代码证"/>
		<OPTION VALUE="9" TITLE="9经营许可证"/>
		<OPTION VALUE="A" TITLE="A营业执照"/>
		<OPTION VALUE="B" TITLE="B事业法人证"/>
		<OPTION VALUE="C" TITLE="C工商核准号"/>
	</SELECT>
  </ITEM>

  <ITEM NAME="#CITYPENAME"  TYPE="%-12s" FUNCTIONS="j(#CITYPE=1,T{身份证})j(#CITYPE=2,T{户口簿})j(#CITYPE=3,T{护照})j(#CITYPE=4,T{军官证})j(#CITYPE=5,T{回乡证})j(#CITYPE=8,T{企业代码证})j(#CITYPE=9,T{经营许可证})j(#CITYPE=A,T{营业执照})j(#CITYPE=B,T{事业法人证})j(#CITYPE=C,T{工商核准号})"/>
<ITEM NAME="#CID" TYPE="%-8s"/>
<!-- 为核查结果中文传值的变量 wudawei 20131101 -->
  <ITEM NAME="#HCJGBL"  TYPE="%-60s" />
  <ITEM NAME="#CINO" LINE="5"  COL="50" TYPE="%-20s" INPUT="TEXT" FUNCTIONS="">
 <ONLOSTFOCUS>
 "{	
 		initfd();
    //if(#CITYPE =='1')
    //{
    //  idcheck(#CINO,'');
    //}	
    commsend_001();
 		$FD16='9804';
		$FD62=#CINO;
		$FD67=#CITYPE;
		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		
		#CINAME=delspace($FD25);
		#CID=rtrim($FD28);
		show(#CINAME,true);
		//add 20131030 wudawei start 调用身份核查
  		  dim @res as string;
				if(#CITYPE=='1' or #CITYPE=='2')
				{
					@res = idcheck(#CINO,#CINAME);
					#HCJGBL = strfld(@res,'|',1);
					@res =  strfld(@res,'|',0);
					if(@res=='02' or @res=='03' or @res=='04' or @res=='05' or @res=='06')
					{
							showmsg('身份核查结果不通过，不能继续办理！');
							return(false);
					}
				}
				//add 20131030 end
		//showmsg('#CID=['+#CID+']');
 }"
 </ONLOSTFOCUS>
  </ITEM>
  <!--1.1-->
  <ITEM NAME="#CINAME" LINE="6"  COL="15" TYPE="%-60s" INPUT="TEXT" ENABLE="FALSE" FUNCTIONS=""/>
  <!---
  <ITEM NAME="#AAA" FUNCTIONS="">
  <ONLOSTFOCUS> 
  "{
    showhelp(10,40,10,10,'提  示','不满整月的,请在后面手动设置到期日');
  "}
   </ONLOSTFOCUS>
  </ITEM>
  --->
<ITEM NAME="#F125" TYPE="%-300s"/>
<!--added by liuyong 2009-9-1 显示图片信息 start-->
<ITEM NAME="#LYIDNO" TYPE="%-20s" FUNCTIONS="" />
<ITEM NAME="#LYIDTYPE" TYPE="%-1s" FUNCTIONS="" />
<ITEM LINE="6" COL="70" LINES="160" COLS="120" NAME="#PIC" TYPE="%-10s" VISABLE="FALSE" FUNCTIONS=""/>
  <ITEM NAME="#SETPIC" TYPE="%-10s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
      #LYIDNO=#CINO;
      #LYIDTYPE=#CITYPE;
      call_96681();
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="7" COL="70" LINES="220" COLS="160" NAME="#PIC1" TYPE="%-10s" VISABLE="FALSE" FUNCTIONS=""/>
  <ITEM NAME="#SETPIC1" TYPE="%-10s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
      #LYIDNO=#CINO;
      #LYIDTYPE=#CITYPE;
      call_96682();
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <!--added by liuyong 2009-9-1 显示图片信息 end-->
  <ITEM NAME="#T_PACT_NO" LINE="7"  COL="17" TYPE="%-20s" INPUT="TEXT" FUNCTIONS="">
<ONLOSTFOCUS>
  "{
  		dim @baktxno as string;
        initfd();
				@baktxno=$TXNO;
				$TXNO='9939';
        $FD63=#T_PACT_NO;
        commsend_001();
        callserver();
		$TXNO=@baktxno;
		
        if($FD12!='0000'){
                showmsg(geterror());
                return(false);
        }
	#F125 = $FD125;
	//showmsg('125=['+#F125+']');
	#JJNO = #T_PACT_NO;
	//enable(#JJNO, false);
	enable(#LNTYPE, true);
	enable(#TERM, true);
	#PRDT_NO=$FD24;
	#PRDT_TITLE=delspace($FD27);
	//showmsg('号码'+#PRDT_NO+'名称'+#PRDT_TITLE);
	#TERM=substr($FD125, 0, 3);
	#WTXYBH_BK=$FD33;
	//showmsg(#WTXYBH_BK);
	//showmsg('25-['+rtrim($FD25)+']'+'name=['+#CINAME+']');
	if(rtrim($FD25) != #CINAME){
		showmsg('贷款户名与审批不符');
		return(false);
	}
	if(substr(#T_PACT_NO,1,5)!= $KINBR){
		showmsg('非本机构业务!!!');
		return(false);
	}

	enable(#TERM, true);
  }"
  </ONLOSTFOCUS>
	</ITEM>
	<ITEM NAME="#PRDT_NO" TYPE="%-3s" FUNCTIONS=""/>
	<ITEM NAME="#PRDT_TITLE" TYPE="%-30s" FUNCTIONS=""/>
	<!--上面是产品号与产品名称 20110811-->
  <ITEM NAME="#TERM" LINE="8"  COL="10" TYPE="%-3s" INPUT="TEXT" FUNCTIONS="V(001,999)">
  </ITEM>
   <ITEM NAME="#LNTYPE" LINE="8"  COL="50" TYPE="%-1s" INPUT="SELECT" FUNCTIONS="V(NB)J(#LNTYPENAME)">
	<SELECT>
		<OPTION VALUE="3" TITLE="抵质押"/>
		<OPTION VALUE="4" TITLE="信  用"/>
		<OPTION VALUE="5" TITLE="保  证"/>
		<OPTION VALUE="7" TITLE="委托贷款"/>
	</SELECT>
  <ONLOSTFOCUS>
 "{	
		dim @rt as string;
    dim @baktxno as string;
        
    #LYTYPE = #LNTYPE;
    //20110728 因为晋中使用独立信贷系统，因此数据由那边负责，输入应与之校验。
    @baktxno=$TXNO;
    $TXNO='9939';
    $FD63=#T_PACT_NO;
    commsend_001();
    callserver();
		$TXNO=@baktxno;
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		if(#LNTYPE != $FD67){
		  showmsg('贷款方式与审批不符，请检查。');
		  return(false);
		}
     <!--modify by gong 20110905 核心不需要做担保人与借据的关联工作了
		if(#LNTYPE == '5')
		{	
				@baktxno=$TXNO;
				$TXNO='9939';
        $FD63=#T_PACT_NO;
        commsend_001();
        callserver();
		    $TXNO=@baktxno;
        if($FD12!='0000'){
          showmsg(geterror());
          return(false);
        }
        //showmsg(substr(#F125, 63, 1));
	      #F125 = $FD125;
        #JJNO = #T_PACT_NO;
        #TERM=substr($FD125, 0, 3);
        enable(#TERM, true);
      //showmsg('#F125=['+substr(#F125, 19*3+6, 30));
      
			if('1' == substr(#F125, 63, 1)){
				showhelp(6, 58, 4, 14, '担保信息', '担保账号:  '+substr(#F125, 64, 19)+chr(10)+chr(10)
						+'担保金额:  '+ comma(substr(#F125, 64+19+9, 16), 16));

				@rt = showmsg('是否删除此担保重建(Y/N)');
				if('y' == @rt or 'Y' == @rt){
				     open('5620.XML','#CZCODE=1;#KHID='+substr(#F125, 64+1+19, 8)+';#DBACTNO='
						+substr(#F125, 64, 19)+';#JJNUM='+#T_PACT_NO+';#GOBACK=2;');
					//goitem(#T_PACT_NO);
			     		return(#T_PACT_NO);	
			     		
				}
				
			}else{
			//showmsg('ZCODE=0;#JJNUM=' +#T_PACT_NO+';#GOBACK='+#VALUE+';#DCID='+#CID+';');
			enable(#LNTYPE, false);
		     open('5620.XML','#CZCODE=0;#JJNUM=' +#T_PACT_NO+';#GOBACK='+#VALUE+';#DCID='+#CID+';');
		     return(true);	}
		}
		end by gong 20110905 -->
 }"
 </ONLOSTFOCUS>
  </ITEM>
  
    <!--added by liuyong 2010-1-22 验证担保户是否与借据号关联 start-->
  <ITEM NAME="#LYF125" TYPE="%-300s"/>
  <ITEM NAME="#LYTYPE" TYPE="%-1s"/>
  <ITEM NAME="#LYCHK" TYPE="%-1s" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
      <!--modify by gong 20110905 核心不需要做担保人与借据的关联工作了
      if(#LYTYPE == '5')
      {
      
        //showmsg('ccccc'+substr(#F125, 63, 1));
        dim @baktxno as string;
        dim @tmpno as string;
				@baktxno=$TXNO;
				$TXNO='9939';
        $FD63=#T_PACT_NO;
        commsend_001();
        callserver();
		    $TXNO=@baktxno;
        if($FD12!='0000'){
                showmsg(geterror());
                return(false);
        }
	      #LYF125 = $FD125;
	      if('1' != substr(#LYF125, 63, 1))
	      {
	          showmsg('担保户与借据号没有关联');
	          return(false);
	      }
	      
      }
      end by gong 20110905 -->
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <!--added by liuyong 2010-1-22 验证担保户是否与借据号关联 end-->
  <!--下面是给#PRNO产品号赋值的-->
  <ITEM NAME="#VALUE" TYPE="%-1s" FUNCTIONS="T(1)">
  <ONLOSTFOCUS>
 "{		
 		//initfd();
 		//$TXNO='3101';
 		//$MSGTYPE='03001';
 		//dim @tota as string;
 		//commsend_001();
 		//$FD16='9747';
		//$FD62=#CINO;
		//$FD67=#CITYPE;
		//$FD103=space(134)+#TERM;
		//$FD114=space(14)+#LNTYPE;
		//$FD115=space(1)+'N';
		//@tota=callserver();
		//if($FD12!='0000'){
		//	showmsg(geterror());
		//	return(false);
		//}
		//#PRNO=delspace($FD23);
		//#CD81=$FD81;//产品名称
		//上面的老方法暂时废弃
		#PRNO=delspace(#PRDT_NO);
		#CD81=#PRDT_TITLE;//产品名称
		#LPRDT_TITLE=#PRDT_TITLE;
		show(#PRNO,true);
		show(#LPRDT_TITLE,true);
		show(#S_WTXYBH, false);
		show(#WTXYBH, false);
		//setsel(#PRNO,@tota,'o5t30o1v3o2');
		//
		if(#LNTYPE == '7'){
			show(#S_WTXYBH,true);
			show(#WTXYBH,true);
			#WTXYBH=#WTXYBH_BK;
		}
		refresh();
 }"
 </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="9"   COL="40" TYPE="%-14s" NAME="#S_WTXYBH"  VISABLE="FALSE"  INPUT="LABEL" FUNCTIONS="T(委托协议编号)"/>

  <ITEM NAME="#WTXYBH"    INPUT="TEXT"   LINE="9"  COL="53" TYPE="%-16s"  FUNCTIONS="T(#WTXYBH)" VISABLE="FALSE" />
  <ITEM NAME="#WTXYBH_BK"    TYPE="%-16s"   FUNCTIONS="T(#WTXYBH)"  />
  
  <ITEM NAME="#NAME"    INPUT="LABEL"   VISABLE="FALSE" LINE="09"  COL="60" TYPE="%-20s"  FUNCTIONS=""/>
  <ITEM NAME="#LNTYPENAME"  TYPE="%-8s" FUNCTIONS="j(#LNTYPE=3,T{抵质押})j(#LNTYPE=4,T{信用})j(#LNTYPE=5,T{保证})j(#LNTYPE=7,T{委托贷款})"/>
  <!--1.2-->
  <!--20110811 晋中商行 用信贷传过来的产品号-->
  <!--ITEM NAME="#PRNO" LINE="12"  COL="15" TYPE="%-3s" INPUT="SELECT" FUNCTIONS=""-20110811-->
  <ITEM NAME="#PRNO" LINE="12"  COL="15" TYPE="%-3s" INPUT="LABEL" FUNCTIONS=""/>
  <ITEM NAME="#LPRDT_TITLE" LINE="12"  COL="20" TYPE="%-30s" INPUT="LABEL" VISABLE="FALSE" FUNCTIONS="">
  <ONLOSTFOCUS>
 "{		
    //#LDATE=addmon($HDATE,val(#TERM)); //20110728 其实可以从9939交易返回 44域开始日期，45域结束日期
	//20110728 屏蔽此信息 showmsg('到期日期为['+substr(#LDATE, 0, 4)+'/' + substr(#LDATE, 4, 2) + '/' + substr(#LDATE, 6, 2) +']');
 		//initfd();
 		$TXNO='3101';
 		$MSGTYPE='03001';
 		commsend_001();
 		$FD16='9805';
 		$FD23=delspace(#PRDT_NO);
		//$FD23=#PRNO;
		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		#COUR=$FD21;
		#RATEG=$FD68;//利息获得方式
		#PYTYPE=$FD69;
		#ATMT=$FD70;
		//#CD81=$FD81; //20110811
		#CD105=delspace($FD105);
		#JCRATE=itoa(val($FD97,0.000001),'%.6f');//基础利率
		//20110728 根据信贷系统决定各种利率
		commsend_001();
 		$FD16='9939';
 		$FD63=#T_PACT_NO;
 		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}		
		#TZTYPEYG=$FD71;//计息类型 				
		#HTRATE_C=itoa(val($FD84,0.000001),'%.6f');
		#YQRATE_C=itoa(val($FD85,0.000001),'%.6f');
		//#FXRATE_C=itoa(val($FD97,0.000001),'%.6f');//罚息利率信贷不管理
		#CKNO_C=$FD30;//存款账号 add by chenchao 2011-7-31 11:48:52
		#HKNO_C=$FD31;//还款账号 add by chenchao 2011-7-31 11:48:52
		#REP_TYP=$FD68;// 还款方式 add by chenchao 2011-7-31 11:48:52
		//showmsg('还款方式='+#REP_TYP);
		show(#COUR,true);
		show(#PYTYPE,true);
		show(#TZTYPE,true);
		show(#RATEG,true);
		show(#JCRATE,true);
		show(#HTRATE,true);
		show(#YQRATE,true);
		show(#HTPC,true);
 }"
 </ONLOSTFOCUS>
  </ITEM>
  
  <!--1.3-->
  <ITEM NAME="#COUR" LINE="14"  COL="15" TYPE="%-2s" INPUT="SELECT" ENABLE="FALSE" FUNCTIONS="T(01)">
  <SELECT>
		<OPTION VALUE="01" TITLE="人民币"/>
  </SELECT>
  </ITEM>
  <ITEM NAME="#PYTYPE" LINE="15"  COL="15" TYPE="%-1s" INPUT="SELECT"   FUNCTIONS="V(NB)">
  <SELECT>
		<OPTION VALUE="2" TITLE="按期还息"/>
		<OPTION VALUE="3" TITLE="等额还本付息"/>
		<OPTION VALUE="4" TITLE="等额还本按期还息"/>
  </SELECT>
    <ONLOSTFOCUS>"{
    	commsend_001();
 		  $FD16='9939';
 		  $FD63=#T_PACT_NO;
 		  callserver();
		  if($FD12!='0000'){
			  showmsg(geterror());
			  return(false);
		  }		
    	#REP_TYP=$FD68;//还款方式
	if(delspace(#REP_TYP) != delspace(#PYTYPE))
	{
		showmsg('输入类型与审批不符，请检查');
		return(false);
	}
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#TZTYPEYG" TYPE="%-1s"/>
  <ITEM NAME="#TZTYPE" LINE="15"  COL="50" TYPE="%-1s" INPUT="SELECT" ENABLE="TRUE" FUNCTIONS="V(NB)">
  <SELECT>  	
  	<OPTION VALUE="0" TITLE="不计息"/>
  	<OPTION VALUE="1" TITLE="利随本清"/>
  	<OPTION VALUE="2" TITLE="按日计息"/>
  	<OPTION VALUE="3" TITLE="按月计息"/>
	<OPTION VALUE="4" TITLE="按季计息"/>
	<OPTION VALUE="5" TITLE="按年计息"/>
	<OPTION VALUE="6" TITLE="按揭"/>
  </SELECT>
  <ONLOSTFOCUS>"{
  	if(#TZTYPE !=#TZTYPEYG){
  	  showmsg('输入类型与审批不符，请检查');
  	  return(false);
  	}
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#RATEG" LINE="16"  COL="15" TYPE="%-1s" INPUT="SELECT" ENABLE="FALSE" FUNCTIONS="">
  <SELECT>
		<OPTION VALUE="1" TITLE="手工输入"/>
  </SELECT>
  </ITEM>
 
  <ITEM NAME="#JCRATE"  TYPE="%-8s" LINE="16" COL="50" INPUT="TEXT" ENABLE="FALSE"  FUNCTIONS=""/>
  <ITEM NAME="#HTRATE"  TYPE="%9.6f" LINE="18" COL="15" INPUT="TEXT"  FUNCTIONS="">
   <ONLOSTFOCUS>
 "{		if(#HTRATE_C != delspace(itoa(#HTRATE,'%9.6f')))
 		{
			showmsg('输入合同利率与审批不符，请检查');
			return(false);
 		}
 		initfd();
 		$TXNO='3101';
 		$MSGTYPE='03001';
 		commsend_001();
 		$FD16='9754';
		$FD23=#PRNO;
		$FD84=itoa(val(#HTRATE,1000000),'%08d');
		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		#FXRATE=itoa(val($FD94,0.00001),'%.5f');//罚息利率采用老方法获得
		<!--add by gong 20110907 晋中商行-->
		commsend_001();//20110907 逾期利率直接回显信贷给的内容
 		$FD16='9939';
 		$FD63=#T_PACT_NO;
 		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		#YQRATE=itoa(val($FD85,0.000001),'%.6f');
		//#FXRATE=itoa(val($FD97,0.00001),'%.5f');
		show(#YQRATE,true);
		show(#FXRATE,true);
		<!--end by gong 20110907 晋中商行-->
		//#HTPC=itoa((val(#HTRATE,100)/val(#JCRATE)),'%.2f');
		#HTPC=itoa(((#HTRATE*100)/val(#JCRATE)),'%.2f');
		show(#HTPC,true);
 }"
 </ONLOSTFOCUS>
  </ITEM>
  <!--1.4-->
  <ITEM NAME="#HTPC" LINE="18"  COL="28" TYPE="%-6s" INPUT="TEXT" ENABLE="FALSE" FUNCTIONS="T()"/>
  <ITEM NAME="#YQRATE"  TYPE="%9.6f" LINE="18" COL="50" INPUT="TEXT"  FUNCTIONS="">
  <ONLOSTFOCUS>"{
	if(#YQRATE_C != delspace(itoa(#YQRATE,'%9.6f')))
 	{
		showmsg('输入合同利率与审批不符，请检查');
		return(false);
 	}
 	
	#YQPC=itoa(((#YQRATE*100)/val(#JCRATE)),'%.2f');
	show(#YQPC,true);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#FXRATE"  TYPE="%9.5f" LINE="19" COL="15" INPUT="TEXT"  FUNCTIONS="">
  <ONLOSTFOCUS>"{
  	//showmsg(#FXRATE_C);
	//if(val(#FXRATE_C,100000) != val(itoa(#FXRATE,'%9.5f'),100000))
 	//{
		//showmsg('输入合同利率与审批不符，请检查');
		//return(false);
 	//}
	#FXPC=itoa(((#FXRATE*100)/val(#JCRATE)),'%.2f');
	show(#FXPC,true);
  }"
  </ONLOSTFOCUS>
  </ITEM>
  
  <ITEM NAME="#YQPC" LINE="18"  COL="63" TYPE="%-6s" INPUT="TEXT" ENABLE="FALSE"  FUNCTIONS="T()"/>
  <ITEM NAME="#FXPC" LINE="19"  COL="28" TYPE="%-6s" INPUT="TEXT" ENABLE="FALSE"  FUNCTIONS="T()"/>

  <ITEM LINE="21" COL="45"  TYPE="%-6s" FUNCTIONS="T(下一页)" INPUT="BUTTON">
  <ONCLICK>"{
	loadpage('PAGE2');
  }"
  </ONCLICK>
  </ITEM>
 </PAGE>
 <PAGE NAME="PAGE2">
  <ITEM LINE="5"  COL="5" TYPE="%-10s" FUNCTIONS="T(借 据 号:)"/>
  <ITEM LINE="6"  COL="5" TYPE="%-10s" FUNCTIONS="T(贷款户名:)"/>
  <!--2.1-->

 <!--输入变量-->
  <ITEM NAME="#AAA" LINE="5"  COL="15" TYPE="%-1s" FUNCTIONS="">
 <ONLOSTFOCUS>
 "{		
	#XCINAME=#CINAME;
	show(#XCINAME,true);
	enable(#JJNO, false);
 }"
 </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#JJNO" LINE="5"  COL="15" TYPE="%-20s" INPUT="TEXT" FUNCTIONS="">
 <ONLOSTFOCUS>
 "{		
 		initfd();
 		$TXNO='3101';
 		$MSGTYPE='03001';
 		commsend_001();
 		$FD16='9939';
		$FD63=#JJNO;
		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
 }"
 </ONLOSTFOCUS>
  </ITEM>
  <ITEM NAME="#XCINAME" LINE="6"  COL="15" TYPE="%-60s" INPUT="TEXT" FUNCTIONS="T()"/>

  <ITEM LINE="9"  COL="5" TYPE="%-10s" FUNCTIONS="T(计划放款:)"/>
  <ITEM NAME="#PLAMT" LINE="9"  COL="15" TYPE="%17.2f" INPUT="TEXT" FUNCTIONS="V(NB)J(#XPLAMT)"/>
  <ITEM NAME="#XPLAMT" TYPE="%-16s" FUNCTIONS="X(#PLAMT)">
  <!--20110728增加检测-->
  <ONLOSTFOCUS>
  	"{
  	  dim @m_amt as number;
  	  commsend_001();
 		  $FD16='9939';
 		  $FD63=#T_PACT_NO;
 		  callserver();
		  if($FD12!='0000'){
		  	showmsg(geterror());
		  	return(false);
		  }
		  @m_amt=val($FD39,0.01); 
		  if(@m_amt != #PLAMT){
		    showmsg('输入金额与审批金额不符，请检查');
		    return(false);
		  }
		  //showmsg('金额a'+itoa(val($FD39,0.01),'%.2f'));	
		  //showmsg('金额b'+itoa(@m_amt)); 
		  //showmsg('金额c'+itoa(@m_amt,'%.2f'));
 	  }"
  </ONLOSTFOCUS>
  </ITEM>
  
  
  <ITEM LINE="11"  COL="5" TYPE="%-10s" FUNCTIONS="T(开户日期:)"/>
  <!--ITEM NAME="#FDATE" LINE="11"  COL="15" TYPE="%-8s" INPUT="TEXT" FUNCTIONS="T($HDATE)D()"-->
  <ITEM NAME="#FDATE" LINE="11"  COL="15" TYPE="%-8s" INPUT="TEXT" FUNCTIONS="T()D()">
 <ONLOSTFOCUS>
   "{
      commsend_001();
 		  $FD16='9939';
 		  $FD63=#T_PACT_NO;
 		  callserver();
		  if($FD12!='0000'){
		  	showmsg(geterror());
		  	return(false);
		  }
		  if(#FDATE != $FD44){
		    showmsg('开户日期与审批的日期不符，请检查。');
		    return(false);
		  }		
    
		//show(#WENZI,true);
		show(#WENZI1,true);
   }"
 </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="11"  COL="40" TYPE="%-10s" FUNCTIONS="T(到期日期:)"/>
  <!--  日期计算 未解决-->
  <ITEM NAME="#LDATE" LINE="11"  COL="50" TYPE="%-8s" INPUT="TEXT" FUNCTIONS="D()">
 <ONLOSTFOCUS>
  "{		
      commsend_001();
 		  $FD16='9939';
 		  $FD63=#T_PACT_NO;
 		  callserver();
		  if($FD12!='0000'){
		  	showmsg(geterror());
		  	return(false);
		  }
		  if(#LDATE != $FD45){
		    showmsg('到期日期与审批的日期不符，请检查。');
		    return(false);
		  }		
		//show(#WENZI,false);
		show(#WENZI1,false);
 }"
 </ONLOSTFOCUS>
  </ITEM>
  <ITEM LINE="12"  COL="5" TYPE="%-10S" FUNCTIONS="T(自动还款:!)"/>
  <ITEM NAME="#ATMT" LINE="12"  COL="15"  TYPE="%-1s"INPUT="SELECT" ENABLE="FALSE" FUNCTIONS="T(Y)">
      <SELECT>
		<OPTION VALUE="Y" TITLE="是"/>
		<OPTION VALUE="N" TITLE="否"/>
		  </SELECT>
  </ITEM>
 
 
  <ITEM LINE="14"  COL="5" TYPE="%-10S" FUNCTIONS="T(还款帐号:)"/>
  <ITEM NAME="#HKNO" LINE="14"  COL="15"  TYPE="%-19s"INPUT="TEXT" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
 "{	//edit by gong 20110827 晋中信贷不给核心传存款账号了！！！
		//if(delspace(#HKNO_C) != delspace(#HKNO))
 		//{
 		//	showmsg('存款账号与信贷审批不符，请检查。');
		//	return(false);
 		//}
 		initfd();
 		$TXNO='3101';
 		$MSGTYPE='03001';
 		commsend_001();
 		$FD16='9915';
		//$FD21=#COUR;
		$FD21='01';
		//showmsg(#COUR);
		$FD38=#HKNO;
		$FD62=#CINO;
		$FD67=#CITYPE;
		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
    #HKNAME=$FD26;
    #CKNO=$FD38;
    #CD34=$FD34;
    show(#HKNAME,true);
    show(#CKNO,true);
 }"
 </ONLOSTFOCUS>
  </ITEM>
  
  <ITEM LINE="15"  COL="5" TYPE="%-10S" FUNCTIONS="T(账户名称:)"/>
  <ITEM NAME="#HKNAME" LINE="15"  COL="15"  TYPE="%-60s"INPUT="TEXT" ENABLE="FALSE" FUNCTIONS=""/>
  
  <ITEM LINE="16"  COL="5" TYPE="%-10S" FUNCTIONS="T(存款账号:)"/>
  <ITEM NAME="#CKNO" LINE="16"  COL="15"  TYPE="%-19s"INPUT="TEXT" FUNCTIONS="">
  <ONLOSTFOCUS>
 "{	//edit by gong 20110827 晋中信贷不给核心传存款账号了！！！
 		//if(delspace(#CKNO_C) != delspace(#CKNO))
 		//{
 		//	showmsg('存款账号与信贷审批不符，请检查。');
		//	return(false);
 		//}
 		initfd();
 		$TXNO='3101';
 		$MSGTYPE='03001';
 		commsend_001();
 		$FD16='9937';
		//$FD21=#COUR;
		$FD21='01';
		$FD32=#CKNO;
		$FD62=#CINO;
		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		#CKNAME=$FD82;
		#CD36=$FD36;
		show(#CKNAME,true);
 }"
 </ONLOSTFOCUS>
  </ITEM>
  
  <ITEM LINE="17"  COL="5" TYPE="%-10s" FUNCTIONS="T(账户名称:)"/>
  <ITEM NAME="#CKNAME" LINE="17"  COL="15"  TYPE="%-60s"INPUT="TEXT" ENABLE="FALSE" FUNCTIONS=""/>

  <ITEM NAME="#WENZI1" LINE="12"  COL="35" TYPE="%-42s" VISABLE="FALSE" INPUT="LABEL" 
							FUNCTIONS="T(不满整月的,请手动设置到期日!)"/>
  <!--
  <ITEM NAME="#WENZI" LINE="19"  COL="5" TYPE="%-42s" VISABLE="FALSE" INPUT="LABEL" 
							FUNCTIONS="T(短期一年;中期三年;中长期五年;长期五年以上)"/>-->
  <ITEM LINE="21" COL="49"  TYPE="%-6s" FUNCTIONS="T(上一页)" INPUT="BUTTON">
    <ONCLICK>"{
        loadpage('DEFAULT');
        }"
    </ONCLICK>
  </ITEM>

 </PAGE>


 <!--脚本两次发包
	36个变量*2	-->


<!--
 
 <PAGE NAME="PAGE3">
  <ITEM LINE="8"  COL="15" TYPE="%-14s" FUNCTIONS="T(贷款账号:)"/>
  <ITEM LINE="10" COL="15" TYPE="%-14s" FUNCTIONS="T(放款计划类型:!)"/>
  <ITEM LINE="11" COL="15" TYPE="%-14s" FUNCTIONS="T(还款计划生成:!)"/>
  <ITEM LINE="14" COL="15" TYPE="%-22s" FUNCTIONS="T(下一步执行 【放款计划】)"/>

  <ITEM NAME="#DKZH"   LINE="8"   COL="30" TYPE="%-20s" INPUT="TEXT" ENABLE="FALSE" FUNCTIONS="T($FD31)"/>
  <ITEM NAME="#FKJHLX" LINE="10"  COL="30" TYPE="%-1s"  INPUT="SELECT" ENABLE="FALSE" FUNCTIONS="T($FD72)">
  <SELECT>
		<OPTION VALUE="N" TITLE="无"/>
		<OPTION VALUE="M" TITLE="手工"/>
  </SELECT>
  </ITEM>

  <ITEM NAME="#HKJHSC" LINE="10"  COL="30" TYPE="%-1s" INPUT="SELECT" ENABLE="FALSE" FUNCTIONS="T($FD66)">
  <SELECT>
		<OPTION VALUE="N" TITLE="无"/>
		<OPTION VALUE="A" TITLE="自动计算"/>
		<OPTION VALUE="M" TITLE="手工输入"/>
  </SELECT>
  </ITEM>

  <ITEM NAME="#YORN" LINE="14"  COL="40" TYPE="%-1s"  INPUT="SELECT" FUNCTIONS="T()">
  <SELECT>
		<OPTION VALUE="Y" TITLE="是"/>
		<OPTION VALUE="N" TITLE="否"/>
  </SELECT>
  </ITEM>

  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(上一页)" INPUT="BUTTON"/>

 </PAGE>
-->
  <ITEM NAME="#CONFIRM"  LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>

  <!------------一些传递变量,------------>
  <ITEM NAME="#CD34"  TYPE="%-4s" FUNCTIONS=""/>
  <ITEM NAME="#CD31"  TYPE="%-24s" FUNCTIONS="T(                        )"/>
  <ITEM NAME="#CD35"  TYPE="%-4s" FUNCTIONS="T(0000)"/>
  <ITEM NAME="#CD36"  TYPE="%-4s" FUNCTIONS=""/>
  <ITEM NAME="#CD37"  TYPE="%-20s" FUNCTIONS="T(                    )"/>
  <ITEM NAME="#CD39"  TYPE="%-16s" FUNCTIONS="T(                )"/>
  <ITEM NAME="#CD41"  TYPE="%-16s" FUNCTIONS="T(0000000000000000)"/>
  <ITEM NAME="#CD42"  TYPE="%-16s" FUNCTIONS="T(0000000000000000)"/>
  <ITEM NAME="#CD61"  TYPE="%-16s" FUNCTIONS="T(                )"/>
  <ITEM NAME="#CD81"  TYPE="%-30s" FUNCTIONS=""/>
  <ITEM NAME="#CD105"  TYPE="%-1s" FUNCTIONS=""/>

  <ITEM NAME="#CD66"  TYPE="%-9s" FUNCTIONS=""/>
  <ITEM NAME="#HTRATE_C"  TYPE="%-9s"  FUNCTIONS=""/>
  <ITEM NAME="#YQRATE_C"  TYPE="%-9s"  FUNCTIONS=""/>
  <ITEM NAME="#FXRATE_C"  TYPE="%-9s"  FUNCTIONS=""/>
  <ITEM NAME="#HKNO_C"  TYPE="%-19s"  FUNCTIONS=""/>
  <ITEM NAME="#CKNO_C"  TYPE="%-19s"  FUNCTIONS=""/>
  <ITEM NAME="#REP_TYP"  TYPE="%1s"  FUNCTIONS="T(2)"/>
  <ITEM NAME="#CD72"  TYPE="%-5s" FUNCTIONS=""/>

  <ITEM NAME="#YEAR"  TYPE="%-4s" FUNCTIONS="T($FD5,1,4)"/>
  <ITEM NAME="#MON"  TYPE="%-2s" FUNCTIONS="T($FD5,5,2)"/>
  <ITEM NAME="#DAY"  TYPE="%-2s" FUNCTIONS="T($FD5,7,2)">
	<ONLOSTFOCUS>"{
	 initfd();
	 dim @i as string;
 	// $TXNO='9986';
 	 $MSGTYPE='03001';
 	 commsend_001();
 	 $FD12='3101';
	 $FD21=#COUR;
	 $FD23=#PRNO;
	 $FD25=#CINAME;
	 $FD26=#HKNAME;
	 $FD27=#CKNAME;
	 $FD31=#CD31;
	 $FD32=#CKNO;
	 $FD34=#CD34;
	 $FD35=#CD35;
	 $FD36=#CD36;
	 $FD37=#CD37;
	 $FD38=#HKNO;
	 $FD39=#CD39;
	 $FD41=#CD41;
	 $FD42=#CD42;
	 $FD43=itoa(#PLAMT*100,'%016.0f');
	 $FD44=#FDATE;
	 $FD45=#LDATE;
	 $FD61=#CD61;
	 $FD62=#CINO;
	 $FD63=#JJNO;
	 $FD67=#CITYPE;
	 $FD68=#RATEG;
	 $FD69=#PYTYPE;
	 $FD70=#ATMT;
	 $FD71=#TZTYPE;
	 $FD81=#CD81;
	 $FD82=#CKNAME;
	 $FD61=#WTXYBH;
	 //$FD84=itoa(val(#HTRATE,1000000),'%08d');
	 //$FD85=itoa(val(#YQRATE,1000000),'%08d');
	 //$FD94='0'+substr(itoa(val(#FXRATE,1000000),'%08d'),0,7);
	 $FD84=getitems('#HTRATE');
	 $FD85=getitems('#YQRATE');
	 $FD94=getitems('#FXRATE');
	 //showmsg($FD94);
	 $FD97=itoa(val(#JCRATE,1000000),'%08d');
	 $FD103=space(104)+#TERM;
	 $FD105=space(63)+#CD105;
	 $FD114=space(14)+#LNTYPE;
	 $FD115=space(1)+'N';
	 // callserver();
	//	if($FD12!='0000'){
		//	showmsg(geterror());
		//	return(false);
		//}
	}"
	</ONLOSTFOCUS>
</ITEM>
  
  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
</VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
    <PACKAGE DEVICE="SCREEN" DESC="显示内容">
    NOTHING
    </PACKAGE>
    <PRINT>"{
        print( 8, 26,'贷款账号:[20]',$FD31);
       // print(10, 26,'放款计划类型:[5]',#CD72);
       // print(11, 26,'还款计划生成:[9]',#CD66);
    }"
    </PRINT>
</RESPONSE>

<RESPONSE>
    <PACKAGE DEVICE="PRINTER" LINESPACE="24" DESC="打印业务专用凭证">
    NOTHING
    </PACKAGE>
    <PRINT>"{
    $KINDNO='00';
	dim @txtime  as string;
	@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
        print( 5, 20,'机构名称:[30]',$BRNAME);
        print( 5, 2,'代码:4401');
        print( 5, 13,'交易:贷款开户');
        print( 7, 20,'贷款帐号:[24                      ]   证件类型:[12          ]  证件号码:[20]',$FD31,#CITYPENAME,#CINO);
        print( 8, 20,'贷款户名:[60]',#XCINAME);
        print( 9, 20,'贷款期限:[3  ]个月                    贷款方式:[8       ]      产品名称:[30]',#TERM,#LNTYPENAME,#CD81);
        print( 10, 20,'合同利率:[9      ]                   逾期利率:[9      ]      罚息利率:[9]',itoa(#HTRATE,'%9.6f'),itoa(#YQRATE,'%9.6f'),itoa(#FXRATE,'%9.6f'));
        print( 11, 20,'借 据 号:[20                 ]       计划放款:[16]',#JJNO,#XPLAMT);
        print( 12, 20,'还款账号:[19                ]        存款账号:[19]',#HKNO,#CKNO);
        print( 13,20,'身份核查结果:[60] ',#HCJGBL);
        print( 24,20,'备注:')
        print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
        print( 24,5,'柜员:[4]',$FD7);
        print( 24,5,'流水号:[6]',$FD4);
      }"
    </PRINT>
</RESPONSE>

</TRANSACTION>
