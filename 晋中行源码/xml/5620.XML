<?xml version="1.0" encoding="GBK" ?> 
<TRANSACTION RIGHTS="11000000" TITLE="5620 担保户与贷款借据的关联" 
xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org"> 
<COMMSEND>"
{ 
	initfd(); 
	$FD32 = #DBACTNO; 
	$FD33 = #JJNUM; 
	$FD40 = getitems('#DBAVBAL');
	$FD55 = #KHID;
	$FD67 = #CZCODE;
	$FD102= getitems('#FD102_1#FD102_2#FD102_3#FD102_4#FD102_5#FD102_6#FD102_7#FD102_8#FD102_9#FD102_10#FD102_11#FD102_12#FD102_13#FD102_14#FD102_15#FD102_16#FD102_17#FD102_18#FD102_19#FD102_20#FD102_21#FD102_22#FD102_23#FD102_24#FD102_25#FD102_26#FD102_27#FD102_28#FD102_29#FD102_30#FD102_31#FD102_32#FD102_33#FD102_34');
	commsend_001();
}"
</COMMSEND>
<COMMRECV>"{
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-60s" FUNCTIONS=
    "T(5620                     担保户与贷款借据的关联)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>

  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=4357)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>

<!-- 定义callserver 返回变量 -->
  <ITEM NAME="#FD102_1"   TYPE="%-24s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_2"   TYPE="%-4s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_3"   TYPE="%-3s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_4"   TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_5"   TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_6"   TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_7"   TYPE="%-6s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_8"   TYPE="%-6s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_9"   TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_10"  TYPE="%-20s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_11"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_12"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_13"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_14"  TYPE="%-8s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_15"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_16"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_17"  TYPE="%-60s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_18"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_19"  TYPE="%-2s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_20"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_21"  TYPE="%-3s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_22"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_23"  TYPE="%-4s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_24"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_25"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_26"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_27"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_28"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_29"  TYPE="%-16s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_30"  TYPE="%-20s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_31"  TYPE="%-30s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_32"  TYPE="%-24s"  FUNCTIONS=""/>
  <ITEM NAME="#FD102_33"  TYPE="%-1s"   FUNCTIONS=""/>
  <ITEM NAME="#FD102_34"  TYPE="%-20s"  FUNCTIONS=""/>
  <ITEM LINE="9"   COL="5"   TYPE="%-13s" FUNCTIONS="T(操 作 码:)"/>
  <ITEM LINE="11"  COL="5"   TYPE="%-13s" FUNCTIONS="T(担保帐号:)"/>
  <ITEM LINE="13"  COL="5"   TYPE="%-13s" FUNCTIONS="T(客 户 号:)"/>
  <ITEM LINE="14"  COL="5"   TYPE="%-13s" NAME="#NAME1" VISABLE="FALSE" INPUT="LABEL" FUNCTIONS="T(户    名:)" />
  <ITEM LINE="15"  COL="5"   TYPE="%-13s" FUNCTIONS="T(借 据 号:)"/>
  <ITEM LINE="17"  COL="5"   TYPE="%-13s" FUNCTIONS="T(担保金额:)"/>

  <ITEM LINE="9"  COL="15" TYPE="%-1s" NAME="#CZCODE" DEVICE="KEYBOARD" FUNCTIONS="T(0)">
    <SELECT LINE="0" COL="0">
        <OPTION VALUE="0" TITLE="建立"/>
        <OPTION VALUE="1" TITLE="删除"/>
    </SELECT>
  </ITEM>
  <ITEM NAME="#CZNAME" TYPE="%-10s" FUNCTIONS="S(#CZCODE,#CZCODE)"/>
  <ITEM NAME="#DCID" TYPE="%-8s" FUNCTIONS=""/>

  <ITEM LINE="11"  COL="15" TYPE="%-24s"  NAME="#DBACTNO"   DEVICE="KEYBOARD" FUNCTIONS="T()">
  <ONLOSTFOCUS>
  "{
    	dim @baktxno as string;
	//showmsg('#DCID=['+#DCID+']');
	enable(#KHID, true);
	if('' == #DBACTNO){return(true);}
    	@baktxno=$TXNO;
    	$TXNO='9405';
    	$FD32=#DBACTNO;
    	commsend_001();
    	callserver();
    	$TXNO=@baktxno;
    	if($FD12!='0000'){
        	showmsg(geterror());
        	return(false);
    	}
//		setitems('#FD102_1#FD102_2#FD102_3#FD102_4#FD102_5#FD102_6#FD102_7#FD102_8#FD102_9#FD102_10#FD102_11#FD102_12#FD102_13#FD102_14#FD102_15#FD102_16#FD102_17#FD102_18#FD102_19#FD102_20#FD102_21#FD102_22#FD102_23#FD102_24#FD102_25#FD102_26#FD102_27#FD102_28#FD102_29#FD102_30#FD102_31#FD102_32#FD102_33#FD102_34',$FD102);
		//#CD102=$FD102;
	#KHID=$FD28;
	#KHNAME=rtrim($FD25);
	enable(#KHID, false);
	  show(#KHNAME,true);
	  show(#NAME1,true);
	  #FD102_17=#KHNAME;
  }"
  </ONLOSTFOCUS>
  </ITEM>
	<ITEM LINE="13"  COL="15" TYPE="%8d" NAME="#KHID" INPUT="TEXT" FUNCTIONS="V(NB)">
	<ONLOSTFOCUS>
	"{
	   dim @baktxno as string;
	   initfd();
	   @baktxno=$TXNO;
	   $TXNO='6707';
	   $FD55=#KHID;
     commsend_001();
     callserver();
		$TXNO=@baktxno;
        if($FD12!='0000'){
                showmsg(geterror());
                return(false);
        }
	  #KHNAME=delspace($FD25);
	  show(#KHNAME,true);
	  show(#NAME1,true);
	  #FD102_17=#KHNAME;
	}"
	</ONLOSTFOCUS>
	</ITEM>
  <ITEM LINE="14"  COL="15" TYPE="%-60s"  NAME="#KHNAME" INPUT="TEXT" FUNCTIONS="" VISABLE="FALSE"/>
  <ITEM LINE="15"  COL="15" TYPE="%-20s"  NAME="#JJNUM"  DEVICE="KEYBOARD" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
  "{
  		dim @baktxno as string;
        initfd();
				@baktxno=$TXNO;
				$TXNO='9939';
        $FD63=#JJNUM;
        commsend_001();
        callserver();
		$TXNO=@baktxno;
        if($FD12!='0000'){
                showmsg(geterror());
                return(false);
        }
		if(#CZCODE == '1'){
			enable(#DBAVBAL, false);
			goitem(#PASSWD,false);
		}
  }"
  </ONLOSTFOCUS>
  </ITEM>

  <ITEM LINE="17"  COL="15" TYPE="%17.2f" NAME="#DBAVBAL"   DEVICE="KEYBOARD" FUNCTIONS="V(NB)">
	<ONLOSTFOCUS>
	"{
		if(#DBAVBAL &lt;= 0){
			showmsg('E---: 担保金额必须大于零');
			return(false);
		}
		if(#DCID == #KHID){
			showmsg('E---: 担保账号不能同贷款是同一客户');
			return(false);
		}
	}"
	</ONLOSTFOCUS>
  </ITEM>	

  <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  <ITEM NAME="#YEAR"  TYPE="%-4s" FUNCTIONS="T($FD5,1,4)"/>
  <ITEM NAME="#MON"  TYPE="%-2s" FUNCTIONS="T($FD5,5,2)"/>
  <ITEM NAME="#DAY"  TYPE="%-2s" FUNCTIONS="T($FD5,7,2)"/>
  <ITEM NAME="#CD102"  TYPE="%-378s" FUNCTIONS=""/>
  <ITEM NAME="#GOBACK" TYPE="%-1s" FUNCTIONS=""/> 
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="BUTTON">
  <ONCLICK>
   "{
     	initfd(); 
			$FD32 = #DBACTNO; 
			$FD33 = #JJNUM; 
			$FD40 = getitems('#DBAVBAL');
			$FD55 = #KHID;
			$FD67 = #CZCODE;
			$FD102= #CD102;
			$FD25 = #KHNAME;
			$FD102= getitems('#FD102_1#FD102_2#FD102_3#FD102_4#FD102_5#FD102_6#FD102_7#FD102_8#FD102_9#FD102_10#FD102_11#FD102_12#FD102_13#FD102_14#FD102_15#FD102_16#FD102_17#FD102_18#FD102_19#FD102_20#FD102_21#FD102_22#FD102_23#FD102_24#FD102_25#FD102_26#FD102_27#FD102_28#FD102_29#FD102_30#FD102_31#FD102_32#FD102_33#FD102_34');
			commsend_001();
			callserver();
      if($FD12!='0000')
      {
            showmsg(geterror());
            return(false);
      }
      runoutput();
//showmsg('#GOBACK=['+#GOBACK+']');
     if(#GOBACK == '1')
     {
	close('#VALUE');
//	return(true);
     }else{
	close('#T_PACT_NO');
	}
   }"
  </ONCLICK>
  </ITEM>
</VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
    <PACKAGE DEVICE="SCREEN" DESC="显示内容" >
        NOTHING
    </PACKAGE>
    <PRINT>"{
        print( 7, 30,'担保关联-[4] 成功',#CZNAME);
        print( 8, 20,'担保帐号:[24]',#DBACTNO);
        print( 9, 20,'户名:[60]',#FD102_17);
        print(10, 20,'担保日期:[8]',$FD5);
        print(11, 20,'担保金额:[16]',ltrim(itoa(#DBAVBAL,'%17.2f')));
        print(12, 20,'担保户余额:[16]',ltrim(comma(#FD102_18,16)));
        print(13, 20,'流水号:[6]',$FD4);
    }"
    </PRINT>
</RESPONSE>

<RESPONSE>
    <PACKAGE DEVICE="PRINTER" DESC="打印业务专用凭证" >
	NOTHING
    </PACKAGE>
    <PRINT>"{
dim @txtime  as string;
@txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
	print( 5,20,'机构名称:[30]',$BRNAME);
	print( 5, 2,'代码:5620');
	print( 5,13,'交易:担保户与贷款借据的关联');
    print( 7,24,'担保关联-[4]',#CZNAME);
   	print( 7,10,'担保帐号:[24]',#DBACTNO);
   	print( 8,20,'户名:[60]',#FD102_17);
   	print( 9,20,'担保日期:[8]',$FD5);
   	print(10,20,'担保金额:[16]',ltrim(itoa(#DBAVBAL,'%17.2f')));
   	print(11,20,'担保户余额:[16]',ltrim(comma(#FD102_18,16)));
   	print(12,20,'客户号:[10]     借据号:[20]',#KHID,#JJNUM);
	print(24,20,'备注:');
	print(24,27,'交易日期:[8] [8]',$HDATE,@txtime);
	print(24,5,'柜员:[4]',$FD7);
	print(24,5,'流水号:[6]',$FD4);

    }"
    </PRINT>
</RESPONSE>

</TRANSACTION>
