<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110000" TITLE="V80017 银行承兑汇票查询报文录入"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
 <COMMSEND>
"{
    commsend_001();
    commsend_123();
    commsend_hv();
    $FD59=#L_PO_NO; //2011-4-15
    showmsg(#AC_BR_NO);
}"
</COMMSEND>

<COMMRECV>
"{
    commrecv_001();
        setitems('#CMTNO#O_CMTNO#PAY_QS_NO#OR_BR_NO#SENDCO#PAY_OPN_BR_NO#PAY_AC_NO#PAY_NAME#PAY_ADDR#CASH_QS_NO#AC_BR_NO#RECECO#CASH_OPN_BR_NO#CASH_AC_NO#CASH_NAME#CASH_ADDR#YW_TYPE#ORDERNO#CONTENT#RATE#RATEDATE#OORDERNO#PROCODE#CR_DATE#CR_BR_NO#CR_TX_NUM#QR_BR_NO#QR_TX_NUM#TX_TYPE#NOTPAY_CONTENT#NOTPAY_ORDERNO#O_NOTPAY_ORDERNO#RESP1#OPERLEVEL#PROC_STS',$FD123);
}"
</COMMRECV>

<VARIABLE>

  <ITEM LINE="3"  COL="3" TYPE="%-52s" FUNCTIONS=
    "T(5126                   银行承兑汇票查询报文录入)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
  "T(───────────────────────────────────)"/> 
<ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=5826)"/>
 <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>


<ITEM NAME="#CMTNO"			TYPE="%-3s"		FUNCTIONS="T(301)"/>
<ITEM NAME="#O_CMTNO"			TYPE="%-3s"		FUNCTIONS="T(301)"/>
<ITEM NAME="#PAY_QS_NO"			TYPE="%-12s"	FUNCTIONS=""/>
<ITEM NAME="#OR_BR_NO"			TYPE="%-12s"	FUNCTIONS=""/>
<ITEM NAME="#QR_BR_NO"			TYPE="%-12s"	FUNCTIONS=""/>
<ITEM NAME="#SENDCO"			TYPE="%-4s"		FUNCTIONS=""/>

<ITEM NAME="#CASH_QS_NO"		TYPE="%-12s"	FUNCTIONS=""/>
<ITEM NAME="#RECECO"			TYPE="%-4s"		FUNCTIONS=""/>
<ITEM NAME="#CASH_OPN_BR_NO"    TYPE="%-12s"	FUNCTIONS=""/>
<ITEM NAME="#CASH_ADDR"			TYPE="%-60s"	FUNCTIONS=""/>
<ITEM NAME="#YW_TYPE"			TYPE="%-2s"		FUNCTIONS=""/>
<ITEM NAME="#ORDERNO"			TYPE="%-8s"		FUNCTIONS=""/>
<ITEM NAME="#QR_TX_NUM"			TYPE="%-8s"		FUNCTIONS=""/>
<ITEM NAME="#CR_TX_NUM"			TYPE="%-8s"		FUNCTIONS=""/>
<ITEM NAME="#CONTENT"			TYPE="%-60s"	FUNCTIONS=""/>
<ITEM NAME="#RATE"				TYPE="%-7s"		FUNCTIONS=""/>
<ITEM NAME="#RATEDATE"			TYPE="%-5s"		FUNCTIONS=""/>
<ITEM NAME="#OORDERNO"          TYPE="%-8s"     FUNCTIONS="T(00000000)"/>
<ITEM NAME="#PROCODE"           TYPE="%-8s"     FUNCTIONS=""/>
<ITEM NAME="#CR_DATE"           TYPE="%-8s"     FUNCTIONS="T($HDATE)"/>
<ITEM NAME="#CR_BR_NO"          TYPE="%-12s"    FUNCTIONS=""/>

<ITEM NAME="#TX_TYPE"           TYPE="%-1s"     FUNCTIONS="T(1)"/>
<ITEM NAME="#NOTPAY_ORDERNO"    TYPE="%-3s"     FUNCTIONS=""/>
<ITEM NAME="#O_NOTPAY_ORDERNO"  TYPE="%-3s"     FUNCTIONS=""/>
<ITEM NAME="#RESP1"             TYPE="%-1s"     FUNCTIONS=""/>
<ITEM NAME="#OPERLEVEL"         TYPE="%-1s"     FUNCTIONS=""/><!--优先级别-->
<ITEM NAME="#PROC_STS"          TYPE="%-1s"     FUNCTIONS=""/><!--处理状态-->
<ITEM NAME="#OPCD"      		TYPE="%-2s" 	FUNCTIONS="T(10)"/>
<ITEM NAME="#NOTE_NO"       	TYPE="%-16s"    FUNCTIONS=""/>
<ITEM NAME="#LW_IND"        	TYPE="%-1s" 	FUNCTIONS="T(1)"/>
<ITEM NAME="#HP_ADD_PWD"    	TYPE="%-1s" 	FUNCTIONS=""/>
<ITEM NAME="#PACKID"        	TYPE="%8d"  	FUNCTIONS=""/>
<ITEM NAME="#O_PACKID"          TYPE="%8d"      FUNCTIONS=""/>
<ITEM NAME="#PACK_DATE"     	TYPE="%8d"  	FUNCTIONS=""/>
<ITEM NAME="#O_PACK_DATE"   	TYPE="%8d"  	FUNCTIONS=""/>
<ITEM NAME="#TXNUM"     		TYPE="%5d"  	FUNCTIONS=""/>
<ITEM NAME="#O_TXNUM"       	TYPE="%5d"  	FUNCTIONS=""/>
<ITEM NAME="#LV_YW_IND"     	TYPE="%12s" 	FUNCTIONS=""/>


<ITEM NAME="#RESP_DATE"     	TYPE="%8d"  	FUNCTIONS=""/>
<ITEM NAME="#RCP_STS"       	TYPE="%2d"  	FUNCTIONS=""/>
<ITEM NAME="#RESP2"             TYPE="%8s"      FUNCTIONS=""/>
<ITEM NAME="#RETCODE"           TYPE="%2d"      FUNCTIONS=""/>
<ITEM NAME="#YW_DTL_ID"         TYPE="%8d"      FUNCTIONS=""/>
<ITEM NAME="#ACC_IND"           TYPE="%1d"      FUNCTIONS=""/>
<ITEM NAME="#REQ_TYPE"          TYPE="%1d"      FUNCTIONS=""/>
<ITEM NAME="#DF_FREEAMT"        TYPE="%16s"     FUNCTIONS=""/>
<ITEM NAME="#PROTNO"            TYPE="%60s"     FUNCTIONS=""/>
<ITEM NAME="#PO_TYPE"           TYPE="%1d"      FUNCTIONS=""/>
<ITEM NAME="#OTYPE"             TYPE="%1d"      FUNCTIONS="T(1)"/><!-- 表示大额 -->
<ITEM NAME="#WT_DAY"            TYPE="%-8s"     FUNCTIONS="T($HDATE)"/>
<ITEM NAME="#CUR_NO"            TYPE="%-3s"     FUNCTIONS=""/>
<ITEM NAME="#NOTE_TYPE"         TYPE="%-3s"     FUNCTIONS=""/>
	
  <ITEM LINE="06"  COL="5" TYPE="%-14s" FUNCTIONS="T(汇票号码:)"/>
  <ITEM LINE="06"  COL="45" TYPE="%-09s" FUNCTIONS="T(查复行号:)"/>
  <ITEM LINE="07"  COL="5" TYPE="%-14s" FUNCTIONS="T(出票日期:)"/>
  <ITEM LINE="08"  COL="5" TYPE="%-14s" FUNCTIONS="T(到期日期:)"/>
  <ITEM LINE="09"  COL="5" TYPE="%-14s" FUNCTIONS="T(票据金额:)"/>
  <ITEM LINE="10"  COL="5" TYPE="%-14s" FUNCTIONS="T(出票人帐号:)"/>
  <ITEM LINE="11"  COL="5" TYPE="%-14s" FUNCTIONS="T(出票人名称:)"/>
  <ITEM LINE="12"  COL="5" TYPE="%-14s" FUNCTIONS="T(收款人帐号:)"/>
  <ITEM LINE="13"  COL="5" TYPE="%-14s" FUNCTIONS="T(收款人名称:)"/>
  <ITEM LINE="14"  COL="5" TYPE="%-14s" FUNCTIONS="T(付款行名称:)"/>
  
  <ITEM LINE="16"  COL="5" TYPE="%-14s" FUNCTIONS="T(查询  附言:)"/>

  <ITEM   LINE="06" COL="17"  NAME="#L_PO_NO"   TYPE="%-16s"  DEVICE="KEYBOARD" FUNCTIONS="V(NB)"/> <!--2011-4-15 --> 
  <ITEM   NAME="#PO_NO"   TYPE="%8d"  FUNCTIONS="T(#L_PO_NO,9,8)"/>			<!--2011-4-15 -->

  <ITEM   LINE="06" COL="54" NAME="#AC_BR_NO" TYPE="%-12s"   DEVICE="KEYBOARD" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
  "{
    dim @bank_type as string;
    
    enable(#PAY_AC_NO,true);
    enable(#CASH_AC_NO,true);
    initfd();
    $FD32=#AC_BR_NO;
    commsend_001();
    $FD16='9553';
    callserver();
    if($FD12!='0000')
    {
        showmsg(geterror());
        return(false);
    }
    showhelp(3,70,8,3,'支付系统行名信息',substr($FD96,0,60));
    
    @bank_type = substr(#AC_BR_NO,0,3);
    if(@bank_type=='103')
    {
    	showmsg('发给农行交易，暂不输入持票帐号收款帐号，键回车继续......');
    	enable(#PAY_AC_NO,false);
    	enable(#CASH_AC_NO,false);
    }
  	}"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM   NAME="#PAY_OPN_BR_NO"   TYPE="%-12s"  FUNCTIONS=""/>
 <!---
  <ONLOSTFOCUS>
  "{
    initfd();
    commsend_001();
    $FD32=#PAY_OPN_BR_NO;
    
    $FD16='9553';
    $FD32 = #PAY_OPN_BR_NO;
    callserver();
    if($FD12!='0000')
    {
        showmsg(geterror());
        return(false);
    }
    showhelp(3,70,8,3,'支付系统行名信息',substr($FD96,0,60));
  	}"
  </ONLOSTFOCUS>
 
</ITEM>
----->
<!--
  <ITEM   LINE="07" COL="17"  NAME="#PAY_OPN_BR_NO"   TYPE="%-12s"  DEVICE="KEYBOARD" FUNCTIONS="V(NB)">
  <ONLOSTFOCUS>
  "{
	dim @sign_date as number;
	dim @po_no as string;
        initfd();
        commsend_001();
        commsend_123();
        $FD16 = '9560';
        callserver();
        if($FD12!='0000')
        {
                showmsg(geterror());
                return(false);
        }
	
	commrecv_123();

	@sign_date = val($FD46);
	#O_WT_DAY = $FD46;

	if(@sign_date==0)
	{
		showmsg('汇票还没有签发,不必查询');
		return (false);
	}
	#TX_AMT   = val(atoi($FD39)/100,0.01);

	

	initfd();
	commsend_001();
	$FD16 = '9553';
	$FD32 = #PAY_OPN_BR_NO;
	callserver();
	if($FD12!='0000')
	{
		showmsg(geterror());
		return (false);
	}
	#PAY_ADDR = substr($FD96,0,60);

	enable(#O_WT_DAY,	false);
	enable(#PAY_NAME,	false);
	enable(#CASH_NAME,	false);
	enable(#PAY_ADDR,	false);
	enable(#TX_AMT,		false);
	
	#NOTPAY_DATE = '';
	#AC_BR_NO	= '';

	enable(#NOTPAY_DATE,	true);
	enable(#AC_BR_NO,		true);


   }"
   </ONLOSTFOCUS>
  </ITEM>
--->
  <ITEM   LINE="07"  COL="17"  NAME="#O_WT_DAY"  	TYPE="%8s" DEVICE="KEYBOARD" FUNCTIONS="D()V(NB)"/>
  <ITEM   LINE="08"  COL="17"  NAME="#NOTPAY_DATE"  	TYPE="%8s" DEVICE="KEYBOARD" FUNCTIONS="D()V(NB)"/>
  
  <ITEM LINE="09" COL="17" NAME="#TX_AMT"  		TYPE="%16.2f"  DEVICE="KEYBOARD" FUNCTIONS=""/>
  <ITEM NAME="#UTX_AMT"  		TYPE="%21s"     FUNCTIONS="X(#TX_AMT)"/>
  <ITEM LINE="10" COL="17" NAME="#PAY_AC_NO"		DEVICE="KEYBOARD"	TYPE="%-32s"	FUNCTIONS=""/>
  <ITEM LINE="11" COL="17" NAME="#PAY_NAME"    		TYPE="%-60s"   DEVICE="KEYBOARD" FUNCTIONS=""/>
  <ITEM LINE="12" COL="17" NAME="#CASH_AC_NO"		DEVICE="KEYBOARD"	TYPE="%-32s"	FUNCTIONS=""/>
  <ITEM LINE="13" COL="17" NAME="#CASH_NAME"   		TYPE="%-60s"   DEVICE="KEYBOARD" FUNCTIONS=""/>
  <ITEM LINE="14" COL="17" NAME="#PAY_ADDR"    		TYPE="%-60s"   DEVICE="KEYBOARD" FUNCTIONS=""/>
  
  <ITEM LINE="16" COL="17" NAME="#T_CONTENT" LINES="2" COLS="40"  TYPE="%-80s"  DEVICE="KEYBOARD" FUNCTIONS="">
    <ONLOSTFOCUS>
  "{
  if (strfldcnt(#T_CONTENT,':') != 1 or strfldcnt(#T_CONTENT,'{') != 1 or strfldcnt(#T_CONTENT,'}') != 1)
  {
        showmsg('输入内容中不能含有半角:{}字符,请修改为全角其它字符');
        return(false);
  }
  }"
  </ONLOSTFOCUS>
  </ITEM>
  <ITEM  NAME="#NOTPAY_CONTENT" TYPE="%-255s"  FUNCTIONS="T(#T_CONTENT)"/>

  <ITEM LINE="21"  COL="65"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT" />
	 </VARIABLE>
<REQUEST>
</REQUEST>
<RESPONSE>
  <PACKAGE DEVICE="SCREEN" DESC="大额承兑汇票查询录入">
    NOTHING
  </PACKAGE>
  <PRINT>"{
   print(3,25, '大额承兑汇票查询录入');
   print(6,10, '委托日期:[8]',$HDATE);
   print(7,10, '交易序号:[8]',#ORDERNO);
   print(8,10, '查复行号:[12]',#AC_BR_NO);
   print(9,10, '汇票金额:[21]',#UTX_AMT);
   print(10,10, '查询内容:[56]',substr(#NOTPAY_CONTENT,0,56));
   print(11,19,'[58]',substr(#NOTPAY_CONTENT,56,58));
   print(12,19,'[58]',substr(#NOTPAY_CONTENT,114,58));
   print(13,19,'[38]',substr(#NOTPAY_CONTENT,172,38));
   print(14,19,'[45]',substr(#NOTPAY_CONTENT,210,45));
  
      }"
  </PRINT>
</RESPONSE>


<RESPONSE DEVICE="PRINTER" DESC="请打印业务专用凭证">
  <PACKAGE>
    NOTHING
  </PACKAGE>
  <PRINT>"{
   print(3,25, '大额承兑汇票查询录入');
   print(6,10, '委托日期:[8]',$HDATE);
   print(7,10, '交易序号:[8]',#ORDERNO);
   print(8,10, '查复行号:[12]',#AC_BR_NO);
   print(9,10, '汇票金额:[21]',#UTX_AMT);
   print(10,10, '查询内容:[56]',substr(#NOTPAY_CONTENT,0,56));
   print(11,19,'[58]',substr(#NOTPAY_CONTENT,56,58));
   print(12,19,'[58]',substr(#NOTPAY_CONTENT,114,58));
   print(13,19,'[38]',substr(#NOTPAY_CONTENT,172,38));
   print(14,19,'[45]',substr(#NOTPAY_CONTENT,210,45));
      }"
  </PRINT>
</RESPONSE>

</TRANSACTION>

