<?xml version="1.0" encoding="GBK" ?>
<TRANSACTION RIGHTS="11110000" TITLE="6804 贴现还款记账"
  xmlns="http://www.otd.org/MENU" xmlns:W3CNS="http://www.w3c.org">
<COMMSEND>"{
    initfd();
	commsend_001();
    $FD30=#ACNO;	//付款帐号
    $FD33=#INACNO;
    $FD40=getitems('#AMT'); /*发生额*/
    $FD60=#PNNO;
    $FD62=#PANO;
    $FD67=#ACTYPE;  /*0科目 1内部帐户 2对公活期帐户*/
    $FD68='2';      /*现转标志*/
    $FD15=space(4)+#KM; /*科目*/
    $FD89=#PZLX;     /*凭证类型*/
    $FD58=#PZH;      /*凭证号*/ 
    $FD90=#NOTYPE;
    $FD100=getitems('#TINT#AMT');
	$FD16='4914';
}"
</COMMSEND>
<COMMRECV>"{
	commrecv_001();
}"
</COMMRECV>
<VARIABLE>
  <ITEM LINE="3"  COL="3" TYPE="%-44s" FUNCTIONS=
    "T(6804                          贴现还款记账)"/>
  <ITEM LINE="4"  COL="3"  TYPE="%-74s" FUNCTIONS=
   "T(─────────────────────────────────────)"/>
  <ITEM NAME="#TXNO" TYPE="%-4s" FUNCTIONS="T($TXNO=4914)"/>
  <ITEM NAME="#MSGTYPE" TYPE="%-5s" FUNCTIONS="T($MSGTYPE=03001)"/>
  
  <ITEM LINE="6"  COL="10" TYPE="%-10s" FUNCTIONS="T(还款帐号:!)"/>
  <ITEM LINE="9"  COL="10" TYPE="%-10s" FUNCTIONS="T(凭证类型:)" />
  <ITEM LINE="10" COL="10" TYPE="%-10s" FUNCTIONS="T(凭 证 号：)" /> 
  <ITEM LINE="11"  COL="10" TYPE="%-10s" FUNCTIONS="T(贴现账号:)"/>
  <ITEM LINE="12"  COL="10" TYPE="%-14s" FUNCTIONS="T(贴现协议编号:)"/>
  
  <ITEM LINE="13"  COL="3" TYPE="%-74s" FUNCTIONS=
  "T(-----------------------------【回显信息】----------------------------------)"/>

  <ITEM LINE="15"  COL="10" TYPE="%-10s" FUNCTIONS="T(票据类型:!)"/>
  <ITEM LINE="16"  COL="10" TYPE="%-10s" FUNCTIONS="T(票 据 号:)"/>
  <ITEM LINE="17"  COL="10" TYPE="%-10s" FUNCTIONS="T(汇票金额:)"/>
  <ITEM LINE="18"  COL="10" TYPE="%-10s" FUNCTIONS="T(申 请 人:)"/>
  <ITEM LINE="19"  COL="10" TYPE="%-10s" FUNCTIONS="T(出 票 人:)"/>
  
  
  <!--输入变量-->
  <ITEM NAME="#ACTYPE" TYPE="%-2s" FUNCTIONS="" />
  <ITEM NAME="#KM"     TYPE="%-5s" FUNCTIONS="" />
  <ITEM NAME="#XZ"     TYPE="%-1s" FUNCTIONS="" />
  <ITEM NAME="#ACNO" LINE="6" COL="20" TYPE="%-19s"  INPUT="TEXT" FUNCTIONS="T()V(NB)"> 
  <ONLOSTFOCUS>
  "{
  
     //if($KINBR!='50901' and $KINBR!='10001')
     //{
     //		showmsg('没有权限做此交易!');
     //		return(false);
     //}
 
initfd();
    commsend_001();
    $FD16='9731';
    $FD102=#ACNO;
    callserver();
    if($FD12 != '0000'){
             showmsg(geterror());
             return(false);
    }
    #ACTYPE=$FD69;
    #ACNAME=$FD25;
    #YUE=val($FD39,0.01);
    show(#ACNAME,true);
    show(#YUE,true);
    if(#ACTYPE == '0')
        #KM=substr(#ACNO,0,5);
  }"
  </ONLOSTFOCUS>
 </ITEM>
  <ITEM LINE="7" COL="10" TYPE="%-10s"  FUNCTIONS="T(户    名:)" />
  <ITEM NAME="#ACNAME" LINE="7" COL="20" TYPE="%-30s" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="T()" />
  <ITEM LINE="8" COL="10" TYPE="%-10s"  FUNCTIONS="T(余    额:)" />
  <ITEM NAME="#YUE" LINE="8" COL="20" TYPE="%17.2f" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="T()" />
 <ITEM NAME="#PZLX" LINE="9" COL="20" TYPE="%-3s" INPUT="SELECT" FUNCTIONS="T(299)" >
       <SELECT>
               <OPTION VALUE="001" TITLE="现金支票"/>
               <OPTION VALUE="299" TITLE="其它凭证"/>
       </SELECT>
  </ITEM>
 <ITEM NAME="#PZH" LINE="10" COL="20" TYPE="%-24s" INPUT="TEXT" FUNCTIONS=""/> 
  
  <ITEM NAME="#INACNO" LINE="11" COL="20" TYPE="%-24s"  INPUT="TEXT" FUNCTIONS="">
  <ONLOSTFOCUS>
  "{
		initfd();
    	commsend_001();
 		$FD16='9922';
		$FD33=#INACNO;
		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		#INACNO=$FD33;
		#PNNO=$FD60;
		#PANO=$FD62;
		#NOTYPE=$FD90;
		#MSG=$FD96;
		setitems('#TINT#AMT',$FD100);
		show(#PANO,true);
		show(#NOTYPE,true);
		show(#PNNO,true);
		show(#AMT,true);
		show(#MSG,true);
		show(#CPR,true);
		show(#SQR,true);
 }"
 </ONLOSTFOCUS>
 </ITEM>
 <ITEM NAME="#PANO" LINE="12" COL="20" TYPE="%-20s"  INPUT="TEXT" FUNCTIONS="">
 <ONLOSTFOCUS>
 "{
		initfd();
    	commsend_001();
 		$FD16='9926';
		$FD62=#PANO;
		callserver();
		if($FD12!='0000'){
			showmsg(geterror());
			return(false);
		}
		#INACNO=$FD33;
//		showmsg($FD26);
//		showmsg($FD27);
		#PNNO=$FD60;
		#PANO=$FD62;
		#NOTYPE=$FD90;
		#MSG=$FD96;
#CPR=$FD26;
#SQR=$FD27;
		setitems('#TINT#AMT',$FD100);
		show(#INACNO,true);
		show(#NOTYPE,true);
		show(#PNNO,true);
		show(#AMT,true);
		show(#MSG,false);
		show(#CPR,true);
		show(#SQR,true);
 }"
 </ONLOSTFOCUS>
 </ITEM>
  
  <ITEM NAME="#NOTYPE" LINE="15" COL="20" TYPE="%-3s" ENABLE="FALSE" INPUT="SELECT" FUNCTIONS="T(111)">
  <SELECT>
		<OPTION VALUE="111" TITLE="银行承兑汇票"/>
		<OPTION VALUE="112" TITLE="商业承兑汇票"/>
	</SELECT>
	</ITEM>
  <ITEM NAME="#PNNO" LINE="16" COL="20" TYPE="%-16s" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="T()"/>
  <ITEM NAME="#AMT" LINE="17" COL="20" TYPE="%17.2f" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="T()"/>
  <ITEM NAME="#SQR" LINE="18" COL="20" TYPE="%-50s" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="T($FD26)"/>
  <ITEM NAME="#CPR" LINE="19" COL="20" TYPE="%-50s" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="T($FD27)"/>
 
  <ITEM NAME="#MSG" LINE="20" COL="10" TYPE="%-50s" ENABLE="FALSE" INPUT="TEXT" FUNCTIONS="T()"/>
  
  <ITEM NAME="#FBAL"  TYPE="%17.2f"  FUNCTIONS="E(#YUE-#AMT)J(#XFBAL)"/><!---交易后余额--->
  <ITEM NAME="#XFBAL" TYPE="%-21s"   FUNCTIONS="X(#FBAL)"/>
 
   <!------------一些没有用的变量,只是为了公共脚本执行时不报错------------>
  <ITEM NAME="#PASSWD" TYPE="%-6s" FUNCTIONS="T()"/>
  <ITEM NAME="#TINT"  TYPE="%17.2f" FUNCTIONS="T()"/>
  <ITEM LINE="21" COL="59"  TYPE="%-6s" FUNCTIONS="T(确  定)" INPUT="SUBMIT"/>
  <ITEM NAME="#YEAR"  TYPE="%-4s" FUNCTIONS="T($FD5,1,4)"/>
  <ITEM NAME="#MON"   TYPE="%-2s" FUNCTIONS="T($FD5,5,2)"/>
  <ITEM NAME="#DAY"   TYPE="%-2s" FUNCTIONS="T($FD5,7,2)"/>

  </VARIABLE>
<REQUEST>
</REQUEST>

<RESPONSE>
<PACKAGE DEVICE="SCREEN" DESC="贴现还款记账">
NOTHING
</PACKAGE>
 <PRINT>"{
	print( 5, 30,'贴现还款记账');
	print( 7, 20,'还款帐号: [19]',#ACNO);
	print( 8, 10,'还款户名:[30]',#ACNAME);
	print( 9, 20,'贴 现  账 号 : [24]',#INACNO);
	print(10, 20,'贴现协议编号 : [16]',#PANO);
 }"
</PRINT>
</RESPONSE>
<RESPONSE>
<PACKAGE DEVICE="PRINTER"  LINESPACE="24" DESC="打印普通凭证">
NOTHING
</PACKAGE>
 <PRINT>"{
	 dim @txtime  as string;
         @txtime=substr($SYSTIME,0,2)+':'+substr($SYSTIME,2,2)+':'+substr($SYSTIME,4,2);
         print( 5,20,'机构名称:[30]',$BRNAME);
         print( 5,2,'代码:6804');
         print( 5,13,'交易:贴现还款记账');
	 print( 7,20,'还款  帐号: [19]',#ACNO);
	 print( 8,20,'还款户  名: [30]',#ACNAME);
	 print(9, 20,'贴 现  账 号: [24]',#INACNO);
	 print(10,20,'贴现协议编号: [16]',#PANO);
	 printacdtl_1();
         print( 24,20,'备注:')
         print( 24,27,'交易日期:[8] [8]',$HDATE,@txtime);
         print( 24,5,'柜员:[4]',$FD7);
         print( 24,5,'流水号:[6]',$FD4);
}"
</PRINT>
</RESPONSE> 
</TRANSACTION>
