#!/bin/sh
cd $DBSDIR/sql
SUM=`ls *.sql|grep -c sql`
NUM=0
FILES=`ls *.sql|grep -v crview`
TMPFILE=/tmp/tmp.a
echo "我确定要重建全部数据库表(y/n):\c"
read yn

if [ "$yn" = "y" ] || [ "$yn" = "Y" ]
then
	echo "开始创建数据库表>>>"
else
	echo "正常退出."
	exit 0
fi

#exit 0

for FILE in $FILES crview.sql
do
	sql <$FILE >$TMPFILE
	ERR=`cat $TMPFILE|grep ERROR`
	if [ "$ERR" != "" ]
	then
		if [ "$1" != "force" ]
		then
			cat $TMPFILE
			rm -f $TMPFILE
			exit
		fi
	fi
	NUM=`expr $NUM + 1`
	printf "完成[%2d]%%,正在处理%25s...\r" `expr $NUM '*' 100 '/' $SUM` $FILE
done
rm -f $TMPFILE
