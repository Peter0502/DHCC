#!/bin/ksh
##################################################################
##  名称:loadtable                                              ##
##  功能:本shell用于将已经准备好的.dat数据文件导入相应的表中    ##
##       .dat文件各个字段值用分隔符'|'分开。                    ##
##  编者：Li JunXu                                              ##
##  日期: 2003.01.18                                            ##
##################################################################
if [ $# -ne 3 ]
then
	echo "usage:loadtable tablename username  password."
	exit 0
fi

TMPFILE=/tmp/tmp.a
##准备工作
echo "set heading off   " >/tmp/$1.colsql
echo "set pagesize 0" >>/tmp/$1.colsql
echo "set linesize 800  " >>/tmp/$1.colsql
echo "set feedback off  " >>/tmp/$1.colsql
echo "set tab off       " >>/tmp/$1.colsql
echo "select decode(column_name,'date','"'"'"date"'"'"','group','"'"'"group"'"'"','number','"'"'"number"'"'"',column_name)||',' from user_tab_columns where lower(table_name)='$1' order by column_id; " >> /tmp/$1.colsql

##产生ctl文件
echo "load data" >/tmp/$1.ctl
echo "infile *" >>/tmp/$1.ctl
echo "into table $1" >>/tmp/$1.ctl 
echo "fields terminated by '|'" >>/tmp/$1.ctl
echo `sqlplus -s $2/$3 < /tmp/$1.colsql` |sed "s/,$/)/g" |sed "s/^/(/g" >>/tmp/$1.ctl

##开始导入数据
echo "truncate table $1;" >/tmp/$1.sql
sqlplus $2/$3 < /tmp/$1.sql
sqlldr $2/$3 data=$1.dat control=/tmp/$1.ctl log=/tmp/$1.log
